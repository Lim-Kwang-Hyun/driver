cscope 15 /usr/src/dm-src/driver               0000529597
	@alloc.c

23 
	~<löux/buf„r_hód.h
>

24 
	~<löux/dm´ngöe.h
>

25 
	~<löux/øid/x‹.h
>

26 
	~<löux/øid/pq.h
>

27 
	~<löux/dm-kc›yd.h
>

28 
	~<löux/blkdev.h
>

29 
	~<löux/sched.h
>

30 
	~<löux/dñay.h
>

31 
	~<löux/¸c32.h
>

32 
	~<löux/gÂ.h
>

33 
	~<löux/øndom.h
>

34 
	~"èrgë.h
"

35 
	~"Æloc.h
"

36 
	~"mëad©a.h
"

37 
	~"d´m⁄.h
"

40 
	$mu…i_Æloˇt‹_öô
(
dm§c_su≥r
 *
su≥r
){

41 
i
, 
j
;

43 
i
 = 0;ò< 
NBUF
;i++){

44 
j
 = 0;j < 
MAX_CACHE_DEVS
;j++)

45 
	`•ö_lock_öô
(&
su≥r
->
ma
[
i
].
lock
[
j
]);

47 
su≥r
->
ma
[
i
].
row_cou¡
 = 
	`kmÆloc
((
©omic_t
Ë* 
CHUNK_SZ
, 
GFP_KERNEL
 | 
__GFP_ZERO
);

48 if(
su≥r
->
ma
[
i
].
row_cou¡
==
NULL
){

54 
	}
}

56 
	$mu…i_Æloˇt‹_deöô
(
dm§c_su≥r
 *
su≥r
){

57 
i
;

59 
i
 = 0;ò< 
NBUF
;i++){

60 
	`k‰ì
(
su≥r
->
ma
[
i
].
row_cou¡
);

62 
	}
}

64 
	$gë_num_em±y_chunks
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
){

65 
mu…i_Æloˇt‹
 *
ma
 = &
su≥r
->ma[
ˇche_ty≥
];

66 
cou¡
 = 0;

67 
i
;

69 
i
 = 0;ò< 
NUM_SSD
;i++){

70 if(
ma
->
£g_em±y_chunk_m≠
[
ˇche_ty≥
][
i
])

71 
cou¡
++;

73  
cou¡
;

74 
	}
}

76 
	$group_ª£rve_em±y_chunk
(
dm§c_su≥r
 *
su≥r
, 
u32
 
group_id
, 
ˇche_ty≥
){

77 
mu…i_Æloˇt‹
 *
ma
 = &
su≥r
->ma[
ˇche_ty≥
];

78 
i
;

79 
ª£rved_chunks
;

80 
group_hódî
 *
group
 = &
su≥r
->
group_hódî_¨øy
[
group_id
];

82 
i
 = 0;ò< 
NUM_SSD
;i++){

83 
ma
->
group_em±y_chunk_m≠
[
ˇche_ty≥
][
i
] = 0;

87 if(
	`is_wrôe_°rùe
(
ˇche_ty≥
Ë&& 
	`USE_ERASURE_CODE
(&
su≥r
->
∑øm
)){

88 
ma
->
group_em±y_chunk_m≠
[
ˇche_ty≥
][
	`gë_∑rôy_ssd
(
su≥r
, 
group_id
)] = 1;

92 if(
su≥r
->
∑øm
.
hŸ_idítifiˇti⁄
){

95 (
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_VERT
 ||

96 
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_HORI
)){

97 
ª£rved_chunks
 = 
NUM_SSD
 - 
	`ˇlc_√ed_num_ssds
(
su≥r
);

98 if(
ª£rved_chunks
==
NUM_DATA_SSD
){

100 
ª£rved_chunks
 = 
NUM_DATA_SSD
-1;

104 
ª£rved_chunks
 = 0;

108 (
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_VERT
 ||

109 
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_HORI
))

111 
ª£rved_chunks
 = 
NUM_SSD
 - 
	`ˇlc_√ed_num_ssds
(
su≥r
);

112 if(
ª£rved_chunks
==
NUM_DATA_SSD
){

114 
ª£rved_chunks
 = 
NUM_DATA_SSD
-1;

117 
ª£rved_chunks
 = 0;

131 if(
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_VERT
 ||

132 
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_HORI
){

133 
	`©omic_£t
(&
group
->
num_u£d_ssd
, 
NUM_SSD
 - 
ª£rved_chunks
);

134 
	`©omic_£t
(&
group
->
skewed_£gmít
, 1);

136 
	`BUG_ON
(1);

137 
	`©omic_£t
(&
group
->
num_u£d_ssd
, 
NUM_SSD
);

138 
	`©omic_£t
(&
group
->
skewed_£gmít
, 1);

141 
i
 = 0;ò< 
ª£rved_chunks
;i++){

142 
u32
 
ssdno
;

143 
	`gë_øndom_byãs
((*)&
ssdno
, (
u32
));

144 
ssdno
 = ssdnÿ% 
NUM_SSD
;

146 if(
ssdno
 =
	`gë_∑rôy_ssd
(
su≥r
, 
group_id
) ||

147 
ma
->
group_em±y_chunk_m≠
[
ˇche_ty≥
][
ssdno
] ){

148 
i
--;

151 
ma
->
group_em±y_chunk_m≠
[
ˇche_ty≥
][
ssdno
] = 1;

155 
	}
}

157 
	$ª£rve_em±y_chunk
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
, 
ˇche_ty≥
){

158 
mu…i_Æloˇt‹
 *
ma
 = &
su≥r
->ma[
ˇche_ty≥
];

159 
i
;

160 
ª£rved_chunks
;

162 
i
 = 0;ò< 
NUM_SSD
;i++){

163 
ma
->
£g_em±y_chunk_m≠
[
ˇche_ty≥
][
i
] = 0;

170 if(
	`is_wrôe_°rùe
(
ˇche_ty≥
Ë&& 
	`USE_ERASURE_CODE
(&
su≥r
->
∑øm
)){

171 
ma
->
£g_em±y_chunk_m≠
[
ˇche_ty≥
][
	`gë_∑rôy_ssd
(
su≥r
, 
£g_id
)] = 1;

175 if(
su≥r
->
∑øm
.
hŸ_idítifiˇti⁄
){

177 if(
ˇche_ty≥
 =
WHBUF
 &&

178 (
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_VERT
 ||

179 
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_HORI
)){

180 
	`BUG_ON
(1);

181 
ª£rved_chunks
 = 
NUM_SSD
 - 
	`ˇlc_√ed_num_ssds
(
su≥r
);

183 
ª£rved_chunks
 = 0;

186 if((
ˇche_ty≥
 =
WHBUF
||ˇche_ty≥==
WCBUF
||ˇche_ty≥==
GWBUF
) &&

187 (
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_VERT
 ||

188 
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_HORI
)){

189 
	`BUG_ON
(1);

190 
ª£rved_chunks
 = 
NUM_SSD
 - 
	`ˇlc_√ed_num_ssds
(
su≥r
);

192 
ª£rved_chunks
 = 0;

196 
i
 = 0;ò< 
ª£rved_chunks
;i++){

197 
u32
 
ssdno
;

198 
	`gë_øndom_byãs
((*)&
ssdno
, (
u32
));

199 
ssdno
 = ssdnÿ% 
NUM_SSD
;

201 if(
ssdno
 =
	`gë_∑rôy_ssd
(
su≥r
, 
£g_id
) ||

202 
ma
->
£g_em±y_chunk_m≠
[
ˇche_ty≥
][
ssdno
] ){

203 
i
--;

206 
ma
->
£g_em±y_chunk_m≠
[
ˇche_ty≥
][
ssdno
] = 1;

211 
	}
}

213 
	$ma_ª£t
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
, 
ˇche_ty≥
){

214 
mu…i_Æloˇt‹
 *
ma
 = &
su≥r
->ma[
ˇche_ty≥
];

215 
curs‹
;

216 
i
;

217 
chunk_off£t
;

218 
Êags
;

219 
∑rôy_ssd
;

220 
°rùe_size
 = 0;

223 
	`©omic_£t
(&
ma
->
tŸÆ_cou¡
, 0);

225 if(
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_VERT
 ||

226 
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_HORI
){

228 
i
 = 0;ò< 
NUM_SSD
;i++){

229 
ma
->
£g_em±y_chunk_m≠
[
ˇche_ty≥
][
i
] =

230 
ma
->
group_em±y_chunk_m≠
[
ˇche_ty≥
][
i
];

232 
∑rôy_ssd
 = 
	`gë_∑rôy_ssd
(
su≥r
, 
£g_id
/
SEGMENT_GROUP_SIZE
);

234 
	`ª£rve_em±y_chunk
(
su≥r
, 
£g_id
, 
ˇche_ty≥
);

235 
∑rôy_ssd
 = 
	`gë_∑rôy_ssd
(
su≥r
, 
£g_id
);

238 if(
∑rôy_ssd
>=0)

239 
	`©omic_£t
(&
ma
->
cur_dev
, 
∑rôy_ssd
);

241 
	`©omic_£t
(&
ma
->
cur_dev
, 0);

243 
chunk_off£t
 = 0;chunk_off£à< 
CHUNK_SZ
;chunk_offset++)

244 
	`©omic_£t
(&
ma
->
row_cou¡
[
chunk_off£t
], 0);

246 
i
 = 0;ò< 
NUM_SSD
;i++){

247 if(
ma
->
£g_em±y_chunk_m≠
[
ˇche_ty≥
][
i
]){

248 
	`©omic_£t
(&
ma
->
cou¡
[
i
], 
CHUNK_SZ
);

249 
	`©omic_add
(
CHUNK_SZ
, &
ma
->
tŸÆ_cou¡
);

251 
chunk_off£t
 = 0;chunk_off£à< 
CHUNK_SZ
;chunk_offset++)

252 
	`©omic_öc
(&
ma
->
row_cou¡
[
chunk_off£t
]);

257 
°rùe_size
 +
CHUNK_SZ
;

258 
	`•ö_lock_úqßve
(&
ma
->
lock
[
i
], 
Êags
);

259 
curs‹
 = 
i
 * 
CHUNK_SZ
 - 1;

260 
ma
->
curs‹
[
i
] = cursor;

261 
	`©omic_£t
(&
ma
->
cou¡
[
i
], 0);

262 
	`•ö_u∆ock_úqª°‹e
(&
ma
->
lock
[
i
], 
Êags
);

265 if(
	`is_wrôe_°rùe
(
ˇche_ty≥
Ë&& 
	`USE_ERASURE_CODE
(&
su≥r
->
∑øm
)){

266 
°rùe_size
 +
CHUNK_SZ
;

271  
°rùe_size
;

272 
	}
}

274 
u32
 
	$ma_£À˘_dev
(
dm§c_su≥r
 *
su≥r
, 
£˘‹_t
 
£˘‹
, 
ˇche_ty≥
){

275 
debug
 = 0;

276 
mu…i_Æloˇt‹
 *
ma
 = &
su≥r
->ma[
ˇche_ty≥
];

277 
cur_dev
 = 
	`©omic_ªad
(&
ma
->cur_dev);

278 
Æloˇti⁄_pﬁicy
 = 
su≥r
->
∑øm
.
d©a_Æloˇti⁄
;

280 if(
Æloˇti⁄_pﬁicy
==
DATA_ALLOC_HORI
 ||

281 
Æloˇti⁄_pﬁicy
==
DATA_ALLOC_FLEX_HORI
){

283 }if(
Æloˇti⁄_pﬁicy
==
DATA_ALLOC_VERT
 ||

284 
Æloˇti⁄_pﬁicy
==
DATA_ALLOC_FLEX_VERT
){

285 if(
	`©omic_ªad
(&
ma
->
cou¡
[
cur_dev
])<
CHUNK_SZ
)

286  
cur_dev
;

288 
	`BUG_ON
(1);

291 
Resˇn
:;

293 
cur_dev
 = (
	`©omic_ªad
(&
ma
->cur_devË+ 1Ë% 
NUM_SSD
;

294 
	`©omic_£t
(&
ma
->
cur_dev
, cur_dev);

296 
debug
++;

297 
	`BUG_ON
(
debug
>
NUM_SSD
);

299 if(
	`©omic_ªad
(&
ma
->
cou¡
[
cur_dev
])>=
CHUNK_SZ
){

301 
Resˇn
;

304  
cur_dev
;

305 
	}
}

307 
u32
 
	$ma_Æloc
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
u64
 
£g_id
, 
ˇche_ty≥
,

308 
devno
, 
u32
 *
cur_cou¡
){

309 
mu…i_Æloˇt‹
 *
ma
 = &
su≥r
->ma[
ˇche_ty≥
];

310 
Êags
;

311 
u32
 
curs‹
;

312 
u32
 
cou¡
;

314 
	`BUG_ON
(
devno
>=
NUM_SSD
);

316 
	`•ö_lock_úqßve
(&
ma
->
lock
[
devno
], 
Êags
);

317 
curs‹
 = ++(
ma
->curs‹[
devno
]);

319 
	`©omic_öc
(&
ma
->
cou¡
[
devno
]);

320 
	`©omic_öc
(&
ma
->
tŸÆ_cou¡
);

321 
	`BUG_ON
(
	`©omic_ªad
(&
ma
->
cou¡
[
devno
]Ë> 
CHUNK_SZ
);

323 
	`©omic_öc
(&
ma
->
row_cou¡
[
curs‹
 % 
CHUNK_SZ
]);

324 
cou¡
 = 
	`©omic_ªad
(&
ma
->
tŸÆ_cou¡
);

325 
	`•ö_u∆ock_úqª°‹e
(&
ma
->
lock
[
devno
], 
Êags
);

327 if(
cur_cou¡
)

328 *
cur_cou¡
 = 
cou¡
;

330 if(
devno
 !
	`©omic_ªad
(&
ma
->
cur_dev
))

331 
	`©omic_£t
(&
ma
->
cur_dev
, 
devno
);

333 if(
	`©omic_ªad
(&
ma
->
row_cou¡
[
curs‹
 % 
CHUNK_SZ
])> 
NUM_SSD
){

334 
	`¥ötk
("Ñow count ... \n");

336 
	`BUG_ON
(
	`©omic_ªad
(&
ma
->
row_cou¡
[
curs‹
 % 
CHUNK_SZ
])> 
NUM_SSD
);

337 if(
	`©omic_ªad
(&
ma
->
tŸÆ_cou¡
Ë> 
STRIPE_SZ
)

338 
	`¥ötk
("Åotal count .. \n");

340 
	`BUG_ON
(
	`©omic_ªad
(&
ma
->
tŸÆ_cou¡
Ë> 
STRIPE_SZ
);

348  
	`SEG_START_IDX
(
£g
Ë+ 
curs‹
;

349 
	}
}

351 
ölöe
 
u32
 
	$ma_gë_cou¡_≥r_dev
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
, 
devno
){

352  
	`©omic_ªad
(&
su≥r
->
ma
[
ˇche_ty≥
].
cou¡
[
devno
]);

353 
	}
}

355 
ölöe
 
u32
 
	$ma_gë_row_cou¡
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
, 
row
){

356  
	`©omic_ªad
(&
su≥r
->
ma
[
ˇche_ty≥
].
row_cou¡
[
row
]);

357 
	}
}

359 
ölöe
 
u32
 
	$ma_gë_‰ì
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
){

360 
i
;

361 
u32
 
‰ì_blocks
 = 0;

362 
u32
 
row_cou¡
 = 0;

364 
i
 = 0;ò< 
CHUNK_SZ
-
NUM_SUMMARY
;i++){

365 
row_cou¡
 = 
	`ma_gë_row_cou¡
(
su≥r
, 
ˇche_ty≥
, 
i
);

366 
‰ì_blocks
 +(
NUM_SSD
 - 
row_cou¡
);

368  
‰ì_blocks
;

369 
	}
}

371 
ölöe
 
u32
 
	$ma_gë_cou¡
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
){

372  
	`©omic_ªad
(&
su≥r
->
ma
[
ˇche_ty≥
].
tŸÆ_cou¡
);

373 
	}
}

375 
ölöe
 
	$ma_£t_cou¡
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
, 
cou¡
){

376 
	`©omic_£t
(&
su≥r
->
ma
[
ˇche_ty≥
].
tŸÆ_cou¡
, 
cou¡
);

377 
	}
}

384 
£˘‹_t
 
	$øid5_ˇlc_£˘‹
(
r5c⁄f
 *
c⁄f
, 
£˘‹_t
 
r_£˘‹
,

385 
¥evious
, *
dd_idx
, *
p_disk
, *
q_disk
)

387 
£˘‹_t
 
°rùe
, 
°rùe2
;

388 
£˘‹_t
 
chunk_numbî
;

389 
chunk_off£t
;

390 
pd_idx
, 
qd_idx
;

391 
ddf_œyout
 = 0;

392 
£˘‹_t
 
√w_£˘‹
;

393 
Æg‹ôhm
 = 
¥evious
 ? 
c⁄f
->
¥ev_Ægo


394 : 
c⁄f
->
Æg‹ôhm
;

395 
£˘‹s_≥r_chunk
 = 
¥evious
 ? 
c⁄f
->
¥ev_chunk_£˘‹s


396 : 
c⁄f
->
chunk_£˘‹s
;

397 
øid_disks
 = 
¥evious
 ? 
c⁄f
->
¥evious_øid_disks


398 : 
c⁄f
->
øid_disks
;

399 
d©a_disks
 = 
øid_disks
 - 
c⁄f
->
max_degøded
;

406 
chunk_off£t
 = 
	`£˘‹_div
(
r_£˘‹
, 
£˘‹s_≥r_chunk
);

407 
chunk_numbî
 = 
r_£˘‹
;

412 
°rùe
 = 
chunk_numbî
;

413 *
dd_idx
 = 
	`£˘‹_div
(
°rùe
, 
d©a_disks
);

414 
°rùe2
 = 
°rùe
;

418 
pd_idx
 = 
qd_idx
 = -1;

419 
c⁄f
->
Àvñ
) {

421 
pd_idx
 = 
d©a_disks
;

424 
Æg‹ôhm
) {

425 
ALGORITHM_LEFT_ASYMMETRIC
:

426 
pd_idx
 = 
d©a_disks
 - 
	`£˘‹_div
(
°rùe2
, 
øid_disks
);

427 i‡(*
dd_idx
 >
pd_idx
)

428 (*
dd_idx
)++;

430 
ALGORITHM_RIGHT_ASYMMETRIC
:

431 
pd_idx
 = 
	`£˘‹_div
(
°rùe2
, 
øid_disks
);

432 i‡(*
dd_idx
 >
pd_idx
)

433 (*
dd_idx
)++;

435 
ALGORITHM_LEFT_SYMMETRIC
:

436 
pd_idx
 = 
d©a_disks
 - 
	`£˘‹_div
(
°rùe2
, 
øid_disks
);

437 *
dd_idx
 = (
pd_idx
 + 1 + *dd_idxË% 
øid_disks
;

439 
ALGORITHM_RIGHT_SYMMETRIC
:

440 
pd_idx
 = 
	`£˘‹_div
(
°rùe2
, 
øid_disks
);

441 *
dd_idx
 = (
pd_idx
 + 1 + *dd_idxË% 
øid_disks
;

443 
ALGORITHM_PARITY_0
:

444 
pd_idx
 = 0;

445 (*
dd_idx
)++;

447 
ALGORITHM_PARITY_N
:

448 
pd_idx
 = 
d©a_disks
;

451 
	`BUG
();

456 
Æg‹ôhm
) {

457 
ALGORITHM_LEFT_ASYMMETRIC
:

458 
pd_idx
 = 
øid_disks
 - 1 - 
	`£˘‹_div
(
°rùe2
,Ñaid_disks);

459 
qd_idx
 = 
pd_idx
 + 1;

460 i‡(
pd_idx
 =
øid_disks
-1) {

461 (*
dd_idx
)++;

462 
qd_idx
 = 0;

463 } i‡(*
dd_idx
 >
pd_idx
)

464 (*
dd_idx
) += 2;

466 
ALGORITHM_RIGHT_ASYMMETRIC
:

467 
pd_idx
 = 
	`£˘‹_div
(
°rùe2
, 
øid_disks
);

468 
qd_idx
 = 
pd_idx
 + 1;

469 i‡(
pd_idx
 =
øid_disks
-1) {

470 (*
dd_idx
)++;

471 
qd_idx
 = 0;

472 } i‡(*
dd_idx
 >
pd_idx
)

473 (*
dd_idx
) += 2;

475 
ALGORITHM_LEFT_SYMMETRIC
:

476 
pd_idx
 = 
øid_disks
 - 1 - 
	`£˘‹_div
(
°rùe2
,Ñaid_disks);

477 
qd_idx
 = (
pd_idx
 + 1Ë% 
øid_disks
;

478 *
dd_idx
 = (
pd_idx
 + 2 + *dd_idxË% 
øid_disks
;

480 
ALGORITHM_RIGHT_SYMMETRIC
:

481 
pd_idx
 = 
	`£˘‹_div
(
°rùe2
, 
øid_disks
);

482 
qd_idx
 = (
pd_idx
 + 1Ë% 
øid_disks
;

483 *
dd_idx
 = (
pd_idx
 + 2 + *dd_idxË% 
øid_disks
;

486 
ALGORITHM_PARITY_0
:

487 
pd_idx
 = 0;

488 
qd_idx
 = 1;

489 (*
dd_idx
) += 2;

491 
ALGORITHM_PARITY_N
:

492 
pd_idx
 = 
d©a_disks
;

493 
qd_idx
 = 
d©a_disks
 + 1;

496 
ALGORITHM_ROTATING_ZERO_RESTART
:

500 
pd_idx
 = 
	`£˘‹_div
(
°rùe2
, 
øid_disks
);

501 
qd_idx
 = 
pd_idx
 + 1;

502 i‡(
pd_idx
 =
øid_disks
-1) {

503 (*
dd_idx
)++;

504 
qd_idx
 = 0;

505 } i‡(*
dd_idx
 >
pd_idx
)

506 (*
dd_idx
) += 2;

507 
ddf_œyout
 = 1;

510 
ALGORITHM_ROTATING_N_RESTART
:

515 
°rùe2
 += 1;

516 
pd_idx
 = 
øid_disks
 - 1 - 
	`£˘‹_div
(
°rùe2
,Ñaid_disks);

517 
qd_idx
 = 
pd_idx
 + 1;

518 i‡(
pd_idx
 =
øid_disks
-1) {

519 (*
dd_idx
)++;

520 
qd_idx
 = 0;

521 } i‡(*
dd_idx
 >
pd_idx
)

522 (*
dd_idx
) += 2;

523 
ddf_œyout
 = 1;

526 
ALGORITHM_ROTATING_N_CONTINUE
:

528 
pd_idx
 = 
øid_disks
 - 1 - 
	`£˘‹_div
(
°rùe2
,Ñaid_disks);

529 
qd_idx
 = (
pd_idx
 + 
øid_disks
 - 1) %Ñaid_disks;

530 *
dd_idx
 = (
pd_idx
 + 1 + *dd_idxË% 
øid_disks
;

531 
ddf_œyout
 = 1;

534 
ALGORITHM_LEFT_ASYMMETRIC_6
:

536 
pd_idx
 = 
d©a_disks
 - 
	`£˘‹_div
(
°rùe2
, 
øid_disks
-1);

537 i‡(*
dd_idx
 >
pd_idx
)

538 (*
dd_idx
)++;

539 
qd_idx
 = 
øid_disks
 - 1;

542 
ALGORITHM_RIGHT_ASYMMETRIC_6
:

543 
pd_idx
 = 
	`£˘‹_div
(
°rùe2
, 
øid_disks
-1);

544 i‡(*
dd_idx
 >
pd_idx
)

545 (*
dd_idx
)++;

546 
qd_idx
 = 
øid_disks
 - 1;

549 
ALGORITHM_LEFT_SYMMETRIC_6
:

550 
pd_idx
 = 
d©a_disks
 - 
	`£˘‹_div
(
°rùe2
, 
øid_disks
-1);

551 *
dd_idx
 = (
pd_idx
 + 1 + *dd_idxË% (
øid_disks
-1);

552 
qd_idx
 = 
øid_disks
 - 1;

555 
ALGORITHM_RIGHT_SYMMETRIC_6
:

556 
pd_idx
 = 
	`£˘‹_div
(
°rùe2
, 
øid_disks
-1);

557 *
dd_idx
 = (
pd_idx
 + 1 + *dd_idxË% (
øid_disks
-1);

558 
qd_idx
 = 
øid_disks
 - 1;

561 
ALGORITHM_PARITY_0_6
:

562 
pd_idx
 = 0;

563 (*
dd_idx
)++;

564 
qd_idx
 = 
øid_disks
 - 1;

568 
	`BUG
();

581 if(
p_disk
)

582 *
p_disk
 = 
pd_idx
;

584 if(
q_disk
)

585 *
q_disk
 = 
qd_idx
;

587 
√w_£˘‹
 = (
£˘‹_t
)
°rùe
 * 
£˘‹s_≥r_chunk
 + 
chunk_off£t
;

588  
√w_£˘‹
;

589 
	}
}

592 
	$ß_öô
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
, 
ˇche_ty≥
){

593 
sögÀ_Æloˇt‹
 *
ß
 = &
su≥r
->ß[
ˇche_ty≥
];

594 
curs‹
;

595 
Êags
;

597 
	`•ö_lock_úqßve
(&
ß
->
lock
, 
Êags
);

599 if(
su≥r
->
∑øm
->
d©a_Æloˇti⁄
==
DATA_ALLOC_VERT
){

600 
curs‹
 = 
	`curs‹_°¨t
(
su≥r
, 
£g_id
) - 1;

603 if(
su≥r
->
∑øm
->
∑rôy_Æloˇti⁄
==
PARITY_ALLOC_FIXED
)

604 
ß
->
cﬁ
 = 
NR_SSD
-1;

606 
ß
->
cﬁ
 = ((
£g_id
%
NR_SSD
) + (NR_SSD-1)) % NR_SSD;

608 
ß
->
row
 = -1;

610 
curs‹
 = 
	`curs‹_°¨t
(
su≥r
, 
£g_id
) - 1;

613 
ß
->
curs‹
 = cursor;

614 
	`©omic_£t
(&
ß
->
cou¡
, 0);

615 
	`•ö_u∆ock_úqª°‹e
(&
ß
->
lock
, 
Êags
);

618 
	}
}

620 
u32
 
	$ß_Æloc_h‹iz⁄èl
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
, 
ˇche_ty≥
){

621 
u32
 
cﬁ
, 
row
;

622 
u32
 
°¨t_ssd
;

623 
u32
 
∑rôy_ssd
;

624 
u32
 
√xt
;

626 
°¨t_ssd
 = 
	`gë_°¨t_ssd
(
su≥r
, 
£g_id
);

628 
cﬁ
 = 
su≥r
->
ß
[
ˇche_ty≥
].col;

629 
row
 = 
su≥r
->
ß
[
ˇche_ty≥
].row;

630 
cﬁ
 = (cﬁ + 1Ë% 
NR_SSD
;

632 if(
	`USE_ERASURE_CODE
(
su≥r
->
∑øm
)){

634 
∑rôy_ssd
 = 
	`gë_∑rôy_ssd
(
su≥r
, 
£g_id
);

636 if(
cﬁ
==
∑rôy_ssd
 ||

637 (
su≥r
->
∑øm
->
îasuª_code
==
ERASURE_CODE_RAID6
 &&

638 
cﬁ
 =(
∑rôy_ssd
+1)%
NR_SSD
)){

639 
cﬁ
!=
°¨t_ssd
){

640 
cﬁ
 = (cﬁ + 1Ë% 
NR_SSD
;

645 if(
cﬁ
==
°¨t_ssd
)

646 
row
++;

648 
√xt
 = 
cﬁ
 * 
CHUNK_SZ
 + 
row
;

649 
√xt
 %
STRIPE_SZ
;

651 
su≥r
->
ß
[
ˇche_ty≥
].
cﬁ
 = col;

652 
su≥r
->
ß
[
ˇche_ty≥
].
row
 =Ñow;

653  
√xt
;

654 
	}
}

657 
u32
 
	$ß_Æloc
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
u64
 
£g_id
, 
ˇche_ty≥
, 
u32
 *
cur_cou¡
){

658 
sögÀ_Æloˇt‹
 *
ß
 = &
su≥r
->ß[
ˇche_ty≥
];

659 
Êags
;

660 
u32
 
√xt
;

661 
u32
 
idx
;

662 
u32
 
cou¡
;

664 
	`•ö_lock_úqßve
(&
ß
->
lock
, 
Êags
);

666 if(
su≥r
->
∑øm
->
d©a_Æloˇti⁄
==
DATA_ALLOC_VERT
)

667 
	`div_u64_ªm
(
su≥r
->
ß
[
ˇche_ty≥
].
curs‹
 + 1, 
NR_CACHES_INSEG
, &
√xt
);

669 
√xt
 = 
	`ß_Æloc_h‹iz⁄èl
(
su≥r
, 
£g_id
, 
ˇche_ty≥
);

671 
su≥r
->
ß
[
ˇche_ty≥
].
curs‹
 = 
√xt
;

673 
	`©omic_öc
(&
su≥r
->
ß
[
ˇche_ty≥
].
cou¡
);

674 
cou¡
 = 
	`©omic_ªad
(&
su≥r
->
ß
[
ˇche_ty≥
].count);

675 if(
cur_cou¡
)

676 *
cur_cou¡
 = 
cou¡
;

677 
	`BUG_ON
(
cou¡
 > 
NR_CACHES_INSEG
);

679 
idx
 = 
	`SEG_START_IDX
(
£g
Ë+ 
su≥r
->
ß
[
ˇche_ty≥
].
curs‹
;

680 
	`•ö_u∆ock_úqª°‹e
(&
ß
->
lock
, 
Êags
);

687  
idx
;

688 
	}
}

690 
ölöe
 
u32
 
	$ß_gë_cou¡
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
){

691  
	`©omic_ªad
(&
su≥r
->
ß
[
ˇche_ty≥
].
cou¡
);

692 
	}
}

	@alloc.h

23 #i‚de‡
DM_ALLOC_H


24 
	#DM_ALLOC_H


	)

32 
	#ALGORITHM_LEFT_ASYMMETRIC
 0

	)

33 
	#ALGORITHM_RIGHT_ASYMMETRIC
 1

	)

34 
	#ALGORITHM_LEFT_SYMMETRIC
 2

	)

35 
	#ALGORITHM_RIGHT_SYMMETRIC
 3

	)

40 
	#ALGORITHM_PARITY_0
 4

	)

41 
	#ALGORITHM_PARITY_N
 5

	)

55 
	#ALGORITHM_ROTATING_ZERO_RESTART
 8

	)

56 
	#ALGORITHM_ROTATING_N_RESTART
 9

	)

57 
	#ALGORITHM_ROTATING_N_CONTINUE
 10

	)

65 
	#ALGORITHM_LEFT_ASYMMETRIC_6
 16

	)

66 
	#ALGORITHM_RIGHT_ASYMMETRIC_6
 17

	)

67 
	#ALGORITHM_LEFT_SYMMETRIC_6
 18

	)

68 
	#ALGORITHM_RIGHT_SYMMETRIC_6
 19

	)

69 
	#ALGORITHM_PARITY_0_6
 20

	)

70 
	#ALGORITHM_PARITY_N_6
 
ALGORITHM_PARITY_N


	)

74 
mu…i_Æloˇt‹_öô
(
dm§c_su≥r
 *
su≥r
);

75 
ma_ª£t
(
dm§c_su≥r
 *
wb
, 
u64
 
£g_id
, 
ˇche_ty≥
);

76 
u32
 
ma_Æloc
(
dm§c_su≥r
 *
wb
, 
£gmít_hódî
 *
£g
, 
u64
 
£g_id
, 
ˇche_ty≥
,

77 
devno
, 
u32
 *
cur_cou¡
);

78 
u32
 
ma_£À˘_dev
(
dm§c_su≥r
 *
wb
, 
£˘‹_t
 
£˘‹
, 
ˇche_ty≥
);

79 
u32
 
ma_gë_cou¡
(
dm§c_su≥r
 *
wb
, 
ˇche_ty≥
);

80 
ma_£t_cou¡
(
dm§c_su≥r
 *
wb
, 
ˇche_ty≥
, 
cou¡
);

82 
curs‹_°¨t
(
dm§c_su≥r
 *
wb
, 
u64
 
£g_id
);

83 
£˘‹_t
 
øid5_ˇlc_£˘‹
(
r5c⁄f
 *
c⁄f
, se˘‹_à
r_£˘‹
,

84 
¥evious
, *
dd_idx
, *
p_disk
, *
q_disk
);

85 
ölöe
 
u32
 
ma_gë_≥r_log_cou¡
(
dm§c_su≥r
 *
wb
, 
£˘‹_t
 
£˘‹
, 
ˇche_ty≥
);

86 
dev_°¨t
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
);

87 
gë_num_em±y_chunks
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
);

88 
ölöe
 
u32
 
ma_gë_cou¡_≥r_dev
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
, 
devno
);

89 
mu…i_Æloˇt‹_deöô
(
dm§c_su≥r
 *
su≥r
);

90 
ölöe
 
u32
 
ma_gë_row_cou¡
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
, 
row
);

91 
group_ª£rve_em±y_chunk
(
dm§c_su≥r
 *
su≥r
, 
u32
 
group_id
, 
ˇche_ty≥
);

92 
ölöe
 
u32
 
ma_gë_‰ì
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
);

	@daemon.c

23 
	~<löux/dm-kc›yd.h
>

24 
	~<löux/øid/x‹.h
>

25 
	~<löux/li°_s‹t.h
>

26 
	~<löux/¸c32.h
>

27 
	~"èrgë.h
"

28 
	~"mëad©a.h
"

29 
	~"d´m⁄.h
"

30 
	~"Æloc.h
"

31 
	~"Ãu.h
"

34 
	$Êush_∂ug_¥oc
(
dm§c_su≥r
 *
su≥r
,

35 
£gmít_hódî
 *
£g
,

36 
ømbuf„r
 *
ømbuf
,

37 
©omic_t
 *
bios_°¨t
,

38 
©omic_t
 *
bios_cou¡
,

39 
f‹˚
,

40 
devno
,

41 
Êush_comm™d
){

43 
wb_job
 *
job
;

44 
cou¡
 = 0;

45 
i
;

46 
u32
 
°¨t_idx
;

49 
i
 = ()
	`©omic_ªad
(&
bios_°¨t
[
devno
]);

50 
i
 < ()
	`©omic_ªad
(&
bios_cou¡
[
devno
]);

51 
i
++)

53 
u32
 
idx
 = (u32)
£g
->
£g_id
 * 
STRIPE_SZ
 + 
devno
 * 
CHUNK_SZ
 + 
i
;

54 
bio
 *biÿ
ømbuf
->
bios
[
idx
 % 
STRIPE_SZ
];

55 
mëablock
 *
mb
 = 
	`mb_©
(
su≥r
, 
idx
);

57 if(
bio
){

58 
	`©omic_öc
(&
su≥r
->
ˇche_°©
.
tŸÆ_bios2
);

59 
	`©omic_öc
(&
£g
->
bios_cou¡
);

61 if(!
	`ã°_bô
(
MB_SKIP
, &
mb
->
mb_Êags
)){

65 
	`¥ötk
(" mb skipÇot support ...\n");

66 
	`BUG_ON
(1);

67 if(
	`©omic_dec_™d_ã°
(&
ømbuf
->
ªf_cou¡
)){

68 
	`¥ötk
(" >>>Ö¨tü»wrôebackÉnd seg id %d \n", ()
£g
->
£g_id
);

69 
	`ªÀa£_ømbuf„r
(
su≥r
, 
ømbuf
, 
£g
->
£g_ty≥
);

75 
°¨t_idx
 = (
u32
)
£g
->
£g_id
 * 
STRIPE_SZ
 + 
devno
 * 
CHUNK_SZ
 + 
	`©omic_ªad
(&
bios_°¨t
[devno]);

76 
cou¡
 = 
	`©omic_ªad
(&
bios_cou¡
[
devno
]Ë-átomic_ªad(&
bios_°¨t
[devno]);

79 #i‡(
USE_SEG_WRITER
 == 0)

80 if(
cou¡
){

81 
job
 = 
	`wrôeback_make_job_exã¡
(
su≥r
, 
£g
, 
ømbuf
, 
°¨t_idx
, 
cou¡
);

82 
job
->
Êush_comm™d
 = flush_command;

83 
	`wrôeback_issue_job_exã¡
(
su≥r
, 
job
, 
Êush_comm™d
);

86 if(
cou¡
){

87 
£g_wrôe_m™agî
 *
£g_wrôe_mgr
 = &
su≥r
->£g_wrôe_mgr[
devno
];

88 
Êags
;

90 
job
 = 
	`wrôeback_make_job_exã¡
(
su≥r
, 
£g
, 
ømbuf
, 
°¨t_idx
, 
cou¡
);

91 
job
->
Êush_comm™d
 = flush_command;

93 
	`•ö_lock_úqßve
(&
£g_wrôe_mgr
->
•ölock
, 
Êags
);

94 
	`li°_add_èû
(&
job
->
li°
, &
£g_wrôe_mgr
->
hód
);

95 
	`©omic_öc
(&
£g_wrôe_mgr
->
cou¡
);

96 
	`•ö_u∆ock_úqª°‹e
(&
£g_wrôe_mgr
->
•ölock
, 
Êags
);

98 
	`queue_w‹k
(
£g_wrôe_mgr
->
wq
, &£g_wrôe_mgr->
w‹k
);

103  
cou¡
;

104 
	}
}

106 
	$queue_b¨rõr_io
(
dm§c_su≥r
 *
su≥r
, 
bio
 *bio)

108 
f
;

110 
	`•ö_lock_úqßve
(&
su≥r
->
≥ndög_mgr
.
b¨rõr_lock
, 
f
);

111 
	`bio_li°_add
(&
su≥r
->
≥ndög_mgr
.
b¨rõr_ios
, 
bio
);

112 
	`©omic_öc
(&
su≥r
->
≥ndög_mgr
.
b¨rõr_cou¡
);

113 
	`•ö_u∆ock_úqª°‹e
(&
su≥r
->
≥ndög_mgr
.
b¨rõr_lock
, 
f
);

115 
	}
}

117 
	$ªad_ˇŒback
(
îr‹
, *
c⁄ãxt
)

119 
ªad_ˇchög_job
 *
gn
 = 
c⁄ãxt
;

120 
dm§c_su≥r
 *
su≥r
 = 
gn
->
gn_su≥r
;

121 
ªad_miss_m™agî
 *
ªad_miss_mgr
 = &
su≥r
->read_miss_mgr;

122 
ªad_ˇchög_job_li°
 *
r_li°
 = &
ªad_miss_mgr
->
queue
;

123 
li°_hód
 *
c›y_hód
 = &
r_li°
->
rm_c›y_hód
;

124 
Êags
;

126 
gn
->
gn_bio_îr‹
 = 
îr‹
;

127 
su≥r
 = 
gn
->
gn_su≥r
;

129 
	`•ö_lock_úqßve
(&
r_li°
->
rm_•ölock
, 
Êags
);

130 
	`li°_add_èû
(&
gn
->
gn_li°
, 
c›y_hód
);

131 
	`©omic_öc
(&
r_li°
->
rm_c›y_cou¡
);

132 
	`•ö_u∆ock_úqª°‹e
(&
r_li°
->
rm_•ölock
, 
Êags
);

134 
	`queue_w‹k
(
ªad_miss_mgr
->
wq
, &ªad_miss_mgr->
w‹k
);

135 
	}
}

137 
	$m≠_ªgi⁄
(
dm_io_ªgi⁄
 *
io
, 
bio
 *bio)

139 
io
->
bdev
 =
bio
->
bi_bdev
;

140 
io
->
£˘‹
 = 
bio
->
bi_£˘‹
;

141 
io
->
cou¡
 = 
	`bio_£˘‹s
(
bio
);

142 
	}
}

144 
ölöe
 
ªad_ˇchög_job
 *
	$Æloc_ªad_ˇchög_job
(
dm§c_su≥r
 *
su≥r
){

145 
ªad_ˇchög_job
 *
gn
;

147 
gn
 = 
	`mempoﬁ_Æloc
(
su≥r
->
ªad_miss_mgr
.
job_poﬁ
, 
GFP_NOIO
);

148 i‡(!
gn
) {

149 
	`WBERR
();

150 
	`BUG_ON
(1);

151  
NULL
;;

154  
gn
;

155 
	}
}

157 
	$ªad_ˇchög_make_job
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
mëablock
 *
mb
, 
bio
 *bio, 
ømbuf„r
 *
ømbuf
)

159 
dm_io_ªgi⁄
 
io
;

160 
dm_io_ªque°
 
io_ªq
;

161 
ªad_ˇchög_job
 *
gn
;

163 
gn
 = 
	`Æloc_ªad_ˇchög_job
(
su≥r
);

164 
gn
->
gn_£˘‹
 = 
bio
->
bi_£˘‹
;

165 
gn
->
gn_bio
 = 
bio
;

166 
gn
->
gn_£g
 = 
£g
;

167 
gn
->
gn_mb
 = 
mb
;

168 
gn
->
gn_ømbuf
 = 
ømbuf
;

169 
gn
->
gn_su≥r
 = 
su≥r
;

171 
io_ªq
.
bi_rw
 = 
READ
,

172 
io_ªq
.
mem
.
ty≥
 = 
DM_IO_BVEC
,

173 
io_ªq
.
mem
.
±r
.
bvec
 = 
bio
->
bi_io_vec
 + bio->
bi_idx
,

174 
io_ªq
.
nŸify
.
‚
 = 
ªad_ˇŒback
,

175 
io_ªq
.
nŸify
.
c⁄ãxt
 = 
gn
,

176 
io_ªq
.
˛õ¡
 = 
su≥r
->
io_˛õ¡
,

177 
	`m≠_ªgi⁄
(&
io
, 
bio
);

179 
	`BUG_ON
(
bio
->
bi_£˘‹
>=
su≥r
->
dev_öfo
.
‹igö_£˘‹s
);

181 
	`dm§c_io
(&
io_ªq
, 1, &
io
, 
NULL
);

182 
	}
}

184 
	$m‹e_w‹k
(
dm§c_su≥r
 *
su≥r
){

185 
ªad_ˇchög_job_li°
 *
r_li°
 = &
su≥r
->
ªad_miss_mgr
.
queue
;

187  
	`©omic_ªad
(&
r_li°
->
rm_c›y_cou¡
);

188 
	}
}

190 
	$c›y_ªad_ˇchög_d©a
(
dm§c_su≥r
 *
su≥r
){

191 
ªad_miss_m™agî
 *
ªad_miss_mgr
 = &
su≥r
->read_miss_mgr;

192 
ªad_ˇchög_job_li°
 *
r_li°
 = &
ªad_miss_mgr
->
queue
;

193 
li°_hód
 *
c›y_hód
 = &
r_li°
->
rm_c›y_hód
;

194 
ªad_ˇchög_job
 *
gn
, *
ãmp
;

195 
li°_hód
 
loˇl_hód
;

197 
Êags
;

199 
cou¡
;

201 
cou¡
 = 
	`©omic_ªad
(&
r_li°
->
rm_c›y_cou¡
);

202 if(!
cou¡
)

205 
	`INIT_LIST_HEAD
(&
loˇl_hód
);

207 
	`•ö_lock_úqßve
(&
r_li°
->
rm_•ölock
, 
Êags
);

208 
	`li°_f‹_óch_íåy_ß„
(
gn
, 
ãmp
, 
c›y_hód
, 
gn_li°
){

209 
	`li°_dñ
(&
gn
->
gn_li°
);

210 
	`li°_add
(&
gn
->
gn_li°
, &
loˇl_hód
);

211 
	`©omic_dec
(&
r_li°
->
rm_c›y_cou¡
);

213 
	`•ö_u∆ock_úqª°‹e
(&
r_li°
->
rm_•ölock
, 
Êags
);

215 
	`li°_f‹_óch_íåy_ß„
(
gn
, 
ãmp
, &
loˇl_hód
, 
gn_li°
){

216 
ˇche_m™agî
 *
˛ón_ˇche
 = 
su≥r
->
˛ón_døm_ˇche_m™agî
;

217 
Ãu_node
 *
 
 = 
NULL
;

218 
Ãu_Êags
;

219 
£˘‹_t
 
key
;

220 
u32
 
¸c32
;

221 *
§c_±r
, *
d°_±r
;

224 
§c_±r
 = 
	`∑ge_addªss
(
	`bio_∑ge
(
gn
->
gn_bio
));

225 
¸c32
 = 
	`¸c32
(17, 
§c_±r
, 
PAGE_SIZE
);

228 
key
 = 
	`ˇlc_ˇche_Æignmít
(
su≥r
, 
gn
->
gn_bio
->
bi_£˘‹
);

232 
	`•ö_lock_úqßve
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

233 
 
 = 
	`CACHE_SEARCH
(
˛ón_ˇche
, 
key
);

234 if(
 
){

235 
	`©omic_£t
(&
 
->
locked
, 1);

236 
	`•ö_u∆ock_úqª°‹e
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

238 
d°_±r
 = 
	`∑ge_addªss
(
 
->
˙_∑ge
);

239 
	`mem˝y
(
d°_±r
, 
§c_±r
, 
SRC_PAGE_SIZE
);

241 
	`•ö_lock_úqßve
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

242 
	`©omic_£t
(&
 
->
locked
, 0);

243 
 
->
¸c32
 = crc32;

244 
	`©omic_£t
(&
 
->
£Æed
, 1);

245 
	`©omic_öc
(&
˛ón_ˇche
->
cm_£Æed_cou¡
);

251 
	`•ö_u∆ock_úqª°‹e
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

253 
	`bio_ídio
(
gn
->
gn_bio
, 0);

254 
	`mempoﬁ_‰ì
(
gn
, 
ªad_miss_mgr
->
job_poﬁ
);

255 
gn
 = 
NULL
;

257 
	}
}

260 
	$£g_wrôe_w‹kî
(
w‹k_°ru˘
 *
w‹k
){

261 
£g_wrôe_m™agî
 *
£g_wrôe_mgr
 =

262 
	`c⁄èöî_of
(
w‹k
, 
£g_wrôe_m™agî
,

263 
w‹k
);

264 
dm§c_su≥r
 *
su≥r
 = 
£g_wrôe_mgr
->super;

265 
Êags
;

266 
wb_job
 *
job
;

268 
	`©omic_ªad
(&
£g_wrôe_mgr
->
cou¡
)){

269 
	`•ö_lock_úqßve
(&
£g_wrôe_mgr
->
•ölock
, 
Êags
);

270 
job
 = (
wb_job
 *)

271 
	`li°_íåy
(
£g_wrôe_mgr
->
hód
.
√xt
, 
wb_job
, 
li°
);

272 
	`li°_dñ
(&
job
->
li°
);

273 
	`©omic_dec
(&
£g_wrôe_mgr
->
cou¡
);

274 
	`•ö_u∆ock_úqª°‹e
(&
£g_wrôe_mgr
->
•ölock
, 
Êags
);

275 
	`wrôeback_issue_job_exã¡
(
su≥r
, 
job
, job->
Êush_comm™d
);

277 
	}
}

279 
	$do_ªad_ˇchög_w‹kî
(
w‹k_°ru˘
 *
w‹k
){

280 
ªad_miss_m™agî
 *
ªad_miss_mgr
 =

281 
	`c⁄èöî_of
(
w‹k
, 
ªad_miss_m™agî
,

282 
w‹k
);

283 
dm§c_su≥r
 *
su≥r
 = 
ªad_miss_mgr
->super;

285 
	`m‹e_w‹k
(
su≥r
)){

286 
	`c›y_ªad_ˇchög_d©a
(
su≥r
);

287 if(
	`√ed_˛ón_£g_wrôe
(
su≥r
)) {

290 
	`≥ndög_w‹kî_scheduÀ
(
su≥r
);

293 
	}
}

295 
	$dm§c_bio_íd_Êush
(
bio
 *bio, 
îr
)

297 i‡(
îr
)

298 
	`˛ór_bô
(
BIO_UPTODATE
, &
bio
->
bi_Êags
);

299 i‡(
bio
->
bi_¥iv©e
)

300 
	`com∂ëe
(
bio
->
bi_¥iv©e
);

301 
	`bio_put
(
bio
);

302 
	}
}

316 
bio
 *
	$dm§c_blkdev_issue_Êush
(
block_devi˚
 *
bdev
, 
gÂ_t
 
gÂ_mask
,

317 
£˘‹_t
 *
îr‹_£˘‹
, 
com∂ëi⁄
 *
waô
)

319 
ªque°_queue
 *
q
;

320 
bio
 *bio;

322 i‡(
bdev
->
bd_disk
 =
NULL
)

323  
NULL
;

325 
q
 = 
	`bdev_gë_queue
(
bdev
);

326 i‡(!
q
)

327  
NULL
;

335 i‡(!
q
->
make_ªque°_‚
)

336  
NULL
;

338 
bio
 = 
	`bio_Æloc
(
gÂ_mask
, 0);

339 
bio
->
bi_íd_io
 = 
dm§c_bio_íd_Êush
;

340 
bio
->
bi_bdev
 = 
bdev
;

341 
bio
->
bi_¥iv©e
 = 
waô
;

343 
	`bio_gë
(
bio
);

344 
	`submô_bio
(
WRITE_FLUSH
, 
bio
);

345  
bio
;

347 
	}
}

349 
	$dm§c_blkdev_waô_Êush
(
bio
 *bio)

351 
com∂ëi⁄
 *
waô
 = 
bio
->
bi_¥iv©e
;

352 
ªt
;

354 
	`waô_f‹_com∂ëi⁄_io
(
waô
);

364 i‡(!
	`bio_Êagged
(
bio
, 
BIO_UPTODATE
))

365 
ªt
 = -
EIO
;

367 
	`bio_put
(
bio
);

368  
ªt
;

369 
	}
}

373 
	$issue_de„ºed_bio
(
dm§c_su≥r
 *
su≥r
, 
bio_li°
 *
b¨rõr_ios
){

374 
devi˚_öfo
 *
dev_öfo
 = &
su≥r
->dev_info;

375 
bio
 *bio;

376 
bio
 *
bios
[
MAX_CACHE_DEVS
];

377 
com∂ëi⁄
 
waô
[
MAX_CACHE_DEVS
];

378 
i
;

380 i‡(
	`bio_li°_em±y
(
b¨rõr_ios
)) {

384 (
bio
 = 
	`bio_li°_p›
(
b¨rõr_ios
))) {

385 
i
 = 0;ò< 
dev_öfo
->
num_ˇche_devs
;i++){

386 
	`öô_com∂ëi⁄
(&
waô
[
i
]);

387 
bios
[
i
] = 
	`dm§c_blkdev_issue_Êush
(
dev_öfo
->
ˇche_dev
[i]->
bdev
, 
GFP_KERNEL
, 
NULL
, &
waô
[i]);

388 if(!
bios
[
i
]){

393 
i
 = 0;ò< 
dev_öfo
->
num_ˇche_devs
;i++){

394 if(
bios
[
i
]){

395 
	`dm§c_blkdev_waô_Êush
(
bios
[
i
]);

400 
	`bio_ídio
(
bio
, 0);

403 
	}
}

407 
	$gí_∑πül_summ¨y_io
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
,

408 
ømbuf„r
 *
ømbuf
,

409 
summ¨y_io_job
 *
c⁄ãxt
){

411 
dm_io_ªque°
 
io_ªq
;

412 
dm_io_ªgi⁄
 
ªgi⁄
;

413 
u32
 
mem_off£t
 = 0;

414 
u32
 
tmp32
;

415 
u32
 
idx
;

418 
idx
 = 
	`curs‹_summ¨y_off£t
(
su≥r
, 
£g
->
£g_id
, seg->
£g_ty≥
);

420 
	`©omic_öc
(&(
c⁄ãxt
->
cou¡
));

422 
	`div_u64_ªm
(
idx
, 
STRIPE_SZ
, &
tmp32
);

423 
mem_off£t
 = 
tmp32
;

425 
ªgi⁄
.
bdev
 = 
	`gë_bdev
(
su≥r
, 
idx
);

426 
ªgi⁄
.
£˘‹
 = 
	`gë_£˘‹
(
su≥r
, 
£g
->
£g_id
, 
idx
);

427 
ªgi⁄
.
cou¡
 = 
SRC_SECTORS_PER_PAGE
;

429 
io_ªq
.
˛õ¡
 = 
su≥r
->
io_˛õ¡
;

430 
io_ªq
.
bi_rw
 = 
WRITE
;

431 
io_ªq
.
nŸify
.
‚
 = 
Êush_£gmd_ídio
;

432 
io_ªq
.
nŸify
.
c⁄ãxt
 = context;

433 
io_ªq
.
mem
.
ty≥
 = 
DM_IO_KMEM
;

434 
io_ªq
.
mem
.
±r
.
addr
 = 
ømbuf
->
∑ges
[
mem_off£t
]->
d©a
;

436 
	`dm§c_io
(&
io_ªq
, 1, &
ªgi⁄
, 
NULL
);

438 
	}
}

444 
	$waô_bufc›y_ios
(
£gmít_hódî
 *
£g
){

445 
u32
 
cou¡
 = 0;

446 
	`©omic_ªad
(&
£g
->
num_bufc›y
)){

447 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(
TIMEOUT_US
));

448 
cou¡
++;

449 if(
cou¡
==100000){

450 
	`¥ötk
(" WARN: wait bufcopy ios ... \n");

451 
cou¡
 = 0;

454 
	}
}

456 
	$waô_fûlög_ios
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
){

457 
u32
 
cou¡
 = 0;

458 
	`©omic_ªad
(&
£g
->
num_fûlög
)){

459 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(
TIMEOUT_US
));

460 
cou¡
++;

461 if(
cou¡
==100000){

462 
	`¥ötk
(" WARN: wait filling ios ... \n");

463 
cou¡
 = 0;

466 
	}
}

469 
	$Êush_mëa_¥oc
(*
d©a
)

471 
dm§c_su≥r
 *
su≥r
 = 
d©a
;

472 
Êush_m™agî
 *
Êush_mgr
 = &
su≥r
->flush_mgr;

473 
Êush_övoke_job
 *
job
;

474 
Êags
;

476 
åue
) {

478 
	`•ö_lock_úqßve
(&
Êush_mgr
->
lock
, 
Êags
);

479 
	`li°_em±y
(&
Êush_mgr
->
queue
)) {

480 
	`•ö_u∆ock_úqª°‹e
(&
Êush_mgr
->
lock
, 
Êags
);

481 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(10));

483 i‡(
	`kthªad_should_°›
())

486 
	`•ö_lock_úqßve
(&
Êush_mgr
->
lock
, 
Êags
);

489 
job
 = 
	`li°_fú°_íåy
(&
Êush_mgr
->
queue
, 
Êush_övoke_job
, 
li°
);

490 
	`li°_dñ
(&
job
->
li°
);

491 
	`•ö_u∆ock_úqª°‹e
(&
Êush_mgr
->
lock
, 
Êags
);

495 
	`waô_fûlög_ios
(
su≥r
, 
job
->
£g
);

497 
	`waô_bufc›y_ios
(
job
->
£g
);

499 
	`buûd_mëad©a
(
su≥r
,

500 
job
->
£g
,

501 
job
->
£g_Àngth
,

502 
job
->
ømbuf
,

503 
job
->
bios_°¨t
,

504 
job
->
bios_cou¡
,

505 
job
->
f‹˚_£Æ
,

506 
job
->
buûd_summ¨y
,

507 
job
->
Êush_d©a
);

509 
	`issue_de„ºed_bio
(
su≥r
, &
job
->
b¨rõr_ios
);

510 
	`©omic_dec
(&
Êush_mgr
->
övoke_cou¡
);

511 
	`mempoﬁ_‰ì
(
job
, 
Êush_mgr
->
övoke_poﬁ
);

513 
	`≥ndög_w‹kî_scheduÀ
(
su≥r
);

516 
	`¥ötk
(" finish meta flushÅhread ... \n");

518 
	}
}

521 
	$˛ónup_£gmít
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
)

523 
u32
 
i
;

525 
i
 = 0; i < 
STRIPE_SZ
; i++) {

526 
mëablock
 *
mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
i
);

527 
	`˛ónup_mb_if_dúty
(
su≥r
, 
£g
, 
mb
);

529 
	}
}

534 
	$föish_mig_w‹k
(
dm§c_su≥r
 *
su≥r
, 
mig_job
 *
job
, 
˛ónup
){

537 if(
	`is_wrôe_°rùe
(
£g
->
£g_ty≥
)){

538 if(
CHUNK_SZ
+
NUM_DATA_SSD
!=
	`©omic_ªad
(&
£g
->
vÆid_cou¡
)){

539 
	`¥ötk
(" Finish: migrating write seg = %d, valid count = %d cleanup = %d \n",

540 ()
£g
->
£g_id
, ()
	`©omic_ªad
(&£g->
vÆid_cou¡
), 
˛ónup
);

541 
	`¥ötk
(" valid count = %d, dirty count = %d \n",

542 
	`check_vÆid_cou¡
(
su≥r
, 
£g
),

543 
	`check_dúty_cou¡
(
su≥r
, 
£g
));

544 
	`¥ötk
(" u£ g¯%d \n", 
job
->
u£_gc
);

547 if(
NUM_SSD
!
	`©omic_ªad
(&
£g
->
vÆid_cou¡
)){

548 
	`¥ötk
(" Finish: migratingÑead seg = %d, valid count = %d cleanup = %d \n",

549 ()
£g
->
£g_id
, ()
	`©omic_ªad
(&£g->
vÆid_cou¡
), 
˛ónup
);

550 
	`¥ötk
(" valid count = %d, dirty count = %d \n",

551 
	`check_vÆid_cou¡
(
su≥r
, 
£g
),

552 
	`check_dúty_cou¡
(
su≥r
, 
£g
));

553 
	`¥ötk
(" u£ g¯%d \n", 
job
->
u£_gc
);

570 
	`BUG_ON
(
	`©omic64_ªad
(&
job
->
cou¡
));

571 
	`mempoﬁ_‰ì
(
job
, 
su≥r
->
migøã_mgr
.
mig_job_poﬁ
);

572 
	`©omic_öc
(&
su≥r
->
migøã_mgr
.
mig_com∂ëes
);

574 
	`≥ndög_w‹kî_scheduÀ
(
su≥r
);

575 
	}
}

578 
	$gë_mëad©a_cou¡
(
dm§c_su≥r
 *
su≥r
, 
£g_ty≥
){

579 
vÆid_cou¡
 = 0;

581 if(
	`is_wrôe_°rùe
(
£g_ty≥
)){

582 
vÆid_cou¡
 +
NUM_SUMMARY
*
NUM_DATA_SSD
;

583 if(
	`USE_ERASURE_PARITY
(&
su≥r
->
∑øm
))

584 
vÆid_cou¡
 +
CHUNK_SZ
;

586 
vÆid_cou¡
 +(
NUM_SUMMARY
*
NUM_SSD
);

589  
vÆid_cou¡
;

590 
	}
}

592 
	$gë_d©a_max_cou¡
(
dm§c_su≥r
 *
su≥r
, 
£g_ty≥
){

594  
STRIPE_SZ
 - 
	`gë_mëad©a_cou¡
(
su≥r
, 
£g_ty≥
);

595 
	}
}

597 
	$gë_d©a_vÆid_cou¡
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
){

598 
vÆid_cou¡
 = 0;

599 
group_hódî
 *
group
 = &
su≥r
->
group_hódî_¨øy
[
£g
->
£g_id
/
SEGMENT_GROUP_SIZE
];

601 if(
	`is_wrôe_°rùe
(
£g
->
£g_ty≥
)){

602 
u32
 
num_d©a_ssd
 = 
	`©omic_ªad
(&
group
->
num_u£d_ssd
)-1;

603 
vÆid_cou¡
 +
NUM_SUMMARY
*
num_d©a_ssd
;

604 if(
	`USE_ERASURE_PARITY
(&
su≥r
->
∑øm
))

605 
vÆid_cou¡
 +
CHUNK_SZ
;

607 
vÆid_cou¡
 +(
NUM_SUMMARY
*
NUM_SSD
);

610  
	`©omic_ªad
(&
£g
->
vÆid_cou¡
)-valid_count;

611 
	}
}

613 
	$is_em±y_£g
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
u£_gc
){

615 
vÆid_cou¡
 = 0;

616 
group_hódî
 *
group
 = &
su≥r
->
group_hódî_¨øy
[
£g
->
£g_id
/
SEGMENT_GROUP_SIZE
];

617 if(
u£_gc
){

618 if(
	`is_wrôe_°rùe
(
£g
->
£g_ty≥
)){

619 
u32
 
num_d©a_ssd
 = 
	`©omic_ªad
(&
group
->
num_u£d_ssd
)-1;

620 
vÆid_cou¡
 +
NUM_SUMMARY
*
num_d©a_ssd
;

621 if(
	`USE_ERASURE_PARITY
(&
su≥r
->
∑øm
))

622 
vÆid_cou¡
 +
CHUNK_SZ
;

624 
vÆid_cou¡
 +(
NUM_SUMMARY
*
NUM_SSD
);

627 if(
	`©omic_ªad
(&
£g
->
vÆid_cou¡
)<valid_count ||átomic_read(&seg->valid_count)!=valid_count){

629 
	`¥ötk
(" seg id = %dÅy≥ = %d vÆid = %d %d %d\n", ()
£g
->
£g_id
, seg->
£g_ty≥
, 
	`©omic_ªad
(&£g->
vÆid_cou¡
), vÆid_cou¡, 
	`ˇlc_mëa_cou¡
(
su≥r
, seg));

630 
	`BUG_ON
(
	`©omic_ªad
(&
£g
->
vÆid_cou¡
)<valid_count);

633 if(
	`©omic_ªad
(&
£g
->
vÆid_cou¡
)==valid_count)

636 if(
	`©omic_ªad
(&
£g
->
vÆid_dúty_cou¡
)==0)

640 if(
u£_gc
){

641 #ifde‡
NO_CLEAN_COPY


642 if(!
	`©omic_ªad
(&
£g
->
vÆid_dúty_cou¡
))

645 #ifde‡
HOT_DATA_COPY


646 if(!
	`©omic_ªad
(&
£g
->
vÆid_dúty_cou¡
)&&!©omic_ªad(&£g->
hŸ_˛ón_cou¡
))

649 if(!
	`©omic_ªad
(&
£g
->
vÆid_dúty_cou¡
)&&!©omic_ªad(&£g->
vÆid_˛ón_cou¡
))

654 if(!
	`©omic_ªad
(&
£g
->
vÆid_dúty_cou¡
))

661 
	}
}

664 
	$föish_kc›y_job
(
dm§c_su≥r
 *
su≥r
, 
c›y_job_group
 *
˝_job_group
){

666 
li°_hód
 *
kc›y_li°
 = &
˝_job_group
->
˝_hód
;

667 
ømbuf„r
 *
d°_ømbuf
 = 
˝_job_group
->dst_rambuf;

668 
c›y_job
 *
˝_job
, *
tmp
;

671 
summ¨y_cou¡
 = 0;

674 
	`li°_f‹_óch_íåy_ß„
(
˝_job
, 
tmp
, 
kc›y_li°
, 
˝_li°
){

675 if(
˝_job
->
§c_mb
==
NULL
&&
˝_job_group
->
rw
==
WRITE
){

676 if(
˝_job_group
->
gc
){

677 
	`li°_dñ
(&
˝_job
->
˝_li°
);

678 
	`£t_bô
(
MB_SEAL
, &
˝_job
->
d°_mb
->
mb_Êags
);

679 if(!
˝_job
->
§c_mb
 && 
	`©omic_dec_™d_ã°
(&
d°_ømbuf
->
ªf_cou¡
)){

682 
	`ªÀa£_ømbuf„r
(
su≥r
, 
˝_job_group
->
d°_ømbuf
, cp_job_group->
ˇche_ty≥
);

684 
	`BUG_ON
(
	`©omic_ªad
(&
d°_ømbuf
->
ªf_cou¡
)<0);

685 
	`mempoﬁ_‰ì
(
˝_job
, 
su≥r
->
migøã_mgr
.
c›y_job_poﬁ
);

686 
summ¨y_cou¡
++;

688 
	`¥ötk
(" invalid ... cp_job->gc\n");

689 
	`BUG_ON
(1);

695 
	`li°_f‹_óch_íåy_ß„
(
˝_job
, 
tmp
, 
kc›y_li°
, 
˝_li°
){

696 
£gmít_hódî
 *
d°_£g
 = 
NULL
, *
§c_£g
 = NULL;

698 
	`li°_dñ
(&
˝_job
->
˝_li°
);

699 if(!
˝_job
->
§c_mb
){

700 
	`¥ötk
(" summary data ... \n");

701 
	`BUG_ON
(1);

704 
§c_£g
 = 
	`gë_£g_by_mb
(
su≥r
, 
˝_job
->
§c_mb
);

705 
d°_£g
 = 
˝_job_group
->dst_seg;

707 if(
§c_£g
 && 
	`©omic_dec_™d_ã°
(&§c_£g->
num_migios
)){

708 
	`©omic_dec
(&
su≥r
->
migøã_mgr
.
mig_öÊights
);

710 if(
	`is_em±y_£g
(
su≥r
, 
§c_£g
)){

712 
	`föÆize_˛ón_£g
(
su≥r
, 
§c_£g
, 1);

714 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(10));

715 
	`¥ötk
("Çìd ch™gê°©ê...ÇŸÉm±y seg ... seg %d %d \n", ()
§c_£g
->
£g_id
,

716 
	`©omic_ªad
(&
§c_£g
->
vÆid_cou¡
));

720 if(
˝_job_group
->
gc
){

721 if(
˝_job
->
§c_mb
){

722 
	`upd©e_d©a_ö_mb
(
su≥r
, 
˝_job
->
d°_mb
->
idx
, 
d°_£g
, 
d°_ømbuf
, d°_£g->
£g_ty≥
, 
NULL
);

723 
	`©omic_dec
(&
d°_£g
->
num_fûlög
);

725 
	`£t_bô
(
MB_SEAL
, &
˝_job
->
d°_mb
->
mb_Êags
);

728 if(!
˝_job_group
->
gc
){

729 
	`‰ì_sögÀ_∑ge
(
su≥r
, 
˝_job
->
∑ge
);

733 
	`mempoﬁ_‰ì
(
˝_job
, 
su≥r
->
migøã_mgr
.
c›y_job_poﬁ
);

736 if(
˝_job_group
->
gc
)

737 
	`make_Êush_övoke_job
(
su≥r
, 
˝_job_group
->
d°_£g
, cp_job_group->
d°_ømbuf
, cp_job_group->
ˇche_ty≥
, 0, 0, 1);

739 
	`¥ötk
(" ### finish kcopy job ... \n");

746 
	}
}

750 
	$upd©e_summ¨y_block
(
dm§c_su≥r
 *
su≥r
, 
c›y_job_group
 *
˝_job_group
){

752 
li°_hód
 *
kc›y_li°
 = &
˝_job_group
->
˝_hód
;

753 
c›y_job
 *
˝_job
, *
tmp
;

754 
£gmít_hódî
 *
§c_£g
 = 
NULL
;

755 
f
;

756 
i
;

758 
	`li°_f‹_óch_íåy_ß„
(
˝_job
, 
tmp
, 
kc›y_li°
, 
˝_li°
){

759 if(
˝_job
->
§c_mb
==
NULL
&&
˝_job_group
->
rw
==
WRITE
)

762 
	`LOCK
(
su≥r
, 
f
);

763 
§c_£g
 = 
	`gë_£g_by_mb
(
su≥r
, 
˝_job
->
§c_mb
);

764 
	`övÆid©e_¥evious_ˇche
(
su≥r
, 
§c_£g
, 
˝_job
->
§c_mb
);

765 if(
˝_job_group
->
gc
){

766 
£˘‹_t
 
key
 = 
	`ˇlc_ˇche_Æignmít
(
su≥r
, 
˝_job
->
§c_mb
->
£˘‹
);

767 if(
key
==~0){

768 
	`¥ötk
(" invÆid se˘‹ = %d \n", ()
key
);

769 
	`BUG_ON
(1);

771 
	`ht_ªgi°î
(
su≥r
, 
key
, 
˝_job
->
d°_mb
);

772 
	`BUG_ON
(
˝_job
->
d°_mb
->
£˘‹
!=˝_job->
§c_mb
->sector);

774 
	`UNLOCK
(
su≥r
, 
f
);

777 if(
˝_job_group
->
gc
){

778 
i
 = 0;ò< 
NUM_SSD
;i++){

779 if(
	`USE_ERASURE_PARITY
(&
su≥r
->
∑øm
) &&

780 
i
 =
	`gë_∑rôy_ssd
(
su≥r
, 
˝_job_group
->
d°_£g
->
£g_id
) &&

781 
	`is_wrôe_°rùe
(
˝_job_group
->
d°_£g
->
£g_ty≥
))

784 
	`¥ï¨e_chunk_summ¨y
(
su≥r
, 
˝_job_group
->
d°_£g
, cp_job_group->
d°_ømbuf
->
∑ges
, 
i
,

785 
˝_job_group
->
d°_£g
->
£g_ty≥
);

788 
	}
}

791 
	$gíî©e_gc_wrôe
(
dm§c_su≥r
 *
su≥r
, 
c›y_job_group
 *
˝_job_group
){

792 
li°_hód
 *
kc›y_li°
 = &
˝_job_group
->
˝_hód
;

793 
c›y_job
 *
˝_job
, *
tmp
;

794 
£gmít_hódî
 *
§c_£g
 = 
NULL
;

795 
mëablock
 *
§c_mb
;

796 
f
;

797 
ˇche_ty≥
;

799 
	`li°_f‹_óch_íåy_ß„
(
˝_job
, 
tmp
, 
kc›y_li°
, 
˝_li°
){

800 
ˇche_ty≥
 = 
WCBUF
;

801 
§c_mb
 = 
˝_job
->src_mb;

803 
	`LOCK
(
su≥r
, 
f
);

805 
§c_£g
 = 
	`gë_£g_by_mb
(
su≥r
, 
§c_mb
);

806 if(
	`ã°_bô
(
MB_DIRTY
, &
§c_mb
->
mb_Êags
)){

807 if(
	`should_√ed_ª‰esh_£g
(
su≥r
, 
ˇche_ty≥
)){

808 
RETRY
:

809 if(
	`ˇn_gë_‰ì_£gmít
(
su≥r
, 
ˇche_ty≥
, 1)){

810 
	`Æloc_√w_£gmít
(
su≥r
, 
ˇche_ty≥
, 
Ál£
);

812 
	`UNLOCK
(
su≥r
, 
f
);

816 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(100));

817 
	`LOCK
(
su≥r
, 
f
);

818 
RETRY
;

823 
	`övÆid©e_¥evious_ˇche
(
su≥r
, 
§c_£g
, 
§c_mb
);

825 
	`wp_upd©e
(
su≥r
, 
WRITE
, 
REQ_CATEGORY_GC
);

827 if(!
	`ã°_bô
(
MB_DIRTY
, &
§c_mb
->
mb_Êags
)){

828 
	`¥ötk
(" WARN: No clean data copy ... \n");

831 
	`¥o˚ss_wrôe_ªque°
(
su≥r
, 
NULL
, 
˝_job
->
∑ge
->
∂
->∑ge, 
§c_mb
->
£˘‹
,

832 
	`ã°_bô
(
MB_DIRTY
, &
§c_mb
->
mb_Êags
), 
f
, 
ˇche_ty≥
, src_mb->
checksum
);

835 
ˇche_m™agî
 *
˛ón_ˇche
 = 
su≥r
->
˛ón_døm_ˇche_m™agî
;

836 
Ãu_node
 *
 
 = 
NULL
;

837 
Ãu_Êags
;

839 
	`•ö_lock_úqßve
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

840 
 
 = 
	`CACHE_SEARCH
(
˛ón_ˇche
, 
§c_mb
->
£˘‹
);

841 if(
 
){

842 
	`©omic_£t
(&
 
->
£Æed
, 1);

843 
	`©omic_£t
(&
 
->
locked
, 0);

844 
	`©omic_öc
(&
˛ón_ˇche
->
cm_£Æed_cou¡
);

846 
	`¥ötk
(" WARN: NÿD©®... %†\n", 
__FUNCTION__
);

848 
	`•ö_u∆ock_úqª°‹e
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

850 
	`UNLOCK
(
su≥r
, 
f
);

853 if(
	`©omic_dec_™d_ã°
(&
§c_£g
->
num_migios
)){

854 if(
	`is_em±y_£g
(
su≥r
, 
§c_£g
, 1)){

855 
	`©omic_dec
(&
su≥r
->
migøã_mgr
.
mig_öÊights
);

856 
	`föÆize_˛ón_£g
(
su≥r
, 
§c_£g
, 1);

858 
	`¥ötk
("Çìd ch™gê°©ê...ÇŸÉm±y seg ... seg %d (vÆid:ÅŸÆ %d, cÀ™ %d, dúty %d, seg_migøtög = %d \n", ()
§c_£g
->
£g_id
,

859 
	`©omic_ªad
(&
§c_£g
->
vÆid_cou¡
),

860 
	`©omic_ªad
(&
§c_£g
->
vÆid_˛ón_cou¡
),

861 
	`©omic_ªad
(&
§c_£g
->
vÆid_dúty_cou¡
),

862 
	`ã°_bô
(
SEG_MIGRATING
, &
§c_£g
->
Êags
));

863 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(1000));

867 
	`li°_dñ
(&
˝_job
->
˝_li°
);

868 
	`‰ì_sögÀ_∑ge
(
su≥r
, 
˝_job
->
∑ge
);

869 
	`©omic_dec
(&
su≥r
->
migøã_mgr
.
c›y_job_cou¡
);

870 
	`mempoﬁ_‰ì
(
˝_job
, 
su≥r
->
migøã_mgr
.
c›y_job_poﬁ
);

872 
	}
}

874 
	$gíî©e_de°age_wrôe
(
dm§c_su≥r
 *
su≥r
, 
c›y_job_group
 *
˝_job_group
){

875 
li°_hód
 *
kc›y_li°
 = &
˝_job_group
->
˝_hód
;

876 
c›y_job
 *
˝_job
, *
tmp
;

877 
£gmít_hódî
 *
§c_£g
 = 
NULL
;

878 
f
;

880 
	`li°_f‹_óch_íåy_ß„
(
˝_job
, 
tmp
, 
kc›y_li°
, 
˝_li°
){

882 
	`LOCK
(
su≥r
, 
f
);

883 
§c_£g
 = 
	`gë_£g_by_mb
(
su≥r
, 
˝_job
->
§c_mb
);

884 
	`övÆid©e_¥evious_ˇche
(
su≥r
, 
§c_£g
, 
˝_job
->
§c_mb
);

885 
	`UNLOCK
(
su≥r
, 
f
);

887 if(
	`©omic_dec_™d_ã°
(&
§c_£g
->
num_migios
)){

888 if(
	`is_em±y_£g
(
su≥r
, 
§c_£g
, 0)){

889 
	`©omic_dec
(&
su≥r
->
migøã_mgr
.
mig_öÊights
);

890 
	`föÆize_˛ón_£g
(
su≥r
, 
§c_£g
, 1);

893 
	`¥ötk
(" WARN: gíî©e_deßge_wrôe:Çìd ch™gê°©ê...ÇŸÉm±y seg ... seg %d %d, seg_migøtög = %d \n", ()
§c_£g
->
£g_id
,

894 
	`©omic_ªad
(&
§c_£g
->
vÆid_cou¡
), 
	`ã°_bô
(
SEG_MIGRATING
, &§c_£g->
Êags
));

895 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(1000));

899 
	`li°_dñ
(&
˝_job
->
˝_li°
);

900 
	`‰ì_sögÀ_∑ge
(
su≥r
, 
˝_job
->
∑ge
);

901 
	`©omic_dec
(&
su≥r
->
migøã_mgr
.
c›y_job_cou¡
);

902 
	`mempoﬁ_‰ì
(
˝_job
, 
su≥r
->
migøã_mgr
.
c›y_job_poﬁ
);

904 
	}
}

906 
	$do_mig_w‹kî
(
w‹k_°ru˘
 *
w‹k
){

907 
migøti⁄_m™agî
 *
migøã_mgr
 = 
	`c⁄èöî_of
(
w‹k
, migøti⁄_m™agî, 
mig_w‹k
);

908 
dm§c_su≥r
 *
su≥r
 = 
migøã_mgr
->super;

909 
c›y_job_group
 *
˝_job_gΩ
, *
˝_tmp
;

910 
li°_hód
 
loˇl_hód
;

912 
Êags
;

914 
	`INIT_LIST_HEAD
(&
loˇl_hód
);

916 
	`•ö_lock_úqßve
(&
migøã_mgr
->
group_queue_lock
, 
Êags
);

917 
	`li°_f‹_óch_íåy_ß„
(
˝_job_gΩ
, 
˝_tmp
, &
migøã_mgr
->
group_queue
, 
group_li°
) {

918 
	`li°_move_èû
(&
˝_job_gΩ
->
group_li°
, &
loˇl_hód
);

920 
	`•ö_u∆ock_úqª°‹e
(&
migøã_mgr
->
group_queue_lock
, 
Êags
);

922 
	`li°_f‹_óch_íåy_ß„
(
˝_job_gΩ
, 
˝_tmp
, &
loˇl_hód
, 
group_li°
) {

923 
	`li°_dñ
(&
˝_job_gΩ
->
group_li°
);

925 if(
˝_job_gΩ
->
gc
){

926 
	`gíî©e_gc_wrôe
(
su≥r
, 
˝_job_gΩ
);

927 
	`mempoﬁ_‰ì
(
˝_job_gΩ
, 
migøã_mgr
->
group_job_poﬁ
);

928 
	`©omic_dec
(&
migøã_mgr
->
group_job_cou¡
);

930 if(
˝_job_gΩ
->
rw
==
READ
){

931 
˝_job_gΩ
->
rw
 = 
WRITE
;

932 
	`Êush_kc›y_job
(
su≥r
, 
˝_job_gΩ
);

934 
	`gíî©e_de°age_wrôe
(
su≥r
, 
˝_job_gΩ
);

935 
	`mempoﬁ_‰ì
(
˝_job_gΩ
, 
migøã_mgr
->
group_job_poﬁ
);

936 
	`©omic_dec
(&
migøã_mgr
->
group_job_cou¡
);

941 if(
˝_job_gΩ
->
rw
==
READ
){

942 
˝_job_gΩ
->
rw
 = 
WRITE
;

943 
	`upd©e_summ¨y_block
(
su≥r
, 
˝_job_gΩ
);

944 
	`Êush_kc›y_job
(
su≥r
, 
˝_job_gΩ
, cp_job_gΩ->
ˇche_ty≥
, cp_job_gΩ->
cur_kc›yd
);

946 
	`föish_kc›y_job
(
su≥r
, 
˝_job_gΩ
);

947 
	`mempoﬁ_‰ì
(
˝_job_gΩ
, 
migøã_mgr
->
group_job_poﬁ
);

952 
	}
}

955 
	$c›y_com∂ëe
(
ªad_îr
, 
wrôe_îr
, *
__c⁄ãxt
)

957 
c›y_job
 *
˝_job
 = 
__c⁄ãxt
;

958 
mig_job
 *
mg_job
 = 
˝_job
->mg_job;

959 
dm§c_su≥r
 *
su≥r
 = 
mg_job
->
wb
;

960 
Êags
;

962 i‡(
ªad_îr
 || 
wrôe_îr
)

963 
mg_job
->
îr‹
 = 1;

965 
	`•ö_lock_úqßve
(&
su≥r
->
mig_queue_lock
, 
Êags
);

966 
	`li°_add_èû
(&
˝_job
->
˝_li°
, &
su≥r
->
c›y_queue
);

967 
	`•ö_u∆ock_úqª°‹e
(&
su≥r
->
mig_queue_lock
, 
Êags
);

969 
	`queue_w‹k
(
su≥r
->
mig_wq
, &
wb
->
mig_w‹k
);

971 
	}
}

975 
	$ª‰esh_gc_buf
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
, *
f
){

976 
£gmít_hódî
 *
d°_£g
;

977 
ømbuf„r
 *
ømbuf
;

980 
d°_£g
 = 
su≥r
->
cuºít_£g
[
ˇche_ty≥
];

981 
ømbuf
 = 
su≥r
->
£gbuf_mgr
.
cuºít_ømbuf
[
ˇche_ty≥
];

983 
	`UNLOCK
(
su≥r
, *
f
);

985 
	`¥ötk
("Ñefresh gc invoke job seg id = %d,Üength = %d \n",

986 ()
d°_£g
->
£g_id
, 
	`©omic_ªad
(&d°_£g->
Àngth
));

988 
	`make_Êush_övoke_job
(
su≥r
, 
d°_£g
, 
ømbuf
, 
ˇche_ty≥
, 0, 0);

992 
	`waô_ømbuf_evít
(
su≥r
, 
ˇche_ty≥
);

994 
	`¥ötk
("Ñambuf gc bufÉxits.. \n");

996 
	`BUG_ON
(!
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
öa˘ive_cou¡
));

997 
	`BUG_ON
(!
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
ª£rve_cou¡
));

999 
	`LOCK
(
su≥r
, *
f
);

1001 
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
öa˘ive_∑ge_cou¡
)<
STRIPE_SZ
){

1002 
	`UNLOCK
(
su≥r
, *
f
);

1003 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(10));

1005 
	`LOCK
(
su≥r
, *
f
);

1008 
	`Æloc_√w_£gmít
(
su≥r
, 
ˇche_ty≥
, 
åue
);

1009 
ømbuf
 = 
su≥r
->
£gbuf_mgr
.
cuºít_ømbuf
[
ˇche_ty≥
];

1010 
	`¥ötk
("Ñe‰esh GCÑe‡cou¡ = %d \n", 
	`©omic_ªad
(&
ømbuf
->
ªf_cou¡
));

1011 
	}
}

1015 
	$gc_job_d⁄e
(
îr‹
, *
c⁄ãxt
)

1017 
c›y_job_group
 *
˝_job_group
 = 
c⁄ãxt
;

1018 
dm§c_su≥r
 *
su≥r
 = 
˝_job_group
->super;

1019 
migøti⁄_m™agî
 *
migøã_mgr
 = &
su≥r
->migrate_mgr;

1020 
Êags
;

1022 if(
	`©omic_dec_™d_ã°
(&
˝_job_group
->
˝_job_cou¡
)){

1023 
	`•ö_lock_úqßve
(&
migøã_mgr
->
group_queue_lock
, 
Êags
);

1024 
	`li°_add_èû
(&
˝_job_group
->
group_li°
, &
migøã_mgr
->
group_queue
);

1025 
	`•ö_u∆ock_úqª°‹e
(&
migøã_mgr
->
group_queue_lock
, 
Êags
);

1026 
	`queue_w‹k
(
migøã_mgr
->
mig_wq
, &migøã_mgr->
mig_w‹k
);

1028 
	}
}

1031 
	$_Êush_kc›y_job
(
dm§c_su≥r
 *
su≥r
, 
c›y_job_group
 *
˝_job_group
, 
c›y_job
 *
˝_job
){

1032 
dm_io_ªque°
 
io_ªq
;

1034 
io_ªq
.
mem
.
ty≥
 = 
DM_IO_PAGE_LIST
;

1035 
io_ªq
.
mem
.
±r
.
∂

˝_job
->
∑ge
->pl;

1036 
io_ªq
.
mem
.
off£t
 = 0;

1037 
io_ªq
.
nŸify
.
‚
 = 
gc_job_d⁄e
;

1038 
io_ªq
.
nŸify
.
c⁄ãxt
 = 
˝_job_group
;

1039 
io_ªq
.
˛õ¡
 = 
su≥r
->
io_˛õ¡
;

1041 if(
˝_job_group
->
rw
==
READ
){

1042 
	`wp_upd©e
(
su≥r
, 
READ
, 
REQ_CATEGORY_GC
);

1043 
io_ªq
.
bi_rw
 = 
READ
;

1044 
	`dm§c_io
(&
io_ªq
, 1, &
˝_job
->
§c_ªgi⁄
, 
NULL
);

1046 
io_ªq
.
bi_rw
 = 
WRITE
;

1047 
	`©omic_öc
(&
su≥r
->
w°©
.
tŸÆ_migøti⁄
);

1048 
	`dm§c_io
(&
io_ªq
, 
˝_job
->
d°_cou¡
, cp_job->
d°_ªgi⁄
, 
NULL
);

1050 
	}
}

1053 
	$Êush_kc›y_job
(
dm§c_su≥r
 *
su≥r
, 
c›y_job_group
 *
˝_job_group
){

1054 
li°_hód
 *
kc›y_li°
 = &
˝_job_group
->
˝_hód
;

1055 
c›y_job
 *
˝_job
, *
tmp
;

1056 
blk_∂ug
 
∂ug
;

1057 
cou¡
 = 0;

1059 
	`li°_f‹_óch_íåy_ß„
(
˝_job
, 
tmp
, 
kc›y_li°
, 
˝_li°
){

1060 
	`©omic_öc
(&
˝_job_group
->
˝_job_cou¡
);

1061 
cou¡
++;

1064 if(!
	`©omic_ªad
(&
˝_job_group
->
˝_job_cou¡
)){

1065 
	`BUG_ON
(1);

1068 
	`blk_°¨t_∂ug
(&
∂ug
);

1069 
	`li°_f‹_óch_íåy_ß„
(
˝_job
, 
tmp
, 
kc›y_li°
, 
˝_li°
){

1070 
	`_Êush_kc›y_job
(
su≥r
, 
˝_job_group
, 
˝_job
);

1072 
	`blk_föish_∂ug
(&
∂ug
);

1073 
	}
}

1075 *
	$Æloc_c›y_job_group
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
){

1076 
c›y_job_group
 *
˝_job_group
;

1077 
migøti⁄_m™agî
 *
migøã_mgr
 = &
su≥r
->migrate_mgr;

1079 
˝_job_group
 = 
	`mempoﬁ_Æloc
(
migøã_mgr
->
group_job_poﬁ
,
GFP_KERNEL
);

1080 if(!
˝_job_group
){

1081 
	`¥ötk
(" cannotálloc memory via kmalloc \n");

1082 
	`BUG_ON
(!
˝_job_group
);

1085 
	`©omic_öc
(&
migøã_mgr
->
group_job_cou¡
);

1087 
	`INIT_LIST_HEAD
(&
˝_job_group
->
˝_hód
);

1088 
	`©omic_£t
(&
˝_job_group
->
˝_job_cou¡
, 0);

1089 
˝_job_group
->
rw
 = 
READ
;

1090 
˝_job_group
->
ˇche_ty≥
 = cache_type;

1091 
˝_job_group
->
su≥r
 = super;

1092 
˝_job_group
->
£q
 = 
	`©omic_ªad
(&
migøã_mgr
->
group_job_£q
);

1093 
	`©omic_öc
(&
migøã_mgr
->
group_job_£q
);

1095  
˝_job_group
;

1096 
	}
}

1098 
	$check_vÆid√ss
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
mëablock
 *
vi˘im_mb
, 
u£_gc
){

1099 
u8
 
dúty_bôs
 = 0;

1101 if(
u£_gc
){

1102 #ifde‡
NO_CLEAN_COPY


1103 if(
	`©omic_ªad_mb_vÆid√ss
(
£g
, 
vi˘im_mb
Ë&& 
	`©omic_ªad_mb_dútöess
(seg, victim_mb))

1104 
dúty_bôs
 = 1;

1106 #ifde‡
HOT_DATA_COPY


1107 if(
	`©omic_ªad_mb_dútöess
(
£g
, 
vi˘im_mb
)){

1108 if(
	`©omic_ªad_mb_vÆid√ss
(
£g
, 
vi˘im_mb
))

1109 
dúty_bôs
 = 1;

1111 if(
	`©omic_ªad_mb_vÆid√ss
(
£g
, 
vi˘im_mb
)&&
	`ã°_bô
(
MB_HIT
, &vi˘im_mb->
mb_Êags
))

1112 
dúty_bôs
 = 1;

1115 
dúty_bôs
 = 
	`©omic_ªad_mb_vÆid√ss
(
£g
, 
vi˘im_mb
);

1119 if(
	`©omic_ªad_mb_vÆid√ss
(
£g
, 
vi˘im_mb
Ë&& 
	`©omic_ªad_mb_dútöess
(seg, victim_mb))

1120 
dúty_bôs
 = 1;

1123  
dúty_bôs
;

1124 
	}
}

1126 
	$ˇlc_mëa_cou¡
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
){

1127 
mëablock
 *
mb
;

1128 
vÆid_cou¡
 = 0;

1129 
summ¨y_cou¡
 = 0;

1130 
∑rôy_cou¡
 = 0;

1131 
i
;

1133 
i
 = 0; i < 
STRIPE_SZ
; i++) {

1134 
mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
i
);

1135 if(
	`ã°_bô
(
MB_PARITY
, &
mb
->
mb_Êags
)){

1136 
vÆid_cou¡
++;

1137 
∑rôy_cou¡
++;

1139 if(
	`ã°_bô
(
MB_SUMMARY
, &
mb
->
mb_Êags
)){

1140 
vÆid_cou¡
++;

1141 
summ¨y_cou¡
++;

1145 if(
vÆid_cou¡
!=
	`gë_mëad©a_cou¡
(
su≥r
, 
£g
->
£g_ty≥
)){

1146 
	`¥ötk
(" invalid meta count: seg = %dÅotal = %d,Öarity = %d, summary = %d \n",

1147 ()
£g
->
£g_id
, 
vÆid_cou¡
, 
∑rôy_cou¡
, 
summ¨y_cou¡
);

1150  
vÆid_cou¡
;

1151 
	}
}

1153 
	$ˇlc_vÆid_cou¡
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
u£_gc
){

1154 
mëablock
 *
mb
;

1155 
vÆid_cou¡
 = 0;

1156 
i
;

1157 
hŸ_gc
;

1158 
u8
 
dúty_bôs
;

1160 
i
 = 0; i < 
STRIPE_SZ
; i++) {

1162 
hŸ_gc
 = 0;

1164 
mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
i
);

1165 
dúty_bôs
 = 
	`check_vÆid√ss
(
su≥r
, 
£g
, 
mb
, 
u£_gc
) ;

1166 if(
mb
->
£˘‹
==~0)

1169 if(
dúty_bôs
)

1170 
vÆid_cou¡
++;

1173 if(
u£_gc
){

1174 #ifde‡
NO_CLEAN_COPY


1175 if(
vÆid_cou¡
!
	`©omic_ªad
(&
£g
->
vÆid_dúty_cou¡
)){

1176 
	`¥ötk
(" calc valid count: gc Invalid valid count .. %d %d \n",

1177 
vÆid_cou¡
, 
	`©omic_ªad
(&
£g
->
vÆid_dúty_cou¡
));

1180 #ifde‡
HOT_DATA_COPY


1181 if(
vÆid_cou¡
!
	`©omic_ªad
(&
£g
->
vÆid_dúty_cou¡
)+©omic_ªad(&£g->
hŸ_˛ón_cou¡
)){

1182 
	`¥ötk
(" calc valid count: gc Invalid valid count .. %d %d \n",

1183 
vÆid_cou¡
, 
	`©omic_ªad
(&
£g
->
vÆid_dúty_cou¡
)+©omic_ªad(&£g->
hŸ_˛ón_cou¡
));

1186 if(
vÆid_cou¡
!
	`©omic_ªad
(&
£g
->
vÆid_dúty_cou¡
)+©omic_ªad(&£g->
vÆid_˛ón_cou¡
)){

1187 
	`¥ötk
(" calc valid count: gc Invalid valid count .. %d %d \n",

1188 
vÆid_cou¡
, 
	`©omic_ªad
(&
£g
->
vÆid_dúty_cou¡
)+©omic_ªad(&£g->
vÆid_˛ón_cou¡
));

1193 if(
vÆid_cou¡
!=
	`©omic_ªad
(&
£g
->
vÆid_dúty_cou¡
)){

1194 
	`¥ötk
(" calc valid count: destage Invalid valid count .. %d %d \n",

1195 
vÆid_cou¡
, 
	`©omic_ªad
(&
£g
->
vÆid_dúty_cou¡
));

1199  
vÆid_cou¡
;

1200 
	}
}

1203 
	$make_de°age_job
(
dm§c_su≥r
 *
su≥r
, 
c›y_job
 *
˝_job
, 
mëablock
 *
vi˘im_mb
, 
d°_cou¡
){

1205 
˝_job
->
d°_mb
 = 
NULL
;

1206 
˝_job
->
d°_ªgi⁄
[
d°_cou¡
].
bdev
 = 
su≥r
->
dev_öfo
.
‹igö_dev
->bdev;

1207 
˝_job
->
d°_ªgi⁄
[
d°_cou¡
].
£˘‹
 = 
vi˘im_mb
->sector;

1208 
˝_job
->
d°_ªgi⁄
[
d°_cou¡
].
cou¡
 = 
SRC_SECTORS_PER_PAGE
;

1209 
˝_job
->
∑ge
 = 
	`Æloc_sögÀ_∑ge
(
su≥r
);

1211 
˝_job
->
d°_cou¡
 = dst_count;

1212 
d°_cou¡
++;

1214 
	`©omic64_öc
(&
su≥r
->
w°©
.
de°age_io_cou¡
);

1216 
	`BUG_ON
(
vi˘im_mb
->
£˘‹
>=
su≥r
->
dev_öfo
.
‹igö_£˘‹s
);

1217 
	}
}

1221 
mëablock
 *
	$Æloc_mb_gc
(
dm§c_su≥r
 *
su≥r
, 
mëablock
 *
vi˘im_mb
, 
ˇche_ty≥
){

1222 
£gmít_hódî
 *
d°_£g
;

1223 
mëablock
 *
d°_mb
;

1224 
f
;

1225 
£˘‹_t
 
key
;

1226 
u32
 
upd©e_mb_idx
;

1227 
u32
 
cou¡
;

1228 
u32
 
tŸÆ_cou¡
 = 0;

1229 
boﬁ
 
chunk_summ¨y
 = 
Ál£
;

1231 
key
 = 
vi˘im_mb
->
£˘‹
;

1233 
cou¡
 = 
	`ma_gë_cou¡
(
su≥r
, 
ˇche_ty≥
);

1234 if(
	`√ed_ª‰esh_£gmít
(
su≥r
, 
ˇche_ty≥
, 
cou¡
)){

1235 
	`¥ötk
("ÇeedÑefresh seg gc .. \n");

1236 
	`BUG_ON
(1);

1238 if(!
	`li°_em±y
(&
˝_job_group
->
˝_hód
)){

1239 
	`Êush_kc›y_job
(
su≥r
, 
˝_job_group
, 
ˇche_ty≥
, 
cur_kc›yd
);

1240 
˝_job_group
 = 
	`Æloc_c›y_job_group
(
su≥r
, 
ˇche_ty≥
, 
cur_kc›yd
 );

1246 
	`LOCK
(
su≥r
, 
f
);

1248 
cou¡
 = 
	`ma_gë_cou¡
(
su≥r
, 
ˇche_ty≥
);

1249 i‡(
	`√ed_ª‰esh_£gmít
(
su≥r
, 
ˇche_ty≥
, 
cou¡
)){

1250 
	`¥ötk
("ÇeedÑefresh seg gc .. \n");

1251 
	`BUG_ON
(1);

1253 
	`ª‰esh_gc_buf
(
su≥r
, 
ˇche_ty≥
, &
f
);

1256 if(
su≥r
->
∑øm
.
gc_wôh_dútysync
)

1257 
d°_mb
 = 
	`Æloc_mb_d©a
(
su≥r
, 
key
, 
ˇche_ty≥
, 
åue
, &
tŸÆ_cou¡
);

1259 
d°_mb
 = 
	`Æloc_mb_d©a
(
su≥r
, 
key
, 
ˇche_ty≥
, !
	`ã°_bô
(
MB_DIRTY
, &
vi˘im_mb
->
mb_Êags
), &
tŸÆ_cou¡
);

1261 
d°_£g
 = 
su≥r
->
cuºít_£g
[
ˇche_ty≥
];

1262 
d°_£g
->
£g_ty≥
 = 
ˇche_ty≥
;

1264 
upd©e_mb_idx
 = 
d°_mb
->
idx
;

1266 if(
	`√ed_chunk_summ¨y
(
su≥r
, 
upd©e_mb_idx
+
NUM_SUMMARY
)){

1267 
u32
 
summ¨y_idx
 = 
	`d©a_to_summ¨y_idx
(
su≥r
, 
upd©e_mb_idx
);

1268 
	`Æloc_mb_summ¨y
(
su≥r
, 
d°_£g
, 
ˇche_ty≥
, 
summ¨y_idx
, &
tŸÆ_cou¡
);

1269 
	`öôülize_mb_summ¨y
(
su≥r
, 
d°_£g
, 
ˇche_ty≥
, 
summ¨y_idx
);

1270 
chunk_summ¨y
 = 
åue
;

1273 
	`UNLOCK
(
su≥r
, 
f
);

1275 
	`˛ór_bô
(
MB_SEAL
, &
d°_mb
->
mb_Êags
);

1277  
d°_mb
;

1278 
	}
}

1282 
c›y_job_group
 *
	$make_gc_job
(
dm§c_su≥r
 *
su≥r
,

1283 
c›y_job_group
 *
˝_job_group
,

1284 
c›y_job
 *
˝_job
,

1285 
mëablock
 *
vi˘im_mb
,

1286 
mëablock
 *
d°_mb
,

1287 *
d°_cou¡
,

1288 
ˇche_ty≥
)

1290 
£gmít_hódî
 *
d°_£g
 = 
	`gë_£g_by_mb
(
su≥r
, 
d°_mb
);

1291 
u32
 
upd©e_mb_idx
 = 
d°_mb
->
idx
;

1293 
˝_job
->
d°_mb
 = dst_mb;

1295 
˝_job
->
d°_ªgi⁄
[*
d°_cou¡
].
bdev
 = 
	`gë_bdev
(
su≥r
, 
upd©e_mb_idx
);

1296 
˝_job
->
d°_ªgi⁄
[*
d°_cou¡
].
£˘‹
 = 
	`gë_£˘‹
(
su≥r
, 
d°_£g
->
£g_id
, 
upd©e_mb_idx
);

1297 
˝_job
->
d°_ªgi⁄
[*
d°_cou¡
].
cou¡
 = 
SRC_SECTORS_PER_PAGE
;

1299 
˝_job
->
∑ge
 = 
˝_job_group
->
d°_ømbuf
->
∑ges
[(
upd©e_mb_idx
%
STRIPE_SZ
)];

1300 (*
d°_cou¡
)++;

1302 if(
vi˘im_mb
 && 
su≥r
->
∑øm
.
gc_wôh_dútysync
 && 
	`ã°_bô
(
MB_DIRTY
, &vi˘im_mb->
mb_Êags
)){

1303 
˝_job
->
d°_ªgi⁄
[*
d°_cou¡
].
bdev
 = 
su≥r
->
dev_öfo
.
‹igö_dev
->bdev;

1304 
˝_job
->
d°_ªgi⁄
[*
d°_cou¡
].
£˘‹
 = 
vi˘im_mb
->sector;

1305 
˝_job
->
d°_ªgi⁄
[*
d°_cou¡
].
cou¡
 = 
SRC_SECTORS_PER_PAGE
;

1306 (*
d°_cou¡
)++;

1309 
˝_job
->
d°_cou¡
 = *dst_count;

1311 
	`©omic64_öc
(&
su≥r
->
w°©
.
gc_io_cou¡
);

1314  
NULL
;

1315 
	}
}

1319 
	$make_gc_summ¨y_job
(
dm§c_su≥r
 *
su≥r
,

1320 
c›y_job_group
 *
˝_job_group
,

1321 
mëablock
 *
d°_mb
,

1322 
ˇche_ty≥
)

1324 
migøti⁄_m™agî
 *
migøã_mgr
 = &
su≥r
->migrate_mgr;

1325 
d°_cou¡
 = 0;

1326 
i
 = 0;

1328 if(
	`√ed_chunk_summ¨y
(
su≥r
, 
d°_mb
->
idx
+
NUM_SUMMARY
)){

1330 
i
 = 0;ò< 
NUM_SUMMARY
;i++){

1331 
mëablock
 *
summ¨y_mb
;

1332 
c›y_job
 *
summ¨y_job
;

1333 
u32
 
idx
 = 
d°_mb
->idx + 1 + 
i
;

1335 
summ¨y_mb
 = 
	`mb_©
(
su≥r
, 
idx
);

1337 
summ¨y_job
 = 
	`mempoﬁ_Æloc
(
migøã_mgr
->
c›y_job_poﬁ
, 
GFP_NOIO
);

1338 
	`BUG_ON
(!
summ¨y_job
);

1339 
summ¨y_job
->
§c_mb
 = 
NULL
;

1340 
d°_cou¡
 = 0;

1341 
	`make_gc_job
(
su≥r
, 
˝_job_group
, 
summ¨y_job
, 
NULL
, 
summ¨y_mb
, &
d°_cou¡
, 
ˇche_ty≥
);

1343 
summ¨y_job
->
d°_cou¡
 = dst_count;

1345 
	`li°_add_èû
(&
summ¨y_job
->
˝_li°
, &
˝_job_group
->
˝_hód
);

1349  
i
;

1350 
	}
}

1354 
	$ªÀa£_vi˘im_£g
(
dm§c_su≥r
 *
su≥r
, 
migøti⁄_m™agî
 *
migøã_mgr
){

1355 
£gmít_hódî
 *
£g
, *
tmp
;

1356 
f
;

1358 if(
	`©omic_ªad
(&
su≥r
->
migøã_mgr
.
migøã_queue_cou¡
))

1359 
	`¥ötk
(" Rñó£ vi˘im seg = %d \n", 
	`©omic_ªad
(&
su≥r
->
migøã_mgr
.
migøã_queue_cou¡
));

1361 
	`li°_f‹_óch_íåy_ß„
(
£g
, 
tmp
, &
migøã_mgr
->
migøã_queue
, 
migøã_li°
) {

1362 if(
migøã_mgr
->
gc_cur_£g
 !
£g
){

1363 
	`li°_dñ
(&
£g
->
migøã_li°
);

1364 
	`©omic_dec
(&
su≥r
->
migøã_mgr
.
migøã_queue_cou¡
);

1365 
	`©omic_dec
(&
migøã_mgr
->
mig_öÊights
);

1367 
	`¥ötk
("Ññó£ vi˘im seg, mig inÊighà%d\n", 
	`©omic_ªad
(&
migøã_mgr
->
mig_öÊights
));

1369 
	`move_£g_migøã_to_£Æed_queue
(
su≥r
, 
£g
);

1370 
	`LOCK
(
su≥r
, 
f
);

1371 
	`˛ór_bô
(
SEG_MIGRATING
, &
£g
->
Êags
);

1372 
	`UNLOCK
(
su≥r
, 
f
);

1374 
	`¥ötk
(" same .. \n");

1375 
	`BUG_ON
(1);

1379 if(
migøã_mgr
->
gc_cur_£g
){

1380 
£g
 = 
migøã_mgr
->
gc_cur_£g
;

1382 
	`©omic_ªad
(&
£g
->
num_migios
)){

1383 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(2000));

1384 
	`¥ötk
(" waitÇum migios ... \n");

1392 if(!
	`ã°_bô
(
SEG_MIGRATING
, &
£g
->
Êags
)){

1393 
	`¥ötk
(" invalid state .. \n");

1394 
	`BUG_ON
(1);

1397 
	`¥ötk
("Ñña£ g¯cu∏£g = %d \n", ()
£g
->
£g_id
);

1398 
	`BUG_ON
(1);

1399 
	`move_£g_migøã_to_£Æed_queue
(
su≥r
, 
£g
);

1400 
	`LOCK
(
su≥r
, 
f
);

1401 
	`˛ór_bô
(
SEG_MIGRATING
, &
£g
->
Êags
);

1402 
	`UNLOCK
(
su≥r
, 
f
);

1404 
migøã_mgr
->
gc_cur_£g
 = 
NULL
;

1405 
migøã_mgr
->
gc_cur_off£t
 = 0;

1409 
	}
}

1411 
	$gë_√xt_vi˘im_£g
(
dm§c_su≥r
 *
su≥r
, 
migøti⁄_m™agî
 *
migøã_mgr
){

1412 if(
	`©omic_ªad
(&
su≥r
->
migøã_mgr
.
migøã_queue_cou¡
))

1413 
migøã_mgr
->
gc_cur_£g
 = 
	`li°_fú°_íåy
(&migøã_mgr->
migøã_queue
, 
£gmít_hódî
, 
migøã_li°
);

1415 
migøã_mgr
->
gc_cur_£g
 = 
NULL
;

1417 
migøã_mgr
->
gc_cur_off£t
 = 0;

1418 
migøã_mgr
->
gc_Æloc_cou¡
 = 0;

1419 if(
migøã_mgr
->
gc_cur_£g
){

1420 
u32
 
vÆid_cou¡
;

1421 
	`li°_dñ
(&
migøã_mgr
->
gc_cur_£g
->
migøã_li°
);

1422 
	`©omic_dec
(&
su≥r
->
migøã_mgr
.
migøã_queue_cou¡
);

1423 
	`©omic_£t
(&
migøã_mgr
->
gc_cur_£g
->
num_migios
, 0);

1425 
vÆid_cou¡
 = 
	`ˇlc_vÆid_cou¡
(
su≥r
, 
migøã_mgr
->
gc_cur_£g
, 1);

1426 
	`©omic64_add
(
vÆid_cou¡
*100/
STRIPE_SZ
, &
su≥r
->
w°©
.
vi˘im_utû
);

1427 
	`©omic64_öc
(&
su≥r
->
w°©
.
vi˘im_cou¡
);

1432 
	}
}

1434 
mëablock
 *
	$gë_√xt_vi˘im_mb
(
dm§c_su≥r
 *
su≥r
,

1435 
migøti⁄_m™agî
 *
migøã_mgr
,

1436 
u£_gc
){

1437 
£gmít_hódî
 *
£g
 = 
migøã_mgr
->
gc_cur_£g
;

1438 
mëablock
 *
vi˘im_mb
 = 
NULL
;

1439 
i
;

1441 if(
migøã_mgr
->
gc_cur_£g
==
NULL
)

1442  
NULL
;

1444 if(
migøã_mgr
->
gc_cur_off£t
 >
STRIPE_SZ
){

1445 
migøã_mgr
->
gc_cur_£g
 = 
NULL
;

1446 if(
	`©omic_ªad
(&
£g
->
num_migios
)==0){

1447 if(!
	`©omic_ªad
(&
£g
->
vÆid_dúty_cou¡
)){

1448 
	`föÆize_˛ón_£g
(
su≥r
, 
£g
, 1);

1450 
	`¥ötk
(" WARN: cleanÉmpty seg .. \n");

1453  
NULL
;

1456 
i
 = 
migøã_mgr
->
gc_cur_off£t
;ò< 
STRIPE_SZ
;i++){

1458 
vi˘im_mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
i
);

1460 if(!
	`check_vÆid√ss
(
su≥r
, 
£g
, 
vi˘im_mb
, 
u£_gc
))

1463 if(
vi˘im_mb
->
£˘‹
==~0)

1466 
migøã_mgr
->
gc_cur_off£t
 = 
i
 + 1;

1467 
migøã_mgr
->
gc_Æloc_cou¡
++;

1468  
vi˘im_mb
;

1470 if(
	`©omic_ªad
(&
£g
->
num_migios
)==0){

1471 if(!
	`©omic_ªad
(&
£g
->
vÆid_dúty_cou¡
)){

1472 
	`föÆize_˛ón_£g
(
su≥r
, 
£g
, 1);

1474 
	`¥ötk
(" WARN: cleanÉmpty seg .. \n");

1478  
NULL
;

1480 
	}
}

1483 
	$make_kc›yd_job
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
mig_job
 *
mg_job
, 
u£_gc
){

1484 
c›y_job_group
 *
˝_job_group
;

1485 
c›y_job
 *
˝_job
;

1486 
i
, 
issue_cou¡
 = 0;

1487 
ˇche_ty≥
;

1488 
migøti⁄_m™agî
 *
migøã_mgr
 = &
su≥r
->migrate_mgr;

1490 if(
£g
->
£g_ty≥
==
WCBUF
 || seg->£g_ty≥==
WHBUF
)

1491 
ˇche_ty≥
 = 
GWBUF
;

1493 
ˇche_ty≥
 = 
GRBUF
;

1495 if(
su≥r
->
∑øm
.
gc_wôh_dútysync
)

1496 
ˇche_ty≥
 = 
GRBUF
;

1498 
issue_cou¡
 = 
	`ˇlc_vÆid_cou¡
(
su≥r
, 
£g
, 
u£_gc
);

1499 if(!
issue_cou¡
){

1500 
	`¥ötk
(" InvÆid issuêcou¡ = %d \n", 
issue_cou¡
);

1501 
	`BUG_ON
(1);

1502  
issue_cou¡
;

1505 
	`©omic64_add
(
issue_cou¡
, &(
mg_job
->
cou¡
));

1507 
˝_job_group
 = 
mg_job
->cp_job_group;

1509 
i
 = 0; i < 
STRIPE_SZ
; i++) {

1510 
mëablock
 *
vi˘im_mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
i
);

1511 
d°_cou¡
 = 0;

1512 
hŸ_gc
 = 0;

1514 if(!
	`check_vÆid√ss
(
su≥r
, 
£g
, 
vi˘im_mb
, 
u£_gc
, &
hŸ_gc
))

1517 if(
vi˘im_mb
->
£˘‹
==~0)

1520 
cou¡
 = 
	`ma_gë_cou¡
(
su≥r
, 
ˇche_ty≥
);

1521 if(
	`√ed_ª‰esh_£gmít
(
su≥r
, 
ˇche_ty≥
, 
cou¡
)){

1522 
	`¥ötk
("Ço block in gc buf .. \n");

1523 
	`BUG_ON
(0);

1525 
	`©omic_öc
(&
£g
->
num_migios
);

1527 
˝_job
 = 
	`mempoﬁ_Æloc
(
migøã_mgr
->
c›y_job_poﬁ
, 
GFP_NOIO
);

1528 !
˝_job
){

1529 
	`¥ötk
(" copy jobÖoolÉrror \n");

1530 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(1));

1531 
˝_job
 = 
	`mempoﬁ_Æloc
(
migøã_mgr
->
c›y_job_poﬁ
, 
GFP_NOIO
);

1534 
˝_job
->
mg_job
 = mg_job;

1535 
˝_job
->
gc
 = 
hŸ_gc
;

1536 
˝_job
->
§c_mb
 = 
vi˘im_mb
;

1537 
˝_job
->
§c_ªgi⁄
.
bdev
 = 
	`gë_bdev
(
su≥r
, 
i
);

1538 
˝_job
->
§c_ªgi⁄
.
£˘‹
 = 
	`gë_£˘‹
(
su≥r
, 
£g
->
£g_id
, 
i
);

1539 
˝_job
->
§c_ªgi⁄
.
cou¡
 = 
SRC_SECTORS_PER_PAGE
;

1541 
d°_cou¡
 = 0;

1542 if(!
hŸ_gc
){

1543 
	`make_de°age_job
(
su≥r
, 
˝_job
, 
vi˘im_mb
, 
d°_cou¡
);

1544 
d°_cou¡
++;

1546 
mëablock
 *
d°_mb
 = 
	`Æloc_mb_gc
(
su≥r
, 
vi˘im_mb
, 
ˇche_ty≥
);

1547 
	`make_gc_job
(
su≥r
, 
˝_job
, 
vi˘im_mb
, 
d°_mb
, &
d°_cou¡
, 
ˇche_ty≥
);

1550 
˝_job
->
d°_cou¡
 = dst_count;

1551 
	`li°_add_èû
(&
˝_job
->
˝_li°
, &
˝_job_group
->
˝_hód
);

1557  
issue_cou¡
;

1558 
	}
}

1562 
	$åy_ª£rve_£gmít_f‹_gc
(
dm§c_su≥r
 *
su≥r
){

1563 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

1564 
	`ªÀa£_ª£rve_£gs
(
su≥r
);

1566 
ª£rve_d⁄e
;

1567 
	`©omic_ªad
(&
£g_Æloˇt‹
->
Æloc_cou¡
)<
MIN_FREE
)

1568 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(10));

1570 
	`BUG_ON
(
	`©omic_ªad
(&
£g_Æloˇt‹
->
Æloc_cou¡
)<
MIN_FREE
);

1572 if(
	`©omic_ªad
(&
£g_Æloˇt‹
->
Æloc_cou¡
)<5)

1573 
ª£rve_d⁄e
 = 
	`ª£rve_ª£rve_£gs
(
su≥r
, 
	`©omic_ªad
(&
£g_Æloˇt‹
->
Æloc_cou¡
));

1575 
ª£rve_d⁄e
 = 
	`ª£rve_ª£rve_£gs
(
su≥r
, 5);

1577 if(
ª£rve_d⁄e
){

1580 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(10));

1581 
	`¥ötk
(" Iàˇ¬ŸÑe£rvê£gmít†f‹ GC fªê%d \n", ()
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
Æloc_cou¡
));

1583 
	}
}

1587 
	$£À˘_em±y_£gs
(
dm§c_su≥r
 *
su≥r
){

1588 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

1589 
li°_hód
 *
£Æed_queue
 = &
£g_Æloˇt‹
->
£g_£Æed_queue
;

1590 
£gmít_hódî
 *
£g
;

1591 
Êags
;

1592 
ªcou¡
 = 0;

1593 
lo›
 = 0;

1595 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

1597 !
	`li°_em±y
(
£Æed_queue
)){

1598 
£g
 = (
£gmít_hódî
 *)

1599 
	`li°_íåy
(
£Æed_queue
->
¥ev
, 
£gmít_hódî
, 
Æloc_li°
);

1601 if(
	`is_em±y_£g
(
su≥r
, 
£g
)){

1602 
	`li°_add_èû
(&
£g
->
migøã_li°
, &
su≥r
->
migøã_mgr
.
migøã_queue
);

1603 
	`©omic_öc
(&
su≥r
->
migøã_mgr
.
migøã_queue_cou¡
);

1604 
	`move_£g_£Æed_to_migøã_queue
(
su≥r
, 
£g
, 0);

1605 
ªcou¡
++;

1608 if(
ªcou¡
>=
MIGRATE_HIGHWATER
)

1611 if(++
lo›
>=
£g_Æloˇt‹
->
£g_£Æed_cou¡
)

1615 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

1619  
ªcou¡
;

1620 
	}
}

1622 
	$˛ón_em±y_£g
(
dm§c_su≥r
 *
su≥r
, 
u£_gc
){

1623 
migøti⁄_m™agî
 *
migøã_mgr
 = &
su≥r
->migrate_mgr;

1624 
£gmít_hódî
 *
£g
, *
tmp
;

1625 
issue_cou¡
 = 0;

1626 
bug_cou¡
 = 0;

1628 if(!
	`£À˘_em±y_£gs
(
su≥r
))

1631 
	`li°_f‹_óch_íåy_ß„
(
£g
, 
tmp
, &
migøã_mgr
->
migøã_queue
, 
migøã_li°
) {

1632 
f
;

1634 if(
	`ã°_bô
(
SEG_MIGRATING
, &
£g
->
Êags
)){

1635 
	`¥ötk
(" seg i†migøtög ... seg %d \n", ()
£g
->
£g_id
);

1636 
	`BUG_ON
(1);

1638 
	`LOCK
(
su≥r
, 
f
);

1639 
	`£t_bô
(
SEG_MIGRATING
, &
£g
->
Êags
);

1640 
	`©omic_£t
(&
£g
->
num_migios
, 0);

1641 
	`UNLOCK
(
su≥r
, 
f
);

1643 
	`©omic_ªad
(&
£g
->
num_ªad_öÊight
) ||

1644 
	`©omic_ªad
(&
£g
->
num_fûlög
) )

1646 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(500000));

1647 
	`¥ötk
(" seg = %d inflight %d filling = %d\n",

1648 ()
£g
->
£g_id
,

1649 
	`©omic_ªad
(&
£g
->
num_ªad_öÊight
)

1650 ,
	`©omic_ªad
(&
£g
->
num_fûlög
));

1652 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(100));

1655 
issue_cou¡
 = 
	`ˇlc_vÆid_cou¡
(
su≥r
, 
£g
, 
u£_gc
);

1656 if(!
issue_cou¡
){

1657 if(
	`is_em±y_£g
(
su≥r
, 
£g
)){

1658 
	`©omic_öc
(&
su≥r
->
w°©
.
gc_em±y_cou¡
);

1660 
	`föÆize_˛ón_£g
(
su≥r
, 
£g
, 1);

1661 
	`li°_dñ
(&
£g
->
migøã_li°
);

1662 
	`©omic_dec
(&
migøã_mgr
->
migøã_queue_cou¡
);

1664 
	`¥ötk
("Ço issue count butÇotÉmpty seg ... \n");

1665 
	`BUG_ON
(1);

1668 
	`¥ötk
(" seg isÇotÉmpty \n");

1669 
	`BUG_ON
(1);

1670 
	`©omic_öc
(&
migøã_mgr
->
mig_öÊights
);

1676 
	`BUG_ON
(++
bug_cou¡
==100000000);

1679 
	}
}

1682 
	$__issue_mig_kc›yd
(
dm§c_su≥r
 *
su≥r
, 
c›y_job_group
 *
˝_job_group
, 
ˇche_ty≥
, 
u£_gc
, 
num_c›y_block
){

1683 
migøti⁄_m™agî
 *
migøã_mgr
 = &
su≥r
->migrate_mgr;

1684 
tŸÆ_cou¡
 = 0;

1688 
mëablock
 *
vi˘im_mb
 = 
NULL
;

1689 
£gmít_hódî
 *
vi˘im_£g
 = 
NULL
;

1690 
c›y_job
 *
˝_job
;

1692 !
vi˘im_mb
){

1693 
vi˘im_mb
 = 
	`gë_√xt_vi˘im_mb
(
su≥r
, &su≥r->
migøã_mgr
, 
u£_gc
);

1694 if(!
vi˘im_mb
){

1695 
	`gë_√xt_vi˘im_£g
(
su≥r
, &su≥r->
migøã_mgr
);

1696 if(!
migøã_mgr
->
gc_cur_£g
){

1698 
NO_VICTIM
;

1703 
vi˘im_£g
 = 
	`gë_£g_by_mb
(
su≥r
, 
vi˘im_mb
);

1704 if(!
	`check_vÆid√ss
(
su≥r
, 
vi˘im_£g
, 
vi˘im_mb
, 
u£_gc
Ë|| vi˘im_mb->
£˘‹
==~0){

1705 
	`¥ötk
(" invalid victim ... \n");

1706 
	`BUG_ON
(1);

1710 if(!
	`ã°_bô
(
MB_DIRTY
, &
vi˘im_mb
->
mb_Êags
)){

1713 
ˇche_m™agî
 *
˛ón_ˇche
 = 
su≥r
->
˛ón_døm_ˇche_m™agî
;

1714 
Ãu_node
 *
 
 = 
NULL
;

1715 
Ãu_Êags
;

1716 
f
;

1717 
£Æed
 = 0, 
locked
 = 0, 
˙_Æloc_by_gc
 = 0;

1718 
Æloc
 = 0;

1721 
	`LOCK
(
su≥r
, 
f
);

1722 
	`•ö_lock_úqßve
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

1723 
 
 = 
	`CACHE_SEARCH
(
˛ón_ˇche
, 
vi˘im_mb
->
£˘‹
);

1725 if(
 
){

1726 
	`¥ötk
(" WARN: clean data hitÇ cleanÑam during GC \n");

1729 #ifde‡
HOT_DATA_COPY


1730 if(!
 
 && 
	`ã°_bô
(
MB_HIT
, &
vi˘im_mb
->
mb_Êags
)){

1732 if(!
 
){

1734 if(
˛ón_ˇche
->
cm_‰ì
){

1735 
 
 = 
	`CACHE_ALLOC
(
˛ón_ˇche
,Ün, 
vi˘im_mb
->
£˘‹
);

1736 
	`CACHE_INSERT
(
˛ón_ˇche
, 
 
);

1737 
	`©omic_£t
(&
 
->
£Æed
, 0);

1738 
	`©omic_£t
(&
 
->
locked
, 0);

1739 
 
->
˙_Æloc_by_gc
 = 1;

1740 
Æloc
 = 1;

1744 
	`övÆid©e_¥evious_ˇche
(
su≥r
, 
vi˘im_£g
, 
vi˘im_mb
);

1746 if(
 
){

1747 
£Æed
 = 
	`©omic_ªad
(&
 
->sealed);

1748 
locked
 = 
	`©omic_ªad
(&
 
->locked);

1749 
˙_Æloc_by_gc
 = 
 
->cn_alloc_by_gc;

1752 
	`•ö_u∆ock_úqª°‹e
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

1753 
	`UNLOCK
(
su≥r
, 
f
);

1755 if(!
 
){

1761 if(!
Æloc
){

1762 
	`¥ötk
(" WARN: dram hit ... during GC sector = %d sealed = %dÜocked = %d,álloc by gc = %d \n",

1763 ()
vi˘im_mb
->
£˘‹
, 
£Æed
, 
locked
, 
˙_Æloc_by_gc
);

1768 
	`©omic_öc
(&
vi˘im_£g
->
num_migios
);

1770 
˝_job
 = 
	`mempoﬁ_Æloc
(
migøã_mgr
->
c›y_job_poﬁ
, 
GFP_NOIO
);

1771 !
˝_job
){

1772 
	`¥ötk
(" copy jobÖoolÉrror \n");

1773 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(1));

1774 
˝_job
 = 
	`mempoﬁ_Æloc
(
migøã_mgr
->
c›y_job_poﬁ
, 
GFP_NOIO
);

1776 
	`©omic_öc
(&
migøã_mgr
->
c›y_job_cou¡
);

1778 
˝_job
->
§c_mb
 = 
vi˘im_mb
;

1779 
˝_job
->
§c_ªgi⁄
.
bdev
 = 
	`gë_bdev
(
su≥r
, 
vi˘im_mb
->
idx
);

1780 
˝_job
->
§c_ªgi⁄
.
£˘‹
 = 
	`gë_£˘‹
(
su≥r
, 
vi˘im_£g
->
£g_id
, 
vi˘im_mb
->
idx
);

1781 
˝_job
->
§c_ªgi⁄
.
cou¡
 = 
SRC_SECTORS_PER_PAGE
;

1783 
	`li°_add_èû
(&
˝_job
->
˝_li°
, &
˝_job_group
->
˝_hód
);

1785 
˝_job
->
∑ge
 = 
	`Æloc_sögÀ_∑ge
(
su≥r
);

1786 if(
˝_job
->
∑ge
==
NULL
){

1787 
	`¥ötk
(" WARN:ÇoÑambuffer isállocated ... \n");

1788 
	`BUG_ON
(1);

1791 if(
u£_gc
){

1792 
˝_job
->
d°_mb
 = 
NULL
;

1793 
˝_job
->
d°_ªgi⁄
[0].
bdev
 = 
NULL
;

1794 
˝_job
->
d°_cou¡
 = 0;

1796 
˝_job
->
d°_ªgi⁄
[0].
bdev
 = 
su≥r
->
dev_öfo
.
‹igö_dev
->bdev;

1797 
˝_job
->
d°_ªgi⁄
[0].
£˘‹
 = 
vi˘im_mb
->sector;

1798 
˝_job
->
d°_ªgi⁄
[0].
cou¡
 = 
SRC_SECTORS_PER_PAGE
;

1799 
˝_job
->
d°_cou¡
 = 1;

1802 
tŸÆ_cou¡
++;

1803 if(
tŸÆ_cou¡
>=
num_c›y_block
)

1807 
NO_VICTIM
:

1813  
tŸÆ_cou¡
;

1814 
	}
}

1817 
	$issue_mig_kc›yd
(
dm§c_su≥r
 *
su≥r
, 
u£_gc
){

1818 
migøti⁄_m™agî
 *
migøã_mgr
 = &
su≥r
->migrate_mgr;

1819 
£gmít_hódî
 *
£g
, *
tmp
;

1820 
c›y_job_group
 *
˝_job_group
;

1821 
f
;

1822 
issue_cou¡
 = 0;

1823 
tŸÆ_cou¡
 = 0;

1824 
tŸÆ_cou¡2
 = 0;

1825 
bug_cou¡
 = 0;

1826 
ˇche_ty≥
;

1828 
tŸÆ_cou¡
 = 0;

1830 if(!
	`©omic_ªad
(&
migøã_mgr
->
migøã_queue_cou¡
)){

1831 
	`¥ötk
(" invalid victim count ... \n");

1832 
	`BUG_ON
(1);

1836 
	`li°_f‹_óch_íåy_ß„
(
£g
, 
tmp
, &
migøã_mgr
->
migøã_queue
, 
migøã_li°
) {

1837 
f
;

1843 
	`BUG_ON
(!
	`ã°_bô
(
SEG_MIGRATING
, &
£g
->
Êags
));

1845 
	`LOCK
(
su≥r
, 
f
);

1846 
	`£t_bô
(
SEG_MIGRATING
, &
£g
->
Êags
);

1847 
	`©omic_£t
(&
£g
->
num_migios
, 0);

1849 
	`©omic_ªad
(&
£g
->
num_ªad_öÊight
Ë||átomic_ªad(&£g->
num_fûlög
)){

1850 
	`UNLOCK
(
su≥r
, 
f
);

1851 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(1000));

1852 
	`¥ötk
(" seg = %d inflight %d filling = %d \n",

1853 ()
£g
->
£g_id
, 
	`©omic_ªad
(&£g->
num_ªad_öÊight
)

1854 ,
	`©omic_ªad
(&
£g
->
num_fûlög
));

1855 
	`LOCK
(
su≥r
, 
f
);

1857 
	`UNLOCK
(
su≥r
, 
f
);

1860 
issue_cou¡
 = 
	`ˇlc_vÆid_cou¡
(
su≥r
, 
£g
, 
u£_gc
);

1865 if(!
issue_cou¡
){

1866 if(
	`is_em±y_£g
(
su≥r
, 
£g
, 
u£_gc
)){

1868 
	`föÆize_˛ón_£g
(
su≥r
, 
£g
, 1);

1869 
	`li°_dñ
(&
£g
->
migøã_li°
);

1870 
	`©omic_dec
(&
migøã_mgr
->
migøã_queue_cou¡
);

1872 
	`¥ötk
(" VÆid = %d\n", 
	`©omic_ªad
(&
£g
->
vÆid_cou¡
));

1873 
	`¥ötk
(" VÆid dúty = %d\n", 
	`©omic_ªad
(&
£g
->
vÆid_dúty_cou¡
));

1874 
	`¥ötk
(" VÆid cÀ™ = %d\n", 
	`©omic_ªad
(&
£g
->
vÆid_˛ón_cou¡
));

1875 
	`¥ötk
("Ço issue count butÇotÉmpty seg ... \n");

1876 
	`BUG_ON
(1);

1879 
	`©omic_öc
(&
migøã_mgr
->
mig_öÊights
);

1881 
tŸÆ_cou¡
 +
issue_cou¡
;

1886 
	`BUG_ON
(++
bug_cou¡
==100000000);

1889 
ˇche_ty≥
 = 
WCBUF
;

1892 if(!
tŸÆ_cou¡
 ||

1893 (
tŸÆ_cou¡
 < 
STRIPE_SZ
-
	`gë_mëad©a_cou¡
(
su≥r
, 
ˇche_ty≥
)

1894 && 
	`gë_Æloc_cou¡
(
su≥r
Ë> 
MIGRATE_LOWWATER
) ){

1903 if(!
tŸÆ_cou¡
){

1916 if(!
	`©omic_ªad
(&
migøã_mgr
->
migøã_queue_cou¡
)){

1917 
	`ªÀa£_vi˘im_£g
(
su≥r
, 
migøã_mgr
);

1918 
	`¥ötk
(" invalid victim count 3... \n");

1936 
tŸÆ_cou¡
){

1937 
˝_job_group
 = 
	`Æloc_c›y_job_group
(
su≥r
, 
ˇche_ty≥
);

1938 
˝_job_group
->
gc
 = 
u£_gc
;

1940 
	`LOCK
(
su≥r
, 
f
);

1941 
˝_job_group
->
d°_£g
 = 
su≥r
->
cuºít_£g
[
ˇche_ty≥
];

1942 
˝_job_group
->
d°_ømbuf
 = 
su≥r
->
£gbuf_mgr
.
cuºít_ømbuf
[
ˇche_ty≥
];

1943 
˝_job_group
->
rw
 = 
READ
;

1944 
	`UNLOCK
(
su≥r
, 
f
);

1946 
tŸÆ_cou¡2
 = 
	`__issue_mig_kc›yd
(
su≥r
, 
˝_job_group
, 
ˇche_ty≥
, 
u£_gc
,

1947 
	`gë_d©a_max_cou¡
(
su≥r
, 
ˇche_ty≥
));

1948 
tŸÆ_cou¡
 -
tŸÆ_cou¡2
;

1950 if(
tŸÆ_cou¡2
){

1951 
	`Êush_kc›y_job
(
su≥r
, 
˝_job_group
);

1953 
	`¥ötk
("Çÿvi˘im cou¡ = %d,ÅŸÆ = %d \n",
tŸÆ_cou¡2
, 
tŸÆ_cou¡
);

1954 
	`mempoﬁ_‰ì
(
˝_job_group
, 
migøã_mgr
->
group_job_poﬁ
);

1955 
	`©omic_dec
(&
migøã_mgr
->
group_job_cou¡
);

1957 if(
tŸÆ_cou¡2
==0){

1958 
	`¥ötk
("ÅŸÆ cou¡ = %d \n",
tŸÆ_cou¡
);

1971 
	`gë_√xt_vi˘im_£g
(
su≥r
, &su≥r->
migøã_mgr
);

1972 if(
migøã_mgr
->
gc_cur_£g
){

1973 
	`¥ötk
("Ço victim segs 2... \n");

1974 
	`BUG_ON
(1);

1976 
	`ªÀa£_vi˘im_£g
(
su≥r
, 
migøã_mgr
);

1978 
	}
}

1980 
	$föÆize_˛ón_£g
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
˛ónup
){

1981 
size_t
 
n1
 = 1;

1982 
f
;

1983 
u32
 
‰ì_£g_cou¡
;

1985 
	`©omic_ªad
(&
£g
->
num_ªad_öÊight
)) {

1986 
	`WBWARN
("Finalize clean seg: inflight iosÑemained for current seg");

1987 
	`BUG_ON
(1);

1988 
n1
++;

1989 i‡(
n1
%10000==0){

1990 
	`WBWARN
("Finalize clean seg: inflight iosÑemained for current seg");

1991 
n1
 = 0;

1993 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(1));

1996 
	`LOCK
(
su≥r
, 
f
);

2002 if(
˛ónup
)

2003 
	`˛ónup_£gmít
(
su≥r
, 
£g
);

2004 
	`disˇrd_ˇches_ö£g
(
su≥r
, 
£g
);

2006 
	`UNLOCK
(
su≥r
, 
f
);

2008 
	`£t_bô
(
SEG_CLEAN
, &
£g
->
Êags
);

2009 
	`˛ór_bô
(
SEG_MIGRATING
, &
£g
->
Êags
);

2010 
	`˛ór_bô
(
SEG_SEALED
, &
£g
->
Êags
);

2017 
	`move_£g_migøã_to_Æloc_queue
(
su≥r
, 
£g
);

2018 
‰ì_£g_cou¡
 = 
	`£gmít_group_öc_‰ì_£gs
(
su≥r
, 
£g
);

2019 if(
‰ì_£g_cou¡
 =
SEGMENT_GROUP_SIZE
){

2021 
	`move_group_migøã_to_Æloc_queue
(
su≥r
, 
£g
->
group
);

2024 if(!
	`©omic_ªad
(&
su≥r
->
migøã_mgr
.
background_gc_⁄
)){

2025 if(
	`gë_Æloc_cou¡
(
su≥r
Ë>
MIGRATE_HIGHWATER
 &&

2026 
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
group_Æloc_cou¡
)>=1){

2028 if(
	`©omic_ªad
(&
su≥r
->
migøã_mgr
.
migøã_åiggîed
)){

2029 
	`©omic_£t
(&
su≥r
->
migøã_mgr
.
background_gc_⁄
, 0);

2030 
	`©omic_£t
(&
su≥r
->
migøã_mgr
.
migøã_åiggîed
, 0);

2034 if(
	`gë_Æloc_cou¡
(
su≥r
Ë>
MIGRATE_HIGHWATER
*4){

2035 
	`¥ötk
(" >>>> Back GC: fªê£g cou¡ = %d \n", 
	`gë_Æloc_cou¡
(
su≥r
));

2036 if(
	`©omic_ªad
(&
su≥r
->
migøã_mgr
.
migøã_åiggîed
)){

2037 
	`©omic_£t
(&
su≥r
->
migøã_mgr
.
background_gc_⁄
, 0);

2038 
	`©omic_£t
(&
su≥r
->
migøã_mgr
.
migøã_åiggîed
, 0);

2044 
	`≥ndög_w‹kî_scheduÀ
(
su≥r
);

2045 
	}
}

2047 
	$£g_˛ór_hô_bôs
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
){

2048 
mëablock
 *
mb
;

2049 
i
;

2051 
i
 = 0;ò< 
STRIPE_SZ
;i++){

2052 
mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
i
);

2053 if(
	`ã°_bô
(
MB_HIT
, &
mb
->
mb_Êags
)){

2054 
	`˛ór_bô
(
MB_HIT
, &
mb
->
mb_Êags
);

2055 
	`©omic_dec
(&
£g
->
hŸ_cou¡
);

2058 
	}
}

2061 
	$gë_d©a_size_ö_°rùe
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
){

2062 
mö
;

2064 if(
SUMMARY_SCHEME
==
SUMMARY_PER_CHUNK
){

2065 if(
ˇche_ty≥
==
WCBUF
 || cache_ty≥==
WHBUF
)

2066 
mö
 = 
STRIPE_SZ
;

2068 
mö
 = 
STRIPE_SZ
;

2070 if(
ˇche_ty≥
==
WCBUF
 || cache_ty≥==
WHBUF
)

2071 
mö
 = 
STRIPE_SZ
;

2073 
mö
 = 
STRIPE_SZ
;

2076  
mö
;

2078 
	}
}

2082 
£gmít_hódî
 *
	$£À˘_vi˘im_gªedy_cﬁd
(
dm§c_su≥r
 *
su≥r
, 
u£_gc
){

2083 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

2084 
£gmít_hódî
 *
£g
, *
mö_£g
 = 
NULL
;

2085 
u32
 
mö
 = 0;

2088 
	`li°_f‹_óch_íåy
(
£g
, &
£g_Æloˇt‹
->
£Æed_queue
, 
Æloc_li°
){

2089 if(
u£_gc
 && 
	`©omic_ªad
(&
£g
->
vÆid_cou¡
)>=
	`gë_d©a_size_ö_°rùe
(
su≥r
, seg->
£g_ty≥
))

2092 if(!
	`is_cﬁd_°rùe
(
£g
->
£g_ty≥
))

2095 if(
mö_£g
){

2096 if(
	`©omic_ªad
(&
£g
->
vÆid_cou¡
)<
mö
 &&

2097 !
	`ã°_bô
(
SEG_MIGRATING
, &
£g
->
Êags
))

2099 
mö_£g
 = 
£g
;

2100 
mö
 = 
	`©omic_ªad
(&
£g
->
vÆid_cou¡
);

2103 
mö_£g
 = 
£g
;

2104 
mö
 = 
	`©omic_ªad
(&
£g
->
vÆid_cou¡
);

2110  
mö_£g
;

2111 
	}
}

2114 
	$¥öt_vÆid_cou¡
(
dm§c_su≥r
 *
su≥r
){

2115 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

2116 
£gmít_hódî
 *
£g
;

2119 
	`li°_f‹_óch_íåy
(
£g
, &
£g_Æloˇt‹
->
£g_£Æed_queue
, 
Æloc_li°
){

2120 if(!
	`ã°_bô
(
SEG_MIGRATING
, &
£g
->
Êags
))

2121 
	`¥ötk
("Ç‹mÆ seg = %d v¯%d \n", ()
£g
->
£g_id
, 
	`©omic_ªad
(&£g->
vÆid_cou¡
));

2123 
	`¥ötk
(" migøtög seg = %d v¯%d \n", ()
£g
->
£g_id
, 
	`©omic_ªad
(&£g->
vÆid_cou¡
));

2126 
	}
}

2129 
£gmít_hódî
 *
	$£À˘_vi˘im_gªedy
(
dm§c_su≥r
 *
su≥r
, 
u£_gc
){

2130 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

2131 
£gmít_hódî
 *
£g
, *
mö_£g
 = 
NULL
;

2132 
u32
 
mö
 = 0;

2134 
	`li°_f‹_óch_íåy
(
£g
, &
£g_Æloˇt‹
->
£Æed_queue
, 
Æloc_li°
){

2135 if(
u£_gc
 && 
	`©omic_ªad
(&
£g
->
vÆid_cou¡
)>=
	`gë_d©a_size_ö_°rùe
(
su≥r
, seg->
£g_ty≥
))

2138 if(
	`ã°_bô
(
SEG_MIGRATING
, &
£g
->
Êags
))

2141 if(
mö_£g
){

2142 if(
	`©omic_ªad
(&
£g
->
vÆid_cou¡
)<
mö
 &&

2143 !
	`ã°_bô
(
SEG_MIGRATING
, &
£g
->
Êags
))

2145 
mö_£g
 = 
£g
;

2146 
mö
 = 
	`©omic_ªad
(&
£g
->
vÆid_cou¡
);

2149 
mö_£g
 = 
£g
;

2150 
mö
 = 
	`©omic_ªad
(&
£g
->
vÆid_cou¡
);

2156  
mö_£g
;

2157 
	}
}

2160 
group_hódî
 *
	$£À˘_vi˘im_fifo
(
dm§c_su≥r
 *
su≥r
, 
u£_gc
){

2161 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

2162 
group_hódî
 *
group
, *
mö_group
 = 
NULL
;

2163 
u32
 
mö
 = 0;

2165 
	`li°_f‹_óch_íåy
(
group
, &
£g_Æloˇt‹
->
group_£Æed_queue
, 
Æloc_li°
){

2169 
mö_group
 = 
group
;

2170 
mö
 = 
	`©omic_ªad
(&
group
->
vÆid_cou¡
);

2177  
mö_group
;

2178 
	}
}

2180 
group_hódî
 *
	$£À˘_vi˘im_gªedy
(
dm§c_su≥r
 *
su≥r
, 
u£_gc
){

2181 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

2182 
group_hódî
 *
group
, *
mö_group
 = 
NULL
;

2183 
u32
 
mö
 = 0;

2185 
	`li°_f‹_óch_íåy
(
group
, &
£g_Æloˇt‹
->
group_£Æed_queue
, 
Æloc_li°
){

2186 if(
u£_gc
 && 
	`©omic_ªad
(&
group
->
vÆid_cou¡
)>=
STRIPE_SZ
 * 
SEGMENT_GROUP_SIZE
)

2190 if(
mö_group
){

2191 if(
	`©omic_ªad
(&
group
->
vÆid_cou¡
)<
mö
){

2192 
mö_group
 = 
group
;

2193 
mö
 = 
	`©omic_ªad
(&
group
->
vÆid_cou¡
);

2196 
mö_group
 = 
group
;

2197 
mö
 = 
	`©omic_ªad
(&
group
->
vÆid_cou¡
);

2204  
mö_group
;

2205 
	}
}

2212 
	$_£À˘_vi˘im_f‹_£À˘ive_gc
(
dm§c_su≥r
 *
su≥r
, 
num_mig
, *
u£_gc
){

2213 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

2214 
li°_hód
 *
£Æed_queue
 = &
£g_Æloˇt‹
->sealed_queue;

2215 
£gmít_hódî
 *
£g
;

2216 
Êags
;

2217 
ªcou¡
 = 0;

2218 
lo›
 = 0;

2220 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

2222 !
	`li°_em±y
(
£Æed_queue
)){

2223 
u32
 
mö
;

2224 
boﬁ
 
hô
 = 
Ál£
;

2225 
boﬁ
 
c⁄dôi⁄
 = 
Ál£
;

2227 
£g
 = (
£gmít_hódî
 *)

2228 
	`li°_íåy
(
£Æed_queue
->
¥ev
, 
£gmít_hódî
, 
Æloc_li°
);

2230 
mö
 = 
	`gë_d©a_size_ö_°rùe
(
su≥r
, 
£g
->
£g_ty≥
);

2232 
hô
 = 
	`ã°_bô
(
SEG_HIT
, &
£g
->
Êags
);

2233 if(
su≥r
->
∑øm
.
hô_bôm≠_ty≥
==
HIT_BITMAP_PER_STRIPE
){

2234 if(
hô
 && 
	`©omic_ªad
(&
£g
->
vÆid_cou¡
Ë< 
mö
){

2235 
c⁄dôi⁄
 = 
åue
;

2238 if(
hô
 && 
	`©omic_ªad
(&
£g
->
vÆid_cou¡
Ë< 
mö
 &&

2239 
	`©omic_ªad
(&
£g
->
hŸ_cou¡
Ë< 
STRIPE_SZ
/2){

2240 
c⁄dôi⁄
 = 
åue
;

2244 if(
c⁄dôi⁄
){

2245 
	`˛ór_bô
(
SEG_HIT
, &
£g
->
Êags
);

2246 
	`li°_add_èû
(&
£g
->
migøã_li°
, &
su≥r
->
migøã_mgr
.
migøã_queue
);

2247 
	`©omic_öc
(&
su≥r
->
migøã_mgr
.
migøã_queue_cou¡
);

2249 
	`move_£g_£Æed_to_migøã_queue
(
su≥r
, 
£g
, 0);

2250 
ªcou¡
++;

2252 if(
ªcou¡
>=
num_mig
)

2255 if(
hô
){

2256 
	`li°_move
(&
£g
->
Æloc_li°
, 
£Æed_queue
);

2257 
	`˛ór_bô
(
SEG_HIT
, &
£g
->
Êags
);

2258 
	`£g_˛ór_hô_bôs
(
su≥r
, 
£g
);

2264 
lo›
++;

2265 if(
lo›
>=
£g_Æloˇt‹
->
£Æed_cou¡
)

2269 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

2276  
ªcou¡
;

2277 
	}
}

2280 
	$_£À˘_vi˘im_f‹_gc
(
dm§c_su≥r
 *
su≥r
, 
num_mig
, 
£gmít_hódî
 *
£g
){

2281 
tŸÆ_vÆid_cou¡
 = 0;

2283 
	`£t_bô
(
SEG_MIGRATING
, &
£g
->
Êags
);

2285 
	`li°_add_èû
(&
£g
->
migøã_li°
, &
su≥r
->
migøã_mgr
.
migøã_queue
);

2286 
	`©omic_öc
(&
su≥r
->
migøã_mgr
.
migøã_queue_cou¡
);

2287 
	`move_£g_£Æed_to_migøã_queue
(
su≥r
, 
£g
, 0);

2288 
tŸÆ_vÆid_cou¡
 +
	`gë_d©a_vÆid_cou¡
(
su≥r
, 
£g
);

2290  
tŸÆ_vÆid_cou¡
;

2291 
	}
}

2294 
	$£À˘_vi˘im_f‹_gc
(
dm§c_su≥r
 *
su≥r
, 
num_mig
){

2295 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

2296 
li°_hód
 *
£Æed_queue
 = &
£g_Æloˇt‹
->
£g_£Æed_queue
;

2297 
group_hódî
 *
group
 = 
NULL
;

2298 
£gmít_hódî
 *
£g
 = 
NULL
;

2299 
Êags
;

2300 
lo›
 = 0;

2301 
ªcou¡
 = 0;

2302 
tŸÆ_vÆid_cou¡
 = 0;

2303 
u32
 
£g_off£t
 = 0;

2305 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

2307 !
	`li°_em±y
(
£Æed_queue
)){

2310 if(
su≥r
->
∑øm
.
vi˘im_pﬁicy
==
VICTIM_GREEDY
)

2311 
group
 = 
	`£À˘_vi˘im_gªedy
(
su≥r
, 1);

2313 
group
 = 
	`£À˘_vi˘im_fifo
(
su≥r
, 1);

2315 if(
group
==
NULL
){

2316 
	`¥öt_vÆid_cou¡
(
su≥r
);

2317 
	`¥ötk
(" Gªedy: Nÿvi˘im, sñe˘ed vi˘im†%d \n", 
tŸÆ_vÆid_cou¡
);

2318 
NO_VICTIM
;

2320 
	`move_group_£Æed_to_migøã_queue
(
su≥r
, 
group
, 0);

2322 
£g_off£t
 = 0;£g_off£à< 
SEGMENT_GROUP_SIZE
;seg_offset++){

2323 
£g
 = 
	`gë_£gmít_hódî_by_id
(
su≥r
, 
group
->
group_id
 * 
SEGMENT_GROUP_SIZE
 + 
£g_off£t
);

2324 
tŸÆ_vÆid_cou¡
 +
	`_£À˘_vi˘im_f‹_gc
(
su≥r
, 
num_mig
, 
£g
);

2325 
	`BUG_ON
(
£g
->
group
!=group);

2328 
ªcou¡
 +
SEGMENT_GROUP_SIZE
;

2332 if(
tŸÆ_vÆid_cou¡
 >
num_mig
 * 
	`gë_d©a_max_cou¡
(
su≥r
, 
WCBUF
))

2335 
lo›
++;

2336 if(
lo›
>=
£g_Æloˇt‹
->
£g_£Æed_cou¡
)

2339 if(
ªcou¡
 >
num_mig
*2)

2343 
NO_VICTIM
:

2345 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

2350  
ªcou¡
;

2351 
	}
}

2353 
	$£À˘_vi˘im_f‹_gc
(
dm§c_su≥r
 *
su≥r
, 
num_mig
, *
u£_gc
){

2354 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

2355 
li°_hód
 *
£Æed_queue
 = &
£g_Æloˇt‹
->sealed_queue;

2356 
£gmít_hódî
 *
£g
 = 
NULL
;

2357 
Êags
;

2358 
lo›
 = 0;

2359 
tŸÆ_vÆid_cou¡
 = 0;

2360 
ªcou¡
 = 0;

2362 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

2364 !
	`li°_em±y
(
£Æed_queue
)){

2365 
debug_cou¡
 = 0;

2367 
£g
 = 
NULL
;

2368 if(
su≥r
->
∑øm
.
vi˘im_pﬁicy
==
VICTIM_GREEDY
){

2369 
£g
 = 
	`£À˘_vi˘im_gªedy
(
su≥r
, 1);

2370 if(
£g
==
NULL
){

2371 
	`¥öt_vÆid_cou¡
(
su≥r
);

2372 
	`¥ötk
(" Gªedy: Nÿvi˘im, sñe˘ed vi˘im†%d \n", 
ªcou¡
);

2373 
NO_VICTIM
;

2377 if(
£g
==
NULL
)

2378 
£g
 = (
£gmít_hódî
 *)

2379 
	`li°_íåy
(
£Æed_queue
->
¥ev
, 
£gmít_hódî
, 
Æloc_li°
);

2381 
	`£t_bô
(
SEG_MIGRATING
, &
£g
->
Êags
);

2384 
	`©omic_ªad
(&
£g
->
num_ªad_öÊight
Ë||átomic_ªad(&£g->
num_fûlög
)) {

2385 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(100));

2386 
debug_cou¡
++;

2387 if(
debug_cou¡
>10000){

2388 
	`¥ötk
(" wait ... \n");

2389 
debug_cou¡
 = 0;

2394 if(
	`©omic_ªad
(&
£g
->
vÆid_cou¡
Ë< 
	`gë_d©a_size_ö_°rùe
(
su≥r
, seg->
£g_ty≥
)){

2396 
	`li°_add_èû
(&
£g
->
migøã_li°
, &
su≥r
->
migøã_mgr
.
migøã_queue
);

2397 
	`©omic_öc
(&
su≥r
->
migøã_mgr
.
migøã_queue_cou¡
);

2399 
	`move_£g_£Æed_to_migøã_queue
(
su≥r
, 
£g
, 0);

2401 
tŸÆ_vÆid_cou¡
 +
	`gë_d©a_vÆid_cou¡
(
su≥r
, 
£g
);

2403 
	`¥ötk
(" GC %d select victim seg = %dÜength = %d, valid count = %d \n",

2404 
ªcou¡
,

2405 ()
£g
->
£g_id
,

2406 ()
	`©omic_ªad
(&
£g
->
Àngth
),

2407 ()
	`©omic_ªad
(&
£g
->
vÆid_cou¡
));

2409 
	`BUG_ON
(!
	`ã°_bô
(
SEG_MIGRATING
, &
£g
->
Êags
));

2411 
ªcou¡
++;

2413 if(
tŸÆ_vÆid_cou¡
 > 
	`gë_d©a_max_cou¡
(
su≥r
, 
WCBUF
Ë* 
num_mig
){

2418 
	`˛ór_bô
(
SEG_MIGRATING
, &
£g
->
Êags
);

2421 
	`li°_move
(&
£g
->
Æloc_li°
, 
£Æed_queue
);

2424 
lo›
++;

2425 if(
lo›
>=
£g_Æloˇt‹
->
£g_£Æed_cou¡
)

2429 
NO_VICTIM
:

2431 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

2438 
	`¥ötk
(" GC:ÅŸÆ vÆid cou¡ = %d,Çum seg†%d \n", 
tŸÆ_vÆid_cou¡
, 
ªcou¡
);

2440  
ªcou¡
;

2441 
	}
}

2445 
	$£À˘_vi˘im_f‹_de°age
(
dm§c_su≥r
 *
su≥r
, 
num_mig
){

2446 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

2447 
li°_hód
 *
£Æed_queue
 = &
£g_Æloˇt‹
->sealed_queue;

2448 
£gmít_hódî
 *
£g
;

2449 
Êags
;

2450 
ªcou¡
 = 0;

2451 
lo›
 = 0;

2452 
tŸÆ_vÆid_cou¡
 = 0;

2454 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

2456 !
	`li°_em±y
(
£Æed_queue
)){

2458 
£g
 = 
	`£À˘_vi˘im_gªedy_cﬁd
(
su≥r
, 0);

2459 if(!
£g
)

2460 
£g
 = 
	`£À˘_vi˘im_gªedy
(
su≥r
, 0);

2462 if(!
£g
)

2463 
£g
 = (
£gmít_hódî
 *)

2464 
	`li°_íåy
(
£Æed_queue
->
¥ev
, 
£gmít_hódî
, 
Æloc_li°
);

2466 
	`˛ór_bô
(
SEG_HIT
, &
£g
->
Êags
);

2467 
	`£g_˛ór_hô_bôs
(
su≥r
, 
£g
);

2470 
	`£t_bô
(
SEG_MIGRATING
, &
£g
->
Êags
);

2473 
	`©omic_ªad
(&
£g
->
num_ªad_öÊight
Ë||átomic_ªad(&£g->
num_fûlög
)) {

2474 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(100));

2477 
	`¥ötk
(" >>>*** Destage seg = %d valid count = %d \n",

2478 ()
£g
->
£g_id
, ()
	`©omic_ªad
(&£g->
vÆid_cou¡
));

2480 
	`move_£g_£Æed_to_migøã_queue
(
su≥r
, 
£g
, 0);

2481 
	`li°_add_èû
(&
£g
->
migøã_li°
, &
su≥r
->
migøã_mgr
.
migøã_queue
);

2482 
	`©omic_öc
(&
su≥r
->
migøã_mgr
.
migøã_queue_cou¡
);

2484 
tŸÆ_vÆid_cou¡
 +
	`gë_d©a_vÆid_cou¡
(
su≥r
, 
£g
);

2486 
ªcou¡
++;

2488 if((
tŸÆ_vÆid_cou¡
+
	`gë_mëad©a_cou¡
(
su≥r
, 
£g
->
£g_ty≥
))*2 > 
STRIPE_SZ
*2){

2496 if(
ªcou¡
>=
num_mig
)

2501 if(++
lo›
>=
£g_Æloˇt‹
->
£Æed_cou¡
)

2505 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

2509  
ªcou¡
;

2510 
	}
}

2513 
	$£À˘_vi˘im_£gs
(
dm§c_su≥r
 *
su≥r
, 
num_mig
, *
u£_gc
){

2514 
ªcou¡
 = 0;

2516 if(
su≥r
->
∑øm
.
ª˛aim_pﬁicy
==
RECLAIM_SELECTIVE
 || su≥r->∑øm.ª˛aim_pﬁicy==
RECLAIM_GC
){

2518 if(
	`gë_cuº_utû
(
su≥r
Ë>su≥r->
∑øm
.
u_max
)

2519 *
u£_gc
 = 0;

2521 *
u£_gc
 = 1;

2529 }if(
su≥r
->
∑øm
.
ª˛aim_pﬁicy
==
RECLAIM_DESTAGE
){

2530 *
u£_gc
 = 0;

2533 
ªcou¡
 = 
	`£À˘_vi˘im_f‹_gc
(
su≥r
, 
num_mig
);

2535 if(
ªcou¡
){

2536 if(*
u£_gc
){

2537 
	`©omic_add
(
num_mig
, &
su≥r
->
w°©
.
gc_cou¡
);

2539 
	`©omic_add
(
num_mig
, &
su≥r
->
w°©
.
de°age_cou¡
);

2542  
ªcou¡
;

2543 
	}
}

2545 
	$migøã_¥oc
(*
d©a
)

2547 
dm§c_su≥r
 *
su≥r
 = 
d©a
;

2548 
migøti⁄_m™agî
 *
migøã_mgr
 = &
su≥r
->migrate_mgr;

2549 
u32
 
num_mig
 = 0;

2550 
u£_gc
 = 0;

2551 
u32
 
high_w©î
;

2552 
u32
 
gc_buf_max_cou¡
 = 
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
tŸÆ_∑ge_cou¡
)/10*5;

2554 
	`¥ötk
(" Migrate daemon has been started .. \n");

2558 if(
	`kthªad_should_°›
())

2561 i‡(!
	`©omic_ªad
(&
migøã_mgr
->
migøã_åiggîed
)||

2562 
	`©omic_ªad
(&
su≥r
->
degøded_mode
) ||

2563 
	`©omic_ªad
(&
su≥r
->
ªsize_mode
))

2565 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(1000));

2569 if(!
	`©omic_ªad
(&
migøã_mgr
->
background_gc_⁄
))

2570 
high_w©î
 = 
MIGRATE_HIGHWATER
;

2572 
high_w©î
 = 
MIGRATE_HIGHWATER
 * 10;

2584 #ifde‡
FORCE_UMAX


2585 if((
	`gë_Æloc_cou¡
(
su≥r
Ë>
high_w©î
 &&

2586 
	`gë_cuº_utû
(
su≥r
Ë<su≥r->
∑øm
.
u_max
) &&

2587 
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
group_Æloc_cou¡
)>1

2590 if(
	`gë_Æloc_cou¡
(
su≥r
Ë>
high_w©î
 &&

2591 
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
group_Æloc_cou¡
)>1

2594 
	`©omic_£t
(&
migøã_mgr
->
background_gc_⁄
, 0);

2595 
	`©omic_£t
(&
migøã_mgr
->
migøã_åiggîed
, 0);

2596 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(50));

2597 
	`¥ötk
(" GC Finished ... 1\n");

2598 
	`≥ndög_w‹kî_scheduÀ
(
su≥r
);

2615 
num_mig
 = 0;

2616 !
num_mig
){

2617 
num_mig
 =

2618 (
gc_buf_max_cou¡
 -

2619 
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
gc_a˘ive_∑ge_cou¡
))

2620 / 
	`gë_d©a_max_cou¡
(
su≥r
, 
WCBUF
);

2622 if(!
num_mig
)

2623 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(50));

2626 if(
num_mig
>
	`gë_Æloc_cou¡
(
su≥r
))

2627 
num_mig
 = 
	`gë_Æloc_cou¡
(
su≥r
)-1;

2629 if(!
num_mig
){

2630 
	`¥ötk
("Çum mig = %d \n", 
num_mig
);

2631 
num_mig
 = 1;

2634 
	`¥ötk
(" Sèπ:Çum mig = %d, job cou¡ = %d,á˘ivê%d,ÅŸÆ = %d (%d%%Ë‰ì = %d\n", 
num_mig
, 
	`©omic_ªad
(&
migøã_mgr
->
c›y_job_cou¡
),

2635 
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
a˘ive_∑ge_cou¡
),átomic_ªad(&su≥r->£gbuf_mgr.
tŸÆ_∑ge_cou¡
),

2636 
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
a˘ive_∑ge_cou¡
)*100/©omic_ªad(&su≥r->£gbuf_mgr.
tŸÆ_∑ge_cou¡
),

2637 
	`gë_Æloc_cou¡
(
su≥r
)

2640 
num_mig
 = 
	`£À˘_vi˘im_£gs
(
su≥r
,Çum_mig, &
u£_gc
);

2641 if(
num_mig
==0){

2642 
	`¥ötk
("Çÿvi˘im block ... u£ g¯%d, fªê%d,Çum vi˘im seg†%d\n", 
u£_gc
,

2643 
	`gë_Æloc_cou¡
(
su≥r
), 
num_mig
);

2644 
	`©omic_£t
(&
migøã_mgr
->
background_gc_⁄
, 0);

2645 
	`©omic_£t
(&
migøã_mgr
->
migøã_åiggîed
, 0);

2646 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(1000));

2650 
	`¥ötk
(" sñe˘ed vi˘im block ... u£ g¯%d, fªê%d,Çum vi˘im seg†%d\n", 
u£_gc
,

2651 
	`gë_Æloc_cou¡
(
su≥r
), 
num_mig
);

2653 
	`issue_mig_kc›yd
(
su≥r
, 
u£_gc
);

2667 
	`©omic_ªad
(&
migøã_mgr
->
c›y_job_cou¡
) &&

2668 (
gc_buf_max_cou¡
 - 
	`gë_d©a_max_cou¡
(
su≥r
, 
WCBUF
)) <

2669 
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
gc_a˘ive_∑ge_cou¡
)){

2672 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(10));

2675 
	`gë_Æloc_cou¡
(
su≥r
)<1){

2676 
	`¥ötk
("Çÿ‰ì seg†f‹ GC fªê%d \n", 
	`gë_Æloc_cou¡
(
su≥r
));

2677 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(5000));

2685 
	}
}

2688 
	$checkî_¥oc
(*
d©a
)

2690 
dm§c_su≥r
 *
su≥r
 = 
d©a
;

2691 
ötvl
;

2693 
j
;

2694 
f
;

2696 !
	`kthªad_should_°›
()) {

2699 
ötvl
 = 
	`ACCESS_ONCE
(
su≥r
->
∑øm
.
checkî_öãrvÆ
) * 1000;

2700 i‡(!
ötvl
) {

2701 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(1000));

2704 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(
ötvl
));

2707 
	`¥ötk
("---------------------------------\n");

2713 
	`¥ötk
(" CheckîÜivêöÊighàio†%d \n", 
	`©omic_ªad
(&
su≥r
->
ˇche_°©
.
öÊight_ios
));

2714 
	`¥ötk
(" CheckîÜivêöÊighàbio†%d \n", 
	`©omic_ªad
(&
su≥r
->
ˇche_°©
.
öÊight_bios
));

2724 
	`¥ötk
(" cuºíàutûiz©i⁄ = %d%%(%d/%dË\n", 
	`gë_cuº_utû
(
su≥r
),

2725 ()
NUM_USED_BLOCKS
, ()
NUM_BLOCKS
);

2731 
	`¥öt_Æloc_queue
(
su≥r
);

2733 
	`LOCK
(
su≥r
, 
f
);

2734 if(
su≥r
->
£gbuf_mgr
.
cuºít_ømbuf
[
WCBUF
]){

2735 
	`¥ötk
(" biosÅotal start = %d, count = %d,Ñefcount = %d \n",

2736 
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
cuºít_ømbuf
[
WCBUF
]->
bios_tŸÆ_°¨t
),

2737 
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
cuºít_ømbuf
[
WCBUF
]->
bios_tŸÆ_cou¡
),

2738 
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
cuºít_ømbuf
[
WCBUF
]->
ªf_cou¡
)

2754 
	`UNLOCK
(
su≥r
, 
f
);

2757 if(
su≥r
->
w°©
.
ªad_cou¡
 && su≥r->w°©.
wrôe_cou¡
){

2758 
	`¥ötk
(" hitÑatio = %dÑhit = %d, whit = %d\n",

2759 
su≥r
->
w°©
.
hô
 * 100 / su≥r->w°©.
cou¡
,

2760 
su≥r
->
w°©
.
ªad_hô
 * 100 / su≥r->w°©.
ªad_cou¡
,

2761 
su≥r
->
w°©
.
wrôe_hô
 * 100 / su≥r->w°©.
wrôe_cou¡


2763 
	`¥ötk
(" cold bypass = %dMB, seq bypass = %dMB \n",

2764 
	`©omic_ªad
(&
su≥r
->
w°©
.
cﬁd_by∑ss_cou¡
)/256,

2765 
	`©omic_ªad
(&
su≥r
->
w°©
.
£q_by∑ss_cou¡
)/256);

2767 
	`¥ötk
(" u£d = %u,ÅŸÆ = %u \n", 
	`©omic_ªad
(&
su≥r
->
ˇche_°©
.
num_u£d_blocks
), 
NUM_BLOCKS
);

2768 
	`¥ötk
(" g¯em±y cou¡ = %u\n", 
	`©omic_ªad
(&
su≥r
->
w°©
.
gc_em±y_cou¡
));

2769 
	`¥ötk
(" g¯job cou¡ = %u, de°agêjob cou¡ = %d \n", 
	`©omic_ªad
(&
su≥r
->
w°©
.
gc_cou¡
),átomic_ªad(&su≥r->w°©.
de°age_cou¡
));

2770 
	`¥ötk
(" g¯iÿcou¡ = %lu, de°agêiÿcou¡ = %lu \n", 
	`©omic64_ªad
(&
su≥r
->
w°©
.
gc_io_cou¡
),átomic64_ªad(&su≥r->w°©.
de°age_io_cou¡
));

2771 
	`¥ötk
("Öídög iÿcou¡ = %d\n", ()
	`©omic64_ªad
(&
su≥r
->
≥ndög_mgr
.
io_cou¡
));

2772 if(
	`©omic64_ªad
(&
su≥r
->
w°©
.
vi˘im_cou¡
)){

2773 
	`¥ötk
(" Average Victim Util = %d\n",

2774 ()(
	`©omic64_ªad
(&
su≥r
->
w°©
.
vi˘im_utû
)/

2775 
	`©omic64_ªad
(&
su≥r
->
w°©
.
vi˘im_cou¡
)));

2778 
	`¥ötk
("Ö¨tü»£g wrôe†%d \n", 
	`©omic_ªad
(&
su≥r
->
w°©
.
∑πül_wrôe_cou¡
));

2779 
	`¥ötk
(" by∑s†wrôe†%dMB/†\n", 
	`©omic_ªad
(&
su≥r
->
w°©
.
by∑ss_wrôe_cou¡
)/256);

2780 if(
	`©omic64_ªad
(&
su≥r
->
w°©
.
avîage_¨rivÆ_time
))

2781 
	`¥ötk
(" Average Arrival Time = %luus \n",

2782 
	`©omic64_ªad
(&
su≥r
->
w°©
.
avîage_¨rivÆ_time
)/

2783 
	`©omic64_ªad
(&
su≥r
->
w°©
.
avîage_¨rivÆ_time
));

2796 
	`queue_w‹k
(
su≥r
->
migøã_mgr
.
mig_wq
, &su≥r->migøã_mgr.
mig_w‹k
);

2798 
	`≥ndög_w‹kî_scheduÀ
(
su≥r
);

2804 
	`¥ötk
(" mig seg inflights = %d, complete = %d \n",

2805 
	`©omic_ªad
(&
su≥r
->
migøã_mgr
.
mig_öÊights
),

2806 
	`©omic_ªad
(&
su≥r
->
migøã_mgr
.
mig_com∂ëes
)

2810 
	`¥ötk
("Ñambu‡∑gêA˘ivêcou¡ = %d (%d MBË\n", ()
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
a˘ive_∑ge_cou¡
),

2811 ()
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
a˘ive_∑ge_cou¡
)/256);

2812 
	`¥ötk
("Ñambu‡∑gêI«˘ivêcou¡ = %d (%d MBË\n", ()
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
öa˘ive_∑ge_cou¡
),

2813 ()
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
öa˘ive_∑ge_cou¡
)/256);

2815 
j
 = 0;j < 
NBUF
;j++){

2816 
	`¥ötk
(" [%d]%d ", 
j
, 
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
a˘ive_cou¡
[j]));

2818 
	`¥ötk
("\n");

2821 if(
su≥r
->
∑øm
.
íabÀ_ªad_ˇche
){

2822 
	`¥ötk
(" clean dram buffer: free = %d, count = %d, sealed = %dMB\n",

2823 
su≥r
->
˛ón_døm_ˇche_m™agî
->
cm_‰ì
/256,

2824 
su≥r
->
˛ón_døm_ˇche_m™agî
->
cm_cou¡
/256,

2825 
	`©omic_ªad
(&
su≥r
->
˛ón_døm_ˇche_m™agî
->
cm_£Æed_cou¡
)/256);

2827 
	`¥ötk
("\n");

2828 
	`¥ötk
("---------------------------------\n");

2832 
	}
}

2836 
	$sync_¥oc
(
w‹k_°ru˘
 *
w‹k
)

2838 
sync_m™agî
 *
sync_mgr
 = 
	`c⁄èöî_of
(
w‹k
, sync_manager, work);

2839 
dm§c_su≥r
 *
su≥r
 = 
sync_mgr
->super;

2840 if(!
	`©omic_ªad
(&
su≥r
->
migøã_mgr
.
migøã_åiggîed
)){

2841 
	`Êush_∑πül_mëa
(
su≥r
, 
WCBUF
);

2845 
	}
}

	@daemon.h

23 #i‚de‡
DM_SRC_DAEMON_H


24 
	#DM_SRC_DAEMON_H


	)

27 
	#HOT_DATA_COPY


	)

31 
	smîge_ªq_t
{

32 
dm_io_ªgi⁄
 
	mo_ªgi⁄
;

33 
dm_io_ªgi⁄
 
	mc_ªgi⁄
;

34 
li°_hód
 
	mli°
;

39 
Êush_mëa_¥oc
(*);

43 
queue_b¨rõr_io
(
dm§c_su≥r
 *, 
bio
 *);

44 
b¨rõr_dódlöe_¥oc
(
d©a
);

45 
Êush_b¨rõr_ios
(
w‹k_°ru˘
 *);

46 
do_ªad_ˇchög_w‹kî
(
w‹k_°ru˘
 *
ws
);

50 
migøã_¥oc
(*);

51 
waô_f‹_migøti⁄
(
dm§c_su≥r
 *, 
u64
 
id
);

55 
moduœt‹_¥oc
(*);

59 
scheduÀ_sync_¥oc
(
d©a
);

60 
sync_¥oc
(
w‹k_°ru˘
 *
w‹k
);

64 
ªc‹dî_¥oc
(*);

68 
checkî_¥oc
(*);

70 
≥ndög_w‹kî
(
w‹k_°ru˘
 *
w‹k
);

71 
do_mig_w‹kî
(
w‹k_°ru˘
 *
w‹k
);

72 
issue_de„ºed_bio
(
dm§c_su≥r
 *
su≥r
, 
bio_li°
 *);

73 
ªad_ˇchög_make_job
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
mëablock
 *
mb
, 
bio
 *bio, 
ømbuf„r
 *
ømbuf
);

74 
ªad_ˇŒback
(
îr‹
, *
c⁄ãxt
);

75 
°¨t_ªcovîy
(
dm§c_su≥r
 *
su≥r
);

76 
ªcovîy_¥oc
(*
d©a
);

77 
do_ªcovîy_w‹kî
(
w‹k_°ru˘
 *
w‹k
);

78 
gí_summ¨y_io
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
,

79 
ømbuf„r
 *
ømbuf
,

80 
u32
 
idx
,

81 
u32
 
mem_idx
);

83 
gí_∑πül_summ¨y_io
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
,

84 
ømbuf„r
 *
ømbuf
);

86 
∂ug_dódlöe_¥oc
(
d©a
);

87 
upd©e_∂ug_dódlöe
(
dm§c_su≥r
 *
su≥r
);

88 
∂ug_¥oc
(
w‹k_°ru˘
 *
w‹k
);

89 
Êush_∂ug_¥oc
(
dm§c_su≥r
 *
su≥r
,

90 
£gmít_hódî
 *
£g
,

91 
ømbuf„r
 *
ømbuf
,

92 
©omic_t
 *
bios_°¨t
,

93 
©omic_t
 *
bios_cou¡
,

94 
f‹˚
,

95 
devno
,

96 
group_£Æed
);

97 
Êush_kc›y_job
(
dm§c_su≥r
 *
su≥r
, 
c›y_job_group
 *
˝_job_group
);

98 
Êush_£gmd_ídio
(
îr‹
, *
c⁄ãxt
);

99 
£gmít_hódî
 *
£À˘_vi˘im_gªedy_cﬁd
(
dm§c_su≥r
 *
su≥r
, 
u£_gc
);

100 
group_hódî
 *
£À˘_vi˘im_gªedy
(
dm§c_su≥r
 *
su≥r
, 
u£_gc
);

101 
föÆize_˛ón_£g
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
˛ónup
);

102 
gë_mëad©a_cou¡
(
dm§c_su≥r
 *
su≥r
, 
£g_ty≥
);

103 
check_∂ug_¥oc
(
dm§c_su≥r
 *
su≥r
,

104 
£gmít_hódî
 *
£g
,

105 
ømbuf„r
 *
ømbuf
,

106 
f‹˚
,

107 
devno
);

108 
˛ón_em±y_£g
(
dm§c_su≥r
 *
su≥r
, 
u£_gc
);

109 
gë_d©a_max_cou¡
(
dm§c_su≥r
 *
su≥r
, 
£g_ty≥
);

110 
gë_d©a_vÆid_cou¡
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
);

111 
ˇlc_mëa_cou¡
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
);

112 
ˇlc_vÆid_cou¡
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
u£_gc
);

113 
£g_wrôe_w‹kî
(
w‹k_°ru˘
 *
w‹k
);

	@dm-src.mod.c

1 
	~<löux/moduÀ.h
>

2 
	~<löux/vîmagic.h
>

3 
	~<löux/compûî.h
>

5 
MODULE_INFO
(
vîmagic
, 
VERMAGIC_STRING
);

7 
moduÀ
 
__this_moduÀ


8 
__©åibuã__
((
£˘i⁄
(".gnu.linkonce.this_module"))) = {

9 .
«me
 = 
KBUILD_MODNAME
,

10 .
	göô
 = 
öô_moduÀ
,

11 #ifde‡
CONFIG_MODULE_UNLOAD


12 .
	gexô
 = 
˛ónup_moduÀ
,

14 .
	g¨ch
 = 
MODULE_ARCH_INIT
,

17 c⁄° 
modvîsi⁄_öfo
 
	g____vîsi⁄s
[]

18 
__u£d


19 
__©åibuã__
((
£˘i⁄
("__versions"))) = {

20 { 0x79833446, 
__VMLINUX_SYMBOL_STR
(
moduÀ_œyout
) },

21 { 0x8487a2b6, 
__VMLINUX_SYMBOL_STR
(
Êush_w‹k
) },

22 { 0x7Øabf54, 
__VMLINUX_SYMBOL_STR
(
Æloc_∑ges_cuºít
) },

23 { 0x2d3385d3, 
__VMLINUX_SYMBOL_STR
(
sy°em_wq
) },

24 { 0x47df7f70, 
__VMLINUX_SYMBOL_STR
(
fs_bio_£t
) },

25 { 0xó645b46, 
__VMLINUX_SYMBOL_STR
(
kmÆloc_ˇches
) },

26 { 0x65e75cb6, 
__VMLINUX_SYMBOL_STR
(
__li°_dñ_íåy
) },

27 { 0xd2b09˚5, 
__VMLINUX_SYMBOL_STR
(
__kmÆloc
) },

28 { 0x9b388444, 
__VMLINUX_SYMBOL_STR
(
gë_zî€d_∑ge
) },

29 { 0x4c4„f19, 
__VMLINUX_SYMBOL_STR
(
kî√l_°ack
) },

30 { 0xf4f1923c, 
__VMLINUX_SYMBOL_STR
(
bio_Æloc_bio£t
) },

31 { 0xd6ì688f, 
__VMLINUX_SYMBOL_STR
(
vmÆloc
) },

32 { 0xa21de278, 
__VMLINUX_SYMBOL_STR
(
dm_gë_devi˚
) },

33 { 0x5769fbcc, 
__VMLINUX_SYMBOL_STR
(
dm_io
) },

34 { 0x43a53735, 
__VMLINUX_SYMBOL_STR
(
__Æloc_w‹kqueue_key
) },

35 { 0xe7f3608a, 
__VMLINUX_SYMBOL_STR
(
hπimî_f‹w¨d
) },

36 { 0xc8b57c27, 
__VMLINUX_SYMBOL_STR
(
aut‹emove_wake_fun˘i⁄
) },

37 { 0x79Ø04a2, 
__VMLINUX_SYMBOL_STR
(
gë_øndom_byãs
) },

38 { 0x46608Á0, 
__VMLINUX_SYMBOL_STR
(
gën°imeofday
) },

39 { 0x94313d7, 
__VMLINUX_SYMBOL_STR
(
hπimî_ˇn˚l
) },

40 { 0x6d0f1f89, 
__VMLINUX_SYMBOL_STR
(
dm_èbÀ_gë_mode
) },

41 { 0xb54533f7, 
__VMLINUX_SYMBOL_STR
(
u£cs_to_jiffõs
) },

42 { 0x88bÁ7e, 
__VMLINUX_SYMBOL_STR
(
ˇn˚l_w‹k_sync
) },

43 { 0xefba93e1, 
__VMLINUX_SYMBOL_STR
(
mempoﬁ_de°roy
) },

44 { 0x999e8297, 
__VMLINUX_SYMBOL_STR
(
v‰ì
) },

45 { 0xe979bb8c, 
__VMLINUX_SYMBOL_STR
(
dm_ªgi°î_èrgë
) },

46 { 0x236437f6, 
__VMLINUX_SYMBOL_STR
(
kthªad_¸óã_⁄_node
) },

47 { 0x7d11c268, 
__VMLINUX_SYMBOL_STR
(
jiffõs
) },

48 { 0x343a1a8, 
__VMLINUX_SYMBOL_STR
(
__li°_add
) },

49 { 0x9e4Áìf, 
__VMLINUX_SYMBOL_STR
(
dm_io_˛õ¡_de°roy
) },

50 { 0xf432dd3d, 
__VMLINUX_SYMBOL_STR
(
__öô_waôqueue_hód
) },

51 { 0xfdfcb8cb, 
__VMLINUX_SYMBOL_STR
(
øid6_ˇŒ
) },

52 { 0xfb578fc5, 
__VMLINUX_SYMBOL_STR
(
mem£t
) },

53 { 0xe988104b, 
__VMLINUX_SYMBOL_STR
(
dm_£t_èrgë_max_io_Àn
) },

54 { 0x8f64Ø4, 
__VMLINUX_SYMBOL_STR
(
_øw_•ö_u∆ock_úqª°‹e
) },

55 { 0xcff55457, 
__VMLINUX_SYMBOL_STR
(
cuºít_èsk
) },

56 { 0x5b6c00e6, 
__VMLINUX_SYMBOL_STR
(
x‹_blocks
) },

57 { 0x37befc70, 
__VMLINUX_SYMBOL_STR
(
jiffõs_to_m£cs
) },

58 { 0x27e1a049, 
__VMLINUX_SYMBOL_STR
(
¥ötk
) },

59 { 0xØ35286, 
__VMLINUX_SYMBOL_STR
(
kthªad_°›
) },

60 { 0x449ad0a7, 
__VMLINUX_SYMBOL_STR
(
memcmp
) },

61 { 0xd4b08e54, 
__VMLINUX_SYMBOL_STR
(
waô_f‹_com∂ëi⁄_io
) },

62 { 0xa9668691, 
__VMLINUX_SYMBOL_STR
(
dm_uƒegi°î_èrgë
) },

63 { 0xØfdc258, 
__VMLINUX_SYMBOL_STR
(
°rˇ£cmp
) },

64 { 0x5eb24829, 
__VMLINUX_SYMBOL_STR
(
dm_shi·_¨g
) },

65 { 0x802d0e93, 
__VMLINUX_SYMBOL_STR
(
¸c32_À
) },

66 { 0x8c03d20c, 
__VMLINUX_SYMBOL_STR
(
de°roy_w‹kqueue
) },

67 { 0x521445b, 
__VMLINUX_SYMBOL_STR
(
li°_dñ
) },

68 { 0x46„b099, 
__VMLINUX_SYMBOL_STR
(
dm_ªad_¨g
) },

69 { 0xd0c50de0, 
__VMLINUX_SYMBOL_STR
(
gíîic_make_ªque°
) },

70 { 0x4Áì48d, 
__VMLINUX_SYMBOL_STR
(
bio_ídio
) },

71 { 0x68e5292c, 
__VMLINUX_SYMBOL_STR
(
bio_put
) },

72 { 0x1a996ab6, 
__VMLINUX_SYMBOL_STR
(
submô_bio
) },

73 { 0x13b715e2, 
__VMLINUX_SYMBOL_STR
(
blk_föish_∂ug
) },

74 { 0x5190a966, 
__VMLINUX_SYMBOL_STR
(
__‰ì_∑ges
) },

75 { 0xe9dff136, 
__VMLINUX_SYMBOL_STR
(
mempoﬁ_Æloc
) },

76 { 0x93fˇ811, 
__VMLINUX_SYMBOL_STR
(
__gë_‰ì_∑ges
) },

77 { 0x3bd1b1f6, 
__VMLINUX_SYMBOL_STR
(
m£cs_to_jiffõs
) },

78 { 0xd62c833f, 
__VMLINUX_SYMBOL_STR
(
scheduÀ_timeout
) },

79 { 0xa202a8e5, 
__VMLINUX_SYMBOL_STR
(
kmÆloc_‹dî_åa˚
) },

80 { 0x3f71Áa1, 
__VMLINUX_SYMBOL_STR
(
mempoﬁ_¸óã
) },

81 { 0x6e8bf789, 
__VMLINUX_SYMBOL_STR
(
hπimî_°¨t
) },

82 { 0xe4b051cf, 
__VMLINUX_SYMBOL_STR
(
øid6_d©≠_ªcov
) },

83 { 0x6a037cf1, 
__VMLINUX_SYMBOL_STR
(
mempoﬁ_k‰ì
) },

84 { 0x2c925659, 
__VMLINUX_SYMBOL_STR
(
wake_up_¥o˚ss
) },

85 { 0xbdfb6dbb, 
__VMLINUX_SYMBOL_STR
(
__„¡ry__
) },

86 { 0xc497f84c, 
__VMLINUX_SYMBOL_STR
(
kmem_ˇche_Æloc_åa˚
) },

87 { 0x4Ød52d7, 
__VMLINUX_SYMBOL_STR
(
mempoﬁ_‰ì
) },

88 { 0x9327f5˚, 
__VMLINUX_SYMBOL_STR
(
_øw_•ö_lock_úqßve
) },

89 { 0x4302d0eb, 
__VMLINUX_SYMBOL_STR
(
‰ì_∑ges
) },

90 { 0xcf21d241, 
__VMLINUX_SYMBOL_STR
(
__wake_up
) },

91 { 0xb3f7646e, 
__VMLINUX_SYMBOL_STR
(
kthªad_should_°›
) },

92 { 0x601f665f, 
__VMLINUX_SYMBOL_STR
(
dm_io_˛õ¡_¸óã
) },

93 { 0xa05c03df, 
__VMLINUX_SYMBOL_STR
(
mempoﬁ_kmÆloc
) },

94 { 0x9c55˚c, 
__VMLINUX_SYMBOL_STR
(
scheduÀ_timeout_öãºu±ibÀ
) },

95 { 0x37a0cba, 
__VMLINUX_SYMBOL_STR
(
k‰ì
) },

96 { 0x5c8b5˚8, 
__VMLINUX_SYMBOL_STR
(
¥ï¨e_to_waô
) },

97 { 0x25a97010, 
__VMLINUX_SYMBOL_STR
(
hπimî_öô
) },

98 { 0xÁ66f77c, 
__VMLINUX_SYMBOL_STR
(
föish_waô
) },

99 { 0x1803a6ed, 
__VMLINUX_SYMBOL_STR
(
øid6_2d©a_ªcov
) },

100 { 0x90b0da35, 
__VMLINUX_SYMBOL_STR
(
dm_put_devi˚
) },

101 { 0x2e0d2f7f, 
__VMLINUX_SYMBOL_STR
(
queue_w‹k_⁄
) },

102 { 0x4b06d2e7, 
__VMLINUX_SYMBOL_STR
(
com∂ëe
) },

103 { 0x65d67a20, 
__VMLINUX_SYMBOL_STR
(
blk_°¨t_∂ug
) },

104 { 0xe914e41e, 
__VMLINUX_SYMBOL_STR
(
°r˝y
) },

107 c⁄° 
	g__moduÀ_dïíds
[]

108 
__u£d


109 
__©åibuã__
((
£˘i⁄
(".modinfo"))) =

113 
MODULE_INFO
(
§cvîsi⁄
, "DC624E3ABFC0CBE6BB64C5C");

	@header.h

23 #i‚de‡
DM_SRC_HEADER_H


24 
	#DM_SRC_HEADER_H


	)

38 
	#RESERVED_START
 0

	)

39 
	#RESERVED_LENGTH
 
GROUP_SZ_SECTOR


40 

	)

41 
	#MAX_CACHE_DEVS
 8

	)

43 #i‚de‡
__KERNEL__


44 
u_öt64_t
 
	t£˘‹_t
;

55 
	#SRC_MAGIC
 0x57427374

	)

56 
	ssu≥rblock_devi˚
 {

58 
__u32
 
	mmagic
;

59 
__u32
 
	muuid
;

60 
__u32
 
	m¸óã_time
;

61 
£˘‹_t
 
	mssd_devsize
;

62 
£˘‹_t
 
	mhdd_devsize
;

63 
__u32
 
	mblock_size
;

64 
__u32
 
	mchunk_size
;

65 
__u32
 
	mchunk_group_size
;

66 
__u32
 
	mchunks_≥r_group
;

67 
__u32
 
	m∑rôy_Æloˇti⁄
;

68 
__u32
 
	m°rùög_pﬁicy
;

69 
__u32
 
	md©a_Æloˇti⁄
;

70 
__u32
 
	mîasuª_code
;

71 
__u32
 
	mhŸ_idítifiˇti⁄
;

72 
__u32
 
	mª˛aim_pﬁicy
;

73 
__u32
 
	mvi˘im_pﬁicy
;

74 
__u32
 
	mømbuf_poﬁ_amou¡
;

75 
__u32
 
	mÊush_comm™d
;

77 
__u32
 
	mÆig√d_io_dummy
;

79 
__u32
 
	mnum_chunks
;

80 
__u32
 
	mnum_blocks_≥r_chunk
;

81 
__u32
 
	mnum_blocks_≥r_ssd
;

83 
__u32
 
	mnum_groups
;

85 
__u32
 
	mnum_summ¨y_≥r_chunk
;

86 
__u32
 
	mnum_íåy_≥r_∑ge
;

87 } 
__©åibuã__
((
∑cked
));

89 
	#MB_SEAL
 0

	)

90 
	#MB_DIRTY
 1

	)

91 
	#MB_VALID
 2

	)

92 
	#MB_PARITY
 3

	)

93 
	#MB_DUMMY
 4

	)

94 
	#MB_SKIP
 5

	)

95 
	#MB_SUMMARY
 6

	)

96 
	#MB_BROKEN
 7

	)

97 
	#MB_PARITY_NEED
 8

	)

98 
	#MB_PARITY_WRITTEN
 9

	)

99 
	#MB_HIT
 10

	)

107 
	smëablock
 {

108 #ifde‡
__KERNEL__


109 
hli°_node
 
	mht_li°
;

111 
__u64
 
	mht_li°
;

113 
	mmb_Êags
;

114 
£˘‹_t
 
	m£˘‹
;

115 
__u32
 
	midx
;

116 
__u16
 
	mchecksum
;

117 } 
__©åibuã__
((
∑cked
));

126 
	smëablock_devi˚
 {

127 
__u32
 
	m£˘‹
;

128 
__u8
 
	mdúty_bôs
;

129 
__u8
 
	mchecksum
;

130 
__u8
 
	m∑ddög
[8 - (4 + 1 + 1)];

131 } 
__©åibuã__
((
∑cked
));

134 
	#SEGMENT_HEADER_SIZE
 4096

	)

139 
	#FLUSH_NONE
 0

	)

140 
	#FLUSH_FINE
 1

	)

141 
	#FLUSH_COARSE
 2

	)

144 
	#ERASURE_CODE_NONE
 0

	)

145 
	#ERASURE_CODE_PARITY
 1

	)

146 
	#ERASURE_CODE_RAID6
 2

	)

149 
	#PARITY_ALLOC_FIXED
 0

	)

150 
	#PARITY_ALLOC_ROTAT
 1

	)

153 
	#ALIGNED_IO_DUMMY
 0

	)

154 
	#ALIGNED_IO_SKIP
 1

	)

157 
	#DATA_ALLOC_VERT
 0

	)

158 
	#DATA_ALLOC_HORI
 1

	)

159 
	#DATA_ALLOC_FLEX_VERT
 2

	)

160 
	#DATA_ALLOC_FLEX_HORI
 3

	)

163 
	#SEPAR_STRIPING
 0

164 
	#MIXED_STRIPING
 1

165 

	)

167 
	#VICTIM_CLOCK
 0

	)

168 
	#VICTIM_LRU
 1

	)

169 
	#VICTIM_GREEDY
 2

	)

172 
	#RECLAIM_SELECTIVE
 0

173 
	#RECLAIM_DESTAGE
 1

174 
	#RECLAIM_GC
 2

175 

	)

177 
	#GC_WITHOUT_DIRTY_SYNC
 0

	)

178 
	#GC_WITH_DIRTY_SYNC
 1

	)

180 
	#DEFAULT_U_MAX
 90

	)

181 
	#MIN_FREE
 10

182 

	)

183 
	#NUM_GC_THREAD
 8

	)

185 
	#MAX_MIGRATE_INFLIGHT_NUM
 10

	)

187 
	#DEFAULT_MIGRATE_LOWWATER
 20

	)

188 
	#DEFAULT_MIGRATE_HIGHWATER
 40

	)

191 
	#HIT_BITMAP_PER_STRIPE
 0

	)

192 
	#HIT_BITMAP_PER_BLOCK
 1

	)

195 
	#SUMMARY_PER_CHUNK
 1

	)

196 
	#SUMMARY_PER_STRIPE
 2

197 
	#SUMMARY_SCHEME
 
SUMMARY_PER_CHUNK


	)

200 
	#WCBUF
 0

201 
	#WHBUF
 1

202 
	#RCBUF
 2

203 
	#RHBUF
 3

204 
	#GWBUF
 4

205 
	#GRBUF
 5

206 
	#RCVBUF
 6

207 
	#NBUF
 7

	)

209 
	#is_wrôe_°rùe
(
x
Ë(x==
WCBUF
||x==
WHBUF
||x==
GWBUF
)

	)

210 
	#is_ªad_°rùe
(
x
Ë(x==
RCBUF
||x==
RHBUF
||x==
GRBUF
)

	)

211 
	#is_n‹mÆ_°rùe
(
x
Ë(x==
RCBUF
 || x==
RHBUF
 || x==
WCBUF
|| x==
WHBUF
)

	)

212 
	#is_gc_°rùe
(
x
Ë(x==
GRBUF
 || x==
GWBUF
)

	)

213 
	#is_cﬁd_°rùe
(
x
Ë(x==
WCBUF
 || x==
RCBUF
)

	)

216 
	#SECTOR_SHIFT
 9

	)

217 
	#SECTOR_SIZE
 (1 << 
SECTOR_SHIFT
)

	)

218 
	#SECTORS_PER_PAGE_SHIFT
 (
PAGE_SHIFT
 - 
SECTOR_SHIFT
)

	)

219 
	#SECTORS_PER_PAGE
 (1 << 
SECTORS_PER_PAGE_SHIFT
)

	)

222 
	#SRC_SIZE_SHIFT
 0

226 

	)

227 
	#SRC_PAGE_SIZE
 ((
SECTOR_SIZE
 * 
SECTORS_PER_PAGE
)<<
SRC_SIZE_SHIFT
)

	)

228 
	#SRC_SECTORS_PER_PAGE
 (
SRC_PAGE_SIZE
/
SECTOR_SIZE
)

	)

229 
	#SRC_SECTORS_PER_PAGE_SHIFT
 (
SECTORS_PER_PAGE_SHIFT
+
SRC_SIZE_SHIFT
)

	)

234 
	#USE_GHOST_BUFFER


	)

235 
	#USE_PENDING_WORKER


	)

237 
	#USE_LAST_SUMMARY
 0

	)

238 
	#USE_FIRST_SUMMARY
 1

	)

239 
	#SUMMARY_LOCATION
 
USE_LAST_SUMMARY


	)

241 #ifde‡
USE_CHECKSUM


242 
	#NUM_SUMMARY
 2

	)

245 
	#NUM_SUMMARY
 (
su≥r
->
∑øm
.
num_summ¨y_≥r_chunk
)

	)

246 
	#NUM_ENTRY_PER_PAGE
 (
su≥r
->
∑øm
.
num_íåy_≥r_∑ge
)

	)

249 
	#USE_SEG_WRITER
 0

	)

	@lru.c

23 
	~"èrgë.h
"

24 
	~"mëad©a.h
"

25 
	~"Ãu.h
"

26 
	~<löux/°rög.h
>

27 
	~<löux/li°.h
>

29 
	#ASSERT
 
as£π


	)

31 
	$Ãu_›í
(
ˇche_m™agî
 *
c
,
ˇche_size
){

32 
i
;

34 
	`INIT_LIST_HEAD
 ( &
c
->
cm_hód
 );

35 
	`INIT_LIST_HEAD
 ( &
c
->
cm_‰ì_hód
 );

37 
c
->
cm_ªf
 = 0;

38 
c
->
cm_hô
 = 0;

39 
c
->
cm_miss
 = 0;

40 
c
->
cm_size
 = 
ˇche_size
;

41 
c
->
cm_‰ì
 = 
ˇche_size
;

42 
c
->
cm_cou¡
 = 0;

43 
	`©omic_£t
(&
c
->
cm_£Æed_cou¡
, 0);

45 
c
->
cm_hash
 = 
	`œrge_¨øy_Æloc
((
hli°_hód
), 
ˇche_size
);

46 if(
c
->
cm_hash
 =
NULL
){

47 
	`¥ötk
(" MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

48 
	`BUG_ON
(1);

51 
i
 = 0;ò< 
ˇche_size
;i++){

52 
hli°_hód
 *
hash
;

53 
hash
 = (
hli°_hód
 *)
	`œrge_¨øy_©
(
c
->
cm_hash
, (
u64
)
i
);

54 
	`INIT_HLIST_HEAD
 ( 
hash
 );

57 
c
->
cm_ˇche
 = 
	`œrge_¨øy_Æloc
((
Ãu_node
), 
ˇche_size
);

58 if(
c
->
cm_ˇche
 =
NULL
){

59 
	`¥ötk
(" MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

60 
	`BUG_ON
(1);

63 
i
=0;i<
ˇche_size
;i++){

64 
Ãu_node
 *
 
;

65 
 
 = 
	`œrge_¨øy_©
(
c
->
cm_ˇche
, 
i
);

66 if(!
 
)

69 
	`mem£t
((*)
 
, 0x00, (
Ãu_node
));

70 
	`li°_add
–&
 
->
˙_li°
, &
c
->
cm_‰ì_hód
 );

72 
 
->
˙_∑ge
 = 
	`Æloc_∑ge
(
__GFP_NOWARN
 | 
__GFP_NORETRY
);

73 if(!
 
->
˙_∑ge
){

74 
	`¥ötk
("áŒo¯∑gêEº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

75 
	`BUG_ON
(1);

78 
	}
}

82 
	$Ãu_˛o£
(
ˇche_m™agî
 *
c
){

83 
Ãu_node
 *
 
, *
ãmp
;

85 
	`li°_f‹_óch_íåy_ß„
(
 
, 
ãmp
, &
c
->
cm_hód
, 
˙_li°
){

86 
	`__‰ì_∑ge
(
 
->
˙_∑ge
);

87 
	`li°_dñ
 ( & 
 
->
˙_li°
 );

88 
	`hli°_dñ
 ( & 
 
->
˙_hash
 );

91 
	`li°_f‹_óch_íåy_ß„
(
 
, 
ãmp
, &
c
->
cm_‰ì_hód
, 
˙_li°
){

92 
	`__‰ì_∑ge
(
 
->
˙_∑ge
);

93 
	`li°_dñ
 ( & 
 
->
˙_li°
 );

96 
	`BUG_ON
 ( !
	`li°_em±y
 ( &
c
->
cm_hód
 ) );

97 
	`BUG_ON
 ( !
	`li°_em±y
 ( &
c
->
cm_‰ì_hód
 ) );

99 
	`œrge_¨øy_‰ì
(
c
->
cm_hash
);

100 
	`œrge_¨øy_‰ì
(
c
->
cm_ˇche
);

101 
	}
}

103 
Ãu_node
 *
	$Ãu_¥e£¨ch
(
ˇche_m™agî
 *
c
, 
£˘‹_t
 
blkno
){

104 
hli°_node
 *
node
;

105 
hli°_hód
 *
hód
;

106 
Ãu_node
 *
 
;

108 
hód
 = (
hli°_hód
 *)
	`œrge_¨øy_©
(
c
->
cm_hash
, 
blkno
%c->
cm_size
);

109 
	`hli°_f‹_óch
 ( 
node
, 
hód
 ) {

110 
 
 = 
	`hli°_íåy
–
node
, 
Ãu_node
, 
˙_hash
 );

111 i‡–
 
->
˙_blkno
 =
blkno
 )

112  
 
;

115  
NULL
;

116 
	}
}

119 
Ãu_node
 *
	$Ãu_£¨ch
(
ˇche_m™agî
 *
c
, 
£˘‹_t
 
blkno
){

120 
Ãu_node
 *
 
;

122 
c
->
cm_ªf
++;

123 
 
 = 
	`Ãu_¥e£¨ch
 ( 
c
, 
blkno
 );

124 if(
 
){

125 
c
->
cm_hô
++;

126  
 
;

128 
c
->
cm_miss
++;

131  
NULL
;

132 
	}
}

135 
	$Ãu_movemru
(
ˇche_m™agî
 *
c
, 
Ãu_node
 *
 
 ) {

136 
	`li°_dñ
 ( &
 
->
˙_li°
 );

137 
	`li°_add
–&
 
->
˙_li°
, &
c
->
cm_hód
 );

138 
	}
}

140 *
	$Ãu_ªmove
(
ˇche_m™agî
 *
c
, 
Ãu_node
 *
 
 ) {

141 
	`li°_dñ
 ( &
 
->
˙_li°
 );

142 
	`hli°_dñ
 ( &
 
->
˙_hash
 );

144 
c
->
cm_‰ì
++;

145 
c
->
cm_cou¡
--;

146  (*)
 
;

147 
	}
}

150 *
	$Ãu_Æloc
(
ˇche_m™agî
 *
c
, 
Ãu_node
 *
 
, 
£˘‹_t
 
blkno
){

151 *
±r
;

152 if(
 
 =
NULL
){

153 
 
 = 
	`li°_fú°_íåy
–&
c
->
cm_‰ì_hód
, 
Ãu_node
, 
˙_li°
);

154 
	`li°_dñ
(&
 
->
˙_li°
);

157 
±r
 = 
 
->
˙_∑ge
;

158 
	`mem£t
((*)
 
, 0x00, (
Ãu_node
));

159 
 
->
˙_∑ge
 = 
±r
;

161 
 
->
˙_blkno
 = 
blkno
;

162  
 
;

163 
	}
}

165 
	$Ãu_ö£π
(
ˇche_m™agî
 *
c
,
Ãu_node
 *
 
){

166 
hli°_hód
 *
hash
;

168 
	`li°_add
–&
 
->
˙_li°
, &
c
->
cm_hód
 );

170 
hash
 = 
	`œrge_¨øy_©
(
c
->
cm_hash
, (
 
->
˙_blkno
Ë% c->
cm_size
);

171 
	`hli°_add_hód
–&
 
->
˙_hash
, 
hash
 ) ;

173 
c
->
cm_‰ì
--;

174 
c
->
cm_cou¡
++;

175 
	}
}

178 *
	$Ãu_ª∂a˚
(
ˇche_m™agî
 *
c
, 
w©îm¨k
){

179 
li°_hód
 *
ªmove_±r
;

180 
Ãu_node
 *
vi˘im
 = 
NULL
;

182 i‡–
c
->
cm_‰ì
 < 
w©îm¨k
 + 1 ) {

183 
ªmove_±r
 = (
li°_hód
 *)(&
c
->
cm_hód
)->
¥ev
;

184 
vi˘im
 = 
	`li°_íåy
 ( 
ªmove_±r
, 
Ãu_node
, 
˙_li°
 );

185 
vi˘im
 = 
	`CACHE_REMOVE
(
c
, victim);

188  
vi˘im
;

189 
	}
}

191 
	$Ãu_öô
(
ˇche_m™agî
 **
c
,*
«me
, 
size
,
high
,
low
){

192 *
c
 = (
ˇche_m™agî
 *)
	`kmÆloc
((ˇche_m™agî), 
GFP_KERNEL
);

193 if(*
c
 =
NULL
){

194 
	`¥ötk
(" MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

195 
	`BUG_ON
(1);

199 
	`mem£t
(*
c
, 0x00, (
ˇche_m™agî
));

201 
	`•ö_lock_öô
(&((*
c
)->
lock
));

203 (*
c
)->
ˇche_›í
 = 
Ãu_›í
;

204 (*
c
)->
ˇche_˛o£
 = 
Ãu_˛o£
;

205 (*
c
)->
ˇche_¥e£¨ch
 = 
Ãu_¥e£¨ch
;

206 (*
c
)->
ˇche_£¨ch
 = 
Ãu_£¨ch
;

207 (*
c
)->
ˇche_ª∂a˚
 = 
Ãu_ª∂a˚
;

208 (*
c
)->
ˇche_ªmove
 = 
Ãu_ªmove
;

209 (*
c
)->
ˇche_move_mru
 = 
Ãu_movemru
;

210 (*
c
)->
ˇche_ö£π
 = 
Ãu_ö£π
;

211 (*
c
)->
ˇche_Æloc
 = 
Ãu_Æloc
;

213 
	`CACHE_OPEN
((*
c
), 
size
);

215 (*
c
)->
cm_loww©î
 = 
low
;

216 (*
c
)->
cm_highw©î
 = 
high
;

217 
	}
}

219 
	$Ãu_deöô
(
ˇche_m™agî
 *
Ãu_m™agî
){

220 
	`CACHE_CLOSE
(
Ãu_m™agî
);

221 
	`k‰ì
(
Ãu_m™agî
);

222 
	}
}

225 
Ãu_node
 *
	$m_Ãu_ö£π
(
ˇche_m™agî
 **
Ãu_m™agî
, 
k
, 
blkno
){

226 
Ãu_node
 *
 
;

227 
j
;

229 
j
 = 
k
;j > 0;j--){

230 
Ãu_node
 *
vi˘im_ 
;

231 
vi˘im_ 
 = 
	`CACHE_REPLACE
(
Ãu_m™agî
[
j
], 0);

232 if(
vi˘im_ 
){

233 
	`k‰ì
(
vi˘im_ 
);

236 
vi˘im_ 
 = 
	`CACHE_REPLACE
(
Ãu_m™agî
[
j
-1], 0);

237 if(
vi˘im_ 
){

238 
	`CACHE_INSERT
(
Ãu_m™agî
[
j
], 
vi˘im_ 
);

242 
 
 = 
	`CACHE_ALLOC
(
Ãu_m™agî
[0], 
NULL
, 
blkno
);

244 
	`CACHE_INSERT
(
Ãu_m™agî
[0], 
 
);

246  
 
;

247 
	}
}

250 
ˇche_m™agî
 **
	$mÃu_öô
(*
«me
,
Ãu_num
, 
tŸÆ_size
){

251 
ˇche_m™agî
 **
Ãu_m™agî
;

252 
°r
[128];

253 
i
;

256 
Ãu_m™agî
 = (
ˇche_m™agî
 **)
	`kmÆloc
((ˇche_m™agî *Ë* 
Ãu_num
, 
GFP_KERNEL
);

257 if(
Ãu_m™agî
 =
NULL
){

258 
	`¥ötk
(" MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

259 
	`BUG_ON
(1);

262 
	`mem£t
(
Ãu_m™agî
, 0x00, (
ˇche_m™agî
 *Ë* 
Ãu_num
);

265 if(
tŸÆ_size
%
Ãu_num
){

268 
i
 = 0;ò< 
Ãu_num
;i++){

270 
	`Ãu_öô
(&
Ãu_m™agî
[
i
],
°r
, 
tŸÆ_size
/
Ãu_num
, 1, 0);

273  
Ãu_m™agî
;

274 
	}
}

276 
	$mÃu_exô
(
ˇche_m™agî
 **
Ãu_m™agî
,
Ãu_num
){

277 
i
;

279 
mÃu_hô
 = 0;

281 
i
 = 0;ò< 
Ãu_num
;i++){

283 
mÃu_hô
 +
Ãu_m™agî
[
i
]->
cm_hô
;

284 
	`CACHE_CLOSE
(
Ãu_m™agî
[
i
]);

289 
	}
}

293 
	$mÃu_ªmove
(
ˇche_m™agî
 **
Ãu_m™agî
,
Ãu_num
, 
blkno
){

295 
Ãu_node
 *
 
=
NULL
;

296 
j
;

298 
j
 = 0;j < 
Ãu_num
;j++){

299 
 
 = 
	`CACHE_SEARCH
(
Ãu_m™agî
[
j
], 
blkno
);

300 if(
 
){

305 if(
 
){

306 
 
 = 
	`CACHE_REMOVE
(
Ãu_m™agî
[
j
],Ün);

307 
	`k‰ì
(
 
);

310 
	}
}

312 
Ãu_node
 *
	$mÃu_£¨ch
(
ˇche_m™agî
 **
Ãu_m™agî
,
Ãu_num
, 
blkno
, 
ö£π
,
hô
, *
hô_posôi⁄
){

313 
Ãu_node
 *
 
=
NULL
;

314 
j
;

316 
j
 = 0;j < 
Ãu_num
;j++){

317 
 
 = 
	`CACHE_SEARCH
(
Ãu_m™agî
[
j
], 
blkno
);

319 i‡–
hô_posôi⁄
 )

320 *
hô_posôi⁄
 = 
j
;

322 if(
 
){

336 if(!
hô
){

337 
Ãu_m™agî
[0]->
cm_ªf
--;

338 if(
 
){

339 
Ãu_m™agî
[
j
]->
cm_hô
--;

343 if(!
ö£π
){

344  
 
;

347 if(!
 
){

348 
 
 = 
	`m_Ãu_ö£π
(
Ãu_m™agî
, 
Ãu_num
 - 1, 
blkno
);

350 
 
 = 
	`CACHE_REMOVE
(
Ãu_m™agî
[
j
],Ün);

351 
	`k‰ì
(
 
);

352 
 
 = 
	`m_Ãu_ö£π
(
Ãu_m™agî
, 
j
, 
blkno
);

355  
 
;

356 
	}
}

	@lru.h

23 
	~<löux/li°.h
>

24 
	~"mëad©a.h
"

26 #i‚de‡
_CACHE_H


27 
	#_CACHE_H


	)

29 
	sÃu_node
{

30 
li°_hód
 
	m˙_li°
;

31 
li°_hód
 
	m˙_wrôe_li°
;

32 
hli°_node
 
	m˙_hash
;

33 
∑ge
 *
	m˙_∑ge
;

35 
£˘‹_t
 
	m˙_blkno
;

36 
u32
 
	m¸c32
;

37 
	m˙_ªad_hô
;

38 
	m˙_wrôe_hô
;

39 
	m˙_ªad_ªf
;

40 
	m˙_wrôe_ªf
;

41 
	m˙_Æloc_by_gc
;

42 
©omic_t
 
	m£Æed
;

43 
©omic_t
 
	mlocked
;

46 
	sˇche_m™agî
{

47 
•ölock_t
 
	mlock
;

48 
li°_hód
 
	mcm_hód
;

49 
li°_hód
 
	mcm_‰ì_hód
;

50 
œrge_¨øy
 *
	mcm_hash
;

51 
œrge_¨øy
 *
	mcm_ˇche
;

53 
	mcm_hô
;

54 
	mcm_miss
;

55 
	mcm_ªf
;

56 
	mcm_ªad_hô
;

57 
	mcm_ªad_ªf
;

59 
©omic_t
 
	mcm_£Æed_cou¡
;

61 
	mcm_size
;

62 
	mcm_‰ì
;

63 
	mcm_cou¡
;

64 
	mcm_mö
;

65 *
	mcm_«me
;

67 
	mcm_loww©î
;

68 
	mcm_highw©î
;

70 (*
	mˇche_›í
)(
ˇche_m™agî
 *
	mˇche
,
	mˇche_size
);

71 (*
	mˇche_˛o£
)(
ˇche_m™agî
 *
	mˇche
);

72 
	mÃu_node
 *(*
	mˇche_¥e£¨ch
)(
ˇche_m™agî
 *
	mˇche
, 
£˘‹_t
 
	mblkno
);

73 
	mÃu_node
 *(*
	mˇche_£¨ch
)(
ˇche_m™agî
 *
	mˇche
, 
£˘‹_t
 
	mblkno
);

74 *(*
	mˇche_ª∂a˚
)(
ˇche_m™agî
 *
	mˇche
, 
	mw
);

75 *(*
	mˇche_ªmove
)(
ˇche_m™agî
 *
	mˇche
, 
Ãu_node
 *
	m 
);

76 (*
	mˇche_move_mru
)(
ˇche_m™agî
 *
	mˇche
, 
Ãu_node
 *
	m 
);

77 (*
	mˇche_ö£π
)(
ˇche_m™agî
 *
	mˇche
, 
Ãu_node
 *
	mnode
);

78 *(*
	mˇche_Æloc
)(
ˇche_m™agî
 *
	mˇche
, 
Ãu_node
 *
	mnode
, 
£˘‹_t
 
	mblkno
);

79 (*
	mˇche_öc
)(
ˇche_m™agî
 *
	mˇche
, 
	mi
);

80 (*
	mˇche_dec
)(
ˇche_m™agî
 *
	mˇche
, 
	mi
);

83 
	#CACHE_OPEN
(
c
, 
sz
Ëc->
	`ˇche_›í
((
ˇche_m™agî
 *)c, sz)

	)

84 
	#CACHE_CLOSE
(
c
 ) c->
	`ˇche_˛o£
((
ˇche_m™agî
 *)c)

	)

85 
	#CACHE_PRESEARCH
(
c
, 
p
Ëc->
	`ˇche_¥e£¨ch
((
ˇche_m™agî
 *)c,Ö)

	)

86 
	#CACHE_SEARCH
(
c
, 
p
Ëc->
	`ˇche_£¨ch
((
ˇche_m™agî
 *)c,Ö)

	)

87 
	#CACHE_REPLACE
(
c
, 
w
Ëc->
	`ˇche_ª∂a˚
((
ˇche_m™agî
 *)c, w)

	)

88 
	#CACHE_MOVEMRU
(
c
, 
w
Ëc->
	`ˇche_move_mru
((
ˇche_m™agî
 *)c, w)

	)

89 
	#CACHE_REMOVE
(
c
, 
p
Ëc->
	`ˇche_ªmove
((
ˇche_m™agî
 *)c,Ö)

	)

90 
	#CACHE_INSERT
(
c
, 
p
Ëc->
	`ˇche_ö£π
((
ˇche_m™agî
 *)c,Ö)

	)

91 
	#CACHE_ALLOC
(
c
, 
n
, 
p
Ëc->
	`ˇche_Æloc
(c,Ç,Ö)

	)

92 
	#CACHE_PRINT
(
c
, 
p
Ëc->
	`ˇche_¥öt
((
ˇche_m™agî
 *)c,Ö)

	)

95 
Ãu_›í
(
ˇche_m™agî
 *
c
,
ˇche_size
);

96 
Ãu_˛o£
(
ˇche_m™agî
 *
c
);

97 
Ãu_node
 *
Ãu_¥e£¨ch
(
ˇche_m™agî
 *
c
, 
£˘‹_t
 
blkno
);

98 
Ãu_node
 *
Ãu_£¨ch
(
ˇche_m™agî
 *
c
, 
£˘‹_t
 
blkno
);

99 *
Ãu_ªmove
(
ˇche_m™agî
 *
c
, 
Ãu_node
 *
 
);

100 *
Ãu_Æloc
(
ˇche_m™agî
 *
c
, 
Ãu_node
 *
 
, 
£˘‹_t
 
blkno
);

101 
Ãu_ö£π
(
ˇche_m™agî
 *
c
,
Ãu_node
 *
 
);

102 *
Ãu_ª∂a˚
(
ˇche_m™agî
 *
c
, 
w©îm¨k
);

103 
Ãu_öô
(
ˇche_m™agî
 **
c
,*
«me
, 
size
,
high
,
low
);

104 
Ãu_deöô
(
ˇche_m™agî
 *
Ãu_m™agî
);

105 
Ãu_move_˛ón_li°
 ( 
ˇche_m™agî
 *
c
, 
Ãu_node
 *
 
 );

108 
Ãu_node
 *
mÃu_£¨ch
(
ˇche_m™agî
 **
Ãu_m™agî
,
Ãu_num
, 
blkno
, 
ö£π
,
hô
, *
hô_posôi⁄
);

109 
mÃu_ªmove
(
ˇche_m™agî
 **
Ãu_m™agî
,
Ãu_num
, 
blkno
);

110 
ˇche_m™agî
 **
mÃu_öô
(*
«me
,
Ãu_num
, 
tŸÆ_size
);

111 
mÃu_exô
(
ˇche_m™agî
 **
Ãu_m™agî
,
Ãu_num
);

	@metadata.c

23 
	~<löux/vmÆloc.h
>

24 
	~<löux/¸c32.h
>

25 
	~"èrgë.h
"

26 
	~"mëad©a.h
"

27 
	~"d´m⁄.h
"

28 
	~"Æloc.h
"

29 
	~"hódî.h
"

30 
	~<löux/li°.h
>

31 
	~<löux/log2.h
>

32 
	~<löux/øndom.h
>

34 
u32
 
	$gë_cuº_utû
(
dm§c_su≥r
 *
su≥r
){

35 
u32
 
utû
=0;

37 if(
	`©omic_ªad
(&
su≥r
->
ˇche_°©
.
num_u£d_blocks
)){

38 
utû
 = (
u32
)((
u64
)
	`©omic_ªad
(&
su≥r
->
ˇche_°©
.
num_u£d_blocks
)*100/
NUM_BLOCKS
);

40 if(
utû
>=100)

41 
utû
 = 0;

44  
utû
;

45 
	}
}

47 #ifde‡
KMALLOC


48 
u32
 
	$num_ñems_ö_∑π
(
œrge_¨øy
 *
¨r
)

50  
	`div_u64
(
ALLOC_SIZE
, 
¨r
->
ñemsize
);

51 
	}
}

54 
u64
 
	$num_∑πs
(
œrge_¨øy
 *
¨r
)

56 
u64
 
a
 = 
¨r
->
num_ñems
;

57 
u32
 
b
 = 
	`num_ñems_ö_∑π
(
¨r
);

58  
	`div_u64
(
a
 + 
b
 - 1, b);

59 
	}
}

62 
œrge_¨øy
 *
	$œrge_¨øy_Æloc
(
u32
 
ñemsize
, 
u64
 
num_ñems
)

64 
∑π
 *part;

65 
u64
 
Æloc_size
 = 0;

67 #ifde‡
VMALLOC


68 
œrge_¨øy
 *
¨r
 = 
	`kmÆloc
((*¨r), 
GFP_KERNEL
);

69 i‡(!
¨r
) {

70 
	`WBERR
("failedÅoállocárr");

71  
NULL
;

74 
¨r
->
ñemsize
 =Élemsize;

75 
¨r
->
num_ñems
 =Çum_elems;

76 
¨r
->
∑πs
 = 
	`kmÆloc
((
∑π
), 
GFP_KERNEL
);

77 i‡(!
¨r
->
∑πs
) {

78 
	`WBERR
("failedÅoállocÖarts");

79 
bad_Æloc_∑πs
;

81 
∑π
 = 
¨r
->
∑πs
 + 0;

82 
∑π
->
mem‹y
 = 
	`vmÆloc
(
ñemsize
 * 
num_ñems
);

83 i‡(!
∑π
->
mem‹y
) {

84 
	`WBERR
("failedÅoállocÖart memory");

85 
	`v‰ì
(
∑π
->
mem‹y
);

86 
bad_Æloc_∑πs_mem‹y
;

89 
Æloc_size
 = 
ñemsize
 * 
num_ñems
;

90 
	`¥ötk
(" Mëad©®AŒoˇti⁄: %ŒuMB (%Œu)\n", 
Æloc_size
/1024/1024,álloc_size);

92 
u64
 
i
, 
j
;

93 
œrge_¨øy
 *
¨r
 = 
	`kmÆloc
((*¨r), 
GFP_KERNEL
);

94 i‡(!
¨r
) {

95 
	`WBERR
("failedÅoállocárr");

96  
NULL
;

99 
¨r
->
ñemsize
 =Élemsize;

100 
¨r
->
num_ñems
 =Çum_elems;

101 
¨r
->
∑πs
 = 
	`kmÆloc
((
∑π
Ë* 
	`num_∑πs
◊º), 
GFP_KERNEL
);

102 i‡(!
¨r
->
∑πs
) {

103 
	`WBERR
("failedÅoállocÖarts");

104 
bad_Æloc_∑πs
;

107 
i
 = 0; i < 
	`num_∑πs
(
¨r
); i++) {

108 
∑π
 = 
¨r
->
∑πs
 + 
i
;

109 
∑π
->
mem‹y
 = 
	`kmÆloc
(
ALLOC_SIZE
, 
GFP_KERNEL
);

111 
Æloc_size
 +
ALLOC_SIZE
;

112 i‡(!
∑π
->
mem‹y
) {

113 
	`WBERR
("failedÅoállocÖart memory");

114 
j
 = 0; j < 
i
; j++) {

115 
∑π
 = 
¨r
->
∑πs
 + 
j
;

116 
	`k‰ì
(
∑π
->
mem‹y
);

118 
bad_Æloc_∑πs_mem‹y
;

121 
	`¥ötk
(" Mëad©®AŒoˇti⁄: %ŒuMB (%Œu)\n", 
Æloc_size
/1024/1024,álloc_size);

124  
¨r
;

126 
bad_Æloc_∑πs_mem‹y
:

127 
	`k‰ì
(
¨r
->
∑πs
);

128 
bad_Æloc_∑πs
:

129 
	`k‰ì
(
¨r
);

131  
NULL
;

132 
	}
}

134 
	$œrge_¨øy_‰ì
(
œrge_¨øy
 *
¨r
)

137 #ifde‡
VMALLOC


138 
∑π
 *∑π = 
¨r
->
∑πs
 + 0;

139 
	`v‰ì
(
∑π
->
mem‹y
);

141 
size_t
 
i
;

142 
i
 = 0; i < 
	`num_∑πs
(
¨r
); i++) {

143 
∑π
 *∑π = 
¨r
->
∑πs
 + 
i
;

145 
	`k‰ì
(
∑π
->
mem‹y
);

147 
	`k‰ì
(
¨r
->
∑πs
);

148 
	`k‰ì
(
¨r
);

150 
	}
}

151 #ifde‡
KMALLOC


152 *
	$œrge_¨øy_©
(
œrge_¨øy
 *
¨r
, 
u64
 
i
)

154 
u32
 
n
 = 
	`num_ñems_ö_∑π
(
¨r
);

155 
u32
 
k
;

156 
u64
 
j
 = 
	`div_u64_ªm
(
i
, 
n
, &
k
);

157 
∑π
 *∑π = 
¨r
->
∑πs
 + 
j
;

158  
∑π
->
mem‹y
 + (
¨r
->
ñemsize
 * 
k
);

159 
	}
}

161 *
	$œrge_¨øy_©
(
œrge_¨øy
 *
¨r
, 
u32
 
i
)

163 
∑π
 *∑π = 
¨r
->
∑πs
 + 0;

164 
	`BUG_ON
(
i
>=
¨r
->
num_ñems
);

165  
∑π
->
mem‹y
 + (
¨r
->
ñemsize
 * 
i
);

166 
	}
}

174 
mëablock
 *
	$mb_©
(
dm§c_su≥r
 *
su≥r
, 
u32
 
idx
)

176 
mëablock
 *
mb
;

177 
u32
 
devno
 = (
idx
 / 
CHUNK_SZ
Ë% 
NUM_SSD
;

178 
u32
 
off£t
 = 
idx
 / 
STRIPE_SZ
 * 
CHUNK_SZ
 + (idx % CHUNK_SZ);

180 if(
off£t
>=
NUM_BLOCKS_PER_SSD
){

181 
	`¥ötk
(" idx = %u\n", 
idx
);

182 
	`¥ötk
(" devnÿ%u, off£à%u \n", 
devno
, 
off£t
);

183 
	`¥ötk
("Çum block†≥∏ssd = %u \n", 
NUM_BLOCKS_PER_SSD
);

184 
	`¥ötk
("Çum block†%u \n", 
NUM_BLOCKS
);

185 
	`BUG_ON
(1);

188 
mb
 = (
mëablock
 *)
	`œrge_¨øy_©
(
su≥r
->
mëablock_¨øy
[
devno
], 
off£t
);

190  
mb
;

191 
	}
}

193 
ölöe
 
mëablock
 *
	$gë_mb
(
dm§c_su≥r
 *
su≥r
, 
u32
 
£g_id
, u32 
idx
){

194  
	`mb_©
(
su≥r
, 
£g_id
 * 
STRIPE_SZ
 + 
idx
);

195 
	}
}

197 
	$mb_¨øy_em±y_öô
(
dm§c_su≥r
 *
su≥r
)

199 
u32
 
i
;

200 
i
 = 0; i < 
NUM_BLOCKS
; i++) {

201 
mëablock
 *
mb
 = 
	`mb_©
(
su≥r
, 
i
);

203 
	`INIT_HLIST_NODE
(&
mb
->
ht_li°
);

205 
mb
->
idx
 = 
i
;

206 
mb
->
£˘‹
 = ~0;

207 
mb
->
mb_Êags
 = 0;

210 
	`˛ór_bô
(
MB_DIRTY
, &
mb
->
mb_Êags
);

211 
	`˛ór_bô
(
MB_VALID
, &
mb
->
mb_Êags
);

212 
	`˛ór_bô
(
MB_SEAL
, &
mb
->
mb_Êags
);

213 
	`˛ór_bô
(
MB_META
, &
mb
->
mb_Êags
);

214 
	`˛ór_bô
(
MB_SUMMARY
, &
mb
->
mb_Êags
);

215 
	`˛ór_bô
(
MB_BROKEN
, &
mb
->
mb_Êags
);

216 
	`˛ór_bô
(
MB_PARITY_NEED
, &
mb
->
mb_Êags
);

217 
	`˛ór_bô
(
MB_PARITY_WRITTEN
, &
mb
->
mb_Êags
);

220 
	}
}

222 
	$check_dúty_cou¡
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
cur_£g
){

223 
i
;

224 
dúty_cou¡
 = 0;

226 
i
 = 0; i < 
STRIPE_SZ
; i++) {

227 
mëablock
 *
mb
 = 
	`gë_mb
(
su≥r
, 
cur_£g
->
£g_id
, 
i
);

228 if(
	`ã°_bô
(
MB_DIRTY
, &
mb
->
mb_Êags
)||

229 
	`ã°_bô
(
MB_PARITY
, &
mb
->
mb_Êags
)||

230 
	`ã°_bô
(
MB_SUMMARY
, &
mb
->
mb_Êags
)){

231 
dúty_cou¡
++;

235 if(
	`is_wrôe_°rùe
(
cur_£g
->
£g_ty≥
)){

236 
dúty_cou¡
 +
NUM_SUMMARY
*
NUM_DATA_SSD
;

237 if(
	`USE_ERASURE_PARITY
(&
su≥r
->
∑øm
))

238 
dúty_cou¡
 +
CHUNK_SZ
;

240 
dúty_cou¡
 +(
NUM_SUMMARY
*
NUM_SSD
);

243  
dúty_cou¡
;

244 
	}
}

246 
	$check_vÆid_cou¡
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
cur_£g
){

247 
i
;

248 
vÆid_cou¡
 = 0;

250 
i
 = 0; i < 
STRIPE_SZ
; i++) {

251 
mëablock
 *
mb
 = 
	`gë_mb
(
su≥r
, 
cur_£g
->
£g_id
, 
i
);

252 if(
	`ã°_bô
(
MB_VALID
, &
mb
->
mb_Êags
)||

253 
	`ã°_bô
(
MB_PARITY
, &
mb
->
mb_Êags
)||

254 
	`ã°_bô
(
MB_SUMMARY
, &
mb
->
mb_Êags
)){

255 
vÆid_cou¡
++;

258 if(
	`is_wrôe_°rùe
(
cur_£g
->
£g_ty≥
)){

259 if(
	`ã°_bô
(
MB_DIRTY
, &
mb
->
mb_Êags
Ë!ã°_bô(
MB_VALID
, &mb->mb_flags)){

260 
	`¥ötk
(" seg id = %d offset = %d Invalid mb dirty mb valid = %d %d \n",

261 ()
cur_£g
->
£g_id
,

262 
i
,

263 ()
	`ã°_bô
(
MB_VALID
, &
mb
->
mb_Êags
),

264 ()
	`ã°_bô
(
MB_DIRTY
, &
mb
->
mb_Êags
));

271 if(
	`is_wrôe_°rùe
(
cur_£g
->
£g_ty≥
)){

272 
vÆid_cou¡
 +
NUM_SUMMARY
*
NUM_DATA_SSD
;

273 if(
	`USE_ERASURE_PARITY
(&
su≥r
->
∑øm
))

274 
vÆid_cou¡
 +
CHUNK_SZ
;

276 
vÆid_cou¡
 +(
NUM_SUMMARY
*
NUM_SSD
);

279  
vÆid_cou¡
;

280 
	}
}

282 
	$mb_¨øy_ßnôy_check
(
dm§c_su≥r
 *
su≥r
)

284 
u32
 
i
;

285 
u32
 
£g_id
;

286 
£gmít_hódî
 *
cur_£g
;

288 
£g_id
 = 0; seg_id < 
su≥r
->
ˇche_°©
.
num_£gmíts
; seg_id++) {

289 
vÆid_cou¡
 = 0;

290 
dúty_cou¡
 = 0;

291 
cur_£g
 = 
	`gë_£gmít_hódî_by_id
(
su≥r
, 
£g_id
);

293 if(
	`ã°_bô
(
SEG_CLEAN
, &
cur_£g
->
Êags
))

296 
vÆid_cou¡
 = 
	`check_vÆid_cou¡
(
su≥r
, 
cur_£g
);

297 
dúty_cou¡
 = 
	`check_dúty_cou¡
(
su≥r
, 
cur_£g
);

306 if(
vÆid_cou¡
!=
	`©omic_ªad
(&
cur_£g
->valid_count)){

307 
	`¥ötk
(" InvÆid seg id = %d, vÆid = %d %d \n", 
£g_id
, 
vÆid_cou¡
,

308 ()
	`©omic_ªad
(&
cur_£g
->
vÆid_cou¡
));

310 if(
dúty_cou¡
!=
	`©omic_ªad
(&
cur_£g
->dirty_count)){

311 
	`¥ötk
(" InvÆid seg id = %d, dúty = %d %d \n", 
£g_id
, 
dúty_cou¡
,

312 ()
	`©omic_ªad
(&
cur_£g
->
dúty_cou¡
));

317 
i
 = 0; i < 
NUM_BLOCKS
; i++) {

318 
mëablock
 *
mb
 = 
	`mb_©
(
su≥r
, 
i
);

320 if(
mb
->
£˘‹
=~0 && (
	`ã°_bô
(
MB_DIRTY
, &mb->
mb_Êags
) ||

321 
	`ã°_bô
(
MB_VALID
, &
mb
->
mb_Êags
)))

323 
	`¥ötk
(" %d: sector = %d, dirty = %d, valid = %d \n",

324 
i
, ()
mb
->
£˘‹
, 
	`ã°_bô
(
MB_DIRTY
, &mb->
mb_Êags
),

325 
	`ã°_bô
(
MB_VALID
, &
mb
->
mb_Êags
));

328 
	}
}

330 
	$£g_°©
(
£gmít_hódî
 *
£g
){

331 
ªs
 = 0;

332 
cou¡
 = 0;

334 if(
	`ã°_bô
(
SEG_CLEAN
, &
£g
->
Êags
)){

335 
ªs
 +
SEG_CLEAN
;

336 
cou¡
++;

339 if(
	`ã°_bô
(
SEG_USED
, &
£g
->
Êags
)){

340 
ªs
 +
SEG_USED
;

341 
cou¡
++;

343 if(
	`ã°_bô
(
SEG_SEALED
, &
£g
->
Êags
)){

344 
ªs
 +
SEG_SEALED
;

345 
cou¡
++;

348 if(
	`ã°_bô
(
SEG_MIGRATING
, &
£g
->
Êags
)){

349 
ªs
 +
SEG_MIGRATING
;

350 
cou¡
++;

352 if(
	`ã°_bô
(
SEG_PARTIAL
, &
£g
->
Êags
)){

353 
ªs
 +
SEG_PARTIAL
;

354 
cou¡
++;

356 if(
	`ã°_bô
(
SEG_RECOVERY
, &
£g
->
Êags
)){

357 
ªs
 +
SEG_RECOVERY
;

358 
cou¡
++;

360 if(
	`ã°_bô
(
SEG_HIT
, &
£g
->
Êags
)){

361 
ªs
 +
SEG_HIT
;

362 
cou¡
++;

365 if(
cou¡
 == 1){

366  
ªs
;

368 
	`¥ötk
(" sèà%d cou¡ = %d \n", 
ªs
, 
cou¡
);

371 
	}
}

373 
	$¥öt_Æloc_queue
(
dm§c_su≥r
 *
su≥r
){

374 
Êags
;

375 
£gmít_hódî
 *
£g
;

376 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

378 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

379 
	`¥ötk
(" seg:álloc = %d, used = %d, sealed = %d, migrate = %d\n",

380 ()
	`©omic_ªad
(&
£g_Æloˇt‹
->
£g_Æloc_cou¡
), ()£g_Æloˇt‹->
£g_u£d_cou¡
,

381 ()
£g_Æloˇt‹
->
£g_£Æed_cou¡
,

382 ()
	`©omic_ªad
(&
£g_Æloˇt‹
->
£g_migøã_cou¡
));

386 
	`li°_f‹_óch_íåy
(
£g
, &
£g_Æloˇt‹
->
£g_u£d_queue
, 
Æloc_li°
){

387 
	`¥ötk
("áŒoc_queue: seg id = %d inu£ = %dÜígth = %dÅy≥ = %d, bufc›y = %d, bio†%d \n", ()
£g
->
£g_id
,

388 
	`£g_°©
(
£g
), ()
	`©omic_ªad
(&£g->
Àngth
), ()£g->
£g_ty≥
,

389 ()
	`©omic_ªad
(&
£g
->
num_bufc›y
), (Ôtomic_ªad(&£g->
bios_cou¡
));

392 
	`¥ötk
(" group:álloc = %d, used = %d, sealed = %d, migrate = %d\n",

393 ()
	`©omic_ªad
(&
£g_Æloˇt‹
->
group_Æloc_cou¡
), ()£g_Æloˇt‹->
group_u£d_cou¡
,

394 ()
£g_Æloˇt‹
->
group_£Æed_cou¡
,

395 ()
	`©omic_ªad
(&
£g_Æloˇt‹
->
group_migøã_cou¡
));

397 
	`¥ötk
("\n");

401 
cou¡
 = 0;

402 
	`li°_f‹_óch_íåy
(
£g
, &
£g_Æloˇt‹
->
migøã_queue
, 
Æloc_li°
){

403 
	`¥ötk
(" migøã_queue: seg id = %d inu£ = %dÜígth = %d vÆid = %dÅy≥ = %d, bufc›y = %d \n", ()
£g
->
£g_id
,

404 
	`£g_°©
(
£g
), ()
	`©omic_ªad
(&£g->
Àngth
),

405 ()
	`©omic_ªad
(&
£g
->
vÆid_cou¡
),

406 ()
£g
->
£g_ty≥
,

407 ()
	`©omic_ªad
(&
£g
->
num_bufc›y
));

408 
cou¡
++;

409 if(
cou¡
>100)

414 
	`¥ötk
("\n");

417 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

418 
	}
}

420 
	$ö£π_group_to_Æloc_queue
(
dm§c_su≥r
 *
su≥r
, 
group_hódî
 *
group
){

421 
Êags
;

422 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

423 
li°_hód
 *
queue
 = &
£g_Æloˇt‹
->
group_Æloc_queue
;

425 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

426 
	`li°_add
(&
group
->
Æloc_li°
, 
queue
);

427 
	`©omic_öc
(&
£g_Æloˇt‹
->
group_Æloc_cou¡
);

428 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

432 
	}
}

434 
	$ö£π_£g_to_Æloc_queue
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
){

435 
Êags
;

436 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

437 
li°_hód
 *
queue
 = &
£g_Æloˇt‹
->
£g_Æloc_queue
;

439 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

440 
	`li°_add
(&
£g
->
Æloc_li°
, 
queue
);

441 
	`©omic_öc
(&
£g_Æloˇt‹
->
£g_Æloc_cou¡
);

442 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

444 if(
	`©omic_ªad
(&
£g_Æloˇt‹
->
£g_Æloc_cou¡
)>=
MIGRATE_LOWWATER
)

445 
	`wake_up_öãºu±ibÀ
(&
£g_Æloˇt‹
->
Æloc_waô_queue
);

446 
	}
}

448 
	$em±y_Æloc_queue
(
dm§c_su≥r
 *
su≥r
){

449 
Êags
;

450 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

451 
li°_hód
 *
queue
 = &
£g_Æloˇt‹
->
£g_Æloc_queue
;

452 
em±y
;

454 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

455 
em±y
 = 
	`li°_em±y
(
queue
);

456 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

457  
em±y
;

458 
	}
}

461 
	$ªÀa£_ª£rve_£gs
(
dm§c_su≥r
 *
su≥r
){

462 
Êags
;

463 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

464 
li°_hód
 *
Æloc_queue
 = &
£g_Æloˇt‹
->alloc_queue;

465 
li°_hód
 *
ª£rve_queue
 = &
£g_Æloˇt‹
->reserve_queue;

466 
£gmít_hódî
 *
£g
, *
ãmp
;

467 
cou¡
 = 0;

469 if(!
	`©omic_ªad
(&
£g_Æloˇt‹
->
ª£rve_cou¡
))

472 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

474 
	`li°_f‹_óch_íåy_ß„
(
£g
, 
ãmp
, 
ª£rve_queue
, 
Æloc_li°
){

475 
	`li°_dñ
(&
£g
->
Æloc_li°
);

476 
	`©omic_dec
(&
£g_Æloˇt‹
->
ª£rve_cou¡
);

478 
	`li°_add
(&
£g
->
Æloc_li°
, 
Æloc_queue
);

479 
	`©omic_öc
(&
£g_Æloˇt‹
->
Æloc_cou¡
);

480 
cou¡
 = 0;

487 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

489 if(
	`©omic_ªad
(&
£g_Æloˇt‹
->
Æloc_cou¡
)>=
MIGRATE_LOWWATER
)

490 
	`wake_up_öãºu±ibÀ
(&
£g_Æloˇt‹
->
Æloc_waô_queue
);

491 
	}
}

493 
	$ª£rve_ª£rve_£gs
(
dm§c_su≥r
 *
su≥r
, 
√ed_£gs
){

494 
Êags
;

495 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

496 
li°_hód
 *
Æloc_queue
 = &
£g_Æloˇt‹
->alloc_queue;

497 
li°_hód
 *
ª£rve_queue
 = &
£g_Æloˇt‹
->reserve_queue;

498 
li°_hód
 *
±r
;

499 
£gmít_hódî
 *
£g
;

500 
ªs
 = 1;

501 
i
;

503 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

509 if(
	`©omic_ªad
(&
£g_Æloˇt‹
->
Æloc_cou¡
Ë< 
√ed_£gs
){

510 
ªs
 = 0;

511 
föish
;

516 
i
 = 0;ò< 
√ed_£gs
;i++){

517 
±r
 = 
Æloc_queue
->
¥ev
;

518 
£g
 = (
£gmít_hódî
 *)

519 
	`li°_íåy
(
±r
, 
£gmít_hódî
, 
Æloc_li°
);

520 
	`li°_dñ
(&
£g
->
Æloc_li°
);

521 
	`©omic_dec
(&
£g_Æloˇt‹
->
Æloc_cou¡
);

523 
	`li°_add
(&
£g
->
Æloc_li°
, 
ª£rve_queue
);

524 
	`©omic_öc
(&
£g_Æloˇt‹
->
ª£rve_cou¡
);

529 
föish
:;

530 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

531  
ªs
;

532 
	}
}

536 
£gmít_hódî
 *
	$ªmove_ª£rve_queue
(
dm§c_su≥r
 *
su≥r
){

537 
Êags
;

538 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

539 
li°_hód
 *
queue
 = &
£g_Æloˇt‹
->
ª£rve_queue
;

540 
li°_hód
 *
±r
;

541 
£gmít_hódî
 *
£g
;

543 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

544 
±r
 = 
queue
->
¥ev
;

545 if(!
	`li°_em±y
(
queue
)){

546 
£g
 = (
£gmít_hódî
 *)

547 
	`li°_íåy
(
±r
, 
£gmít_hódî
, 
Æloc_li°
);

548 
	`li°_dñ
(&
£g
->
Æloc_li°
);

549 
	`©omic_dec
(&
£g_Æloˇt‹
->
ª£rve_cou¡
);

552 
	`BUG_ON
(1);

553 
£g
 = 
NULL
;

555 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

556  
£g
;

557 
	}
}

560 
group_hódî
 *
	$ªmove_Æloc_group_queue
(
dm§c_su≥r
 *
su≥r
){

561 
Êags
;

562 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

563 
li°_hód
 *
queue
 = &
£g_Æloˇt‹
->
group_Æloc_queue
;

564 
li°_hód
 *
±r
;

565 
group_hódî
 *
group
;

567 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

568 
±r
 = 
queue
->
¥ev
;

569 if(!
	`li°_em±y
(
queue
)){

570 
group
 = (
group_hódî
 *)

571 
	`li°_íåy
(
±r
, 
group_hódî
, 
Æloc_li°
);

572 
	`li°_dñ
(&
group
->
Æloc_li°
);

573 
	`©omic_dec
(&
£g_Æloˇt‹
->
group_Æloc_cou¡
);

575 
group
 = 
NULL
;

577 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

578  
group
;

579 
	}
}

581 
£gmít_hódî
 *
	$ªmove_Æloc_queue
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
){

582 
Êags
;

583 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

584 
li°_hód
 *
queue
 = &
£g_Æloˇt‹
->
£g_Æloc_queue
;

585 
li°_hód
 *
±r
;

588 
	`BUG_ON
(
£g
==
NULL
);

589 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

590 
±r
 = 
queue
->
¥ev
;

591 if(!
	`li°_em±y
(
queue
)){

594 
	`li°_dñ
(&
£g
->
Æloc_li°
);

595 
	`©omic_dec
(&
£g_Æloˇt‹
->
£g_Æloc_cou¡
);

597 
£g
 = 
NULL
;

599 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

600  
£g
;

601 
	}
}

603 
	$ö£π_group_to_u£d_queue
(
dm§c_su≥r
 *
su≥r
, 
group_hódî
 *
group
){

604 
Êags
;

605 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

606 
li°_hód
 *
queue
 = &
£g_Æloˇt‹
->
group_u£d_queue
;

608 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

609 
	`li°_add
(&
group
->
Æloc_li°
, 
queue
);

610 
£g_Æloˇt‹
->
group_u£d_cou¡
++;

611 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

612 
	}
}

614 
	$ö£π_£g_to_u£d_queue
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
){

615 
Êags
;

616 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

617 
li°_hód
 *
queue
 = &
£g_Æloˇt‹
->
£g_u£d_queue
;

619 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

620 
	`li°_add
(&
£g
->
Æloc_li°
, 
queue
);

621 
£g_Æloˇt‹
->
£g_u£d_cou¡
++;

622 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

623 
	}
}

625 
	$em±y_£Æed_queue
(
dm§c_su≥r
 *
su≥r
){

626 
Êags
;

627 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

628 
li°_hód
 *
queue
 = &
£g_Æloˇt‹
->
£g_£Æed_queue
;

629 
em±y
;

631 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

632 
em±y
 = 
	`li°_em±y
(
queue
);

633 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

634  
em±y
;

635 
	}
}

637 
	$gë_group_Æloc_cou¡
(
dm§c_su≥r
 *
su≥r
){

638 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

639 
Êags
;

640 
cou¡
;

642 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

643 
cou¡
 = 
	`©omic_ªad
(&
£g_Æloˇt‹
->
group_Æloc_cou¡
);

644 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

645  
cou¡
;

646 
	}
}

648 
	$gë_Æloc_cou¡
(
dm§c_su≥r
 *
su≥r
){

649 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

650 
Êags
;

651 
cou¡
;

653 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

654 
cou¡
 = 
	`©omic_ªad
(&
£g_Æloˇt‹
->
£g_Æloc_cou¡
);

655 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

656  
cou¡
;

657 
	}
}

660 
	$move_group_u£d_to_£Æed_queue
(
dm§c_su≥r
 *
su≥r
, 
group_hódî
 *
group
){

661 
Êags
;

662 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

663 
li°_hód
 *
queue
 = &
£g_Æloˇt‹
->
group_£Æed_queue
;

665 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

666 
	`li°_dñ
(&
group
->
Æloc_li°
);

667 
	`li°_add_èû
(&
group
->
Æloc_li°
, 
queue
);

668 
	`BUG_ON
(
£g_Æloˇt‹
->
group_u£d_cou¡
==0);

669 
£g_Æloˇt‹
->
group_u£d_cou¡
--;

670 
£g_Æloˇt‹
->
group_£Æed_cou¡
++;

671 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

672 
	}
}

674 
	$move_£g_u£d_to_£Æed_queue
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
){

675 
Êags
;

676 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

677 
li°_hód
 *
queue
 = &
£g_Æloˇt‹
->
£g_£Æed_queue
;

679 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

680 
	`li°_dñ
(&
£g
->
Æloc_li°
);

681 
	`li°_add
(&
£g
->
Æloc_li°
, 
queue
);

682 
	`BUG_ON
(
£g_Æloˇt‹
->
£g_u£d_cou¡
==0);

683 
£g_Æloˇt‹
->
£g_u£d_cou¡
--;

684 
£g_Æloˇt‹
->
£g_£Æed_cou¡
++;

685 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

686 
	}
}

688 
	$move_£g_mru_£Æed
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
){

689 
Êags
;

690 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

691 
li°_hód
 *
queue
 = &
£g_Æloˇt‹
->
£g_£Æed_queue
;

693 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

694 
	`li°_dñ
(&
£g
->
Æloc_li°
);

695 
	`li°_add
(&
£g
->
Æloc_li°
, 
queue
);

696 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

697 
	}
}

699 
	$move_group_£Æed_to_migøã_queue
(
dm§c_su≥r
 *
su≥r
, 
group_hódî
 *
group
, 
lock
){

700 
Êags
;

701 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

702 
li°_hód
 *
queue
 = &
£g_Æloˇt‹
->
group_migøã_queue
;

704 if(
lock
)

705 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

707 
	`li°_dñ
(&
group
->
Æloc_li°
);

708 
	`li°_add
(&
group
->
Æloc_li°
, 
queue
);

709 
£g_Æloˇt‹
->
group_£Æed_cou¡
--;

710 
	`©omic_öc
(&
£g_Æloˇt‹
->
group_migøã_cou¡
);

712 if(
lock
)

713 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

714 
	}
}

717 
	$move_£g_£Æed_to_migøã_queue
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
lock
){

718 
Êags
;

719 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

720 
li°_hód
 *
queue
 = &
£g_Æloˇt‹
->
£g_migøã_queue
;

722 if(
lock
)

723 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

725 
	`li°_dñ
(&
£g
->
Æloc_li°
);

726 
	`li°_add
(&
£g
->
Æloc_li°
, 
queue
);

727 
£g_Æloˇt‹
->
£g_£Æed_cou¡
--;

728 
	`©omic_öc
(&
£g_Æloˇt‹
->
£g_migøã_cou¡
);

730 if(
lock
)

731 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

732 
	}
}

734 
	$move_£g_migøã_to_£Æed_queue
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
){

735 
Êags
;

736 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

737 
li°_hód
 *
queue
 = &
£g_Æloˇt‹
->
£g_£Æed_queue
;

739 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

740 
	`li°_dñ
(&
£g
->
Æloc_li°
);

741 
	`li°_add
(&
£g
->
Æloc_li°
, 
queue
);

742 
	`©omic_dec
(&
£g_Æloˇt‹
->
£g_migøã_cou¡
);

743 
£g_Æloˇt‹
->
£g_£Æed_cou¡
--;

744 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

745 
	}
}

747 
	$move_group_migøã_to_Æloc_queue
(
dm§c_su≥r
 *
su≥r
, 
group_hódî
 *
group
){

748 
Êags
;

749 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

750 
li°_hód
 *
queue
 = &
£g_Æloˇt‹
->
group_Æloc_queue
;

752 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

753 
	`li°_dñ
(&
group
->
Æloc_li°
);

754 
	`li°_add
(&
group
->
Æloc_li°
, 
queue
);

755 
	`©omic_dec
(&
£g_Æloˇt‹
->
group_migøã_cou¡
);

756 
	`©omic_öc
(&
£g_Æloˇt‹
->
group_Æloc_cou¡
);

757 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

758 
	}
}

760 
	$move_£g_migøã_to_Æloc_queue
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
){

761 
Êags
;

762 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

763 
li°_hód
 *
queue
 = &
£g_Æloˇt‹
->
£g_Æloc_queue
;

765 
	`•ö_lock_úqßve
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

766 
	`li°_dñ
(&
£g
->
Æloc_li°
);

767 
	`li°_add
(&
£g
->
Æloc_li°
, 
queue
);

768 
	`©omic_dec
(&
£g_Æloˇt‹
->
£g_migøã_cou¡
);

769 
	`©omic_öc
(&
£g_Æloˇt‹
->
£g_Æloc_cou¡
);

770 
	`•ö_u∆ock_úqª°‹e
(&
£g_Æloˇt‹
->
Æloc_lock
, 
Êags
);

771 
	}
}

773 
£˘‹_t
 
	$ˇlc_£gmít_hódî_°¨t
(
dm§c_su≥r
 *
su≥r
,

774 
u32
 
£gmít_idx
)

776  (
su≥r
->
∑øm
.
chunk_size
Ë* 
NUM_SSD
 * (
£gmít_idx
);

777 
	}
}

780 
u32
 
	$ˇlc_£gmít_œp
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£gmít_id
)

782 
u64
 
a
 = 
	`div_u64
(
£gmít_id
 - 1, 
su≥r
->
ƒ_£gmíts
);

783  
a
 + 1;

784 
	}
};

787 
u32
 
	$ˇlc_num_chunks
(
dm_dev
 *
dev
, 
dm§c_su≥r
 *
su≥r
)

789 
£˘‹_t
 
devsize
 = 
	`dm§c_devsize_£˘‹s
(
dev
);

790  
	`div_u64
(
devsize
, 
su≥r
->
∑øm
.
chunk_size
) - 1;

791 
	}
}

793 
£˘‹_t
 
	$ˇlc_mb_°¨t_£˘‹
(
dm§c_su≥r
 *
su≥r
,

794 
£gmít_hódî
 *
£g
,

795 
u32
 
mb_idx
)

797 
u32
 
idx
;

798 
£˘‹_t
 
°¨t_£˘‹
;

800 
	`div_u64_ªm
(
mb_idx
, 
STRIPE_SZ
, &
idx
);

801 
°¨t_£˘‹
 = 
	`ˇlc_£gmít_hódî_°¨t
(
su≥r
, 
£g
->
£g_id
);

803  
°¨t_£˘‹
 + ((
idx
Ë* 
SRC_SECTORS_PER_PAGE
);

804 
	}
}

811 
ölöe
 
£gmít_hódî
 *
	$gë_£gmít_hódî_by_id
(
dm§c_su≥r
 *
su≥r
,

812 
u64
 
£gmít_id
)

814 
u32
 
idx
;

815 
	`div_u64_ªm
(
£gmít_id
, 
su≥r
->
ˇche_°©
.
num_£gmíts
, &
idx
);

816  
	`œrge_¨øy_©
(
su≥r
->
£gmít_hódî_¨øy
, 
idx
);

817 
	}
}

819 
£gmít_hódî
 *
	$gë_£gmít_hódî_by_mb_idx
(
dm§c_su≥r
 *
su≥r
,

820 
u32
 
mb_idx
)

822 
u32
 
idx
;

823 
u32
 
£g_id
;

824 
£g_id
 = 
	`div_u64_ªm
(
mb_idx
, 
STRIPE_SZ
, &
idx
);

825  
	`œrge_¨øy_©
(
su≥r
->
£gmít_hódî_¨øy
, 
£g_id
);

826 
	}
}

828 
£gmít_hódî
 *
	$gë_£g_by_mb
(
dm§c_su≥r
 *
su≥r
,

829 
mëablock
 *
mb
)

831  
	`gë_£gmít_hódî_by_mb_idx
(
su≥r
, 
mb
->
idx
);

832 
	}
}

834 
__mu°_check
 
	$öô_£gmít_hódî_¨øy
(
dm§c_su≥r
 *
su≥r
)

836 
u32
 
£gmít_idx
, 
group_idx
;

837 
u32
 
num_£gmíts
 = 
su≥r
->
ˇche_°©
.num_segments;

838 
u32
 
num_groups
 = 
su≥r
->
ˇche_°©
.num_groups;

839 
i
;

841 
su≥r
->
group_hódî_¨øy
 = 
	`vmÆloc
((
group_hódî
)*
num_groups
);

842 i‡(!
su≥r
->
group_hódî_¨øy
) {

843 
	`WBERR
();

844  -
ENOMEM
;

847 
group_idx
 = 0;group_idx < 
num_groups
;group_idx++){

848 
group_hódî
 *group_hódî = &
su≥r
->
group_hódî_¨øy
[
group_idx
];

849 
group_hódî
->
group_id
 = 
group_idx
;

850 
	`©omic_£t
(&
group_hódî
->
‰ì_£g_cou¡
, 0);

851 
	`©omic_£t
(&
group_hódî
->
vÆid_cou¡
, 0);

852 
	`INIT_LIST_HEAD
(&
group_hódî
->
group_hód
);

853 
	`•ö_lock_öô
(&
group_hódî
->
lock
);

855 
su≥r
->
cuºít_group
 = 
NULL
;

857 
	`¥ötk
(" segment headállocation\n");

858 
su≥r
->
£gmít_hódî_¨øy
 =

859 
	`œrge_¨øy_Æloc
((
£gmít_hódî
), 
num_£gmíts
);

860 i‡(!
su≥r
->
£gmít_hódî_¨øy
) {

861 
	`WBERR
();

862  -
ENOMEM
;

865 
i
 = 0;ò< 
MAX_CACHE_DEVS
;i++){

866 if(
i
<
NUM_SSD
){

867 
	`¥ötk
(" mëablockáŒoˇti⁄ %d\n", 
i
);

868 
su≥r
->
mëablock_¨øy
[
i
] =

869 
	`œrge_¨øy_Æloc
((
mëablock
), 
NUM_BLOCKS_PER_SSD
);

870 i‡(!
su≥r
->
mëablock_¨øy
[
i
]) {

871 
	`WBERR
();

872  -
ENOMEM
;

880 
su≥r
->
mëablock_¨øy
[
i
] = 
NULL
;

884 
£gmít_idx
 = 0; segmít_idx < 
num_£gmíts
; segment_idx++) {

885 
£gmít_hódî
 *
£g
 =

886 
	`œrge_¨øy_©
(
su≥r
->
£gmít_hódî_¨øy
, 
£gmít_idx
);

887 
group_hódî
 *group_header;

889 
group_idx
 = 
£gmít_idx
 / 
SEGMENT_GROUP_SIZE
;

891 
group_hódî
 = &
su≥r
->
group_hódî_¨øy
[
group_idx
];

892 
	`li°_add_èû
(&
£g
->
group_li°
, &
group_hódî
->
group_hód
);

894 
£g
->
group
 = 
group_hódî
;

896 
	`©omic_£t
(&
£g
->
Àngth
, 0);

897 
	`©omic_£t
(&
£g
->
vÆid_cou¡
, 0);

898 
	`©omic_£t
(&
£g
->
dúty_cou¡
, 0);

899 
	`©omic_£t
(&
£g
->
hŸ_cou¡
, 0);

900 
	`©omic_£t
(&
£g
->
∑π_°¨t
, 0);

901 
	`©omic_£t
(&
£g
->
∑π_Àngth
, 0);

902 
	`©omic_£t
(&
£g
->
bios_cou¡
, 0);

904 
£g
->
£g_id
 = (
u64
)
£gmít_idx
;

905 
£g
->
group_id
 = (
u64
)
£gmít_idx
/
SEGMENT_GROUP_SIZE
;

906 
£g
->
Êags
 = 0;

907 
£g
->
£g_lﬂd
 = 0;

908 
£g
->
£quí˚
 = 0;

912 
	`©omic_£t
(&
£g
->
num_ªad_öÊight
, 0);

913 
	`©omic_£t
(&
£g
->
num_fûlög
, 0);

914 
	`©omic_£t
(&
£g
->
num_bufc›y
, 0);

916 
i
 = 0;ò< 
MAX_CACHE_DEVS
;i++)

917 
	`©omic_£t
(&
£g
->
summ¨y_°¨t
[
i
], 0);

919 
	`•ö_lock_öô
(&
£g
->
lock
);

921 
	`INIT_LIST_HEAD
(&
£g
->
migøã_li°
);

924 
	`mb_¨øy_em±y_öô
(
su≥r
);

926 
su≥r
->
mëa_öôülized
 = 1;

929 
	}
}

931 
	$‰ì_£gmít_hódî_¨øy
(
dm§c_su≥r
 *
su≥r
)

933 
i
;

935 if(!
su≥r
->
mëa_öôülized
)

938 
	`v‰ì
(
su≥r
->
group_hódî_¨øy
);

939 
	`œrge_¨øy_‰ì
(
su≥r
->
£gmít_hódî_¨øy
);

941 
i
 = 0;ò< 
MAX_CACHE_DEVS
;i++){

942 if(
su≥r
->
mëablock_¨øy
[
i
]){

943 
	`œrge_¨øy_‰ì
(
su≥r
->
mëablock_¨øy
[
i
]);

946 
	}
}

953 
__mu°_check
 
	$ht_em±y_öô
(
dm§c_su≥r
 *
su≥r
)

955 
u32
 
idx
;

956 
size_t
 
i
, 
num_hóds
;

957 
œrge_¨øy
 *
¨r
;

959 
su≥r
->
htsize
 = 
NUM_BLOCKS
;

960 
num_hóds
 = 
su≥r
->
htsize
 + 1;

962 
	`¥ötk
(" hashÅableállocation\n");

963 
¨r
 = 
	`œrge_¨øy_Æloc
((
ht_hód
), 
num_hóds
);

964 i‡(!
¨r
) {

965 
	`WBERR
();

966  -
ENOMEM
;

969 
su≥r
->
hèbÀ
 = 
¨r
;

971 
i
 = 0; i < 
num_hóds
; i++) {

972 
ht_hód
 *
hd
 = 
	`œrge_¨øy_©
(
¨r
, 
i
);

973 
	`INIT_HLIST_HEAD
(&
hd
->
ht_li°
);

980 
su≥r
->
nuŒ_hód
 = 
	`œrge_¨øy_©
(su≥r->
hèbÀ
, su≥r->
htsize
);

982 
idx
 = 0; idx < 
NUM_BLOCKS
; idx++) {

983 
mëablock
 *
mb
 = 
	`mb_©
(
su≥r
, 
idx
);

984 
	`hli°_add_hód
(&
mb
->
ht_li°
, &
su≥r
->
nuŒ_hód
->ht_list);

987 
su≥r
->
ht_öôülized
 = 1;

990 
	}
}

992 
	$‰ì_ht
(
dm§c_su≥r
 *
su≥r
)

994 if(!
su≥r
->
ht_öôülized
)

997 
	`œrge_¨øy_‰ì
(
su≥r
->
hèbÀ
);

998 
	}
}

1000 
ht_hód
 *
	$ht_gë_hód
(
dm§c_su≥r
 *
su≥r
, 
£˘‹_t
 
key
)

1002 
u32
 
idx
;

1003 
	`div_u64_ªm
(
key
, 
su≥r
->
htsize
, &
idx
);

1004  
	`œrge_¨øy_©
(
su≥r
->
hèbÀ
, 
idx
);

1005 
	}
}

1007 
boﬁ
 
	$mb_hô
(
mëablock
 *
mb
, 
£˘‹_t
 
key
)

1009  
mb
->
£˘‹
 =
key
;

1010 
	}
}

1012 
	$ht_dñ
(
dm§c_su≥r
 *
su≥r
, 
mëablock
 *
mb
)

1014 
ht_hód
 *
nuŒ_hód
;

1016 
	`hli°_dñ
(&
mb
->
ht_li°
);

1018 
nuŒ_hód
 = 
su≥r
->null_head;

1019 
	`hli°_add_hód
(&
mb
->
ht_li°
, &
nuŒ_hód
->ht_list);

1022 
	}
}

1024 
	$ht_ªgi°î
(
dm§c_su≥r
 *
su≥r
,
£˘‹_t
 
key
, 
mëablock
 *
mb
)

1026 
ht_hód
 *
hód
;

1027 
hód
 = 
	`ht_gë_hód
(
su≥r
, 
key
);

1029 
	`hli°_dñ
(&
mb
->
ht_li°
);

1030 
	`hli°_add_hód
(&
mb
->
ht_li°
, &
hód
->ht_list);

1034 
mb
->
£˘‹
 = 
key
;

1035 
	}
};

1037 
mëablock
 *
	$ht_lookup
(
dm§c_su≥r
 *
su≥r
,
£˘‹_t
 
key
)

1039 
mëablock
 *
mb
, *
found
 = 
NULL
;

1040 
ht_hód
 *
hód
;

1041 
hód
 = 
	`ht_gë_hód
(
su≥r
, 
key
);

1043 
	`hli°_f‹_óch_íåy
(
mb
, &
hód
->
ht_li°
, ht_list) {

1044 i‡(
	`mb_hô
(
mb
, 
key
)) {

1045 
found
 = 
mb
;

1050  
found
;

1051 
	}
}

1056 
	$disˇrd_ˇches_ö£g
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
)

1058 
Êags
;

1059 
u32
 
i
;

1061 
i
 = 0; i < 
STRIPE_SZ
; i++) {

1062 
mëablock
 *
mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
i
);

1063 
	`ht_dñ
(
su≥r
, 
mb
);

1064 
	`lock£g
(
£g
, 
Êags
);

1065 if(
	`ã°_bô
(
MB_VALID
, &
mb
->
mb_Êags
)||

1066 
	`ã°_bô
(
MB_PARITY
, &
mb
->
mb_Êags
)||

1067 
	`ã°_bô
(
MB_SUMMARY
, &
mb
->
mb_Êags
)){

1069 
	`©omic_dec
(&
£g
->
vÆid_cou¡
);

1070 
	`©omic_dec
(&
£g
->
group
->
vÆid_cou¡
);

1072 
	`˛ór_bô
(
MB_VALID
, &
mb
->
mb_Êags
);

1073 
	`˛ór_bô
(
MB_PARITY
, &
mb
->
mb_Êags
);

1074 
	`˛ór_bô
(
MB_SUMMARY
, &
mb
->
mb_Êags
);

1076 if(
	`ã°_bô
(
MB_HIT
, &
mb
->
mb_Êags
)){

1077 
	`˛ór_bô
(
MB_HIT
, &
mb
->
mb_Êags
);

1078 
	`©omic_dec
(&
£g
->
hŸ_cou¡
);

1081 
	`©omic_dec
(&
su≥r
->
ˇche_°©
.
num_u£d_blocks
);

1083 
	`u∆ock£g
(
£g
, 
Êags
);

1085 
	}
}

1089 
	$ªad_su≥rblock_hódî
(
su≥rblock_devi˚
 *
sup
,

1090 
dm§c_su≥r
 *
su≥r
, 
dm_dev
 *
dev
)

1092 
r
 = 0;

1093 
dm_io_ªque°
 
io_ªq_sup
;

1094 
dm_io_ªgi⁄
 
ªgi⁄_sup
;

1095 
£˘‹_t
 
£˘‹
 = 0;

1097 *
buf
 = 
	`kmÆloc
((1 << 
SECTOR_SHIFT
), 
GFP_KERNEL
);

1098 i‡(!
buf
) {

1099 
	`WBERR
("failedÅoálloc buffer");

1100  -
ENOMEM
;

1105 
io_ªq_sup
 = (
dm_io_ªque°
) {

1106 .
˛õ¡
 = 
su≥r
->
io_˛õ¡
,

1107 .
bi_rw
 = 
READ
,

1108 .
nŸify
.
‚
 = 
NULL
,

1109 .
mem
.
ty≥
 = 
DM_IO_KMEM
,

1110 .
mem
.
±r
.
addr
 = 
buf
,

1112 
ªgi⁄_sup
 = (
dm_io_ªgi⁄
) {

1113 .
bdev
 = 
dev
->bdev,

1114 .
£˘‹
 = sector,

1115 .
cou¡
 = 1,

1117 
r
 = 
	`dm§c_io
(&
io_ªq_sup
, 1, &
ªgi⁄_sup
, 
NULL
);

1118 i‡(
r
) {

1119 
	`WBERR
("io failed inÑeading superblock header");

1120 
bad_io
;

1123 
	`mem˝y
(
sup
, 
buf
, (*sup));

1125 
bad_io
:

1126 
	`k‰ì
(
buf
);

1128  
r
;

1129 
	}
}

1137 
__mu°_check
 
	$sˇn_su≥rblock
(
dm§c_su≥r
 *
su≥r
)

1139 
su≥rblock_devi˚
 *
sup
 = 
NULL
;

1140 
num_ˇche_devs
;

1141 
r
 = 0;

1142 
i
;

1143 
u32
 
uuid
;

1145 
num_ˇche_devs
 = 
su≥r
->
dev_öfo
.num_cache_devs;

1147 
i
 = 0;ò< 
num_ˇche_devs
;i++){

1148 
sup
 = &
su≥r
->
dev_öfo
.
sb_devi˚
[
i
];

1149 
r
 = 
	`ªad_su≥rblock_hódî
(
sup
, 
su≥r
, su≥r->
dev_öfo
.
ˇche_dev
[
i
]);

1150 i‡(
r
) {

1151 
	`WBERR
("failedÅoÑead superblock header");

1152  
r
;

1155 
	`¥ötk
(" magi¯%x\n", 
sup
->
magic
);

1156 
	`¥ötk
(" uuid = %d \n", 
sup
->
uuid
);

1157 
	`¥ötk
(" chunk sizê%d se˘‹s\n", 
sup
->
chunk_size
);

1158 
	`¥ötk
("Çum chunk†%d \n", 
sup
->
num_chunks
);

1160 i‡(
	`À32_to_˝u
(
sup
->
magic
Ë!
SRC_MAGIC
) {

1161 
	`WBERR
("superblock header: magicÇumber invalid");

1166 
i
 = 0;ò< 
num_ˇche_devs
;i++){

1167 
sup
 = &
su≥r
->
dev_öfo
.
sb_devi˚
[
i
];

1169 if(
i
==0)

1170 
uuid
 = 
sup
->uuid;

1172 if(
sup
->
uuid
 != uuid){

1173 
	`WBERR
("superblock heaer: invalid uuid");

1182 
su≥r
->
ˇche_°©
.
uuid
 = 
sup
->uuid;

1183 
su≥r
->
ˇche_°©
.
num_chunks_≥r_ssd
 = 
sup
->
num_chunks
;

1184 
su≥r
->
ˇche_°©
.
num_chunks_≥r_group
 = 
sup
->
chunks_≥r_group
;

1185 
su≥r
->
ˇche_°©
.
num_£gmíts
 = 
sup
->
num_chunks
;

1186 
su≥r
->
ˇche_°©
.
num_groups
 = 
sup
->num_groups;

1187 
su≥r
->
ˇche_°©
.
num_blocks_≥r_chunk
 = 
sup
->num_blocks_per_chunk;

1188 
su≥r
->
ˇche_°©
.
num_blocks_≥r_ssd
 = 
sup
->num_blocks_per_ssd;

1190 
	`©omic64_£t
(&
su≥r
->
ˇche_°©
.
Æloc_£quí˚
, 0);

1191 
	`©omic64_£t
(&
su≥r
->
ˇche_°©
.
num_dúty_blocks
, 0);

1192 
	`©omic_£t
(&
su≥r
->
ˇche_°©
.
num_u£d_blocks
, 1) ;

1193 
	`©omic_£t
(&
su≥r
->
ˇche_°©
.
öÊight_ios
, 0);

1194 
	`©omic_£t
(&
su≥r
->
ˇche_°©
.
öÊight_bios
, 0);

1195 
	`©omic_£t
(&
su≥r
->
ˇche_°©
.
tŸÆ_ios
, 0);

1196 
	`©omic_£t
(&
su≥r
->
ˇche_°©
.
tŸÆ_bios
, 0);

1197 
	`©omic_£t
(&
su≥r
->
ˇche_°©
.
num_‰ì_£gmíts
, su≥r->ˇche_°©.
num_£gmíts
);

1199 
su≥r
->
dev_öfo
.
‹igö_£˘‹s
 = 
sup
->
hdd_devsize
;

1200 
su≥r
->
dev_öfo
.
≥r_ssd_£˘‹s
 = 
sup
->
ssd_devsize
;

1202 
su≥r
->
∑øm
.
chunk_size
 = 
sup
->chunk_size;

1203 
su≥r
->
∑øm
.
chunk_group_size
 = 
sup
->chunk_group_size;

1204 
su≥r
->
∑øm
.
∑rôy_Æloˇti⁄
 = 
sup
->parity_allocation;

1205 
su≥r
->
∑øm
.
°rùög_pﬁicy
 = 
sup
->striping_policy;

1206 
su≥r
->
∑øm
.
d©a_Æloˇti⁄
 = 
sup
->data_allocation;

1207 
su≥r
->
∑øm
.
îasuª_code
 = 
sup
->erasure_code;

1208 
su≥r
->
∑øm
.
hŸ_idítifiˇti⁄
 = 
sup
->hot_identification;

1209 
su≥r
->
∑øm
.
ª˛aim_pﬁicy
 = 
sup
->reclaim_policy;

1210 
su≥r
->
∑øm
.
vi˘im_pﬁicy

sup
->victim_policy;

1211 
su≥r
->
∑øm
.
ømbuf_poﬁ_amou¡
 = 
sup
->rambuf_pool_amount;

1212 
su≥r
->
∑øm
.
num_summ¨y_≥r_chunk
 = 
sup
->num_summary_per_chunk;

1213 
su≥r
->
∑øm
.
num_íåy_≥r_∑ge
 = 
sup
->num_entry_per_page;

1214 
su≥r
->
∑øm
.
Êush_comm™d
 = 
sup
->flush_command;

1216  
r
;

1217 
	}
}

1219 
u8
 
	$ˇlc_checksum
(
u8
 *
±r
, 
size
){

1220  
	`¸c32_À
(17, 
±r
, 
size
);

1221 
	}
}

1224 
	$c›y_summ¨y
(
dm§c_su≥r
 *
su≥r
, *
buf
, 
u32
 
£g_id
, u32 
ssd_id
){

1225 
£gmít_hódî
 *
√w_£g
;

1226 
£gmít_hódî_devi˚
 *
hódî
;

1227 
u64
 
£quí˚
;

1228 
u64
 
uuid
;

1229 
u32
 
magic
;

1230 
u32
 
ty≥
;

1231 
u32
 
off£t
;

1233 
hódî
 = (
£gmít_hódî_devi˚
 *)
buf
;

1234 
£quí˚
 = 
	`À64_to_˝u
(
hódî
->sequence);

1235 
uuid
 = 
	`À64_to_˝u
(
hódî
->uuid);

1236 
magic
 = 
	`À32_to_˝u
(
hódî
->magic);

1237 
ty≥
 = 
	`À32_to_˝u
(
hódî
->type);

1239 if(
magic
!=
SRC_MAGIC
)

1241 if(
uuid
!=
su≥r
->
ˇche_°©
.uuid)

1244 if(
	`USE_ERASURE_CODE
(&
su≥r
->
∑øm
Ë&& 
ssd_id
==
	`gë_∑rôy_ssd
(su≥r, 
£g_id
)){

1245 
	`¥ötk
("Ö¨ôy SSD id = %d segid %d \n", 
ssd_id
, 
£g_id
);

1249 
√w_£g
 = 
	`gë_£gmít_hódî_by_id
(
su≥r
, 
£g_id
);

1250 
√w_£g
->
£quí˚
 = sequence;

1251 
√w_£g
->
£g_ty≥
 = 
ty≥
;

1252 
√w_£g
->
£g_lﬂd
 = 1;

1254 
off£t
=0;off£t<
CHUNK_SZ
;offset++){

1255 
mëablock_devi˚
 *
mbdev
;

1256 
mëablock
 *
√w_mb
;

1257 
u32
 
mëa_∑ge
 = 
off£t
 / 
NUM_ENTRY_PER_PAGE
;

1258 
u32
 
mëa_off£t
 = 
off£t
 % 
NUM_ENTRY_PER_PAGE
;

1259 
u32
 
√w_idx
;

1261 
mbdev
 = (
mëablock_devi˚
 *)(
buf
 + 
PAGE_SIZE
 + 
mëa_∑ge
 * PAGE_SIZE);

1262 
mbdev
 +
mëa_off£t
;

1264 
√w_idx
 = 
ssd_id
 * 
CHUNK_SZ
 + 
off£t
;

1265 
√w_mb
 = 
	`gë_mb
(
su≥r
, 
£g_id
, 
√w_idx
);

1266 if(
mbdev
->
£˘‹
==(
u32
)~0)

1267 
√w_mb
->
£˘‹
 = ~0;

1269 
√w_mb
->
£˘‹
 = 
mbdev
->sector;

1271 if(
£g_id
==0)

1272 
	`¥ötk
(" më®∑gê%d, off£à%d, se˘‹ = %d\n", 
mëa_∑ge
, 
mëa_off£t
, ()
√w_mb
->
£˘‹
);

1275 if(
mbdev
->
dúty_bôs
)

1276 
	`£t_bô
(
MB_DIRTY
, &
√w_mb
->
mb_Êags
);

1278 
	`˛ór_bô
(
MB_DIRTY
, &
√w_mb
->
mb_Êags
);

1280 
	}
}

1282 
	$sˇn_mëad©a_com∂ëe_to_öa˘ive
(
dm§c_su≥r
 *
su≥r
,
sˇn_mëad©a_m™agî
 *
sˇn_m™agî
){

1283 
sˇn_mëad©a_job
 *
job
;

1284 
Êags
;

1285 
cou¡
;

1287 
cou¡
 = 
	`©omic_ªad
(&
sˇn_m™agî
->
com∂ëe_cou¡
);

1288 
cou¡
--){

1290 
	`•ö_lock_úqßve
(&
sˇn_m™agî
->
lock
, 
Êags
);

1291 
job
 = 
	`li°_fú°_íåy
(&
sˇn_m™agî
->
com∂ëe_queue
, 
sˇn_mëad©a_job
, 
li°
);

1292 
	`li°_dñ
(&
job
->
li°
);

1293 
	`©omic_dec
(&
sˇn_m™agî
->
com∂ëe_cou¡
);

1294 
	`•ö_u∆ock_úqª°‹e
(&
sˇn_m™agî
->
lock
, 
Êags
);

1296 
	`c›y_summ¨y
(
su≥r
, 
job
->
d©a
, job->
£g_id
, job->
ssd_id
);

1298 
	`•ö_lock_úqßve
(&
sˇn_m™agî
->
lock
, 
Êags
);

1299 
	`li°_add_èû
(&
job
->
li°
, &
sˇn_m™agî
->
öa˘ive_queue
);

1300 
	`©omic_öc
(&
sˇn_m™agî
->
öa˘ive_cou¡
);

1301 
	`•ö_u∆ock_úqª°‹e
(&
sˇn_m™agî
->
lock
, 
Êags
);

1304 
	}
}

1305 
sˇn_mëad©a_job
 *
	$sˇn_m™agî_Æloc
(
dm§c_su≥r
 *
su≥r
){

1306 
sˇn_mëad©a_m™agî
 *
sˇn_m™agî
;

1307 
sˇn_mëad©a_job
 *
job
;

1308 
Êags
;

1310 
sˇn_m™agî
 = 
su≥r
->scan_manager;

1316 
	`•ö_lock_úqßve
(&
sˇn_m™agî
->
lock
, 
Êags
);

1317 
job
 = 
	`li°_fú°_íåy
(&
sˇn_m™agî
->
öa˘ive_queue
, 
sˇn_mëad©a_job
, 
li°
);

1318 
	`li°_dñ
(&
job
->
li°
);

1319 
	`©omic_dec
(&
sˇn_m™agî
->
öa˘ive_cou¡
);

1320 
	`©omic_öc
(&
sˇn_m™agî
->
a˘ive_cou¡
);

1321 
	`•ö_u∆ock_úqª°‹e
(&
sˇn_m™agî
->
lock
, 
Êags
);

1323  
job
;

1324 
	}
}

1326 
	$sˇn_m™agî_öô
(
dm§c_su≥r
 *
su≥r
){

1327 
sˇn_mëad©a_m™agî
 *
sˇn_m™agî
;

1328 
r
 = 0;

1329 
i
;

1331 
sˇn_m™agî
 = 
	`kmÆloc
((
sˇn_mëad©a_m™agî
), 
GFP_KERNEL
);

1332 if(!
sˇn_m™agî
){

1333 
	`WBERR
();

1334 
r
 = -
ENOMEM
;

1335  
r
;

1337 
su≥r
->
sˇn_m™agî
 = scan_manager;

1338 
	`•ö_lock_öô
(&
sˇn_m™agî
->
lock
);

1340 
	`©omic_£t
(&
sˇn_m™agî
->
öa˘ive_cou¡
, 0);

1341 
	`©omic_£t
(&
sˇn_m™agî
->
a˘ive_cou¡
, 0);

1342 
	`©omic_£t
(&
sˇn_m™agî
->
com∂ëe_cou¡
, 0);

1344 
	`INIT_LIST_HEAD
(&
sˇn_m™agî
->
öa˘ive_queue
);

1346 
	`INIT_LIST_HEAD
(&
sˇn_m™agî
->
com∂ëe_queue
);

1349 
sˇn_m™agî
->
qdïth
 = 256;

1355 
i
 = 0;ò< 
sˇn_m™agî
->
qdïth
;i++){

1356 
sˇn_mëad©a_job
 *
job
;

1358 
job
 = 
	`kmÆloc
((
sˇn_mëad©a_job
), 
GFP_KERNEL
);

1359 if(!
job
){

1360 
	`BUG_ON
(1);

1361 
	`WBERR
();

1362  -
ENOMEM
;

1364 
	`mem£t
(
job
, 0x00, (
sˇn_mëad©a_job
));

1366 
job
->
ödex
 = 
i
;

1368 
	`li°_add
(&
job
->
li°
, &
sˇn_m™agî
->
öa˘ive_queue
);

1369 
	`©omic_öc
(&
sˇn_m™agî
->
öa˘ive_cou¡
);

1370 
job
->
su≥r
 = super;

1372 
job
->
d©a
 = (*)
	`__gë_‰ì_∑ges
(
GFP_KERNEL
, 
	`ûog2
(
	`roundup_pow_of_two
(
NUM_SUMMARY
)));

1373 i‡(!
job
->
d©a
) {

1374 
	`BUG_ON
(1);

1375 
	`WBERR
();

1376  -
ENOMEM
;

1380  
r
;

1381 
	}
}

1383 
	$sˇn_m™agî_deöô
(
dm§c_su≥r
 *
su≥r
){

1384 
sˇn_mëad©a_m™agî
 *
sˇn_m™agî
;

1385 
sˇn_mëad©a_job
 *
job
, *
ãmp
;

1387 
sˇn_m™agî
 = 
su≥r
->scan_manager;

1389 
	`li°_f‹_óch_íåy_ß„
(
job
, 
ãmp
, &
sˇn_m™agî
->
öa˘ive_queue
, 
li°
){

1391 
	`li°_dñ
(&
job
->
li°
);

1392 
	`‰ì_∑ges
(()
job
->
d©a
, 
	`ûog2
(
	`roundup_pow_of_two
(
NUM_SUMMARY
)));

1393 
	`k‰ì
(
job
);

1394 
	`©omic_dec
(&
sˇn_m™agî
->
öa˘ive_cou¡
);

1397 
	`BUG_ON
(
	`©omic_ªad
(&
sˇn_m™agî
->
öa˘ive_cou¡
));

1399 
	`k‰ì
(
sˇn_m™agî
);

1400 
su≥r
->
sˇn_m™agî
 = 
NULL
;

1401 
	}
}

1404 
	$sˇn_mëad©a_ídio
(
îr‹
, *
c⁄ãxt
)

1406 
sˇn_mëad©a_job
 *
job
 = 
c⁄ãxt
;

1407 
dm§c_su≥r
 *
su≥r
 = 
job
->super;

1408 
sˇn_mëad©a_m™agî
 *
sˇn_m™agî
 = 
su≥r
->scan_manager;

1409 
Êags
;

1411 if(
îr‹
){

1412 
	`¥ötk
(" End ioÉrror \n");

1417 
	`•ö_lock_úqßve
(&
sˇn_m™agî
->
lock
, 
Êags
);

1418 
	`li°_add_èû
(&
job
->
li°
, &
sˇn_m™agî
->
com∂ëe_queue
);

1419 
	`•ö_u∆ock_úqª°‹e
(&
sˇn_m™agî
->
lock
, 
Êags
);

1421 
	`©omic_dec
(&
sˇn_m™agî
->
a˘ive_cou¡
);

1422 
	`©omic_öc
(&
sˇn_m™agî
->
com∂ëe_cou¡
);

1424 
	}
}

1426 
__mu°_check


1427 
	$ªad_£gmít_hódî_devi˚
(
dm§c_su≥r
 *
su≥r
, 
u32
 
£gmít_idx
, u32 
off£t
, 
sˇn_mëad©a_job
 *
job
)

1429 
dm_io_ªque°
 
io_ªq
;

1430 
dm_io_ªgi⁄
 
ªgi⁄
;

1431 
r
 = 0;

1433 
io_ªq
 = (
dm_io_ªque°
) {

1434 .
˛õ¡
 = 
su≥r
->
io_˛õ¡
,

1435 .
bi_rw
 = 
READ
,

1436 .
nŸify
.
‚
 = 
sˇn_mëad©a_ídio
,

1437 .
nŸify
.
c⁄ãxt
 = 
job
,

1438 .
mem
.
ty≥
 = 
DM_IO_KMEM
,

1439 .
mem
.
±r
.
addr
 = 
job
->
d©a
,

1441 
ªgi⁄
 = (
dm_io_ªgi⁄
) {

1442 .
bdev
 = 
	`gë_bdev
(
su≥r
, 
off£t
),

1443 .
£˘‹
 = 
	`gë_£˘‹
(
su≥r
, 
£gmít_idx
, 
off£t
),

1444 .
cou¡
 = 
SRC_SECTORS_PER_PAGE
 * 
NUM_SUMMARY
,

1446 
r
 = 
	`dm§c_io
(&
io_ªq
, 1, &
ªgi⁄
, 
NULL
);

1447 i‡(
r
) {

1448 
	`WBERR
();

1454  
r
;

1455 
	}
}

1458 
	$lﬂd_summ¨y_‰om_ssd
(
dm§c_su≥r
 *
su≥r
){

1459 
sˇn_mëad©a_m™agî
 *
sˇn_m™agî
;

1460 
sˇn_mëad©a_job
 *
job
;

1461 
u32
 
summ¨y_idx
;

1462 
u32
 
num_£gmíts
 = 
su≥r
->
ˇche_°©
.num_segments;

1463 
u32
 
£g_id
, 
ssd_id
;

1464 
r
 = 0;

1466 
r
 = 
	`sˇn_m™agî_öô
(
su≥r
);

1467 if(
r
<0)

1468  
r
;

1470 
sˇn_m™agî
 = 
su≥r
->scan_manager;

1472 
£g_id
 = 0; seg_id < 
num_£gmíts
; seg_id++) {

1473 
ssd_id
 = 0;ssd_id < 
NUM_SSD
;ssd_id++){

1475 !
	`©omic_ªad
(&
sˇn_m™agî
->
öa˘ive_cou¡
)){

1476 !
	`©omic_ªad
(&
sˇn_m™agî
->
com∂ëe_cou¡
)){

1477 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(1000));

1479 
	`sˇn_mëad©a_com∂ëe_to_öa˘ive
(
su≥r
, 
sˇn_m™agî
);

1482 
job
 = (
sˇn_mëad©a_job
 *)
	`sˇn_m™agî_Æloc
(
su≥r
);

1483 
job
->
su≥r
 = super;

1484 
job
->
£g_id
 = seg_id;

1485 
job
->
ssd_id
 = ssd_id;

1488 
summ¨y_idx
 = 
	`gë_summ¨y_off£t
(
su≥r
, 
ssd_id
);

1492 
r
 = 
	`ªad_£gmít_hódî_devi˚
(
su≥r
, 
£g_id
, 
summ¨y_idx
, 
job
);

1493 i‡(
r
) {

1494 
	`WBERR
();

1495 
r
 = -1;

1496 
bad_su≥r
;

1500 
	`©omic_ªad
(&
sˇn_m™agî
->
a˘ive_cou¡
)){

1502 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(1000));

1505 
sˇn_m™agî
->
qdïth
 !
	`©omic_ªad
(&sˇn_m™agî->
öa˘ive_cou¡
)){

1506 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(1000));

1507 
	`sˇn_mëad©a_com∂ëe_to_öa˘ive
(
su≥r
, 
sˇn_m™agî
);

1512 
bad_su≥r
:;

1514  
r
;

1515 
	}
}

1517 
	$_c⁄°ru˘_mëad©a_ö_øm
(
dm§c_su≥r
 *
su≥r
, 
u32
 
£g_id
){

1518 
£gmít_hódî
 *
cur_£g
, *
ﬁd_£g
;

1519 
u32
 
ssd_id
, 
off£t
;

1520 
u32
 
cur_idx
;

1521 
cur_is_√w
 = 0;

1522 
mëablock
 *
ﬁd_mb
, *
cur_mb
;

1523 
£˘‹_t
 
key
;

1525 
cur_£g
 = 
	`gë_£gmít_hódî_by_id
(
su≥r
, 
£g_id
);

1527 
ssd_id
 = 0;ssd_id < 
NUM_SSD
;ssd_id++){

1528 
off£t
 = 0;off£à< 
CHUNK_SZ
;offset++){

1530 
cur_idx
 = 
ssd_id
 * 
CHUNK_SZ
 + 
off£t
;

1531 
cur_mb
 = 
	`gë_mb
(
su≥r
, 
£g_id
, 
cur_idx
);

1534 if(
	`USE_ERASURE_CODE
(&
su≥r
->
∑øm
)){

1535 if(
ssd_id
!=
	`gë_∑rôy_ssd
(
su≥r
, 
£g_id
Ë&& 
off£t
==
CHUNK_SZ
-1)

1536 
	`£t_bô
(
MB_SUMMARY
, &
cur_mb
->
mb_Êags
);

1538 if(
off£t
==
CHUNK_SZ
-1)

1539 
	`£t_bô
(
MB_SUMMARY
, &
cur_mb
->
mb_Êags
);

1543 
key
 = 
cur_mb
->
£˘‹
;

1544 if(
cur_mb
->
£˘‹
==~0 || cur_mb->£˘‹>=
su≥r
->
dev_öfo
.
‹igö_£˘‹s
){

1546 if(
	`ã°_bô
(
MB_DIRTY
, &
cur_mb
->
mb_Êags
)){

1547 
	`©omic_öc
(&
cur_£g
->
dúty_cou¡
);

1549 
	`˛ór_bô
(
MB_VALID
, &
cur_mb
->
mb_Êags
);

1553 
ﬁd_mb
 = 
	`ht_lookup
(
su≥r
, 
key
);

1560 if(
ﬁd_mb
 && old_mb->
£˘‹
 != ~0){

1562 
ﬁd_£g
 = 
	`gë_£gmít_hódî_by_mb_idx
(
su≥r
, 
ﬁd_mb
->
idx
);

1563 if(
cur_£g
->
£quí˚
 > 
ﬁd_£g
->sequence){

1564 
cur_is_√w
 = 1;

1566 if(
cur_£g
->
£quí˚
 =
ﬁd_£g
->£quí˚ && 
cur_idx
 > 
ﬁd_mb
->
idx
){

1567 
cur_is_√w
= 1;

1570 if(
cur_is_√w
){

1571 
	`övÆid©e_¥evious_ˇche
(
su≥r
, 
ﬁd_£g
, 
ﬁd_mb
);

1575 
cur_is_√w
= 1;

1578 if(
	`USE_ERASURE_CODE
(&
su≥r
->
∑øm
)){

1579 if(
ssd_id
==
	`gë_∑rôy_ssd
(
su≥r
, 
£g_id
)){

1580 
	`¥ötk
("Ö¨ôy SSD id = %d segid %d se˘‹ = %d \n", 
ssd_id
, 
£g_id
, ()
key
);

1581 
	`BUG_ON
(1);

1585 if(
cur_is_√w
){

1586 
boﬁ
 
˛ón
;

1594 
	`ht_ªgi°î
(
su≥r
, 
key
, 
cur_mb
);

1595 
˛ón
 = !
	`ã°_bô
(
MB_DIRTY
, &
cur_mb
->
mb_Êags
);

1596 
	`öôülize_mb
(
su≥r
, 
cur_mb
, 
cur_£g
->
£g_ty≥
, 
˛ón
);

1597 
	`£g_Àngth_öc
(
su≥r
, 
cur_£g
, 
cur_mb
, 
Ál£
);

1598 
	`£t_bô
(
MB_SEAL
, &
cur_mb
->
mb_Êags
);

1599 
	`©omic_öc
(&
su≥r
->
ˇche_°©
.
num_u£d_blocks
);

1601 if(
	`ã°_bô
(
MB_DIRTY
, &
cur_mb
->
mb_Êags
)){

1602 
	`©omic_öc
(&
cur_£g
->
dúty_cou¡
);

1604 
	`˛ór_bô
(
MB_VALID
, &
cur_mb
->
mb_Êags
);

1607 #ifde‡
USE_LAST_SUMMARY


1608 if(
off£t
==
CHUNK_SZ
-1)

1610 
	`¥ötk
(" invalid offset ... \n");

1611 
	`BUG_ON
(1);

1614 if(
off£t
 < 
NUM_SUMMARY
)

1616 
	`¥ötk
(" invÆid off£à... %d\n", ()
off£t
);

1617 
	`BUG_ON
(1);

1623 if(
£g_id
<10){

1624 
	`¥ötk
(" seg id = %d, vÆid = %d, dúty = %d \n", 
£g_id
, 
	`©omic_ªad
(&
cur_£g
->
vÆid_cou¡
),

1625 
	`©omic_ªad
(&
cur_£g
->
dúty_cou¡
));

1628 
	}
}

1630 
	$£gmít_group_¥öt_°©
(
dm§c_su≥r
 *
su≥r
){

1631 
u32
 
group_idx
;

1632 
u32
 
num_groups
 = 
su≥r
->
ˇche_°©
.num_groups;

1634 
	`¥ötk
("\n");

1635 
group_idx
 = 0;group_idx < 
num_groups
;group_idx++){

1636 
group_hódî
 *
group
 = &
su≥r
->
group_hódî_¨øy
[
group_idx
];

1638 if(
group_idx
<10)

1639 
	`¥ötk
(" gid = %d, fªê%d \n", ()
group
->
group_id
, ()
	`©omic_ªad
(&group->
‰ì_£g_cou¡
));

1641 
	`¥ötk
("\n");

1643 
	}
}

1645 
	$£gmít_group_dec_‰ì_£gs
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
){

1646 
u32
 
group_idx
 = 
£g
->
£g_id
/
SEGMENT_GROUP_SIZE
;

1647 
group_hódî
 *
group
 = &
su≥r
->
group_hódî_¨øy
[
group_idx
];

1649 
	`©omic_dec
(&
group
->
‰ì_£g_cou¡
);

1650 
	`BUG_ON
(()
	`©omic_ªad
(&
group
->
‰ì_£g_cou¡
)<0);

1651 
	}
}

1653 
u32
 
	$£gmít_group_öc_‰ì_£gs
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
){

1654 
u32
 
group_idx
 = 
£g
->
£g_id
/
SEGMENT_GROUP_SIZE
;

1655 
u32
 
‰ì_£g_cou¡
;

1656 
group_hódî
 *
group
 = &
su≥r
->
group_hódî_¨øy
[
group_idx
];

1658 
‰ì_£g_cou¡
 = 
	`©omic_öc_ªtu∫
(&
group
->free_seg_count);

1659 
	`BUG_ON
(
	`©omic_ªad
(&
group
->
‰ì_£g_cou¡
)>
SEGMENT_GROUP_SIZE
);

1660  
‰ì_£g_cou¡
;

1661 
	}
}

1663 
	$c⁄°ru˘_mëad©a_ö_øm
(
dm§c_su≥r
 *
su≥r
){

1664 
£gmít_hódî
 *
cur_£g
;

1665 
u64
 
œ°_£quí˚
 = 0;

1666 
u32
 
£g_id
;

1667 
u32
 
group_id
;

1668 
u32
 
num_£gmíts
;

1669 
u32
 
num_groups
;

1670 
u32
 *
ønd_èbÀ
;

1672 
num_£gmíts
 = 
su≥r
->
ˇche_°©
.num_segments;

1673 
num_groups
 = 
su≥r
->
ˇche_°©
.num_groups;

1675 
£g_id
 = 0; seg_id < 
num_£gmíts
; seg_id++) {

1677 
cur_£g
 = 
	`gë_£gmít_hódî_by_id
(
su≥r
, 
£g_id
);

1679 if(
cur_£g
->
£g_lﬂd
){

1681 if(
cur_£g
->
£quí˚
 > 
œ°_£quí˚
)

1682 
œ°_£quí˚
 = 
cur_£g
->
£quí˚
;

1685 
	`_c⁄°ru˘_mëad©a_ö_øm
(
su≥r
, 
£g_id
);

1696 
ønd_èbÀ
 = (
u32
 *)
	`kmÆloc
((u32)*
num_£gmíts
, 
GFP_KERNEL
);

1697 if(
ønd_èbÀ
==
NULL
){

1700 
£g_id
 = 0; seg_id < 
num_£gmíts
; seg_id++) {

1701 
ønd_èbÀ
[
£g_id
] = seg_id;

1705 
£g_id
 = 0; seg_id < 
num_£gmíts
; seg_id++) {

1706 
u32
 
ønd_num
;

1707 
u32
 
ãmp
;

1709 
	`gë_øndom_byãs
(&
ønd_num
, (
u32
));

1710 
ønd_num
 %
num_£gmíts
;

1712 
ãmp
 = 
ønd_èbÀ
[
£g_id
];

1713 
ønd_èbÀ
[
£g_id
] =Ñ™d_èbÀ[
ønd_num
];

1714 
ønd_èbÀ
[
ønd_num
] = 
ãmp
;

1718 
£g_id
 = 0; seg_id < 
num_£gmíts
; seg_id++) {

1719 
u32
 
ønd_£g_id
 = 
ønd_èbÀ
[
£g_id
];

1722 
cur_£g
 = 
	`gë_£gmít_hódî_by_id
(
su≥r
, 
ønd_£g_id
);

1724 if(
	`©omic_ªad
(&
cur_£g
->
vÆid_cou¡
)){

1726 
	`©omic_öc
(&
su≥r
->
w°©
.
£g_cou¡
[
cur_£g
->
£g_ty≥
]);

1729 if(
	`is_wrôe_°rùe
(
cur_£g
->
£g_ty≥
)){

1730 
	`©omic_add
(
NUM_SUMMARY
*
NUM_DATA_SSD
, &
cur_£g
->
vÆid_cou¡
);

1731 
	`©omic_add
(
NUM_SUMMARY
*
NUM_DATA_SSD
, &
cur_£g
->
group
->
vÆid_cou¡
);

1732 
	`©omic_add
(
NUM_SUMMARY
*
NUM_DATA_SSD
, &
cur_£g
->
dúty_cou¡
);

1733 
	`©omic_add
(
NUM_SUMMARY
*
NUM_DATA_SSD
, &
su≥r
->
ˇche_°©
.
num_u£d_blocks
);

1735 if(
	`USE_ERASURE_PARITY
(&
su≥r
->
∑øm
)){

1736 
	`©omic_add
(
CHUNK_SZ
, &
cur_£g
->
vÆid_cou¡
);

1737 
	`©omic_add
(
CHUNK_SZ
, &
cur_£g
->
group
->
vÆid_cou¡
);

1738 
	`©omic_add
(
CHUNK_SZ
, &
cur_£g
->
dúty_cou¡
);

1739 
	`©omic_add
(
CHUNK_SZ
, &
su≥r
->
ˇche_°©
.
num_u£d_blocks
);

1741 
	`BUG_ON
(
	`USE_ERASURE_RAID6
(&
su≥r
->
∑øm
));

1744 
	`©omic_add
(
NUM_SUMMARY
*
NUM_SSD
, &
cur_£g
->
group
->
vÆid_cou¡
);

1745 
	`©omic_add
(
NUM_SUMMARY
*
NUM_SSD
, &
cur_£g
->
dúty_cou¡
);

1746 
	`©omic_add
(
NUM_SUMMARY
*
NUM_SSD
, &
su≥r
->
ˇche_°©
.
num_u£d_blocks
);

1748 
	`BUG_ON
(
	`©omic_ªad
(&
cur_£g
->
vÆid_cou¡
Ë> 
STRIPE_SZ
);

1749 
	`BUG_ON
(
	`©omic_ªad
(&
cur_£g
->
dúty_cou¡
Ë> 
STRIPE_SZ
);

1751 
	`ö£π_£g_to_u£d_queue
(
su≥r
, 
cur_£g
);

1753 
	`£t_bô
(
SEG_SEALED
, &
cur_£g
->
Êags
);

1754 
	`˛ór_bô
(
SEG_USED
, &
cur_£g
->
Êags
);

1755 
	`˛ór_bô
(
SEG_PARTIAL
, &
cur_£g
->
Êags
);

1757 
	`move_£g_u£d_to_£Æed_queue
(
su≥r
, 
cur_£g
);

1759 
	`ö£π_£g_to_Æloc_queue
(
su≥r
, 
cur_£g
);

1760 
	`£t_bô
(
SEG_CLEAN
, &
cur_£g
->
Êags
);

1761 
	`˛ór_bô
(
SEG_RECOVERY
, &
cur_£g
->
Êags
);

1762 
	`˛ór_bô
(
SEG_HIT
, &
cur_£g
->
Êags
);

1764 
	`£gmít_group_öc_‰ì_£gs
(
su≥r
, 
cur_£g
);

1768 
group_id
 = 0; group_id < 
num_groups
; group_id++) {

1769 
group_hódî
 *
group
 = &
su≥r
->
group_hódî_¨øy
[
group_id
];

1771 if(
	`©omic_ªad
(&
group
->
‰ì_£g_cou¡
)==
SEGMENT_GROUP_SIZE
){

1772 
	`ö£π_group_to_Æloc_queue
(
su≥r
, 
group
);

1774 
	`ö£π_group_to_u£d_queue
(
su≥r
, 
group
);

1775 
	`move_group_u£d_to_£Æed_queue
(
su≥r
, 
group
);

1779 
	`¥ötk
("Üa° sequí˚ = %Œu\n", 
œ°_£quí˚
+1);

1780 
	`©omic64_£t
(&
su≥r
->
ˇche_°©
.
Æloc_£quí˚
, 
œ°_£quí˚
+1);

1782 
	`k‰ì
(
ønd_èbÀ
);

1785 
	}
}

1788 
	$assign_√w_£gmít
(
dm§c_su≥r
 *
su≥r
){

1789 
ty≥
;

1792 
ty≥
 = 0;ty≥ <
RHBUF
;type++){

1794 if(
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
£g_Æloc_cou¡
)<1){

1795 
	`¥ötk
("Çÿm‹ê‰ì segmít†%d \n", 
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
£g_Æloc_cou¡
));

1799 
£g_id
 = 
	`Æloc_√w_£gmít
(
su≥r
, 
ty≥
, 
Ál£
);

1800 
	`¥ötk
("ássig¿√w seg = %d \n", ()
£g_id
);

1802 
	`ma_£t_cou¡
(
su≥r
, 
ty≥
, 
STRIPE_SZ
);

1803 if(
	`should_√ed_ª‰esh_£g
(
su≥r
, 
ty≥
)){

1804 
	`¥ötk
("ássig¿√w seg = %d %d \n", ()
ty≥
,

1805 
	`ma_gë_cou¡
(
su≥r
, 
ty≥
) );

1811 
	}
}

1813 
__mu°_check
 
	$sˇn_mëad©a
(
dm§c_su≥r
 *
su≥r
)

1815 
r
 = 0;

1816 
°¨t_jiffõs
;

1817 
íd_jiffõs
;

1819 
°¨t_jiffõs
 = 
jiffõs
;

1821 
r
 = 
	`lﬂd_summ¨y_‰om_ssd
(
su≥r
);

1822 if(
r
)

1823  
r
;

1825 
r
 = 
	`c⁄°ru˘_mëad©a_ö_øm
(
su≥r
);

1826 if(
r
)

1827  
r
;

1829 
	`mb_¨øy_ßnôy_check
(
su≥r
);

1831 
	`¥ötk
(" cuºíàutû = %d \n", 
	`gë_cuº_utû
(
su≥r
));

1833 
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
£g_Æloc_cou¡
) < 20){

1834 
	`do_background_gc
(
su≥r
);

1835 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(1000));

1836 
	`¥ötk
(" fªê£gmíà%d \n", 
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
£g_Æloc_cou¡
));

1838 
	`©omic_£t
(&
su≥r
->
migøã_mgr
.
migøã_åiggîed
, 0);

1839 
	`©omic_£t
(&
su≥r
->
migøã_mgr
.
background_gc_⁄
, 0);

1840 
su≥r
->
migøã_mgr
.
Ælow_migøã
 = 0;

1842 
r
 = 
	`assign_√w_£gmít
(
su≥r
);

1843 if(
r
)

1844  
r
;

1846 
íd_jiffõs
 = 
jiffõs
;

1848 
	`¥ötk
(" cuºíàutû = %d \n", 
	`gë_cuº_utû
(
su≥r
));

1849 
	`¥ötk
(" fªê£gmíà%d \n", 
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
£g_Æloc_cou¡
));

1850 
	`¥ötk
(" Sˇ¬ög Mëad©®Timê = %d m†\n", 
	`jiffõs_to_m£cs
(
íd_jiffõs
 - 
°¨t_jiffõs
));

1854 
	}
}

1856 
ømbuf_∑ge
 *
	$Æloc_sögÀ_∑ge
(
dm§c_su≥r
 *
su≥r
){

1857 
Êags
;

1858 
ømbuf_∑ge
 *
∑ge
;

1859 
£gbuf_m™agî
 *
£gbuf_mgr
 = &
su≥r
->segbuf_mgr;

1860 
check
 = 0;

1862 
	`•ö_lock_úqßve
(&
£gbuf_mgr
->
lock
, 
Êags
);

1863 
	`©omic_ªad
(&
£gbuf_mgr
->
öa˘ive_∑ge_cou¡
)<=
STRIPE_SZ
){

1864 
	`•ö_u∆ock_úqª°‹e
(&
£gbuf_mgr
->
lock
, 
Êags
);

1866 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(50));

1867 
	`•ö_lock_úqßve
(&
£gbuf_mgr
->
lock
, 
Êags
);

1868 
check
 = 1;

1870 if(
check
)

1871 
	`¥ötk
(" delayedÑamállocated .. \n");

1873 
	`©omic_öc
(&
£gbuf_mgr
->
gc_a˘ive_∑ge_cou¡
);

1874 
∑ge
 = 
	`_Æloc_ømbuf_∑ge
(
su≥r
);

1875 
∑ge
->
∂
->
√xt
 = 
NULL
;

1876 
	`•ö_u∆ock_úqª°‹e
(&
£gbuf_mgr
->
lock
, 
Êags
);

1877  
∑ge
;

1878 
	}
}

1880 
	$‰ì_sögÀ_∑ge
(
dm§c_su≥r
 *
su≥r
, 
ømbuf_∑ge
 *
∑ge
){

1881 
Êags
;

1882 
£gbuf_m™agî
 *
£gbuf_mgr
 = &
su≥r
->segbuf_mgr;

1884 
	`•ö_lock_úqßve
(&
£gbuf_mgr
->
lock
, 
Êags
);

1885 
	`_‰ì_ømbuf_∑ge
(
su≥r
, 
∑ge
);

1886 
	`©omic_dec
(&
£gbuf_mgr
->
gc_a˘ive_∑ge_cou¡
);

1887 
	`•ö_u∆ock_úqª°‹e
(&
£gbuf_mgr
->
lock
, 
Êags
);

1888 
	}
}

1890 
ømbuf_∑ge
 *
	$_Æloc_ømbuf_∑ge
(
dm§c_su≥r
 *
su≥r
){

1891 
ømbuf_∑ge
 *
∑ge
;

1892 
£gbuf_m™agî
 *
£gbuf_mgr
 = &
su≥r
->segbuf_mgr;

1894 if(
	`©omic_ªad
(&
£gbuf_mgr
->
öa˘ive_∑ge_cou¡
)==0){

1895 
	`¥ötk
("ÇoÑambuf ... \n");

1897 
	`BUG_ON
(
	`©omic_ªad
(&
£gbuf_mgr
->
öa˘ive_∑ge_cou¡
)==0);

1898 
∑ge
 = 
	`li°_fú°_íåy
(

1899 &
£gbuf_mgr
->
öa˘ive_∑ge_li°
, 
ømbuf_∑ge
, 
li°
);

1901 
	`li°_move_èû
(&
∑ge
->
li°
, &
£gbuf_mgr
->
a˘ive_∑ge_li°
);

1902 
	`©omic_dec
(&
£gbuf_mgr
->
öa˘ive_∑ge_cou¡
);

1903 
	`©omic_öc
(&
£gbuf_mgr
->
a˘ive_∑ge_cou¡
);

1905  
∑ge
;

1906 
	}
}

1908 
ømbuf_∑ge
 *
	$_‰ì_ømbuf_∑ge
(
dm§c_su≥r
 *
su≥r
, 
ømbuf_∑ge
 *
∑ge
){

1909 
£gbuf_m™agî
 *
£gbuf_mgr
 = &
su≥r
->segbuf_mgr;

1911 if(!
∑ge
)

1912  
NULL
;

1914 
	`li°_move_èû
(&
∑ge
->
li°
, &
£gbuf_mgr
->
öa˘ive_∑ge_li°
);

1915 
	`©omic_dec
(&
£gbuf_mgr
->
a˘ive_∑ge_cou¡
);

1916 
	`©omic_öc
(&
£gbuf_mgr
->
öa˘ive_∑ge_cou¡
);

1918  
∑ge
;

1919 
	}
}

1921 
	$Æloc_summ¨y_ømbuf
(
dm§c_su≥r
 *
su≥r
, 
ømbuf„r
 *
ømbuf
){

1922 
i
;

1923 if(
SUMMARY_SCHEME
==
SUMMARY_PER_CHUNK
){

1924 
i
=0;i<
STRIPE_SZ
;i++){

1925 if(!
ømbuf
->
∑ges
[
i
] && 
	`chunk_summ¨y_ønge
(
su≥r
, i)){

1926 
ømbuf
->
∑ges
[
i
] = 
	`_Æloc_ømbuf_∑ge
(
su≥r
);

1930 if(!
ømbuf
->
∑ges
[
STRIPE_SZ
-1])

1931 
ømbuf
->
∑ges
[
STRIPE_SZ
-1] = 
	`_Æloc_ømbuf_∑ge
(
su≥r
);

1933 
	}
}

1935 
	$Æloc_ømbuf_∑ge
(
dm§c_su≥r
 *
su≥r
, 
ømbuf„r
 *
ømbuf
, 
ˇche_ty≥
){

1936 
i
;

1937 
summ¨y_⁄ly
;

1939 if(
ømbuf
==
NULL
)

1942 
ømbuf
->
Æloc_cou¡
 = 0;

1944 if(
	`is_gc_°rùe
(
ˇche_ty≥
)){

1945 
summ¨y_⁄ly
 = 0;

1947 if(
ˇche_ty≥
 =
RHBUF
 || cache_ty≥ =
RCBUF
){

1948 
summ¨y_⁄ly
 = 0;

1950 if(
su≥r
->
∑øm
.
îasuª_code
!=
ERASURE_CODE_NONE
){

1951 
summ¨y_⁄ly
 = 0;

1953 
summ¨y_⁄ly
 = 0;

1958 if(
summ¨y_⁄ly
){

1959 
	`Æloc_summ¨y_ømbuf
(
su≥r
, 
ømbuf
);

1961 
i
=0;i<
STRIPE_SZ
;i++){

1962 if(!
ømbuf
->
∑ges
[
i
])

1963 
ømbuf
->
∑ges
[
i
] = 
	`_Æloc_ømbuf_∑ge
(
su≥r
);

1967 
i
=0;i<
STRIPE_SZ
;i++){

1968 if(
ømbuf
->
∑ges
[
i
])

1969 
ømbuf
->
Æloc_cou¡
++;

1971 
	`BUG_ON
(!
ømbuf
->
Æloc_cou¡
);

1972 
	}
}

1974 
	$‰ì_ømbuf_∑ge
(
dm§c_su≥r
 *
su≥r
, 
ømbuf„r
 *
ømbuf
){

1975 
i
;

1977 
i
=0;i<
STRIPE_SZ
;i++){

1978 if(
ømbuf
->
∑ges
[
i
]){

1979 
	`_‰ì_ømbuf_∑ge
(
su≥r
, 
ømbuf
->
∑ges
[
i
]);

1980 
ømbuf
->
Æloc_cou¡
--;

1982 
ømbuf
->
∑ges
[
i
] = 
NULL
;

1984 
	`BUG_ON
(
ømbuf
->
Æloc_cou¡
);

1985 
	}
}

1987 
ømbuf„r
 *
	$Æloc_ømbuf„r
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
, 
°rùe_size
){

1988 
ømbuf„r
 *
√xt_ømbuf
;

1989 
£gbuf_m™agî
 *
£gbuf_mgr
 = &
su≥r
->segbuf_mgr;

1990 
li°_hód
 *
öa˘ive_hód
 = &
£gbuf_mgr
->
öa˘ive_li°
;

1991 
li°_hód
 *
a˘ive_hód
 = &
£gbuf_mgr
->
a˘ive_li°
;

1992 
Êags
;

1993 
i
;

1995 
	`•ö_lock_úqßve
(&
£gbuf_mgr
->
lock
, 
Êags
);

1997 
öa˘ive_hód
 = &
£gbuf_mgr
->
öa˘ive_li°
;

1998 
a˘ive_hód
 = &
£gbuf_mgr
->
a˘ive_li°
;

2000 if(
	`©omic_ªad
(&
£gbuf_mgr
->
öa˘ive_cou¡
)){

2002 
√xt_ømbuf
 = (
ømbuf„r
 *)

2003 
	`li°_íåy
(
öa˘ive_hód
->
√xt
, 
ømbuf„r
, 
li°
);

2005 
	`li°_dñ
(&
√xt_ømbuf
->
li°
);

2006 
	`©omic_dec
(&
£gbuf_mgr
->
öa˘ive_cou¡
);

2008 
	`li°_add_èû
(&
√xt_ømbuf
->
li°
, 
a˘ive_hód
);

2009 
	`©omic_öc
(&
£gbuf_mgr
->
a˘ive_cou¡
[
ˇche_ty≥
]);

2010 
	`©omic_öc
(&
£gbuf_mgr
->
a˘ive_tŸÆ_cou¡
);

2011 
	`Æloc_ømbuf_∑ge
(
su≥r
, 
√xt_ømbuf
, 
ˇche_ty≥
);

2012 
	`©omic_£t
(&
√xt_ømbuf
->
ªf_cou¡
, 
°rùe_size
);

2014 
i
 = 0;ò< 
NUM_SSD
;i++){

2015 
	`©omic_£t
(&
√xt_ømbuf
->
bios_cou¡
[
i
], 0);

2016 
	`©omic_£t
(&
√xt_ømbuf
->
bios_°¨t
[
i
], 0);

2018 
	`©omic_£t
(&
√xt_ømbuf
->
bios_tŸÆ_cou¡
, 0);

2019 
	`©omic_£t
(&
√xt_ømbuf
->
bios_tŸÆ_°¨t
, 0);

2020 
i
 = 0;ò< 
STRIPE_SZ
;i++){

2021 
√xt_ømbuf
->
bios
[
i
] = 
NULL
;

2023 
	`•ö_lock_öô
(&
√xt_ømbuf
->
lock
);

2032 if(
	`is_wrôe_°rùe
(
ˇche_ty≥
)){

2033 
	`©omic_add
(
NUM_SUMMARY
*
NUM_DATA_SSD
, &
√xt_ømbuf
->
ªf_cou¡
);

2034 if(
	`USE_ERASURE_PARITY
(&
su≥r
->
∑øm
))

2035 
	`©omic_add
(
CHUNK_SZ
, &
√xt_ømbuf
->
ªf_cou¡
);

2037 
	`©omic_add
(
NUM_SUMMARY
*
NUM_SSD
, &
√xt_ømbuf
->
ªf_cou¡
);

2040 
	`BUG_ON
(
	`USE_ERASURE_RAID6
(&
su≥r
->
∑øm
));

2042 
	`¥ötk
 ("álloc:áctive = %d, inactve = %d \n",

2043 ()
	`©omic_ªad
(&
£gbuf_mgr
->
a˘ive_tŸÆ_cou¡
),

2044 ()
	`©omic_ªad
(&
£gbuf_mgr
->
öa˘ive_cou¡
));

2045 
	`BUG_ON
(1);

2048 
	`•ö_u∆ock_úqª°‹e
(&
£gbuf_mgr
->
lock
, 
Êags
);

2051 
	`¥ötk
 ("álloc:áctive = %d, inactve = %d \n",

2052 ()
	`©omic_ªad
(&
£gbuf_mgr
->
a˘ive_cou¡
),

2053 ()
	`©omic_ªad
(&
£gbuf_mgr
->
öa˘ive_cou¡
));

2054 
	`¥ötk
("Ñambu‡∑gêöa˘ivêcou¡ = %d (%d MBË\n", ()
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
öa˘ive_∑ge_cou¡
),

2055 ()
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
öa˘ive_∑ge_cou¡
)/256);

2060 
	`BUG_ON
(
√xt_ømbuf
==
NULL
);

2061  
√xt_ømbuf
;

2062 
	}
}

2064 
	$ªÀa£_ømbuf„r
(
dm§c_su≥r
 *
su≥r
, 
ømbuf„r
 *
ømbuf
, 
ˇche_ty≥
){

2065 
£gbuf_m™agî
 *
£gbuf_mgr
 = &
su≥r
->segbuf_mgr;

2066 
li°_hód
 *
öa˘ive_hód
 = &
£gbuf_mgr
->
öa˘ive_li°
;

2067 
Êags
;

2072 
	`•ö_lock_úqßve
(&
£gbuf_mgr
->
lock
, 
Êags
);

2074 
	`‰ì_ømbuf_∑ge
(
su≥r
, 
ømbuf
);

2076 
	`li°_dñ
(&
ømbuf
->
li°
);

2077 
	`©omic_dec
(&
£gbuf_mgr
->
a˘ive_cou¡
[
ˇche_ty≥
]);

2078 
	`©omic_dec
(&
£gbuf_mgr
->
a˘ive_tŸÆ_cou¡
);

2080 
	`li°_add_èû
(&
ømbuf
->
li°
, 
öa˘ive_hód
);

2081 
	`©omic_öc
(&
£gbuf_mgr
->
öa˘ive_cou¡
);

2083 
	`•ö_u∆ock_úqª°‹e
(&
£gbuf_mgr
->
lock
, 
Êags
);

2085 
	`≥ndög_w‹kî_scheduÀ
(
su≥r
);

2086 
	}
}

2089 
	$check_ømbuf_poﬁ
(
dm§c_su≥r
 *
su≥r
){

2090 
i
;

2091 
ømbuf„r
 *
ømbuf
;

2092 
£gbuf_m™agî
 *
£gbuf_mgr
 = &
su≥r
->segbuf_mgr;

2094 
i
 = 0; i < 
£gbuf_mgr
->
num_ømbuf_poﬁ
; i++) {

2095 
ømbuf
 = 
£gbuf_mgr
->
ømbuf_poﬁ
 + 
i
;

2096 if(
ømbuf
==
NULL
)

2099 
	`¥ötk
("Ñambuf %d, start %dÜength = %d \n",

2100 
i
, 
	`©omic_ªad
(&
ømbuf
->
bios_tŸÆ_°¨t
),

2101 
	`©omic_ªad
(&
ømbuf
->
bios_tŸÆ_cou¡
));

2105 
	}
}

2110 
∑ge_li°
 *
	$Æloc_∂
(
gÂ_t
 
gÂ
)

2112 
∑ge_li°
 *
∂
;

2114 
∂
 = 
	`kmÆloc
((*∂), 
gÂ
);

2115 i‡(!
∂
)

2116  
NULL
;

2118 
∂
->
∑ge
 = 
	`Æloc_∑ge
(
gÂ
);

2119 i‡(!
∂
->
∑ge
) {

2120 
	`k‰ì
(
∂
);

2121  
NULL
;

2124  
∂
;

2125 
	}
}

2127 
	$‰ì_∂
(
∑ge_li°
 *
∂
)

2129 
	`__‰ì_∑ge
(
∂
->
∑ge
);

2130 
	`k‰ì
(
∂
);

2131 
	}
}

2134 
	$öô_óch_ømbuf_poﬁ
(
dm§c_su≥r
 *
su≥r
){

2135 
i
, 
j
;

2136 
ømbuf„r
 *
ømbuf
;

2137 
£gbuf_m™agî
 *
£gbuf_mgr
 = &
su≥r
->segbuf_mgr;

2138 
li°_hód
 *
a˘ive_hód
 = &
£gbuf_mgr
->
a˘ive_li°
;

2139 
li°_hód
 *
öa˘ive_hód
 = &
£gbuf_mgr
->
öa˘ive_li°
;

2141 
i
=0;i<()
	`©omic_ªad
(&
£gbuf_mgr
->
öa˘ive_∑ge_cou¡
);i++){

2142 
ømbuf_∑ge
 *
∑ge
;

2143 
∑ge
 = 
	`kmÆloc
((
ømbuf_∑ge
), 
GFP_KERNEL
);

2144 if(!
∑ge
){

2145 
	`WBERR
();

2146  -
ENOMEM
;

2149 
	`li°_add_èû
(&
∑ge
->
li°
, &
£gbuf_mgr
->
öa˘ive_∑ge_li°
);

2152 
∑ge
->
d©a
 = (*)
	`__gë_‰ì_∑ges
(
GFP_KERNEL
, 
SRC_SIZE_SHIFT
);

2153 i‡(!
∑ge
->
d©a
) {

2154 
	`WBERR
();

2155  -
ENOMEM
;

2158 
∑ge
->
∂
 = 
	`Æloc_∂
(
__GFP_NOWARN
 | 
__GFP_NORETRY
);

2159 i‡(!
∑ge
->
∂
) {

2160 
	`WBERR
();

2161  -
ENOMEM
;

2164 
∑ge
->∑gê
	`Æloc_∑ges
(
GFP_KERNEL
, 
SRC_SIZE_SHIFT
);

2165 i‡(!
∑ge
->page) {

2166 
	`WBERR
();

2167  -
ENOMEM
;

2172 
	`INIT_LIST_HEAD
(
a˘ive_hód
);

2173 
	`INIT_LIST_HEAD
(
öa˘ive_hód
);

2175 
£gbuf_mgr
->
∑ges
 = 
	`vmÆloc
(£gbuf_mgr->
num_ømbuf_poﬁ
 * (*Ë* 
CHUNK_SZ
 * 
MAX_CACHE_DEVS
);

2176 
	`¥ötk
(" Allocate memory segbuf_mgr->pages = %dbytes \n",

2177 ()(
£gbuf_mgr
->
num_ømbuf_poﬁ
 * (*Ë* 
CHUNK_SZ
 * 
MAX_CACHE_DEVS
));

2178 if(
£gbuf_mgr
->
∑ges
==
NULL
){

2179 
	`¥ötk
(" Cannotállocate memory segbuf_mgr->pages = %dbytes \n",

2180 ()(
£gbuf_mgr
->
num_ømbuf_poﬁ
 * (*Ë* 
CHUNK_SZ
 * 
MAX_CACHE_DEVS
));

2181  -
ENOMEM
;

2183 
£gbuf_mgr
->
bios
 = 
	`vmÆloc
(£gbuf_mgr->
num_ømbuf_poﬁ
 * (*Ë* 
CHUNK_SZ
 * 
MAX_CACHE_DEVS
);

2185 
	`¥ötk
(" Allocate memory segbuf_mgr->bios = %dbytes \n",

2186 ()(
£gbuf_mgr
->
num_ømbuf_poﬁ
 * (*Ë* 
CHUNK_SZ
 * 
MAX_CACHE_DEVS
));

2187 if(
£gbuf_mgr
->
bios
==
NULL
){

2188 
	`¥ötk
(" Cannotállocate memory segbuf_mgr->bios = %dbytes \n",

2189 ()(
£gbuf_mgr
->
num_ømbuf_poﬁ
 * (*Ë* 
CHUNK_SZ
 * 
MAX_CACHE_DEVS
));

2190  -
ENOMEM
;

2193 
i
 = 0; i < 
£gbuf_mgr
->
num_ømbuf_poﬁ
; i++) {

2194 
num_∑ges
 = 
CHUNK_SZ
 * 
MAX_CACHE_DEVS
;

2196 
ømbuf
 = 
£gbuf_mgr
->
ømbuf_poﬁ
 + 
i
;

2197 
ømbuf
->
ømbuf_id
 = 
i
;

2198 
ømbuf
->
Æloc_cou¡
 = 0;

2211 
ømbuf
->
∑ges
 = (
ømbuf_∑ge
 **)
£gbuf_mgr
->∑ge†+ 
i
 * 
num_∑ges
;

2212 i‡(!
ømbuf
->
∑ges
) {

2213 
	`BUG_ON
(1);

2214  -
ENOMEM
;

2219 
ømbuf
->
bios
 = (
bio
 **)
£gbuf_mgr
->bio†+ 
i
 * 
num_∑ges
;

2220 i‡(!
ømbuf
->
bios
) {

2221 
	`BUG_ON
(1);

2222  -
ENOMEM
;

2225 
j
=0;j<
num_∑ges
;j++){

2226 
ømbuf
->
∑ges
[
j
] = 
NULL
;

2229 
j
=0;j<
num_∑ges
;j++){

2230 
ømbuf
->
bios
[
j
] = 
NULL
;

2233 
j
 = 0;j < 
NUM_SSD
;j++){

2234 
	`©omic_£t
(&
ømbuf
->
bios_cou¡
[
j
], 0);

2235 
	`©omic_£t
(&
ømbuf
->
bios_°¨t
[
j
], 0);

2237 
	`©omic_£t
(&
ømbuf
->
bios_tŸÆ_cou¡
, 0);

2238 
	`©omic_£t
(&
ømbuf
->
bios_tŸÆ_°¨t
, 0);

2240 
	`li°_add_èû
(&
ømbuf
->
li°
, 
öa˘ive_hód
);

2241 
	`©omic_öc
(&
£gbuf_mgr
->
öa˘ive_cou¡
);

2245 
	}
}

2247 
__mu°_check
 
	$öô_ømbuf_poﬁ
(
dm§c_su≥r
 *
su≥r
)

2249 
ªs
;

2250 
u32
 
ƒ
;

2251 
£gbuf_m™agî
 *
£gbuf_mgr
 = &
su≥r
->segbuf_mgr;

2252 
i
;

2258 
ƒ
 = 
su≥r
->
∑øm
.
ømbuf_poﬁ_amou¡
/
STRIPE_SZ
;

2260 i‡(!
ƒ
) {

2261 
	`WBERR
("rambuf must beállocatedátÜeast one");

2262  -
EINVAL
;

2270 
£gbuf_mgr
->
num_ømbuf_poﬁ
 = 
ƒ
;

2272 
£gbuf_mgr
->
ømbuf_poﬁ
 = 
	`vmÆloc
((
ømbuf„r
Ë* segbuf_mgr->
num_ømbuf_poﬁ
);

2273 i‡(!
£gbuf_mgr
->
ømbuf_poﬁ
) {

2274 
	`WBERR
();

2275  -
ENOMEM
;

2278 
	`©omic_£t
(&
£gbuf_mgr
->
a˘ive_tŸÆ_cou¡
, 0);

2279 
i
 = 0;ò< 
NBUF
;i++)

2280 
	`©omic_£t
(&
£gbuf_mgr
->
a˘ive_cou¡
[
i
], 0);

2281 
	`©omic_£t
(&
£gbuf_mgr
->
öa˘ive_cou¡
, 0);

2283 
	`INIT_LIST_HEAD
(&
£gbuf_mgr
->
a˘ive_∑ge_li°
);

2284 
	`INIT_LIST_HEAD
(&
£gbuf_mgr
->
öa˘ive_∑ge_li°
);

2286 
	`©omic_£t
(&
£gbuf_mgr
->
a˘ive_∑ge_cou¡
, 0);

2287 
	`©omic_£t
(&
£gbuf_mgr
->
gc_a˘ive_∑ge_cou¡
, 0);

2288 
	`©omic_£t
(&
£gbuf_mgr
->
öa˘ive_∑ge_cou¡
, 
su≥r
->
∑øm
.
ømbuf_poﬁ_amou¡
);

2289 
	`©omic_£t
(&
£gbuf_mgr
->
tŸÆ_∑ge_cou¡
, 
su≥r
->
∑øm
.
ømbuf_poﬁ_amou¡
);

2290 
	`¥ötk
(" Rambu‡Sizê%d MB,ÇumÑmabu‡hód = %d\n", 
su≥r
->
∑øm
.
ømbuf_poﬁ_amou¡
/256, 
ƒ
);

2292 
ªs
 = 
	`öô_óch_ømbuf_poﬁ
(
su≥r
);

2293 if(
ªs
)

2294  
ªs
;

2296 
	`¥ötk
 ("á˘ivê%d, i«˘vê%d \n", ()
	`©omic_ªad
(&
£gbuf_mgr
->
a˘ive_tŸÆ_cou¡
),

2297 ()
	`©omic_ªad
(&
£gbuf_mgr
->
öa˘ive_cou¡
));

2299 
	`•ö_lock_öô
(&
£gbuf_mgr
->
lock
);

2301 
	`öô_waôqueue_hód
(&
£gbuf_mgr
->
waô_queue
);

2303 
£gbuf_mgr
->
öôülized
 = 1;

2306 
	}
}

2308 
	$‰ì_ømbuf_poﬁ
(
dm§c_su≥r
 *
su≥r
)

2311 
ømbuf_∑ge
 *
∑ge
, *
ãmp
;

2312 
£gbuf_m™agî
 *
£gbuf_mgr
 = &
su≥r
->segbuf_mgr;

2315 if(!
£gbuf_mgr
->
öôülized
)

2325 
	`v‰ì
(
£gbuf_mgr
->
∑ges
);

2326 
	`v‰ì
(
£gbuf_mgr
->
bios
);

2327 
	`v‰ì
(
£gbuf_mgr
->
ømbuf_poﬁ
);

2329 
	`li°_f‹_óch_íåy_ß„
(
∑ge
, 
ãmp
, &
£gbuf_mgr
->
a˘ive_∑ge_li°
, 
li°
){

2330 
	`li°_dñ
(&
∑ge
->
li°
);

2334 
	`‰ì_∂
(
∑ge
->
∂
);

2335 
	`k‰ì
(
∑ge
);

2336 
	`©omic_dec
(&
£gbuf_mgr
->
a˘ive_∑ge_cou¡
);

2338 
	`BUG_ON
(
	`©omic_ªad
(&
£gbuf_mgr
->
a˘ive_∑ge_cou¡
));

2340 
	`li°_f‹_óch_íåy_ß„
(
∑ge
, 
ãmp
, &
£gbuf_mgr
->
öa˘ive_∑ge_li°
, 
li°
){

2341 
	`li°_dñ
(&
∑ge
->
li°
);

2345 
	`‰ì_∂
(
∑ge
->
∂
);

2346 
	`k‰ì
(
∑ge
);

2347 
	`©omic_dec
(&
£gbuf_mgr
->
öa˘ive_∑ge_cou¡
);

2349 
	`BUG_ON
(
	`©omic_ªad
(&
£gbuf_mgr
->
öa˘ive_∑ge_cou¡
));

2350 
	}
}

2352 
¸óã_d´m⁄
(
dm§c_su≥r
 *
su≥r
,

2353 
èsk_°ru˘
 **
èskp
,

2354 (*
thªad‚
)(*
d©a
),

2355 *
«me
){

2356 
èsk_°ru˘
 *
èsk
;

2357 
r
 = 0;

2359 
èsk
 = 
	`kthªad_¸óã
(
thªad‚
, 
su≥r
, 
«me
);

2360 i‡(
	`IS_ERR
(
«me
)) {

2361 
r
 = 
	`PTR_ERR
(
èsk
);

2362 
èsk
 = 
NULL
;

2364 
	`¥ötk
(" %†d´m⁄ c™nŸ bê¸óãd \n", 
«me
);

2366 
	`wake_up_¥o˚ss
(
èsk
);

2368 *
èskp
 = 
èsk
;

2370  
r
;

2371 
	}
}

2375 
	#CREATE_DAEMON
(
«me
) \

2377 
su≥r
->
«me
##
_d´m⁄
 = 
	`kthªad_¸óã
“ame##
_¥oc
, super, \

2379 i‡(
	`IS_ERR
(
su≥r
->
«me
##
_d´m⁄
)) { \

2380 
r
 = 
	`PTR_ERR
(
su≥r
->
«me
##
_d´m⁄
); \

2381 
su≥r
->
«me
##
_d´m⁄
 = 
NULL
; \

2382 
	`WBERR
("couldn't spawn" #name "daemon"); \

2383 
bad_
##
«me
##
_d´m⁄
; \

2385 
	`wake_up_¥o˚ss
(
su≥r
->
«me
##
_d´m⁄
); \

2386 } 0)

	)

	@metadata.h

23 #i‚de‡
DM_SRC_METADATA_H


24 
	#DM_SRC_METADATA_H


	)

26 
	#VMALLOC


	)

29 
	s∑π
 {

30 *
	mmem‹y
;

33 
	sœrge_¨øy
 {

34 
∑π
 *
	m∑πs
;

35 
u64
 
	mnum_ñems
;

36 
u32
 
	mñemsize
;

38 
	#ALLOC_SIZE
 (1 << 16)

	)

43 
mëablock
 *
mb_©
(
dm§c_su≥r
 *
su≥r
, 
u32
 
idx
);

44 
£gmít_hódî
 *
gë_£gmít_hódî_by_id
(
dm§c_su≥r
 *,

45 
u64
 
£gmít_id
);

46 
£gmít_hódî
 *
gë_£gmít_hódî_by_mb_idx
(
dm§c_su≥r
 *
su≥r
,

47 
u32
 
mb_idx
);

48 
£˘‹_t
 
ˇlc_mb_°¨t_£˘‹
(
dm§c_su≥r
 *,

49 
£gmít_hódî
 *, 
u32
 
mb_idx
);

50 
boﬁ
 
is_⁄_buf„r
(
dm§c_su≥r
 *, 
u32
 
mb_idx
);

52 
u32
 
gë_cuº_utû
(
dm§c_su≥r
 *);

56 
ht_hód
 *
ht_gë_hód
(
dm§c_su≥r
 *, 
£˘‹_t
);

57 
mëablock
 *
ht_lookup
(
dm§c_su≥r
 *, 
£˘‹_t
);

58 
ht_ªgi°î
(
dm§c_su≥r
 *, 
£˘‹_t
, 
mëablock
 *);

59 
ht_dñ
(
dm§c_su≥r
 *, 
mëablock
 *);

60 
disˇrd_ˇches_ö£g
(
dm§c_su≥r
 *, 
£gmít_hódî
 *);

64 
__mu°_check
 
sˇn_su≥rblock
(
dm§c_su≥r
 *);

65 
__mu°_check
 
f‹m©_ˇche_devi˚
(
dm§c_su≥r
 *);

69 
¥ï¨e_£gmít_hódî_devi˚
(
£gmít_hódî_devi˚
 *
de°
,

70 
dm§c_su≥r
 *,

71 
£gmít_hódî
 *
§c
, 
ˇche_ty≥
, 
ømbuf_∑ge
 **
ømbuf
);

73 
u8
 
ˇlc_checksum
(u8 *
±r
, 
size
);

76 
Æloc_migøti⁄_buf„r
(
dm§c_su≥r
 *, 
size_t
 
num_b©ch
);

77 
‰ì_migøti⁄_buf„r
(
dm§c_su≥r
 *);

81 
__mu°_check
 
ªsume_ˇche
(
dm§c_su≥r
 *);

82 
‰ì_ˇche
(
dm§c_su≥r
 *);

86 
ö£π_£g_to_Æloc_queue
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
);

87 
ö£π_£g_to_u£d_queue
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
);

88 
move_£g_u£d_to_£Æed_queue
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
);

89 
move_£g_£Æed_to_migøã_queue
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
lock
);

90 
move_£g_migøã_to_Æloc_queue
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
);

91 
£gmít_hódî
 *
ªmove_Æloc_queue
(
dm§c_su≥r
 *
su≥r
, £gmít_hódî *
£g
);

92 
em±y_£Æed_queue
(
dm§c_su≥r
 *
su≥r
);

93 
em±y_Æloc_queue
(
dm§c_su≥r
 *
su≥r
);

94 
gë_Æloc_cou¡
(
dm§c_su≥r
 *
su≥r
);

95 
¥öt_Æloc_queue
(
dm§c_su≥r
 *
su≥r
);

96 
move_£g_mru_£Æed
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
);

97 
ªÀa£_ª£rve_£gs
(
dm§c_su≥r
 *
su≥r
);

98 
ª£rve_ª£rve_£gs
(
dm§c_su≥r
 *
su≥r
, 
√ed_£gs
);

99 
£gmít_hódî
 *
ªmove_ª£rve_queue
(
dm§c_su≥r
 *
su≥r
);

100 
ømbuf„r
 *
Æloc_ømbuf„r
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
, 
°rùe_size
);

101 
Æloc_ømbuf_∑ge
(
dm§c_su≥r
 *
su≥r
, 
ømbuf„r
 *
ømbuf
, 
ˇche_ty≥
);

102 
ªÀa£_ømbuf„r
(
dm§c_su≥r
 *
su≥r
, 
ømbuf„r
 *, 
ˇche_ty≥
);

103 
£g_°©
(
£gmít_hódî
 *
£g
);

104 
mëablock
 *
gë_mb
(
dm§c_su≥r
 *
su≥r
, 
u32
 
£g_id
, u32 
idx
);

105 
œrge_¨øy
 *
œrge_¨øy_Æloc
(
u32
 
ñemsize
, 
u64
 
num_ñems
);

106 
ømbuf_∑ge
 *
_Æloc_ømbuf_∑ge
(
dm§c_su≥r
 *
su≥r
);

107 
ømbuf_∑ge
 *
_‰ì_ømbuf_∑ge
(
dm§c_su≥r
 *
su≥r
, ømbuf_∑gê*
∑ge
);

108 
‰ì_sögÀ_∑ge
(
dm§c_su≥r
 *
su≥r
, 
ømbuf_∑ge
 *
∑ge
);

109 
ømbuf_∑ge
 *
Æloc_sögÀ_∑ge
(
dm§c_su≥r
 *
su≥r
);

111 *
œrge_¨øy_©
(
œrge_¨øy
 *
¨r
, 
u32
 
i
);

112 
œrge_¨øy_‰ì
(
œrge_¨øy
 *
¨r
);

113 
œrge_¨øy
 *
œrge_¨øy_Æloc
(
u32
 
ñemsize
, 
u64
 
num_ñems
);

114 
¸óã_d´m⁄
(
dm§c_su≥r
 *
su≥r
, 
èsk_°ru˘
 **
èskp
, (*
thªad‚
)(*
d©a
), *
«me
);

115 
u32
 
	`ˇlc_num_chunks
(
dm_dev
 *
dev
, 
dm§c_su≥r
 *
su≥r
);

116 
__mu°_check
 
	`sˇn_mëad©a
(
dm§c_su≥r
 *
su≥r
);

117 
__mu°_check
 
	`ªsume_m™agîs
(
dm§c_su≥r
 *
su≥r
);

118 
__mu°_check
 
	`öô_ømbuf_poﬁ
(
dm§c_su≥r
 *
su≥r
);

119 
__mu°_check
 
	`öô_£gmít_hódî_¨øy
(
dm§c_su≥r
 *
su≥r
);

120 
__mu°_check
 
	`ht_em±y_öô
(
dm§c_su≥r
 *
su≥r
);

121 
	`‰ì_ht
(
dm§c_su≥r
 *
su≥r
);

122 
	`‰ì_£gmít_hódî_¨øy
(
dm§c_su≥r
 *
su≥r
);

123 
	`‰ì_ømbuf_poﬁ
(
dm§c_su≥r
 *
su≥r
);

124 
	`check_dúty_cou¡
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
cur_£g
);

125 
	`check_vÆid_cou¡
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
cur_£g
);

126 
	`move_£g_migøã_to_£Æed_queue
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
);

127 
	`check_ømbuf_poﬁ
(
dm§c_su≥r
 *
su≥r
);

129 
u32
 
	`£gmít_group_öc_‰ì_£gs
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
);

130 
	`£gmít_group_dec_‰ì_£gs
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
);

131 
	`£gmít_group_¥öt_°©
(
dm§c_su≥r
 *
su≥r
);

132 
group_hódî
 *
	`ªmove_Æloc_group_queue
(
dm§c_su≥r
 *
su≥r
);

133 
	`ö£π_group_to_u£d_queue
(
dm§c_su≥r
 *
su≥r
, 
group_hódî
 *
group
);

134 
	`move_group_u£d_to_£Æed_queue
(
dm§c_su≥r
 *
su≥r
, 
group_hódî
 *
group
);

135 
	`move_group_£Æed_to_migøã_queue
(
dm§c_su≥r
 *
su≥r
, 
group_hódî
 *
group
, 
lock
);

136 
	`move_group_migøã_to_Æloc_queue
(
dm§c_su≥r
 *
su≥r
, 
group_hódî
 *
group
);

137 
	`gë_group_Æloc_cou¡
(
dm§c_su≥r
 *
su≥r
);

138 
	`assign_√w_£gmít
(
dm§c_su≥r
 *
su≥r
);

	@raid.h

24 #i‚de‡
_RAID_CONF_H


25 
	#_RAID_CONF_H


	)

29 
	#NR_STRIPE_HASH_LOCKS
 8

	)

30 
	#STRIPE_HASH_LOCKS_MASK
 (
NR_STRIPE_HASH_LOCKS
 - 1)

	)

32 
	sr5c⁄f
 {

33 
hli°_hód
 *
	m°rùe_hashtbl
;

35 
•ölock_t
 
	mhash_locks
[
NR_STRIPE_HASH_LOCKS
];

36 
mddev
 *
	mmddev
;

37 
	mchunk_£˘‹s
;

38 
	mÀvñ
, 
	mÆg‹ôhm
;

39 
	mmax_degøded
;

40 
	møid_disks
;

41 
	mmax_ƒ_°rùes
;

48 
£˘‹_t
 
	mªsh≠e_¥ogªss
;

52 
£˘‹_t
 
	mªsh≠e_ß„
;

53 
	m¥evious_øid_disks
;

54 
	m¥ev_chunk_£˘‹s
;

55 
	m¥ev_Ægo
;

56 
	mgíî©i⁄
;

57 
£qcou¡_t
 
	mgí_lock
;

58 
	mªsh≠e_checkpoöt
;

60 
	mmö_off£t_diff
;

67 
li°_hód
 
	mh™dÀ_li°
;

68 
li°_hód
 
	mhﬁd_li°
;

69 
li°_hód
 
	mdñayed_li°
;

70 
li°_hód
 
	mbôm≠_li°
;

71 
bio
 *
	mªåy_ªad_Æig√d
;

72 
bio
 *
	mªåy_ªad_Æig√d_li°
;

73 
©omic_t
 
	m¥îód_a˘ive_°rùes
;

74 
©omic_t
 
	ma˘ive_Æig√d_ªads
;

75 
©omic_t
 
	m≥ndög_fuŒ_wrôes
;

76 
	mby∑ss_cou¡
;

77 
	mby∑ss_thªshﬁd
;

78 
li°_hód
 *
	mœ°_hﬁd
;

80 
©omic_t
 
	mªsh≠e_°rùes
;

84 
	ma˘ive_«me
;

85 
	mˇche_«me
[2][32];

86 
kmem_ˇche
 *
	m¶ab_ˇche
;

88 
	m£q_Êush
, 
	m£q_wrôe
;

89 
	mquõs˚
;

91 
	mfuŒsync
;

95 
	mªcovîy_dißbÀd
;

97 
	søid5_≥r˝u
 {

98 
∑ge
 *
	m•¨e_∑ge
;

99 *
	ms¸ibbÀ
;

103 } 
__≥r˝u
 *
	m≥r˝u
;

104 
size_t
 
	ms¸ibbÀ_Àn
;

108 #ifde‡
CONFIG_HOTPLUG_CPU


109 
nŸifõr_block
 
	m˝u_nŸify
;

115 
©omic_t
 
	ma˘ive_°rùes
;

116 
li°_hód
 
	möa˘ive_li°
[
NR_STRIPE_HASH_LOCKS
];

117 
©omic_t
 
	mem±y_öa˘ive_li°_ƒ
;

118 
Œi°_hód
 
	mªÀa£d_°rùes
;

119 
waô_queue_hód_t
 
	mwaô_f‹_°rùe
;

120 
waô_queue_hód_t
 
	mwaô_f‹_ovîœp
;

121 
	möa˘ive_blocked
;

124 
	mpoﬁ_size
;

125 
•ölock_t
 
	mdevi˚_lock
;

126 
disk_öfo
 *
	mdisks
;

131 
md_thªad
 *
	mthªad
;

132 
li°_hód
 
	mãmp_öa˘ive_li°
[
NR_STRIPE_HASH_LOCKS
];

133 
r5w‹kî_group
 *
	mw‹kî_groups
;

134 
	mgroup_˙t
;

135 
	mw‹kî_˙t_≥r_group
;

	@target.c

24 
	~<löux/buf„r_hód.h
>

25 
	~<löux/dm´ngöe.h
>

26 
	~<löux/øid/x‹.h
>

27 
	~<löux/øid/pq.h
>

28 
	~<löux/dm-kc›yd.h
>

29 
	~<löux/blkdev.h
>

30 
	~<löux/sched.h
>

31 
	~<löux/dñay.h
>

32 
	~<löux/¸c32.h
>

33 
	~<löux/gÂ.h
>

34 
	~<löux/w‹kqueue.h
>

35 
	~<löux/hπimî.h
>

36 
	~<löux/ktime.h
>

37 
	~<löux/jhash.h
>

38 
	~"èrgë.h
"

39 
	~"mëad©a.h
"

40 
	~"d´m⁄.h
"

41 
	~"Ãu.h
"

42 
	~"Æloc.h
"

47 
	$dm§c_io
(
dm_io_ªque°
 *
io_ªq
, 
num_ªgi⁄s
,

48 
dm_io_ªgi⁄
 *
whîe
, *
sync_îr‹_bôs
)

50  
	`dm_io
(
io_ªq
, 
num_ªgi⁄s
, 
whîe
, 
sync_îr‹_bôs
);

51 
	}
}

54 
£˘‹_t
 
	$dm§c_devsize_£˘‹s
(
dm_dev
 *
dev
)

56  
	`i_size_ªad
(
dev
->
bdev
->
bd_öode
Ë>> 
SECTOR_SHIFT
;

57 
	}
}

60 
	$¥ï¨e_chunk_summ¨y
(

61 
dm§c_su≥r
 *
su≥r
,

62 
£gmít_hódî
 *
£g
,

63 
ømbuf_∑ge
 **
∑ges
,

64 
ssd_id
,

65 
ˇche_ty≥


68 
£gmít_hódî_devi˚
 *
de°
;

69 
u32
 
chunk_°¨t
;

70 
u32
 
i
;

71 
u64
 
£quí˚
;

72 
u32
 
summ¨y_off£t
;

74 
summ¨y_off£t
 = 
	`gë_summ¨y_off£t
(
su≥r
, 
ssd_id
);

75 
chunk_°¨t
 = 
ssd_id
 * 
CHUNK_SZ
;

77 
£quí˚
 = 
	`©omic64_öc_ªtu∫
(&
su≥r
->
ˇche_°©
.
Æloc_£quí˚
);

78 
£g
->
£quí˚
 = sequence;

81 
de°
 = (
£gmít_hódî_devi˚
 *)
	`∑ge_addªss
(
∑ges
[
summ¨y_off£t
]->
∂
->
∑ge
);

82 
de°
->
£quí˚
 = 
	`˝u_to_À64
(
£g
->sequence);

83 
de°
->
uuid
 = 
su≥r
->
ˇche_°©
.uuid;

84 
de°
->
magic
 = 
SRC_MAGIC
;

85 
de°
->
ty≥
 = 
ˇche_ty≥
;

87 if(
ˇche_ty≥
==
GWBUF
)

88 
de°
->
ty≥
 = 
WCBUF
;

89 if(
ˇche_ty≥
==
GRBUF
)

90 
de°
->
ty≥
 = 
RCBUF
;

92 
i
 = 0; i < 
CHUNK_SZ
; i++) {

93 
mëablock
 *
mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
chunk_°¨t
 + 
i
);

94 
mëablock_devi˚
 *
mbdev
;

95 
u32
 
mëa_∑ge
 = 
summ¨y_off£t
 + 1 + 
i
/
NUM_ENTRY_PER_PAGE
;

96 
u32
 
mëa_off£t
 = 
i
 % 
NUM_ENTRY_PER_PAGE
;

98 
mbdev
 = (
mëablock_devi˚
 *)
	`∑ge_addªss
(
∑ges
[
mëa_∑ge
]->
∂
->
∑ge
);

100 if(!
	`chunk_summ¨y_ønge
(
su≥r
, 
i
)){

101 if(
ˇche_ty≥
==
GWBUF
){

102 if(
mb
->
£˘‹
==~0){

103 
	`¥ötk
(" seg = %d, ssd = %d, off£à%d se˘‹ = %d \n", ()
£g
->
£g_id
, 
ssd_id
, 
i
, ()
mb
->
£˘‹
);

104 
	`¥ötk
(" check .. \n");

108 
mbdev
[
mëa_off£t
].
£˘‹
 = 
mb
->sector;

109 
mbdev
[
mëa_off£t
].
dúty_bôs
 = 
	`ã°_bô
(
MB_DIRTY
, &
mb
->
mb_Êags
);

111 
mbdev
[
mëa_off£t
].
£˘‹
 = ~0;

112 
mbdev
[
mëa_off£t
].
dúty_bôs
 = 0;

116 #ifde‡
USE_CHECKSUM


117 
i
 = 0; i < 
CHUNK_SZ
; i++) {

118 
mëablock
 *
mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
chunk_°¨t
 + 
i
);

119 
mëablock_devi˚
 *
mbdev
 = &
de°
->
mb¨r
[
i
];

120 
mbdev
->
checksum
 = 
mb
->checksum;

123 
	}
}

128 
	$gíî©e_fuŒ_summ¨y
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
,

129 
ømbuf„r
 *
ømbuf
, 
ssd_id
, 
fuŒ
){

130 
blk_∂ug
 
∂ug
;

131 
i
;

133 
	`¥ï¨e_chunk_summ¨y
(
su≥r
, 
£g
, 
ømbuf
->
∑ges
, 
ssd_id
, seg->
£g_ty≥
);

135 
	`blk_°¨t_∂ug
(&
∂ug
);

136 
i
 = 0;ò< 
NUM_SUMMARY
;i++){

137 
wb_job
 *
job
;

139 
u32
 
summ¨y_mb_idx
 = 
	`gë_summ¨y_off£t
(
su≥r
, 
ssd_id
Ë+ 
i
;

140 
job
 = 
	`wrôeback_make_job
(
su≥r
, 
£g
, 
summ¨y_mb_idx
, 
NULL
, 
ømbuf
, 
fuŒ
);

141 
	`wrôeback_issue_job
(
su≥r
, 
job
);

143 
	`blk_föish_∂ug
(&
∂ug
);

144 
	}
}

148 
	$ch™ge_£g_°©us
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
£g_Àngth
, 
f‹˚_£Æ
){

149 
group_hódî
 *
group
;

150 
Êags
;

151 
group_£Æed
 = 0;

155 
	`LOCK
(
su≥r
, 
f
);

156 
	`©omic_add
(
	`©omic_ªad
(&
£g
->
∑π_Àngth
), &£g->
∑π_°¨t
);

157 
	`©omic_£t
(&
£g
->
∑π_Àngth
, 0);

158 
	`UNLOCK
(
su≥r
, 
f
);

161 if(
f‹˚_£Æ
 || 
£g_Àngth
>=
STRIPE_SZ
){

163 if(
	`ã°_bô
(
SEG_PARTIAL
, &
£g
->
Êags
)){

164 
	`¥ötk
(" f‹˚ só»... seg .. = %d \n", ()
£g
->
£g_id
);

168 if(
	`ˇlc_mëa_cou¡
(
su≥r
, 
£g
)!=
	`gë_mëad©a_cou¡
(su≥r, seg->
£g_ty≥
)){

169 
	`¥ötk
(" *£Æed: seg = %d vÆid = %d, mëacou¡ = %d \n", ()
£g
->
£g_id
, 
	`©omic_ªad
(&£g->
vÆid_cou¡
),

170 
	`ˇlc_mëa_cou¡
(
su≥r
, 
£g
));

173 
	`LOCK
(
su≥r
, 
f
);

174 if(
	`©omic_ªad
(&
£g
->
vÆid_cou¡
)-
	`gë_mëad©a_cou¡
(
su≥r
, seg->
£g_ty≥
)!=

175 
	`ˇlc_vÆid_cou¡
(
su≥r
, 
£g
, 1)){

176 
	`¥ötk
(" invalid valid count = %d %d, dummy = %d \n",

177 
	`©omic_ªad
(&
£g
->
vÆid_cou¡
)-
	`gë_mëad©a_cou¡
(
su≥r
, seg->
£g_ty≥
),

178 
	`ˇlc_vÆid_cou¡
(
su≥r
, 
£g
, 1),

179 
	`©omic_ªad
(&
£g
->
dummy_cou¡
));

181 
	`UNLOCK
(
su≥r
, 
f
);

191 
	`lock£g
(
£g
, 
Êags
);

192 if(
£g
->
£g_ty≥
==
GWBUF
){

193 
	`©omic_dec
(&
su≥r
->
w°©
.
£g_cou¡
[
GWBUF
]);

194 
	`©omic_öc
(&
su≥r
->
w°©
.
£g_cou¡
[
WCBUF
]);

195 
£g
->
£g_ty≥
 = 
WCBUF
;

196 }if(
£g
->
£g_ty≥
==
GRBUF
){

197 
	`©omic_dec
(&
su≥r
->
w°©
.
£g_cou¡
[
GRBUF
]);

198 
	`©omic_öc
(&
su≥r
->
w°©
.
£g_cou¡
[
RCBUF
]);

199 
£g
->
£g_ty≥
 = 
RCBUF
;

201 
	`u∆ock£g
(
£g
, 
Êags
);

203 if(
	`ã°_bô
(
SEG_USED
, &
£g
->
Êags
)||ã°_bô(
SEG_PARTIAL
, &seg->flags)){

204 
	`£t_bô
(
SEG_SEALED
, &
£g
->
Êags
);

205 
	`˛ór_bô
(
SEG_USED
, &
£g
->
Êags
);

206 
	`˛ór_bô
(
SEG_PARTIAL
, &
£g
->
Êags
);

207 
	`move_£g_u£d_to_£Æed_queue
(
su≥r
, 
£g
);

209 
group
 = &
su≥r
->
group_hódî_¨øy
[
£g
->
£g_id
/
SEGMENT_GROUP_SIZE
];

210 if(
	`©omic_öc_ªtu∫
(&
group
->
£Æed_£g_cou¡
)==
SEGMENT_GROUP_SIZE
){

212 
	`move_group_u£d_to_£Æed_queue
(
su≥r
, 
group
);

213 
group_£Æed
 = 1;

217 if(
	`ã°_bô
(
SEG_PARTIAL
, &
£g
->
Êags
)){

218 
	`£t_bô
(
SEG_USED
, &
£g
->
Êags
);

219 
	`˛ór_bô
(
SEG_PARTIAL
, &
£g
->
Êags
);

223 
	`BUG_ON
(
	`©omic_ªad
(&
£g
->
Àngth
)>
STRIPE_SZ
);

224  
group_£Æed
;

226 
	}
}

228 
	$Æloc_summ¨y
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
,

229 
ømbuf„r
 *
ømbuf
, 
u32
 
summ¨y_idx
, 
ˇche_ty≥
, 
fuŒ
){

230 
u32
 
j
;

232 
	`Æloc_mb_summ¨y
(
su≥r
, 
£g
, 
ˇche_ty≥
, 
summ¨y_idx
, 
NULL
);

233 
	`öôülize_mb_summ¨y
(
su≥r
, 
£g
, 
ˇche_ty≥
, 
summ¨y_idx
, 
fuŒ
);

234 
j
 = 0;j < 
NUM_SUMMARY
;j++)

235 
	`bio_∂uggög
(
su≥r
, 
£g
, 
ømbuf
, 
NULL
, 
summ¨y_idx
 + 
j
);

236 
	}
}

238 
u32
 
	$Æloc_skù
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
,

239 
ømbuf„r
 *
ømbuf
, 
ˇche_ty≥
){

240 
u32
 
dummy_idx
;

242 
dummy_idx
 = 
	`Æloc_√xt_mb
(
su≥r
, 
£g
, 0, 
ˇche_ty≥
, 
NULL
);

243 
	`_Æloc_mb_summ¨y
(
su≥r
, 
£g
, 
ˇche_ty≥
, 
dummy_idx
, 0, 1);

244 
	`bio_∂uggög
(
su≥r
, 
£g
, 
ømbuf
, 
NULL
, 
dummy_idx
);

245  
dummy_idx
;

246 
	}
}

249 
u32
 
	$Æloc_dummy
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
,

250 
ømbuf„r
 *
ømbuf
, 
ˇche_ty≥
){

251 
u32
 
dummy_idx
;

252 
dummy_idx
 = 
	`Æloc_√xt_mb
(
su≥r
, 
£g
, 0, 
ˇche_ty≥
, 
NULL
);

253 
	`_Æloc_mb_summ¨y
(
su≥r
, 
£g
, 
ˇche_ty≥
, 
dummy_idx
, 0, 1);

254 
	`bio_∂uggög
(
su≥r
, 
£g
, 
ømbuf
, 
NULL
, 
dummy_idx
);

255  
dummy_idx
;

256 
	}
}

258 
	$Æloc_∑πül_summ¨y
(
dm§c_su≥r
 *
su≥r
,

259 
£gmít_hódî
 *
£g
,

260 
ømbuf„r
 *
ømbuf
, 
ˇche_ty≥
){

261 
group_hódî
 *
group
 = 
£g
->group;

262 
i
;

263 
√ed_fuŒ_summ¨y
 = 0;

264 
s32
 
‰ì_blocks
 = 0;

265 
s32
 
summ¨y_blocks
 = 0;

267 
s32
 
num_∑πül_summ¨y
;

268 
s32
 
num_upd©ed_blocks
;

269 
s32
 
summ¨y_byãs
;

270 
u32
 
row_cou¡
 = 0, 
œ°_row_‰ì_cou¡
 = 0;

271 
num_a˘ive_ssd
;

273 
i
 = 0;ò< 
CHUNK_SZ
-
NUM_SUMMARY
;i++){

274 
row_cou¡
 = 
	`ma_gë_row_cou¡
(
su≥r
, 
£g
->
£g_ty≥
, 
i
);

275 
‰ì_blocks
 +(
NUM_SSD
 - 
row_cou¡
);

276 if(
i
==
CHUNK_SZ
-
NUM_SUMMARY
-1)

277 
œ°_row_‰ì_cou¡
 = (
NUM_SSD
 - 
row_cou¡
);

280 
num_upd©ed_blocks
 = 
	`©omic_ªad
(&
ømbuf
->
bios_tŸÆ_cou¡
Ë-átomic_ªad(&ømbuf->
bios_tŸÆ_°¨t
);

281 
summ¨y_byãs
 = (
mëablock_devi˚
)*
num_upd©ed_blocks
+1;

282 
num_∑πül_summ¨y
 = 
summ¨y_byãs
/
SRC_PAGE_SIZE
;

283 if(
summ¨y_byãs
%
SRC_PAGE_SIZE
)

284 
num_∑πül_summ¨y
++;

289 if(
‰ì_blocks
==0){

290 
summ¨y_blocks
 = 0;

291 
√ed_fuŒ_summ¨y
 = 1;

293 if(
‰ì_blocks
-
num_∑πül_summ¨y
<
œ°_row_‰ì_cou¡
){

296 
summ¨y_blocks
 = 
‰ì_blocks
;

297 
√ed_fuŒ_summ¨y
 = 1;

298 }if(
‰ì_blocks
-
num_∑πül_summ¨y
>=
œ°_row_‰ì_cou¡
){

300 
summ¨y_blocks
 = 
num_∑πül_summ¨y
;

301 
√ed_fuŒ_summ¨y
 = 0;

305 if(
	`USE_ERASURE_PARITY
(&
su≥r
->
∑øm
))

306 
num_a˘ive_ssd
 = 
	`©omic_ªad
(&
group
->
num_u£d_ssd
)-1;

308 
num_a˘ive_ssd
 = 
	`©omic_ªad
(&
group
->
num_u£d_ssd
);

310 if(
‰ì_blocks
<=
œ°_row_‰ì_cou¡
){

312 
summ¨y_blocks
 = 
œ°_row_‰ì_cou¡
;

313 
√ed_fuŒ_summ¨y
 = 1;

315 
u32
 
ªmaöög_‰ì_blocks
 = 
‰ì_blocks
 - 
num_∑πül_summ¨y
;

317 if(
‰ì_blocks
<
num_∑πül_summ¨y
){

318 
summ¨y_blocks
 = 
‰ì_blocks
;

319 
√ed_fuŒ_summ¨y
 = 1;

320 }if(
ªmaöög_‰ì_blocks
>=
œ°_row_‰ì_cou¡
 &&

321 
œ°_row_‰ì_cou¡
 =
num_a˘ive_ssd


324 
summ¨y_blocks
 = 
num_∑πül_summ¨y
;

325 
√ed_fuŒ_summ¨y
 = 0;

326 }if(
ªmaöög_‰ì_blocks
<
œ°_row_‰ì_cou¡
){

329 
summ¨y_blocks
 = 
‰ì_blocks
;

330 
√ed_fuŒ_summ¨y
 = 1;

332 
summ¨y_blocks
 = 
‰ì_blocks
;

333 
√ed_fuŒ_summ¨y
 = 1;

334 
	`¥ötk
("Ö¨tü»summ¨y s≥cü»ˇ£ = %dÜa° fªê%dÇumá˘ivêssd %d \n", 
‰ì_blocks
, 
œ°_row_‰ì_cou¡
, 
num_a˘ive_ssd
);

340 
i
 = 0;ò< 
summ¨y_blocks
;i++){

341 
mëablock
 *
mb
;

342 
u32
 
dummy_idx
;

344 
dummy_idx
 = 
	`Æloc_dummy
(
su≥r
, 
£g
, 
ømbuf
, seg->
£g_ty≥
);

345 
mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
dummy_idx
%
STRIPE_SZ
);

346 
	`£t_bô
(
MB_DUMMY
, &
mb
->
mb_Êags
);

353 if(!
√ed_fuŒ_summ¨y
)

356 
i
 = 0;ò< 
NUM_SSD
;i++){

357 
u32
 
summ¨y_idx
 = 
i
 * 
CHUNK_SZ
;

358 
u32
 
dev_cou¡
;

360 if(
	`USE_ERASURE_PARITY
(&
su≥r
->
∑øm
Ë&& 
	`is_wrôe_°rùe
(
£g
->
£g_ty≥
)){

361 if(
i
==
	`gë_∑rôy_ssd
(
su≥r
, 
£g
->
£g_id
))

365 
dev_cou¡
 = 
	`ma_gë_cou¡_≥r_dev
(
su≥r
, 
ˇche_ty≥
, 
i
);

366 if(
dev_cou¡
 =
CHUNK_SZ
)

369 
summ¨y_idx
 = 
i
 * 
CHUNK_SZ
 + 
dev_cou¡
;

371 
	`Æloc_summ¨y
(
su≥r
, 
£g
, 
ømbuf
, 
summ¨y_idx
, 
ˇche_ty≥
, 1);

372 
	`©omic_£t
(&
£g
->
summ¨y_°¨t
[
i
], 
dev_cou¡
+
NUM_SUMMARY
);

375 if(
	`ma_gë_cou¡
(
su≥r
, 
£g
->
£g_ty≥
)!
STRIPE_SZ
)

376 
	`¥ötk
(" Nìd **fuŒ summ¨y wrôã¿summ¨y m©ŸÆ = %d, vÆid %d \n", 
	`ma_gë_cou¡
(
su≥r
, 
£g
->
£g_ty≥
), 
STRIPE_SZ
);

379 
	}
}

381 
	$buûd_mëad©a
(
dm§c_su≥r
 *
su≥r
,

382 
£gmít_hódî
 *
£g
,

383 
£g_Àngth
,

384 
ømbuf„r
 *
ømbuf
,

385 
©omic_t
 *
bios_°¨t
,

386 
©omic_t
 *
bios_cou¡
,

387 
f‹˚_£Æ
,

388 
buûd_summ¨y
,

389 
Êush_d©a
)

391 
group_£Æed
;

392 
Êush_comm™d
 = 0;

394 #i‡
SUMMARY_LOCATION
 =
USE_FIRST_SUMMARY


395 if(
	`ã°_bô
(
SEG_PARTIAL
, &
£g
->
Êags
))

396 
	`Æloc_∑πül_summ¨y
(
su≥r
, 
£g
, 
ømbuf
, 
ˇche_ty≥
);

399 
group_£Æed
 = 
	`ch™ge_£g_°©us
(
su≥r
, 
£g
, 
£g_Àngth
, 
f‹˚_£Æ
);

400 if(
buûd_summ¨y
){

401 
	`¥ötk
(" build summary ... \n");

402 
	`BUG_ON
(1);

406 if(
su≥r
->
∑øm
.
Êush_comm™d
==
FLUSH_NONE
){

407 
Êush_comm™d
 = 0;

408 }if(
su≥r
->
∑øm
.
Êush_comm™d
==
FLUSH_FINE
){

409 
Êush_comm™d
 = 1;

410 }if(
su≥r
->
∑øm
.
Êush_comm™d
==
FLUSH_COARSE
){

411 if(
group_£Æed
)

412 
Êush_comm™d
 = 1;

414 
Êush_comm™d
 = 0;

420 if(
Êush_d©a
){

421 
cou¡
;

422 
i
;

424 if(
	`ã°_bô
(
SEG_PARTIAL
, &
£g
->
Êags
))

425 
	`¥ötk
(" P¨tü»Êush d©®...£g = %dÜígth = %d(biÿÀngth = %dË\n", ()
£g
->
£g_id
,

426 ()
	`©omic_ªad
(&
£g
->
Àngth
),

427 ()
	`©omic_ªad
(&
ømbuf
->
bios_tŸÆ_cou¡
));

429 
i
 = 0;ò< 
NUM_SSD
;i++){

430 if(
	`USE_ERASURE_PARITY
(&
su≥r
->
∑øm
Ë&& 
	`is_wrôe_°rùe
(
£g
->
£g_ty≥
)){

431 if(
i
==
	`gë_∑rôy_ssd
(
su≥r
, 
£g
->
£g_id
))

434 
	`¥ï¨e_chunk_summ¨y
(
su≥r
, 
£g
, 
ømbuf
->
∑ges
, 
i
, seg->
£g_ty≥
);

437 
cou¡
 = 0;

438 
i
 = 0;ò< 
NUM_SSD
;i++){

439 
cou¡
 +
	`Êush_∂ug_¥oc
(
su≥r
, 
£g
, 
ømbuf
, 
bios_°¨t
, 
bios_cou¡
, 1, 
i
, 
Êush_comm™d
);

442 
	}
}

445 
	$öô_√w_£gmít
(
dm§c_su≥r
 *
su≥r
, 
u64
 
√xt_id
, 
ˇche_ty≥
){

446 
£gmít_hódî
 *
√w_£g
;

447 
i
;

449 
√w_£g
 = 
	`gë_£gmít_hódî_by_id
(
su≥r
, 
√xt_id
);

450 
√w_£g
->
£g_ty≥
 = 
ˇche_ty≥
;

451 
√w_£g
->
Êags
 = 0;

453 
	`©omic_£t
(&
√w_£g
->
Àngth
, 0);

454 
	`©omic_£t
(&
√w_£g
->
vÆid_cou¡
, 0);

455 
	`©omic_£t
(&
√w_£g
->
vÆid_˛ón_cou¡
, 0);

456 
	`©omic_£t
(&
√w_£g
->
vÆid_dúty_cou¡
, 0);

457 
	`©omic_£t
(&
√w_£g
->
dummy_cou¡
, 0);

458 
	`©omic_£t
(&
√w_£g
->
dúty_cou¡
, 0);

459 
	`©omic_£t
(&
√w_£g
->
hŸ_cou¡
, 0);

460 
	`©omic_£t
(&
√w_£g
->
hŸ_˛ón_cou¡
, 0);

461 
	`©omic_£t
(&
√w_£g
->
∑π_°¨t
, 0);

462 
	`©omic_£t
(&
√w_£g
->
∑π_Àngth
, 0);

463 
	`©omic_£t
(&
√w_£g
->
bios_cou¡
, 0);

464 
	`©omic_£t
(&
√w_£g
->
num_bufc›y
, 0);

465 
	`©omic_£t
(&
√w_£g
->
num_fûlög
, 0);

466 
	`©omic_£t
(&
√w_£g
->
num_ªad_öÊight
, 0);

467 
	`©omic_£t
(&
√w_£g
->
num_migios
, 0);

468 
i
 = 0;ò< 
MAX_CACHE_DEVS
;i++)

469 
	`©omic_£t
(&
√w_£g
->
summ¨y_°¨t
[
i
], 0);

471 
	`˛ór_bô
(
SEG_CLEAN
, &
√w_£g
->
Êags
);

472 
	`˛ór_bô
(
SEG_USED
, &
√w_£g
->
Êags
);

473 
	`˛ór_bô
(
SEG_SEALED
, &
√w_£g
->
Êags
);

474 
	`˛ór_bô
(
SEG_MIGRATING
, &
√w_£g
->
Êags
);

475 
	`˛ór_bô
(
SEG_PARTIAL
, &
√w_£g
->
Êags
);

476 
	`˛ór_bô
(
SEG_RECOVERY
, &
√w_£g
->
Êags
);

477 
	`˛ór_bô
(
SEG_HIT
, &
√w_£g
->
Êags
);

478 
	`˛ór_bô
(
SEG_LOCK
, &
√w_£g
->
Êags
);

480 
	}
}

482 
ölöe
 
	$√ed_ømbuf_size
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
){

483 
√ed_size
;

485 if(
	`is_gc_°rùe
(
ˇche_ty≥
)){

486 
√ed_size
 = 
STRIPE_SZ
;

487 }if(
	`is_ªad_°rùe
(
ˇche_ty≥
Ë|| 
	`NO_USE_ERASURE_CODE
(&
su≥r
->
∑øm
)){

488 
√ed_size
 = 
STRIPE_SZ
;

490 
√ed_size
 = 
STRIPE_SZ
;

493  
√ed_size
;

494 
	}
}

496 
ölöe
 
	$ˇn_gë_‰ì_£gmít
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
, 
gc
){

497 
√ed_size
;

498 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

500 
√ed_size
 = 
	`√ed_ømbuf_size
(
su≥r
, 
ˇche_ty≥
);

502 if(!
gc
){

503 if(
	`©omic_ªad
(&
£g_Æloˇt‹
->
£g_Æloc_cou¡
)>=
MIGRATE_LOWWATER
 &&

504 
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
öa˘ive_cou¡
) &&

505 
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
öa˘ive_∑ge_cou¡
)>=
√ed_size
)

510 if(
	`©omic_ªad
(&
£g_Æloˇt‹
->
£g_Æloc_cou¡
)>=2&&

511 
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
öa˘ive_cou¡
) &&

512 
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
öa˘ive_∑ge_cou¡
)>=
√ed_size
)

522 
	}
}

524 
£gmít_hódî
 *
	$_Æloc_√w_£g
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
){

525 
group_hódî
 *
group
;

526 
£gmít_hódî
 *
√w_£g
 = 
NULL
;

538 
group
 = 
su≥r
->
cuºít_group
;

539 if(
su≥r
->
cuºít_group
==
NULL
 || (su≥r->cuºít_grou∞&& 
	`©omic_ªad
(&su≥r->cuºít_group->
‰ì_£g_cou¡
)==0)){

541 
group
 = 
	`ªmove_Æloc_group_queue
(
su≥r
);

542 if(
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
group_Æloc_cou¡
)<=1){

543 
	`¥ötk
("WARN: AŒo¯£g fªê%d \n", ()
	`gë_Æloc_cou¡
(
su≥r
));

544 
	`¥ötk
("WARN: AŒo¯grou∞‰ì = %d \n", ()
	`gë_group_Æloc_cou¡
(
su≥r
));

547 if(
group
==
NULL
){

548 
	`¥ötk
("AŒo¯cu∏grou∞‰ì = %d \n", ()
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
group_Æloc_cou¡
));

549 
	`¥ötk
("AŒo¯£g fªê%d \n", ()
	`gë_Æloc_cou¡
(
su≥r
));

550 
	`¥ötk
("AŒo¯grou∞‰ì = %d \n", ()
	`gë_group_Æloc_cou¡
(
su≥r
));

551 
	`BUG_ON
(1);

553 
	`ö£π_group_to_u£d_queue
(
su≥r
, 
group
);

554 
su≥r
->
cuºít_group
 = 
group
;

555 
group
->
cuºít_£g_id
 = group->
group_id
 * 
SEGMENT_GROUP_SIZE
-1;

556 
	`©omic_£t
(&
group
->
£Æed_£g_cou¡
, 0);

557 
	`©omic_£t
(&
group
->
vÆid_cou¡
, 0);

559 if((
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_VERT
 ||

560 
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_HORI
)){

561 
	`group_ª£rve_em±y_chunk
(
su≥r
, 
group
->
group_id
, 
ˇche_ty≥
);

564 if(
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_VERT
 ||

565 
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_HORI
){

569 
	`©omic_£t
(&
group
->
num_u£d_ssd
, 
NUM_SSD
);

570 
	`©omic_£t
(&
group
->
skewed_£gmít
, 1);

573 
group
->
cuºít_£g_id
++;

577 
√w_£g
 = 
	`gë_£gmít_hódî_by_id
(
su≥r
, 
group
->
cuºít_£g_id
);

578 
	`ªmove_Æloc_queue
(
su≥r
, 
√w_£g
);

580 
	`£gmít_group_dec_‰ì_£gs
(
su≥r
, 
√w_£g
);

582  
√w_£g
;

583 
	}
}

585 
u64
 
	$Æloc_√w_£gmít
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
, 
boﬁ
 
u£_migøã
)

587 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

588 
£gmít_hódî
 *
√w_£g
;

589 
ømbuf„r
 *
ømbuf
;

590 
mëablock
 *
mb
;

591 
ª£rved_em±y_blocks
;

592 
i
;

593 
°rùe_size
;

595 
	`BUG_ON
(
	`©omic_ªad
(&
£g_Æloˇt‹
->
£g_Æloc_cou¡
)<1);

597 
√w_£g
 = 
	`_Æloc_√w_£g
(
su≥r
, 
ˇche_ty≥
);

598 
	`ö£π_£g_to_u£d_queue
(
su≥r
, 
√w_£g
);

600 
	`öô_√w_£gmít
(
su≥r
, 
√w_£g
->
£g_id
, 
ˇche_ty≥
);

602 
	`£t_bô
(
SEG_USED
, &
√w_£g
->
Êags
);

603 
su≥r
->
cuºít_£g
[
ˇche_ty≥
] = 
√w_£g
;

605 
°rùe_size
 = 
	`ma_ª£t
(
su≥r
, 
√w_£g
->
£g_id
, 
ˇche_ty≥
);

608 
ømbuf
 = 
	`Æloc_ømbuf„r
(
su≥r
, 
ˇche_ty≥
, 
°rùe_size
);

609 
su≥r
->
£gbuf_mgr
.
cuºít_ømbuf
[
ˇche_ty≥
] = 
ømbuf
;

611 
ª£rved_em±y_blocks
 = 
	`gë_num_em±y_chunks
(
su≥r
, 
ˇche_ty≥
Ë* 
CHUNK_SZ
;

612 
	`©omic_£t
(&
√w_£g
->
Àngth
, 
ª£rved_em±y_blocks
);

613 
	`©omic_£t
(&
√w_£g
->
∑π_Àngth
, 
ª£rved_em±y_blocks
);

615 
i
 = 0;ò< 
STRIPE_SZ
;i++){

616 
mb
 = 
	`gë_mb
(
su≥r
, 
√w_£g
->
£g_id
, 
i
);

617 
mb
->
£˘‹
 = ~0;

618 
mb
->
mb_Êags
 = 0;

621 
	`©omic_öc
(&
su≥r
->
w°©
.
£g_cou¡
[
ˇche_ty≥
]);

623 #i‡
SUMMARY_LOCATION
 =
USE_FIRST_SUMMARY


624 
i
 = 0;ò< 
NUM_SSD
;i++){

625 
u32
 
summ¨y_idx
 = 
i
 * 
CHUNK_SZ
;

627 if(
	`USE_ERASURE_PARITY
(&
su≥r
->
∑øm
Ë&& 
	`is_wrôe_°rùe
(
√w_£g
->
£g_ty≥
)){

628 if(
i
==
	`gë_∑rôy_ssd
(
su≥r
, 
√w_£g
->
£g_id
))

631 
	`Æloc_summ¨y
(
su≥r
, 
√w_£g
, 
ømbuf
, 
summ¨y_idx
, 
ˇche_ty≥
, 1);

637 
	`©omic_add
(
	`©omic_ªad
(&
√w_£g
->
∑π_Àngth
), &√w_£g->
∑π_°¨t
);

638 
	`©omic_£t
(&
√w_£g
->
∑π_Àngth
, 0);

644  
√w_£g
->
£g_id
;

645 
	}
}

648 
	$waô_Æloc_evít
(
dm§c_su≥r
 *
su≥r
, 
mö
){

649 
	`©omic_ªad
(&
su≥r
->
Æloc_cou¡
)<
mö
){

650 
	`waô_evít_öãºu±ibÀ_timeout
(
su≥r
->
Æloc_waô_queue
,

651 
	`©omic_ªad
(&
su≥r
->
Æloc_cou¡
)>=
mö
, 
	`u£cs_to_jiffõs
(
TIMEOUT_US
));

653 
	}
}

656 
	$waô_ømbuf_evít
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
){

657 
√ed_size
 = 
	`√ed_ømbuf_size
(
su≥r
, 
ˇche_ty≥
);

659  !
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
öa˘ive_cou¡
) ||

660 
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
öa˘ive_∑ge_cou¡
)<
√ed_size
){

662 
	`waô_evít_öãºu±ibÀ_timeout
(
su≥r
->
£gbuf_mgr
.
waô_queue
,

663 
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
öa˘ive_cou¡
) &&

664 
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
öa˘ive_∑ge_cou¡
)>=
√ed_size
,

665 
	`u£cs_to_jiffõs
(
TIMEOUT_US
));

667 
	}
}

669 
	$make_bios_∑rôy
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
ømbuf„r
 *
ømbuf
, 
∑πül
){

670 
u32
 
chunk_off£t
;

671 
mëablock
 *
∑rôy_mb
;

672 
mëablock
 *
dummy_mb
;

673 
Êags
;

676 if(!(
	`is_wrôe_°rùe
(
£g
->
£g_ty≥
Ë&& 
	`USE_ERASURE_CODE
(&
su≥r
->
∑øm
)))

681 
chunk_off£t
 = 0;chunk_off£à< 
CHUNK_SZ
;chunk_offset++){

682 
u32
 
∑rôy_idx
 = 
	`curs‹_∑rôy_°¨t
(
su≥r
, 
£g
->
£g_id
, seg->
£g_ty≥
Ë+ 
chunk_off£t
;

684 
u32
 
row_cou¡
 = 
	`ma_gë_row_cou¡
(
su≥r
, 
£g
->
£g_ty≥
, 
∑rôy_idx
 % 
CHUNK_SZ
);

686 
∑rôy_mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
∑rôy_idx
);

688 if(!
	`ã°_bô
(
MB_PARITY_NEED
, &
∑rôy_mb
->
mb_Êags
))

690 if(
	`ã°_bô
(
MB_PARITY_WRITTEN
, &
∑rôy_mb
->
mb_Êags
))

692 if(
row_cou¡
==1)

696 if(
row_cou¡
 < 
NUM_SSD
){

697 
u32
 
dummy_idx
;

699 if(
chunk_off£t
 >
CHUNK_SZ
-
NUM_SUMMARY
)

700 
	`¥ötk
(" ** Partial segment, Invalid ... seg = %dÖarity offset = %d....row count = %d,Öartial = %d \n",

701 ()
£g
->
£g_id
,

702 
chunk_off£t
, 
row_cou¡
, 
∑πül
);

704 if(
row_cou¡
 + 1 >
NUM_SSD
){

705 if(
su≥r
->
∑øm
.
Æig√d_io_dummy
==
ALIGNED_IO_DUMMY
){

707 
dummy_idx
 = 
	`Æloc_dummy
(
su≥r
, 
£g
, 
ømbuf
, seg->
£g_ty≥
);

708 
dummy_mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
dummy_idx
%
STRIPE_SZ
);

709 
	`£t_bô
(
MB_DUMMY
, &
dummy_mb
->
mb_Êags
);

712 
dummy_idx
 = 
	`Æloc_skù
(
su≥r
, 
£g
, 
ømbuf
, seg->
£g_ty≥
);

713 
dummy_mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
dummy_idx
%
STRIPE_SZ
);

714 
	`£t_bô
(
MB_SKIP
, &
dummy_mb
->
mb_Êags
);

718 
dummy_idx
 = 
	`Æloc_dummy
(
su≥r
, 
£g
, 
ømbuf
, seg->
£g_ty≥
);

719 
	`˛ór_bô
(
MB_PARITY_NEED
, &
∑rôy_mb
->
mb_Êags
);

720 
dummy_mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
dummy_idx
%
STRIPE_SZ
);

721 
	`£t_bô
(
MB_DUMMY
, &
dummy_mb
->
mb_Êags
);

723 
row_cou¡
 = 
	`ma_gë_row_cou¡
(
su≥r
, 
£g
->
£g_ty≥
, 
∑rôy_idx
 % 
CHUNK_SZ
);

728 if(
row_cou¡
 =
NUM_SSD
){

730 
	`bio_∂uggög
(
su≥r
, 
£g
, 
ømbuf
, 
NULL
, 
∑rôy_idx
);

732 
	`lock£g
(
£g
, 
Êags
);

733 
	`˛ór_bô
(
MB_DIRTY
, &
∑rôy_mb
->
mb_Êags
);

734 
	`˛ór_bô
(
MB_VALID
, &
∑rôy_mb
->
mb_Êags
);

735 
	`£t_bô
(
MB_PARITY
, &
∑rôy_mb
->
mb_Êags
);

737 if(
	`ã°_bô
(
MB_PARITY_NEED
, &
∑rôy_mb
->
mb_Êags
)){

738 
	`£t_bô
(
MB_PARITY_WRITTEN
, &
∑rôy_mb
->
mb_Êags
);

740 
	`u∆ock£g
(
£g
, 
Êags
);

742 if(
	`ã°_bô
(
MB_PARITY_WRITTEN
, &
∑rôy_mb
->
mb_Êags
)){

743 
	`©omic_öc
(&
£g
->
vÆid_cou¡
);

744 
	`©omic_öc
(&
£g
->
group
->
vÆid_cou¡
);

745 
	`©omic_öc
(&
£g
->
dúty_cou¡
);

746 
	`©omic_öc
(&
su≥r
->
ˇche_°©
.
num_u£d_blocks
);

747 if(
	`©omic_ªad
(&
£g
->
vÆid_cou¡
Ë> 
STRIPE_SZ
){

748 
	`¥ötk
("WARN: segid = %d,Ö¨ôy x‹ d©®vÆid cou¡ = %d \n", ()
£g
->
£g_id
, 
	`©omic_ªad
(&£g->
vÆid_cou¡
));

757 
§c_cou¡
 = 0;

758 *
§cs
[
MAX_CACHE_DEVS
];

759 *
d°
 = 
NULL
;

760 
cur_ssd
 = 
	`curs‹_d©a_°¨t_ssd
(
su≥r
, 
£g
->
£g_id
, 
WCBUF
);

761 
u32
 
øm_off£t
;

763 
§c_cou¡
 = 0;§c_cou¡ < 
row_cou¡
-1; src_count++){

764 
øm_off£t
 = 
chunk_off£t
 + (
cur_ssd
 * 
CHUNK_SZ
);

765 
§cs
[
§c_cou¡
] = 
	`∑ge_addªss
(
ømbuf
->
∑ges
[
øm_off£t
]->
∂
->
∑ge
);

766 
cur_ssd
 = (cur_ssd + 1Ë% 
NUM_SSD
;

768 
øm_off£t
 = 
chunk_off£t
 + (
cur_ssd
 * 
CHUNK_SZ
);

769 
d°
 = 
	`∑ge_addªss
(
ømbuf
->
∑ges
[
øm_off£t
]->
∂
->
∑ge
);

772 
	`mem£t
(
d°
, 0xFF, 
SRC_PAGE_SIZE
);

773 
	`run_x‹
(
§cs
, 
d°
, 
§c_cou¡
, 
SRC_PAGE_SIZE
);

776 
	}
}

778 
	$make_bios_ve˘‹
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
ømbuf„r
 *
ømbuf
,

779 
©omic_t
 *
bios_°¨t
,átomic_à*
bios_cou¡
){

780 
u32
 
devno
;

782 
devno
 = 0;devnÿ< 
NUM_SSD
;devno++){

783 
u32
 
cou¡
 = 
	`©omic_ªad
(&
ømbuf
->
bios_cou¡
[
devno
])

784 - 
	`©omic_ªad
(&
ømbuf
->
bios_°¨t
[
devno
]);

787 
	`©omic_£t
(&
bios_cou¡
[
devno
], 
	`©omic_ªad
(&
ømbuf
->bios_count[devno]));

788 
	`©omic_£t
(&
bios_°¨t
[
devno
], 
	`©omic_ªad
(&
ømbuf
->bios_start[devno]));

790 
	`©omic_£t
(&
ømbuf
->
bios_°¨t
[
devno
], 
	`©omic_ªad
(&ømbuf->
bios_cou¡
[devno]));

791 
	`©omic_add
(
cou¡
, &
ømbuf
->
bios_tŸÆ_°¨t
);

793 
	}
}

795 
	$Êush_∑πül_mëa
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
)

797 
£gmít_hódî
 *
£g
;

798 
ømbuf„r
 *
ømbuf
;

799 
boﬁ
 
√ed_Êush
 = 
Ál£
;

800 
f
;

801 
u32
 
Àngth
;

802 
u32
 
£g_Àngth
;

803 
©omic_t
 
bios_°¨t
[
MAX_CACHE_DEVS
];

804 
©omic_t
 
bios_cou¡
[
MAX_CACHE_DEVS
];

805 
u64
 
globÆ_£g_£quí˚
;

807 
ªt
 = 0;

809 
	`LOCK
(
su≥r
, 
f
);

811 
£g
 = 
su≥r
->
cuºít_£g
[
ˇche_ty≥
];

813 
ømbuf
 = 
su≥r
->
£gbuf_mgr
.
cuºít_ømbuf
[
ˇche_ty≥
];

814 if(!
ømbuf
)

815 
No_Rambuf
;

826 
Àngth
 = 
	`©omic_ªad
(&
ømbuf
->
bios_tŸÆ_cou¡
Ë-átomic_ªad(&ømbuf->
bios_tŸÆ_°¨t
);

828 if(
Àngth
 || ((
	`©omic_ªad
(&
£g
->
∑π_Àngth
)) &&

829 
	`©omic_ªad
(&
£g
->
Àngth
)<
STRIPE_SZ
 &&

830 !
	`ã°_bô
(
SEG_SEALED
, &
£g
->
Êags
)))

835 
√ed_Êush
 = 
åue
;

836 
globÆ_£g_£quí˚
 = 
	`©omic64_öc_ªtu∫
(&
su≥r
->
Êush_mgr
.global_seg_sequence);

838 
ªt
 = 
	`Æloc_∑πül_summ¨y
(
su≥r
, 
£g
, 
ømbuf
, 
ˇche_ty≥
);

839 if(
ªt
 < 0)

840 
No_Rambuf
;

842 
	`make_bios_∑rôy
(
su≥r
, 
£g
, 
ømbuf
, 1);

848 
	`©omic_öc
(&
su≥r
->
w°©
.
∑πül_wrôe_cou¡
);

851 
	`make_bios_ve˘‹
(
su≥r
, 
£g
, 
ømbuf
, 
bios_°¨t
, 
bios_cou¡
);

852 
£g_Àngth
 = 
	`©omic_ªad
(&
£g
->
Àngth
);

854 
No_Rambuf
:

855 
	`UNLOCK
(
su≥r
, 
f
);

857 if(
ªt
<0){

858 
	`¥ötk
("áŒo¯∑πü»summ¨yÉº‹ = %d \n", 
ªt
);

859 
	`BUG_ON
(1);

862 if(
√ed_Êush
){

864 if(
su≥r
->
∑øm
.
bio_∂uggög
){

865 
	`make_Êush_övoke_job
(
su≥r
, 
£g
, 
ømbuf
, 
£g_Àngth
, 
bios_°¨t
, 
bios_cou¡
,

866 
ˇche_ty≥
, 0, 0, 1, 
globÆ_£g_£quí˚
);

868 
	`make_Êush_övoke_job
(
su≥r
, 
£g
, 
ømbuf
, 
£g_Àngth
, 
bios_°¨t
, 
bios_cou¡
,

869 
ˇche_ty≥
, 0, 1, 0, 
globÆ_£g_£quí˚
);

872 
≥ndög_m™agî
 *
≥ndög_mgr
 = &
su≥r
->pending_mgr;

873 
bio_li°
 
loˇl_li°
;

874 
	`bio_li°_öô
(&
loˇl_li°
);

875 
	`•ö_lock_úqßve
(&
≥ndög_mgr
->
b¨rõr_lock
, 
f
);

876 
	`bio_li°_mîge
(&
loˇl_li°
, &
≥ndög_mgr
->
b¨rõr_ios
);

877 
	`bio_li°_öô
(&
≥ndög_mgr
->
b¨rõr_ios
);

878 
	`©omic_£t
(&
≥ndög_mgr
->
b¨rõr_cou¡
, 0);

879 
	`•ö_u∆ock_úqª°‹e
(&
≥ndög_mgr
->
b¨rõr_lock
, 
f
);

881 
	`issue_de„ºed_bio
(
su≥r
, &
loˇl_li°
);

883 
	}
}

887 
ölöe
 
	$öc_num_dúty_blocks
(
dm§c_su≥r
 *
su≥r
)

889 
	`©omic64_öc
(&
su≥r
->
ˇche_°©
.
num_dúty_blocks
);

890 
	}
}

892 
ölöe
 
	$dec_num_dúty_blocks
(
dm§c_su≥r
 *
su≥r
)

894 
	`©omic64_dec
(&
su≥r
->
ˇche_°©
.
num_dúty_blocks
);

895 
	}
}

897 
	$˛ónup_mb_if_dúty
(
dm§c_su≥r
 *
su≥r
,

898 
£gmít_hódî
 *
£g
,

899 
mëablock
 *
mb
)

901 
Êags
;

902 
boﬁ
 
b
 = 
Ál£
;

904 
	`lock£g
(
£g
, 
Êags
);

905 i‡(
	`ã°_bô
(
MB_DIRTY
, &
mb
->
mb_Êags
)) {

907 
b
 = 
åue
;

910 if(
	`is_ªad_°rùe
(
£g
->
£g_ty≥
))

911 
b
 = 
åue
;

913 
	`u∆ock£g
(
£g
, 
Êags
);

915 i‡(
b
)

916 
	`dec_num_dúty_blocks
(
su≥r
);

917 
	}
}

919 
u8
 
	$©omic_ªad_mb_vÆid√ss
(
£gmít_hódî
 *
£g
, 
mëablock
 *
mb
)

921  
	`ã°_bô
(
MB_VALID
, &
mb
->
mb_Êags
);

922 
	}
}

924 
u8
 
	$©omic_ªad_mb_dútöess
(
£gmít_hódî
 *
£g
, 
mëablock
 *
mb
)

926  
	`ã°_bô
(
MB_DIRTY
, &
mb
->
mb_Êags
);

927 
	}
}

930 
ölöe
 
	$bio_ªm≠
(
bio
 *bio, 
dm_dev
 *
dev
, 
£˘‹_t
 
£˘‹
)

932 
bio
->
bi_bdev
 = 
dev
->
bdev
;

933 
bio
->
bi_£˘‹
 = 
£˘‹
;

934 
	}
}

936 
ölöe
 
£˘‹_t
 
	$ˇlc_ˇche_Æignmít
(
dm§c_su≥r
 *
su≥r
,

937 
£˘‹_t
 
bio_£˘‹
)

939  
	`div_u64
(
bio_£˘‹
, 
SRC_SECTORS_PER_PAGE
) * (SRC_SECTORS_PER_PAGE);

940 
	}
}

942 
	$övÆid©e_¥evious_ˇche
(
dm§c_su≥r
 *
su≥r
,

943 
£gmít_hódî
 *
£g
,

944 
mëablock
 *
ﬁd_mb
)

947 
	`˛ónup_mb_if_dúty
(
su≥r
, 
£g
, 
ﬁd_mb
);

949 
	`ht_dñ
(
su≥r
, 
ﬁd_mb
);

951 
	`©omic_dec
(&
£g
->
vÆid_cou¡
);

952 
	`©omic_dec
(&
£g
->
group
->
vÆid_cou¡
);

954 if(
	`ã°_bô
(
MB_DIRTY
, &
ﬁd_mb
->
mb_Êags
))

955 
	`©omic_dec
(&
£g
->
vÆid_dúty_cou¡
);

957 
	`©omic_dec
(&
£g
->
vÆid_˛ón_cou¡
);

959 
	`©omic_dec
(&
su≥r
->
ˇche_°©
.
num_u£d_blocks
);

960 
	`˛ór_bô
(
MB_VALID
, &
ﬁd_mb
->
mb_Êags
);

964 if(
	`ã°_bô
(
MB_HIT
, &
ﬁd_mb
->
mb_Êags
)){

965 
	`˛ór_bô
(
MB_HIT
, &
ﬁd_mb
->
mb_Êags
);

966 
	`©omic_dec
(&
£g
->
hŸ_cou¡
);

968 if(!
	`ã°_bô
(
MB_DIRTY
, &
ﬁd_mb
->
mb_Êags
))

969 
	`©omic_dec
(&
£g
->
hŸ_˛ón_cou¡
);

972 
	}
}

975 
ölöe
 
	$wake_ªad_ˇchög_w‹kî
(
dm§c_su≥r
 *
su≥r
){

976 
	`queue_w‹k
(
su≥r
->
ªad_miss_mgr
.
wq
, &su≥r->ªad_miss_mgr.
w‹k
);

977 
	}
}

979 
	$öô_ªad_ˇchög_job_li°
(
dm§c_su≥r
 *
su≥r
){

980 
ªad_ˇchög_job_li°
 *
li°
;

982 
li°
 = &
su≥r
->
ªad_miss_mgr
.
queue
;

983 
	`©omic_£t
(&
li°
->
rm_c›y_cou¡
, 0);

984 
	`•ö_lock_öô
(&
li°
->
rm_•ölock
);

985 
	`INIT_LIST_HEAD
(&
li°
->
rm_c›y_hód
);

986 
	}
}

989 
	$m¨k_∑rôy_dúty
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
,

990 
£gmít_hódî
 *
£g
, 
u32
 
idx
){

992 
mëablock
 *
mb
;

993 
∑rôy_°¨t
;

994 
∑rôy_off£t
;

995 
u32
 
∑rôy_idx
;

997 if(
	`is_ªad_°rùe
(
ˇche_ty≥
))

1000 if(
	`NO_USE_ERASURE_CODE
(&
su≥r
->
∑øm
))

1003 
∑rôy_°¨t
 = 
	`curs‹_∑rôy_°¨t
(
su≥r
, 
£g
->
£g_id
, 
ˇche_ty≥
);

1004 
∑rôy_off£t
 = 
idx
%(
CHUNK_SZ
);

1006 
∑rôy_idx
 = 
∑rôy_°¨t
 + 
∑rôy_off£t
;

1007 
mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
∑rôy_idx
);

1008 
	`£t_bô
(
MB_PARITY_NEED
, &
mb
->
mb_Êags
);

1009 
	`˛ór_bô
(
MB_VALID
, &
mb
->
mb_Êags
);

1010 
	`˛ór_bô
(
MB_DIRTY
, &
mb
->
mb_Êags
);

1013 if(
	`USE_ERASURE_RAID6
(&
su≥r
->
∑øm
)){

1014 
∑rôy_idx
 +
CHUNK_SZ
;

1015 
∑rôy_idx
 %
STRIPE_SZ
;

1016 
mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
∑rôy_idx
);

1017 
	`£t_bô
(
MB_PARITY_NEED
, &
mb
->
mb_Êags
);

1019 
	}
}

1021 
	$ª£t_∑rôy
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
ˇche_ty≥
, 
˛ór_wrôãn
){

1022 
Êags
;

1023 
∑rôy_size
;

1024 
∑rôy_°¨t
;

1025 
i
;

1027 if(
	`is_ªad_°rùe
(
ˇche_ty≥
))

1030 if(
	`NO_USE_ERASURE_CODE
(&
su≥r
->
∑øm
))

1033 
∑rôy_size
 = 
CHUNK_SZ
;

1034 
∑rôy_°¨t
 = 
	`curs‹_∑rôy_°¨t
(
su≥r
, 
£g
->
£g_id
, 
ˇche_ty≥
);

1036 
	`lock£g
(
£g
, 
Êags
);

1038 
i
 = 0;ò<
∑rôy_size
;i++){

1039 
u32
 
off£t
 = 
∑rôy_°¨t
 + 
i
;

1040 
mëablock
 *
mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
off£t
);

1042 
	`˛ór_bô
(
MB_PARITY_NEED
, &
mb
->
mb_Êags
);

1044 if(
˛ór_wrôãn
 && 
	`ã°_bô
(
MB_PARITY_WRITTEN
, &
mb
->
mb_Êags
)){

1045 
	`˛ór_bô
(
MB_PARITY_WRITTEN
, &
mb
->
mb_Êags
);

1049 if(
	`USE_ERASURE_RAID6
(&
su≥r
->
∑øm
)){

1050 
i
 = 0;ò<
∑rôy_size
;i++){

1051 
u32
 
off£t
 = (
∑rôy_°¨t
 + 
CHUNK_SZ
 + 
i
Ë% 
STRIPE_SZ
;

1052 
mëablock
 *
mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
off£t
);

1054 
	`˛ór_bô
(
MB_PARITY_NEED
, &
mb
->
mb_Êags
);

1056 if(
˛ór_wrôãn
 && 
	`ã°_bô
(
MB_PARITY_WRITTEN
, &
mb
->
mb_Êags
)){

1057 
	`˛ór_bô
(
MB_PARITY_WRITTEN
, &
mb
->
mb_Êags
);

1062 
	`u∆ock£g
(
£g
, 
Êags
);

1064 
	}
}

1072 
	$run_x‹
(**
∑ges
, *
de°
, 
§c_˙t
, 
ssize_t
 
Àn
)

1074 
§c_off
 = 0;

1075 
x‹_§c_˙t
 = 0;

1077 
§c_˙t
 > 0) {

1078 
x‹_§c_˙t
 = 
	`mö
(
§c_˙t
, 
MAX_XOR_BLOCKS
);

1079 
	`x‹_blocks
(
x‹_§c_˙t
, 
Àn
, 
de°
, 
∑ges
 + 
§c_off
);

1081 
§c_˙t
 -
x‹_§c_˙t
;

1082 
§c_off
 +
x‹_§c_˙t
;

1084 
	}
}

1087 
	$vîify_x‹
(
dm§c_su≥r
 *
su≥r
, 
ømbuf_∑ge
 **
∑ges
, 
i
, *
ãmp
){

1088 *
§cs
[
MAX_CACHE_DEVS
];

1089 *
d°
 = 
NULL
;

1090 
§c_cou¡
;

1091 
∑rôy_size
;

1092 
j
;

1094 
∑rôy_size
 = 
CHUNK_SZ
;

1096 
§c_cou¡
 = 0;

1097 
j
 = 0;j < 
NUM_SSD
;j++){

1098 if(
j
==0)

1099 
d°
 = 
∑ges
[
i
 + (
j
 * 
∑rôy_size
)]->
d©a
;

1101 
§cs
[
§c_cou¡
++] = 
∑ges
[
i
 + (
j
 * 
∑rôy_size
)]->
d©a
;

1104 
	`mem£t
(
ãmp
, 0xFF, 
PAGE_SIZE
);

1106 
	`run_x‹
(
§cs
, 
ãmp
, 
§c_cou¡
, 
PAGE_SIZE
);

1107 if(
	`memcmp
(
ãmp
, 
d°
, 
PAGE_SIZE
)){

1108 
	`¥ötk
(" %dÖarity mismatchÑecovered %u original %u\n",

1109 
i
,

1110 
	`¸c32_À
(17, 
ãmp
, 
PAGE_SIZE
),

1111 
	`¸c32_À
(17, 
d°
, 
PAGE_SIZE
)

1114 
	}
}

1118 
	$gíî©e_∑rôy_x‹
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
ømbuf_∑ge
 **
∑ges
, 
fuŒ_£g
, 
ˇche_ty≥
){

1119 
mëablock
 *
mb
;

1120 *
§cs
[
MAX_CACHE_DEVS
];

1122 
Êags
;

1123 *
ãmp
;

1124 *
d°
 = 
NULL
;

1126 
∑rôy_size
;

1127 
∑rôy_°¨t
;

1129 
i
, 
j
;

1131 
§c_cou¡
 = 0;

1132 
∑rôy_ssd
;

1134 
∑rôy_size
 = 
CHUNK_SZ
;

1135 
∑rôy_°¨t
 = 
	`curs‹_∑rôy_°¨t
(
su≥r
, 
£g
->
£g_id
, 
ˇche_ty≥
);

1136 
ãmp
 = (*)
	`gë_zî€d_∑ge
(
GFP_KERNEL
);

1140 
i
 = 0;ò<
∑rôy_size
;i++){

1141 
∑rôy_ssd
 = 
	`gë_∑rôy_ssd
(
su≥r
, 
£g
->
£g_id
);

1142 
§c_cou¡
 = 0;

1143 
d°
 = 
NULL
;

1145 
mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
∑rôy_°¨t
 + 
i
);

1147 
	`lock£g
(
£g
, 
Êags
);

1148 
	`˛ór_bô
(
MB_DIRTY
, &
mb
->
mb_Êags
);

1149 
	`˛ór_bô
(
MB_VALID
, &
mb
->
mb_Êags
);

1150 
	`£t_bô
(
MB_PARITY
, &
mb
->
mb_Êags
);

1153 if(
	`ã°_bô
(
MB_PARITY_NEED
, &
mb
->
mb_Êags
)){

1154 
	`£t_bô
(
MB_PARITY_WRITTEN
, &
mb
->
mb_Êags
);

1156 
	`u∆ock£g
(
£g
, 
Êags
);

1158 if(
	`ã°_bô
(
MB_PARITY_NEED
, &
mb
->
mb_Êags
)){

1159 
j
 = 0;j < 
NUM_SSD
;j++){

1160 if(
j
 !
∑rôy_ssd
){

1161 
§cs
[
§c_cou¡
++] = 
∑ges
[
i
 + (
j
 * 
∑rôy_size
)]->
d©a
;

1163 
d°
 = 
∑ges
[
i
 + (
j
 * 
∑rôy_size
)]->
d©a
;

1167 
	`mem£t
(
d°
, 0xFF, 
SRC_PAGE_SIZE
);

1168 
	`run_x‹
(
§cs
, 
d°
, 
§c_cou¡
, 
SRC_PAGE_SIZE
);

1170 
	`vîify_x‹
(
su≥r
, 
∑ges
, 
i
 
d°
);

1175 if(
fuŒ_£g
 && 
	`ã°_bô
(
MB_PARITY_WRITTEN
, &
mb
->
mb_Êags
)){

1176 
	`©omic_öc
(&
£g
->
vÆid_cou¡
);

1177 
	`©omic_öc
(&
£g
->
group
->
vÆid_cou¡
);

1178 
	`©omic_öc
(&
£g
->
dúty_cou¡
);

1179 
	`©omic_öc
(&
su≥r
->
ˇche_°©
.
num_u£d_blocks
);

1180 
cou¡
 ++;

1181 if(
	`©omic_ªad
(&
£g
->
vÆid_cou¡
Ë> 
STRIPE_SZ
){

1182 
	`¥ötk
(" segid = %d,Ö¨ôy x‹ d©®vÆid cou¡ = %d \n", ()
£g
->
£g_id
, 
	`©omic_ªad
(&£g->
vÆid_cou¡
));

1188 
	`‰ì_∑ge
(()
ãmp
);

1195 
	`BUG_ON
(
	`©omic_ªad
(&
£g
->
Àngth
)>
STRIPE_SZ
);

1196 
	}
}

1198 
	$gíî©e_∑rôy_pq
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
ømbuf_∑ge
 **
∑ges
, 
fuŒ_£g
, 
ˇche_ty≥
){

1199 
∑rôy_size
;

1200 
∑rôy_°¨t
;

1201 
Êags
;

1202 
cou¡
 = 0;

1203 
i
;

1205 
∑rôy_size
 = 
CHUNK_SZ
;

1206 
∑rôy_°¨t
 = 
	`curs‹_∑rôy_°¨t
(
su≥r
, 
£g
->
£g_id
, 
ˇche_ty≥
);

1208 
i
 = 0;ò<
∑rôy_size
;i++){

1209 
u32
 
∑rôy_idx
 = 
∑rôy_°¨t
 + 
i
;

1210 
mëablock
 *
mb
[2];

1211 *
§cs
[
MAX_CACHE_DEVS
];

1212 
§c_cou¡
 = 0;

1213 
∑rôy_ssd
 = 
	`gë_∑rôy_ssd
(
su≥r
, 
£g
->
£g_id
);

1214 
j
;

1216 
mb
[0] = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
∑rôy_idx
);

1217 
mb
[1] = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, (
∑rôy_idx
 + 
CHUNK_SZ
)%
STRIPE_SZ
);

1219 
	`lock£g
(
£g
, 
Êags
);

1220 
j
 =0;j < 2;j++){

1221 
	`˛ór_bô
(
MB_DIRTY
, &
mb
[
j
]->
mb_Êags
);

1222 
	`˛ór_bô
(
MB_VALID
, &
mb
[
j
]->
mb_Êags
);

1223 
	`£t_bô
(
MB_PARITY
, &
mb
[
j
]->
mb_Êags
);

1225 if(
	`ã°_bô
(
MB_PARITY_NEED
, &
mb
[
j
]->
mb_Êags
)){

1226 
	`£t_bô
(
MB_PARITY_WRITTEN
, &
mb
[
j
]->
mb_Êags
);

1229 
	`u∆ock£g
(
£g
, 
Êags
);

1231 if(
	`ã°_bô
(
MB_PARITY_NEED
, &
mb
[0]->
mb_Êags
)){

1232 
j
 = 0;j < 
NUM_SSD
;j++){

1233 
u32
 
off£t
 = 
i
 + (
j
 * 
∑rôy_size
);

1234 if(!
∑ges
[
off£t
]){

1235 
	`¥ötk
("Öage†i†nuŒ ... %d \n", 
off£t
);

1236 
	`BUG_ON
(1);

1239 if(
j
==
∑rôy_ssd
){

1240 
§cs
[
NUM_SSD
-2] = 
∑ges
[
off£t
]->
d©a
;

1241 
	`mem£t
(
§cs
[
NUM_SSD
-2], 0xEE, 
SRC_PAGE_SIZE
);

1242 }if(
j
==(
∑rôy_ssd
+1)%
NUM_SSD
){

1243 
§cs
[
NUM_SSD
-1] = 
∑ges
[
off£t
]->
d©a
;

1244 
	`mem£t
(
§cs
[
NUM_SSD
-1], 0xEE, 
SRC_PAGE_SIZE
);

1246 
§cs
[
§c_cou¡
++] = 
∑ges
[
off£t
]->
d©a
;

1250 
øid6_ˇŒ
.
	`gí_syndrome
(
NUM_SSD
, 
SRC_PAGE_SIZE
, 
§cs
);

1253 if(
fuŒ_£g
 && 
	`ã°_bô
(
MB_PARITY_WRITTEN
, &
mb
[0]->
mb_Êags
)){

1254 
j
 =0;j < 2;j++){

1255 
	`©omic_öc
(&
£g
->
Àngth
);

1256 
	`©omic_öc
(&
£g
->
∑π_Àngth
);

1257 
	`©omic_öc
(&
su≥r
->
ˇche_°©
.
num_u£d_blocks
);

1258 
cou¡
 ++;

1263 
	`BUG_ON
(
	`©omic_ªad
(&
£g
->
Àngth
)>
STRIPE_SZ
);

1268 
	}
}

1272 
	$gíî©e_∑rôy_d©a
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
,

1273 
ømbuf_∑ge
 **
∑ges
, 
fuŒ_£g
, 
ˇche_ty≥
){

1275 if(
	`is_ªad_°rùe
(
ˇche_ty≥
))

1278 if(
	`NO_USE_ERASURE_CODE
(&
su≥r
->
∑øm
))

1281 if(
	`USE_ERASURE_PARITY
(&
su≥r
->
∑øm
)){

1282 
	`gíî©e_∑rôy_x‹
(
su≥r
, 
£g
, 
∑ges
, 
fuŒ_£g
, 
ˇche_ty≥
);

1284 
	`gíî©e_∑rôy_pq
(
su≥r
, 
£g
, 
∑ges
, 
fuŒ_£g
, 
ˇche_ty≥
);

1286 
	}
}

1290 #i‡
SUMMARY_LOCATION
 =
USE_FIRST_SUMMARY


1291 
ölöe
 
u32
 
	$gë_summ¨y_off£t
(
dm§c_su≥r
 *
su≥r
, 
u32
 
ssd_id
){

1292  (
ssd_id
Ë* 
CHUNK_SZ
;

1293 
	}
}

1295 
ölöe
 
boﬁ
 
	$chunk_summ¨y_ønge
(
dm§c_su≥r
 *
su≥r
, 
u32
 
idx
){

1296 
u32
 
off£t
 = (
idx
Ë% 
CHUNK_SZ
;

1297 if(
off£t
 >0 && (off£tË< 
NUM_SUMMARY
){

1298  
åue
;

1300  
Ál£
;

1301 
	}
}

1303 
ölöe
 
boﬁ
 
	$√ed_chunk_summ¨y
(
dm§c_su≥r
 *
su≥r
, 
u32
 
idx
){

1304 
u32
 
off£t
 = (
idx
Ë% 
CHUNK_SZ
;

1305 if((
off£t
Ë=(
NUM_SUMMARY
)){

1306  
åue
;

1308  
Ál£
;

1309 
	}
}

1311 
ölöe
 
u32
 
	$d©a_to_summ¨y_idx
(
dm§c_su≥r
 *
su≥r
, 
u32
 
idx
){

1312  (
idx
%
STRIPE_SZ
)/
CHUNK_SZ
*CHUNK_SZ;

1313 
	}
}

1317 #i‡
SUMMARY_LOCATION
 =
USE_LAST_SUMMARY


1318 
ölöe
 
u32
 
	$gë_summ¨y_off£t
(
dm§c_su≥r
 *
su≥r
, 
u32
 
ssd_id
){

1319  (
ssd_id
 + 1Ë* 
CHUNK_SZ
 - 
NUM_SUMMARY
;

1320 
	}
}

1322 
ölöe
 
boﬁ
 
	$chunk_summ¨y_ønge
(
dm§c_su≥r
 *
su≥r
, 
u32
 
idx
){

1323 
u32
 
off£t
 = (
idx
Ë% 
CHUNK_SZ
;

1324 if((
off£t
+1Ë>
CHUNK_SZ
-(
NUM_SUMMARY
-1) && (offset+1) <= CHUNK_SZ){

1325  
åue
;

1327  
Ál£
;

1328 
	}
}

1330 
ölöe
 
boﬁ
 
	$√ed_chunk_summ¨y
(
dm§c_su≥r
 *
su≥r
, 
u32
 
idx
){

1331 
u32
 
off£t
 = (
idx
Ë% 
CHUNK_SZ
;

1332 if((
off£t
+1Ë=(
CHUNK_SZ
)){

1333  
åue
;

1335  
Ál£
;

1336 
	}
}

1337 
ölöe
 
u32
 
	$d©a_to_summ¨y_idx
(
dm§c_su≥r
 *
su≥r
, 
u32
 
idx
){

1338  (
idx
%
STRIPE_SZ
Ë- (idx%
CHUNK_SZ
Ë+ (CHUNK_SZ-
NUM_SUMMARY
);

1339 
	}
}

1344 
ölöe
 
	$gë_∑rôy_size
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
){

1346 if(
	`NO_USE_ERASURE_CODE
(&
su≥r
->
∑øm
))

1348 if(
	`USE_ERASURE_PARITY
(&
su≥r
->
∑øm
))

1349  
CHUNK_SZ
;

1351  
CHUNK_SZ
 * 2;

1352 
	}
}

1355 
ölöe
 
	$£t_max_Àngth
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
){

1356 
u32
 
thªshﬁd
;

1358 
£gmít_hódî
 *
£g
 = 
su≥r
->
cuºít_£g
[
ˇche_ty≥
];

1360 if(
SUMMARY_SCHEME
==
SUMMARY_PER_CHUNK
)

1361 
thªshﬁd
 = 
STRIPE_SZ
;

1363 
thªshﬁd
 = 
STRIPE_SZ
 - 
NUM_SUMMARY
;

1365 if(
	`is_ªad_°rùe
(
ˇche_ty≥
)){

1366 
	`©omic_£t
(&
£g
->
Àngth
, 
thªshﬁd
);

1367 
	`©omic_£t
(&
£g
->
∑π_Àngth
, 
thªshﬁd
);

1371 
	`©omic_£t
(&
£g
->
Àngth
, 
thªshﬁd
);

1372 
	`©omic_£t
(&
£g
->
∑π_Àngth
, 
thªshﬁd
);

1374 
	}
}

1376 
ölöe
 
	$£t_max_cou¡
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
){

1377 
u32
 
thªshﬁd
;

1380 if(
SUMMARY_SCHEME
==
SUMMARY_PER_CHUNK
)

1381 
thªshﬁd
 = 
STRIPE_SZ
;

1383 
thªshﬁd
 = 
STRIPE_SZ
-
NUM_SUMMARY
;

1385 if(
	`is_ªad_°rùe
(
ˇche_ty≥
)){

1386 
	`ma_£t_cou¡
(
su≥r
, 
ˇche_ty≥
, 
thªshﬁd
);

1388 
	`ma_£t_cou¡
(
su≥r
, 
ˇche_ty≥
, 
thªshﬁd
);

1391 
	}
}

1394 
ölöe
 
boﬁ
 
	$√ed_ª‰esh_£gmít
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
, 
cou¡
){

1395 
boﬁ
 
ª‰esh
 = 
Ál£
;

1396 
u32
 
thªshﬁd
 = 
STRIPE_SZ
;

1398 if(
	`is_ªad_°rùe
(
ˇche_ty≥
)){

1399 if(
cou¡
>=
thªshﬁd
)

1400 
ª‰esh
 = 
åue
;

1402 if(
cou¡
>=
thªshﬁd
)

1403 
ª‰esh
 = 
åue
;

1406  
ª‰esh
;

1407 
	}
}

1410 
ölöe
 
	$gë_°¨t_ssd
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
){

1411 
ssd
;

1412 if(
su≥r
->
∑øm
->
∑rôy_Æloˇti⁄
==
PARITY_ALLOC_FIXED
){

1413 
ssd
 = 0;

1415 
ssd
 = 
£g_id
 % 
NR_SSD
;

1418  
ssd
;

1419 
	}
}

1423 
ölöe
 
	$gë_∑rôy_ssd
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
){

1424 
£˘‹_t
 
£˘‹
;

1425 
∑rôy_ssd
;

1426 
ãmp
;

1428 if(
	`NO_USE_ERASURE_CODE
(&
su≥r
->
∑øm
))

1431 if(
su≥r
->
∑øm
.
∑rôy_Æloˇti⁄
==
PARITY_ALLOC_FIXED
)

1432 
£˘‹
 = (
£g_id
 * 
STRIPE_SZ
 - 
CHUNK_SZ
Ë<< 
SRC_SECTORS_PER_PAGE_SHIFT
;

1434 
£˘‹
 = (
£g_id
 * 
STRIPE_SZ
Ë<< 
SRC_SECTORS_PER_PAGE_SHIFT
;

1436 
	`øid5_ˇlc_£˘‹
(&
su≥r
->
øid_c⁄f
, 
£˘‹
, 0, &
ãmp
, &
∑rôy_ssd
, 
NULL
);

1438  
∑rôy_ssd
 % 
NUM_SSD
;

1439 
	}
}

1441 
ölöe
 
	$gë_∑rôyq_ssd
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
){

1442 
£˘‹_t
 
£˘‹
;

1443 
∑rôy_ssd
;

1444 
ãmp
;

1446 if(!
	`USE_ERASURE_RAID6
(&
su≥r
->
∑øm
))

1449 
£˘‹
 = (
£g_id
 * 
STRIPE_SZ
Ë<< 
SRC_SECTORS_PER_PAGE_SHIFT
;

1450 
	`øid5_ˇlc_£˘‹
(&
su≥r
->
øid_c⁄f
, 
£˘‹
, 0, &
ãmp
, 
NULL
, &
∑rôy_ssd
);

1452  
∑rôy_ssd
 % 
NUM_SSD
;

1453 
	}
}

1455 
ölöe
 
	$curs‹_∑rôy_°¨t
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
, 
ˇche_ty≥
){

1456 
∑rôy_ssd
 = 
	`gë_∑rôy_ssd
(
su≥r
, 
£g_id
);

1457  (
∑rôy_ssd
 * 
CHUNK_SZ
Ë% 
STRIPE_SZ
;

1458 
	}
}

1460 
ölöe
 
	$curs‹_d©a_°¨t_ssd
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
, 
ˇche_ty≥
){

1461 
∑rôy_ssd
 = 
	`gë_∑rôy_ssd
(
su≥r
, 
£g_id
);

1462  (
∑rôy_ssd
 + 1 ) % 
NUM_SSD
;

1463 
	}
}

1466 
ölöe
 
	$curs‹_summ¨y_off£t
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
, 
ˇche_ty≥
){

1467 
d©a_°¨t
 = 
	`curs‹_°¨t
(
su≥r
, 
£g_id
);

1469 if(
	`is_ªad_°rùe
(
ˇche_ty≥
Ë|| 
	`NO_USE_ERASURE_CODE
(&
su≥r
->
∑øm
)){

1470  (
d©a_°¨t
 + 
CHUNK_SZ
 * 
NUM_SSD
 - 
NUM_SUMMARY
Ë% 
STRIPE_SZ
;

1472  (
d©a_°¨t
 + 
CHUNK_SZ
 * 
NUM_DATA_SSD
 - 
NUM_SUMMARY
Ë% 
STRIPE_SZ
;

1474 
	}
}

1478 
ölöe
 
	$curs‹_öô
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
, 
ˇche_ty≥
){

1479 if(
su≥r
->
∑øm
->
d©a_Æloˇti⁄
==
DATA_ALLOC_VERT
){

1480  
	`curs‹_°¨t
(
su≥r
, 
£g_id
) - 1;

1483 if(
su≥r
->
∑øm
->
∑rôy_Æloˇti⁄
==
PARITY_ALLOC_FIXED
)

1484 
su≥r
->
cﬁ
[
ˇche_ty≥
] = 
NR_SSD
-1;

1486 
su≥r
->
cﬁ
[
ˇche_ty≥
] = ((
£g_id
%
NR_SSD
) + (NR_SSD-1)) % NR_SSD;

1488 
su≥r
->
row
[
ˇche_ty≥
] = -1;

1490  
	`curs‹_°¨t
(
su≥r
, 
£g_id
) - 1;

1492 
	}
}

1495 
	$_Æloc_mb_summ¨y
(
dm§c_su≥r
 *
su≥r
,
£gmít_hódî
 *
£g
, 
ˇche_ty≥
, 
u32
 
mb_idx
, 
fuŒ
, 
dummy
){

1496 
mëablock
 *
√w_mb
;

1497 
u32
 
tmp32
;

1499 
tmp32
 = 
mb_idx
%
STRIPE_SZ
;

1500 
√w_mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
tmp32
);

1501 
√w_mb
->
£˘‹
 = ~0;

1503 if(
	`ã°_bô
(
MB_VALID
, &
√w_mb
->
mb_Êags
))

1504 
	`¥ötk
(" summ¨y block i†d©®block ..Åy≥ = %d\n", 
£g
->
£g_ty≥
);

1506 
	`©omic_öc
(&
su≥r
->
ˇche_°©
.
num_u£d_blocks
);

1508 
	`˛ór_bô
(
MB_SEAL
, &
√w_mb
->
mb_Êags
);

1509 
	`˛ór_bô
(
MB_DIRTY
, &
√w_mb
->
mb_Êags
);

1510 
	`˛ór_bô
(
MB_VALID
, &
√w_mb
->
mb_Êags
);

1511 
	`˛ór_bô
(
MB_SKIP
, &
√w_mb
->
mb_Êags
);

1513 if(!
fuŒ
){

1514 
	`˛ór_bô
(
MB_SUMMARY
, &
√w_mb
->
mb_Êags
);

1515 if(
dummy
)

1516 
	`£t_bô
(
MB_DUMMY
, &
√w_mb
->
mb_Êags
);

1518 
	`˛ór_bô
(
MB_DUMMY
, &
√w_mb
->
mb_Êags
);

1519 
	`©omic_öc
(&
£g
->
dummy_cou¡
);

1523 if(
fuŒ
){

1524 
	`£t_bô
(
MB_SUMMARY
, &
√w_mb
->
mb_Êags
);

1525 
	`©omic_öc
(&
£g
->
vÆid_cou¡
);

1526 
	`©omic_öc
(&
£g
->
group
->
vÆid_cou¡
);

1529 
	`©omic_öc
(&
£g
->
dúty_cou¡
);

1530 
	`©omic_öc
(&
£g
->
Àngth
);

1531 
	`©omic_öc
(&
£g
->
∑π_Àngth
);

1532 
	`m¨k_∑rôy_dúty
(
su≥r
, 
ˇche_ty≥
, 
£g
, 
tmp32
);

1534 
	`BUG_ON
(
	`©omic_ªad
(&
£g
->
vÆid_cou¡
Ë> 
STRIPE_SZ
);

1535 
	`BUG_ON
(
	`©omic_ªad
(&
£g
->
Àngth
Ë> 
STRIPE_SZ
);

1536 
	}
}

1539 
	$_Æloc_mb_summ¨y
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
, 
u32
 
idx
){

1540 
£gmít_hódî
 *
£g
;

1541 
mëablock
 *
√w_mb
;

1542 
u32
 
upd©e_mb_idx
;

1543 
u32
 
tmp32
;

1545 
£g
 = 
su≥r
->
cuºít_£g
[
ˇche_ty≥
];

1547 
	`©omic_öc
(&
su≥r
->
cou¡
[
ˇche_ty≥
]);

1549 
upd©e_mb_idx
 = 
	`SEG_START_IDX
(
£g
Ë+ 
su≥r
->
curs‹
[
ˇche_ty≥
];

1550 
upd©e_mb_idx
 = 
idx
;

1552 
	`div_u64_ªm
(
upd©e_mb_idx
, 
NR_CACHES_INSEG
, &
tmp32
);

1553 
√w_mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
tmp32
);

1555 if(
	`ã°_bô
(
MB_VALID
, &
√w_mb
->
mb_Êags
))

1556 
	`¥ötk
(" block i†ÆªadyáŒoˇãdá†®d©®block ..Åy≥ = %d\n", 
£g
->
£g_ty≥
);

1559 
	`©omic_öc
(&
su≥r
->
ƒ_u£d_ˇches
);

1561 
	`˛ór_bô
(
MB_SEAL
, &
√w_mb
->
mb_Êags
);

1562 
	`˛ór_bô
(
MB_DIRTY
, &
√w_mb
->
mb_Êags
);

1563 
	`˛ór_bô
(
MB_VALID
, &
√w_mb
->
mb_Êags
);

1564 
	`£t_bô
(
MB_SUMMARY
, &
√w_mb
->
mb_Êags
);

1566 
	`©omic_öc
(&
£g
->
vÆid_cou¡
);

1567 
	`©omic_öc
(&
£g
->
Àngth
);

1568 
	`©omic_öc
(&
£g
->
∑π_Àngth
);

1570 
	`m¨k_∑rôy_dúty
(
su≥r
, 
ˇche_ty≥
, 
£g
, 
tmp32
);

1575 
	`BUG_ON
(
	`©omic_ªad
(&
£g
->
Àngth
Ë> 
NR_CACHES_INSEG
);

1577 
	}
}

1580 
	$öôülize_mb_summ¨y
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
,

1581 
ˇche_ty≥
, 
u32
 
idx
, 
fuŒ
)

1583 
i
;

1585 
i
 = 0;ò< 
NUM_SUMMARY
;i++){

1586 
	`_Æloc_mb_summ¨y
(
su≥r
, 
£g
, 
ˇche_ty≥
, 
idx
+
i
, 
fuŒ
, 0);

1588 
	}
}

1591 
	$Æloc_mb_summ¨y
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
,

1592 
ˇche_ty≥
, 
u32
 
idx
, u32 *
tŸÆ_cou¡
 ){

1593 
i
;

1595 
i
 = 0;ò< 
NUM_SUMMARY
;i++){

1596 
	`ma_Æloc
(
su≥r
, 
£g
, seg->
£g_id
, 
ˇche_ty≥
, (
idx
+
i
)/
CHUNK_SZ
, 
tŸÆ_cou¡
);

1598 
	}
}

1601 
	$Æloc_mb_summ¨y
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
,

1602 
ˇche_ty≥
, 
u32
 
idx
, u32 *
tŸÆ_cou¡
 )

1604 
i
;

1606 if(
su≥r
->
∑øm
->
d©a_Æloˇti⁄
==
DATA_ALLOC_VERT
){

1607 
i
 = 0;ò< 
NR_SUMMARY
;i++){

1608 
u32
 
Æloc_idx
 = 
	`ß_Æloc
(
su≥r
, 
£g
, seg->
£g_id
, 
ˇche_ty≥
, 
tŸÆ_cou¡
);

1609 
	`BUG_ON
(
idx
+
i
!=
Æloc_idx
%
STRIPE_SZ
);

1611 }if(
su≥r
->
∑øm
->
d©a_Æloˇti⁄
==
DATA_ALLOC_HORI
){

1612 
i
 = 0;ò< 
NR_SUMMARY
;i++){

1614 
u32
 
Æloc_idx
 = 
	`ß_Æloc
(
su≥r
, 
£g
, seg->
£g_id
, 
ˇche_ty≥
, 
tŸÆ_cou¡
);

1617 
	`©omic_öc
(&
su≥r
->
ß
[
ˇche_ty≥
].
cou¡
);

1618 if(
tŸÆ_cou¡
)

1619 *
tŸÆ_cou¡
 = 
	`©omic_ªad
(&
su≥r
->
ß
[
ˇche_ty≥
].
cou¡
);

1625 
i
 = 0;ò< 
NR_SUMMARY
;i++){

1627 
	`ma_Æloc
(
su≥r
, 
£g
, seg->
£g_id
, 
ˇche_ty≥
, (
idx
+
i
)/
CHUNK_SZ
, 
tŸÆ_cou¡
);

1631 
	}
}

1635 
	$Æloc_mb_summ¨y
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
,

1636 
ˇche_ty≥
, 
u32
 
idx
 )

1638 
i
;

1640 if(
su≥r
->
∑øm
->
d©a_Æloˇti⁄
==
DATA_ALLOC_VERT
){

1641 
i
 = 0;ò< 
NR_SUMMARY
;i++){

1642 
	`curs‹_öc
(
su≥r
, 
£g
->
£g_id
, 
ˇche_ty≥
);

1643 
	`_Æloc_mb_summ¨y
(
su≥r
, 
ˇche_ty≥
, 
idx
+
i
);

1646 
i
 = 0;ò< 
NR_SUMMARY
;i++){

1649 
	`_Æloc_mb_summ¨y
(
su≥r
, 
ˇche_ty≥
, 
idx
+
i
);

1652 
	}
}

1655 
	$£g_Àngth_öc
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
mëablock
 *
mb
, 
boﬁ
 
öÊight
){

1657 
	`©omic_öc
(&
£g
->
vÆid_cou¡
);

1658 
	`©omic_öc
(&
£g
->
group
->
vÆid_cou¡
);

1660 if(
	`ã°_bô
(
MB_DIRTY
, &
mb
->
mb_Êags
)){

1661 
	`©omic_öc
(&
£g
->
dúty_cou¡
);

1662 
	`©omic_öc
(&
£g
->
vÆid_dúty_cou¡
);

1664 
	`©omic_öc
(&
£g
->
vÆid_˛ón_cou¡
);

1668 if(
öÊight
){

1669 
	`©omic_öc
(&
£g
->
Àngth
);

1670 
	`©omic_öc
(&
£g
->
∑π_Àngth
);

1671 
	`©omic_öc
(&
£g
->
num_fûlög
);

1672 
	`©omic_öc
(&
£g
->
num_bufc›y
);

1674 
	`BUG_ON
(
	`©omic_ªad
(&
£g
->
vÆid_cou¡
Ë> 
STRIPE_SZ
);

1675 
	`BUG_ON
(
	`©omic_ªad
(&
£g
->
Àngth
Ë> 
STRIPE_SZ
);

1676 
	}
}

1678 
	$öôülize_mb
(
dm§c_su≥r
 *
su≥r
, 
mëablock
 *
√w_mb
, 
ˇche_ty≥
, 
boﬁ
 
˛ón
){

1680 
	`˛ór_bô
(
MB_SEAL
, &
√w_mb
->
mb_Êags
);

1681 
	`£t_bô
(
MB_VALID
, &
√w_mb
->
mb_Êags
);

1682 
	`˛ór_bô
(
MB_PARITY
, &
√w_mb
->
mb_Êags
);

1683 
	`˛ór_bô
(
MB_SUMMARY
, &
√w_mb
->
mb_Êags
);

1684 
	`˛ór_bô
(
MB_HIT
, &
√w_mb
->
mb_Êags
);

1685 
	`˛ór_bô
(
MB_SKIP
, &
√w_mb
->
mb_Êags
);

1686 
	`˛ór_bô
(
MB_DUMMY
, &
√w_mb
->
mb_Êags
);

1688 if(
	`is_ªad_°rùe
(
ˇche_ty≥
)){

1689 
	`˛ór_bô
(
MB_DIRTY
, &
√w_mb
->
mb_Êags
);

1691 
	`£t_bô
(
MB_DIRTY
, &
√w_mb
->
mb_Êags
);

1694 if(
˛ón
){

1695 
	`˛ór_bô
(
MB_DIRTY
, &
√w_mb
->
mb_Êags
);

1697 
	}
}

1699 
u32
 
	$Æloc_√xt_mb
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
£˘‹_t
 
key
,

1700 
ˇche_ty≥
, 
u32
 *
tŸÆ_cou¡
){

1701 
s32
 
devno
;

1702 
u32
 
mb_idx
;

1704 
devno
 = 
	`ma_£À˘_dev
(
su≥r
, 
key
, 
ˇche_ty≥
);

1705 
	`BUG_ON
(!
£g
);

1706 
mb_idx
 = 
	`ma_Æloc
(
su≥r
, 
£g
, seg->
£g_id
, 
ˇche_ty≥
, 
devno
, 
tŸÆ_cou¡
);

1707  
mb_idx
;

1708 
	}
}

1710 
mëablock
 *
	$Æloc_mb_d©a
(
dm§c_su≥r
 *
su≥r
,

1711 
£˘‹_t
 
key
,

1712 
ˇche_ty≥
,

1713 
boﬁ
 
˛ón
,

1714 
u32
 *
tŸÆ_cou¡
)

1716 
£gmít_hódî
 *
£g
;

1717 
mëablock
 *
√w_mb
;

1718 
u32
 
upd©e_mb_idx
;

1720 
£g
 = 
su≥r
->
cuºít_£g
[
ˇche_ty≥
];

1721 
upd©e_mb_idx
 = 
	`Æloc_√xt_mb
(
su≥r
, 
£g
, 
key
, 
ˇche_ty≥
, 
tŸÆ_cou¡
);

1722 
√w_mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
upd©e_mb_idx
%
STRIPE_SZ
);

1724 
	`©omic_öc
(&
su≥r
->
ˇche_°©
.
num_u£d_blocks
);

1726 if(
	`is_n‹mÆ_°rùe
(
ˇche_ty≥
)){

1727 
	`ht_ªgi°î
(
su≥r
, 
key
, 
√w_mb
);

1730 
	`öôülize_mb
(
su≥r
, 
√w_mb
, 
ˇche_ty≥
, 
˛ón
);

1731 
	`£g_Àngth_öc
(
su≥r
, 
£g
, 
√w_mb
, 
åue
);

1733 
	`m¨k_∑rôy_dúty
(
su≥r
, 
£g
->
£g_ty≥
, seg, 
√w_mb
->
idx
%
STRIPE_SZ
);

1735  
√w_mb
;

1736 
	}
}

1738 
	$upd©e_d©a_ö_mb
(
dm§c_su≥r
 *
su≥r
,

1739 
u32
 
upd©e_mb_idx
,

1740 
£gmít_hódî
 *
£g
,

1741 
ømbuf„r
 *
ømbuf
,

1742 
ˇche_ty≥
,

1743 *
d©a
,

1744 
u32
 
¸c32
)

1746 
mëablock
 *
mb
;

1747 
u32
 
tmp32
;

1749 
	`div_u64_ªm
(
upd©e_mb_idx
, 
STRIPE_SZ
, &
tmp32
);

1750 
mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
tmp32
);;

1752 
	`öc_num_dúty_blocks
(
su≥r
);

1754 if(
ømbuf
 && 
d©a
 && 
	`is_wrôe_°rùe
(
ˇche_ty≥
) &&

1755 
	`USE_ERASURE_CODE
(&
su≥r
->
∑øm
)){

1757 if(
ømbuf
->
∑ges
[
tmp32
]){

1758 
	`BUG_ON
(!
ømbuf
->
∑ges
[
tmp32
]);

1759 
	`mem˝y
(
ømbuf
->
∑ges
[
tmp32
]->
d©a
, d©a, 
SRC_PAGE_SIZE
);

1762 *
±r
;

1763 
±r
 = 
	`∑ge_addªss
(
ømbuf
->
∑ges
[
tmp32
]->
∂
->
∑ge
);

1764 
	`mem˝y
(
±r
, 
d©a
, 
SRC_PAGE_SIZE
);

1769 #ifde‡
USE_CHECKSUM


1772 
mb
->
checksum
 = 
¸c32
;

1775 if(
	`©omic_dec_ªtu∫
(&
£g
->
num_bufc›y
)<0){

1776 
	`¥ötk
(" invalidÇum bufcopy ... \n");

1777 
	`BUG_ON
(1);

1779 
	}
}

1781 
	$wrôeback_ídio_exã¡
(
îr‹
, *
c⁄ãxt
)

1783 
wb_job
 *
job
 = 
c⁄ãxt
;

1784 
dm§c_su≥r
 *
su≥r
 = 
job
->super;

1785 
£gmít_hódî
 *
£g
 = 
job
->seg;

1786 
ømbuf„r
 *
ømbuf
 = 
job
->rambuf;

1787 
u32
 
idx
;

1789 if(
îr‹
){

1790 
	`¥ötk
(" Writeback:Énd ioÉrror \n");

1796 
idx
 = 
job
->
°¨t_idx
;idx < job->°¨t_idx + job->
cou¡
;idx++){

1797 
bio
 *biÿ
ømbuf
->
bios
[
idx
 % 
STRIPE_SZ
];

1798 
mëablock
 *
mb
 = 
	`mb_©
(
su≥r
, 
idx
);

1800 if(
bio
){

1801 
	`©omic_dec
(&
su≥r
->
ˇche_°©
.
öÊight_bios
);

1802 
	`bio_ídio
(
bio
, 0);

1805 if(
job
->
ømbuf
 && 
	`©omic_ªad
(&job->
ømbuf_ªÀa£
)){

1807 if(
	`©omic_dec_™d_ã°
(&
job
->
ømbuf
->
ªf_cou¡
)){

1809 
	`ªÀa£_ømbuf„r
(
su≥r
, 
job
->
ømbuf
, 
£g
->
£g_ty≥
);

1811 if(
	`©omic_ªad
(&
job
->
ømbuf
->
ªf_cou¡
)<0){

1812 
	`¥ötk
(" Invalid!!ÖarityÉnd ioÑamÑefcount = %d, id = %d \n",

1813 
	`©omic_ªad
(&
job
->
ømbuf
->
ªf_cou¡
),

1814 
job
->
ømbuf
->
ømbuf_id
);

1817 
	`£t_bô
(
MB_SEAL
, &
mb
->
mb_Êags
);

1821 
	`mempoﬁ_‰ì
(
job
, 
su≥r
->
≥ndög_mgr
.
wb_job_poﬁ
);

1824 
	}
}

1827 
	$wrôeback_ídio
(
îr‹
, *
c⁄ãxt
)

1829 
wb_job
 *
job
 = 
c⁄ãxt
;

1830 
dm§c_su≥r
 *
su≥r
 = 
job
->super;

1831 
£gmít_hódî
 *
£g
 = 
job
->seg;

1832 
mëablock
 *
mb
 = 
job
->mb;

1833 
bio
 *biÿ
job
->bio;

1835 if(
îr‹
){

1836 
	`¥ötk
(" Writeback:Énd ioÉrror \n");

1839 if(
job
->
bio
){

1840 
	`©omic_dec
(&
su≥r
->
ˇche_°©
.
öÊight_bios
);

1841 
	`bio_ídio
(
bio
, 0);

1842 
job
->
bio
 = 
NULL
;

1845 if(
job
->
ømbuf
 && 
	`©omic_ªad
(&job->
ømbuf_ªÀa£
)){

1847 if(
	`©omic_dec_™d_ã°
(&
job
->
ømbuf
->
ªf_cou¡
)){

1849 
	`ªÀa£_ømbuf„r
(
su≥r
, 
job
->
ømbuf
, 
£g
->
£g_ty≥
);

1851 if(
	`©omic_ªad
(&
job
->
ømbuf
->
ªf_cou¡
)<0){

1852 
	`¥ötk
(" Invalid!!ÖarityÉnd ioÑamÑefcount = %d, id = %d \n",

1853 
	`©omic_ªad
(&
job
->
ømbuf
->
ªf_cou¡
),

1854 
job
->
ømbuf
->
ømbuf_id
);

1858 
	`£t_bô
(
MB_SEAL
, &
mb
->
mb_Êags
);

1859 
	`mempoﬁ_‰ì
(
job
, 
su≥r
->
≥ndög_mgr
.
wb_job_poﬁ
);

1862 
	}
}

1865 
ölöe
 
dm_dev
 *
	$gë_dmdev
(
dm§c_su≥r
 *
su≥r
, 
u32
 
idx
){

1866 
dev_no
;

1867 
dev_no
 = 
idx
 / 
CHUNK_SZ
 % 
NUM_SSD
;

1868  
su≥r
->
dev_öfo
.
ˇche_dev
[
dev_no
];

1869 
	}
}

1871 
ölöe
 
	$gë_devno
(
dm§c_su≥r
 *
su≥r
, 
u32
 
idx
){

1872  
idx
 / 
CHUNK_SZ
 % 
NUM_SSD
;

1873 
	}
}

1875 
ölöe
 
block_devi˚
 *
	$gë_bdev
(
dm§c_su≥r
 *
su≥r
, 
u32
 
idx
){

1876 
dev_no
;

1877 
dev_no
 = 
idx
 / 
CHUNK_SZ
 % 
NUM_SSD
;

1878  
su≥r
->
dev_öfo
.
ˇche_dev
[
dev_no
]->
bdev
;

1879 
	}
}

1882 
ölöe
 
£˘‹_t
 
	$gë_£˘‹
(
dm§c_su≥r
 *
su≥r
, 
u32
 
£g_id
, u32 
idx
){

1883 
u32
 
ba£
;

1884 
u32
 
off£t
;

1886 
ba£
 = 
£g_id
 * 
CHUNK_SZ
;

1887 
off£t
 = 
idx
 % 
CHUNK_SZ
;

1889 
	`BUG_ON
((
ba£
+
off£t
)*
SRC_SECTORS_PER_PAGE
>=
su≥r
->
dev_öfo
.
≥r_ssd_£˘‹s
);

1890  (
RESERVED_START
+
RESERVED_LENGTH
) +

1891 (
ba£
 + 
off£t
Ë* 
SRC_SECTORS_PER_PAGE
;

1892 
	}
}

1894 
wb_job
 *
	$wrôeback_make_job_exã¡
(
dm§c_su≥r
 *
su≥r
,

1895 
£gmít_hódî
 *
£g
,

1896 
ømbuf„r
 *
ømbuf
,

1897 
u32
 
°¨t_idx
,

1898 
u32
 
cou¡
)

1900 
wb_job
 *
job
;

1902 
job
 = 
	`mempoﬁ_Æloc
(
su≥r
->
≥ndög_mgr
.
wb_job_poﬁ
, 
GFP_NOIO
);

1903 if(!
job
){

1904 
	`¥ötk
(" mempoolÉrror \n");

1905 
	`BUG_ON
(1);

1908 
job
->
su≥r
 = super;

1909 
job
->
£g
 = seg;

1910 
job
->
ømbuf
 =Ñambuf;

1911 
job
->
°¨t_idx
 = start_idx;

1912 
job
->
cou¡
 = count;

1913 
	`©omic_£t
(&
job
->
ømbuf_ªÀa£
, 1);

1915  
job
;

1916 
	}
}

1918 
	$wrôeback_issue_job_exã¡
(
dm§c_su≥r
 *
su≥r
, 
wb_job
 *
job
, 
Êush_comm™d
)

1920 
dm_io_ªgi⁄
 
io
;

1921 
dm_io_ªque°
 
io_ªq
;

1922 
ømbuf„r
 *
ømbuf
 = 
job
->rambuf;

1923 
£gmít_hódî
 *
£g
 = 
job
->seg;

1924 
u32
 
°¨t_idx
 = 
job
->start_idx;

1925 
u32
 
ømbuf_idx
 = 
job
->
°¨t_idx
 % 
STRIPE_SZ
;

1926 
u32
 
cur_idx
;

1927 
∑ge_li°
 *
∂s
;

1928 
u32
 
cou¡
 = 0;

1930 
∂s
 = 
NULL
;

1931 
cur_idx
 = 
ømbuf_idx
 + 
job
->
cou¡
 - 1;cur_idx >ømbuf_idx && cur_idx < 
STRIPE_SZ
;cur_idx--){

1932 
∑ge_li°
 *
∂
;

1933 
∂
 = 
ømbuf
->
∑ges
[
cur_idx
]->pl;

1934 
	`BUG_ON
(!
∂
);

1935 
∂
->
√xt
 = 
∂s
;

1936 
∂s
 = 
∂
;

1937 
cou¡
++;

1940 if(
cou¡
==0 || cou¡ > 
CHUNK_SZ
){

1941 
	`BUG_ON
(
cou¡
==0);

1944 
io_ªq
.
mem
.
off£t
 = 0;

1945 
io_ªq
.
mem
.
ty≥
 = 
DM_IO_PAGE_LIST
;

1946 
io_ªq
.
mem
.
±r
.
∂
 = 
∂s
;

1948 if(
Êush_comm™d
){

1949 
io_ªq
.
bi_rw
 = 
WRITE_FLUSH
;

1952 
io_ªq
.
bi_rw
 = 
WRITE_SYNC
;

1956 
io_ªq
.
nŸify
.
‚
 = 
wrôeback_ídio_exã¡
;

1957 
io_ªq
.
nŸify
.
c⁄ãxt
 = 
job
;

1958 
io_ªq
.
˛õ¡
 = 
su≥r
->
io_˛õ¡
;

1960 
io
.
bdev
 = 
	`gë_bdev
(
su≥r
, 
°¨t_idx
);

1961 
io
.
£˘‹
 = 
	`gë_£˘‹
(
su≥r
, 
£g
->
£g_id
, 
°¨t_idx
);

1962 
io
.
cou¡
 = 
SRC_SECTORS_PER_PAGE
 * 
job
->count;

1964 
	`dm§c_io
(&
io_ªq
, 1, &
io
, 
NULL
);

1965 
	}
}

1968 
wb_job
 *
	$wrôeback_make_job
(
dm§c_su≥r
 *
su≥r
,

1969 
£gmít_hódî
 *
£g
,

1970 
u32
 
idx
,

1971 
bio
 *bio,

1972 
ømbuf„r
 *
ømbuf
,

1973 
ømbuf_ªÀa£
)

1975 
wb_job
 *
job
;

1976 
u32
 
ømbuf_idx
 = 
idx
 % 
STRIPE_SZ
;

1978 
job
 = 
	`mempoﬁ_Æloc
(
su≥r
->
≥ndög_mgr
.
wb_job_poﬁ
, 
GFP_NOIO
);

1979 if(!
job
){

1980 
	`¥ötk
(" mempoolÉrror \n");

1981 
	`BUG_ON
(1);

1984 
job
->
su≥r
 = super;

1985 
job
->
£g
 = seg;

1986 
job
->
mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
ømbuf_idx
);

1987 
job
->
bio
 = bio;

1988 
job
->
ømbuf
 =Ñambuf;

1989 
	`©omic_£t
(&
job
->
ømbuf_ªÀa£
,Ñambuf_release);

1991  
job
;

1992 
	}
}

1994 
	$wrôeback_issue_job
(
dm§c_su≥r
 *
su≥r
, 
wb_job
 *
job
)

1996 
u32
 
idx
 = 
job
->
mb
->idx;

1997 
u32
 
ømbuf_idx
 = 
job
->
mb
->
idx
 % 
STRIPE_SZ
;

1998 
dm_io_ªgi⁄
 
io
;

1999 
dm_io_ªque°
 
io_ªq
;

2000 
bio
 *biÿ
job
->bio;

2001 
ømbuf„r
 *
ømbuf
 = 
job
->rambuf;

2002 
£gmít_hódî
 *
£g
 = 
job
->seg;

2005 if(
job
->
bio
){

2006 
io_ªq
.
mem
.
ty≥
 = 
DM_IO_BVEC
;

2007 
io_ªq
.
mem
.
±r
.
bvec
 = 
bio
->
bi_io_vec
 + bio->
bi_idx
;

2009 
io_ªq
.
mem
.
ty≥
 = 
DM_IO_KMEM
;

2010 if(
ømbuf
->
∑ges
[
ømbuf_idx
]==
NULL
){

2011 
	`¥ötk
(" invÆidÑambu‡idx %d \n", 
ømbuf_idx
);

2012 
	`BUG_ON
(1);

2014 
io_ªq
.
mem
.
±r
.
addr
 = 
ømbuf
->
∑ges
[
ømbuf_idx
]->
d©a
;

2017 
io_ªq
.
mem
.
ty≥
 = 
DM_IO_KMEM
;

2018 if(
ømbuf
->
∑ges
[
ømbuf_idx
]==
NULL
){

2019 
	`¥ötk
(" invÆidÑambu‡idx %d \n", 
ømbuf_idx
);

2020 
	`BUG_ON
(1);

2022 
io_ªq
.
mem
.
±r
.
addr
 = 
ømbuf
->
∑ges
[
ømbuf_idx
]->
d©a
;

2025 
io_ªq
.
bi_rw
 = 
WRITE
;

2027 
io_ªq
.
nŸify
.
‚
 = 
wrôeback_ídio
;

2028 
io_ªq
.
nŸify
.
c⁄ãxt
 = 
job
;

2029 
io_ªq
.
˛õ¡
 = 
su≥r
->
io_˛õ¡
;

2031 
io
.
bdev
 = 
	`gë_bdev
(
su≥r
, 
idx
);

2032 
io
.
£˘‹
 = 
	`gë_£˘‹
(
su≥r
, 
£g
->
£g_id
, 
idx
);

2033 if(
bio
)

2034 
io
.
cou¡
 = 
	`bio_£˘‹s
(
bio
);

2036 
io
.
cou¡
 = 
SRC_SECTORS_PER_PAGE
;

2038 
	`dm§c_io
(&
io_ªq
, 1, &
io
, 
NULL
);

2039 
	}
}

2044 
	$wrôe_async_bio
(
dm§c_su≥r
 *
su≥r
,

2045 
£gmít_hódî
 *
£g
,

2046 
u32
 
idx
,

2047 
bio
 *bio,

2048 
ømbuf„r
 *
ømbuf
,

2049 
ømbuf_ªÀa£
)

2051 
u32
 
ømbuf_idx
 = 
idx
 % 
STRIPE_SZ
;

2052 
dm_io_ªgi⁄
 
io
;

2053 
dm_io_ªque°
 
io_ªq
;

2054 
wb_job
 *
job
;

2056 
job
 = 
	`mempoﬁ_Æloc
(
su≥r
->
≥ndög_mgr
.
wb_job_poﬁ
, 
GFP_NOIO
);

2057 if(!
job
){

2058 
	`¥ötk
(" mempoolÉrror \n");

2059 
	`BUG_ON
(1);

2062 
job
->
su≥r
 = super;

2063 
job
->
£g
 = seg;

2064 
job
->
mb
 = 
	`gë_mb
(
su≥r
, 
£g
->
£g_id
, 
ømbuf_idx
);

2066 if(
bio
){

2067 
job
->
bio
 = bio;

2068 
job
->
ømbuf
 =Ñambuf;

2069 
	`©omic_£t
(&
job
->
ømbuf_ªÀa£
,Ñambuf_release);

2070 
io_ªq
.
mem
.
ty≥
 = 
DM_IO_BVEC
;

2071 
io_ªq
.
mem
.
±r
.
bvec
 = 
bio
->
bi_io_vec
 + bio->
bi_idx
;

2073 
job
->
bio
 = 
NULL
;

2074 
job
->
ømbuf
 =Ñambuf;

2075 
	`©omic_£t
(&
job
->
ømbuf_ªÀa£
,Ñambuf_release);

2077 
io_ªq
.
mem
.
ty≥
 = 
DM_IO_KMEM
;

2079 if(
ømbuf
->
∑ges
[
ømbuf_idx
]==
NULL
){

2080 
	`¥ötk
(" invÆidÑambu‡idx %d \n", 
ømbuf_idx
);

2081 
	`BUG_ON
(1);

2083 
io_ªq
.
mem
.
±r
.
addr
 = 
ømbuf
->
∑ges
[
ømbuf_idx
]->
d©a
;

2086 
io_ªq
.
bi_rw
 = 
WRITE
;

2087 
io_ªq
.
nŸify
.
‚
 = 
wrôeback_ídio
;

2088 
io_ªq
.
nŸify
.
c⁄ãxt
 = 
job
;

2089 
io_ªq
.
˛õ¡
 = 
su≥r
->
io_˛õ¡
;

2091 
io
.
bdev
 = 
	`gë_bdev
(
su≥r
, 
idx
);

2092 
io
.
£˘‹
 = 
	`gë_£˘‹
(
su≥r
, 
£g
->
£g_id
, 
idx
);

2093 if(
bio
)

2094 
io
.
cou¡
 = 
	`bio_£˘‹s
(
bio
);

2096 
io
.
cou¡
 = 
SRC_SECTORS_PER_PAGE
;

2098 
	`dm§c_io
(&
io_ªq
, 1, &
io
, 
NULL
);

2099 
	}
}

2102 
	$make_Êush_övoke_job
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
,

2103 
ømbuf„r
 *
ømbuf
, 
£g_Àngth
,

2104 
©omic_t
 *
bios_°¨t
,átomic_à*
bios_cou¡
,

2105 
ˇche_ty≥
, 
f‹˚_£Æ
, 
summ¨y
, 
Êush_d©a
, 
u64
 
globÆ_£g_£quí˚
){

2106 
Êush_m™agî
 *
Êush_mgr
 = &
su≥r
->flush_mgr;

2107 
Êush_övoke_job
 *
job
, *
¥ev_job
;

2108 
Êags
;

2109 
boﬁ
 
found
 = 0;

2110 
u32
 
devno
;

2112 
job
 = 
	`mempoﬁ_Æloc
(
Êush_mgr
->
övoke_poﬁ
, 
GFP_NOIO
);

2114 
	`bio_li°_öô
(&
job
->
b¨rõr_ios
);

2115 if(
	`is_n‹mÆ_°rùe
(
ˇche_ty≥
)){

2116 
f
;

2117 
	`•ö_lock_úqßve
(&
su≥r
->
≥ndög_mgr
.
b¨rõr_lock
, 
f
);

2122 
	`bio_li°_mîge
(&
job
->
b¨rõr_ios
, &
su≥r
->
≥ndög_mgr
.barrier_ios);

2123 
	`bio_li°_öô
(&
su≥r
->
≥ndög_mgr
.
b¨rõr_ios
);

2124 
	`©omic_£t
(&
su≥r
->
≥ndög_mgr
.
b¨rõr_cou¡
, 0);

2125 
	`•ö_u∆ock_úqª°‹e
(&
su≥r
->
≥ndög_mgr
.
b¨rõr_lock
, 
f
);

2128 
job
->
ˇche_ty≥
 = cache_type;

2129 
job
->
£g
 = seg;

2130 
job
->
ømbuf
 =Ñambuf;

2131 
job
->
f‹˚_£Æ
 = force_seal;

2132 
job
->
buûd_summ¨y
 = 
summ¨y
;

2133 
job
->
Êush_d©a
 = flush_data;

2134 
job
->
£g_Àngth
 =seg_length;

2135 
job
->
globÆ_£g_£quí˚
 = global_seg_sequence;

2137 
devno
 = 0;devnÿ< 
NUM_SSD
;devno++){

2138 
	`©omic_£t
(&
job
->
bios_°¨t
[
devno
], 
	`©omic_ªad
(&bios_start[devno]));

2139 
	`©omic_£t
(&
job
->
bios_cou¡
[
devno
], 
	`©omic_ªad
(&bios_count[devno]));

2145 
	`•ö_lock_úqßve
(&
Êush_mgr
->
lock
, 
Êags
);

2146 
	`li°_f‹_óch_íåy_ªvî£
(
¥ev_job
, &
Êush_mgr
->
queue
, 
li°
){

2147 if(
¥ev_job
->
globÆ_£g_£quí˚
 < global_seg_sequence){

2150 
found
 = 
åue
;

2157 if(!
found
){

2158 
	`li°_add_èû
(&
job
->
li°
, &
Êush_mgr
->
queue
);

2160 
	`li°_add
(&
job
->
li°
, &
¥ev_job
->list);

2164 
	`©omic_öc
(&
Êush_mgr
->
övoke_cou¡
);

2165 
	`•ö_u∆ock_úqª°‹e
(&
Êush_mgr
->
lock
, 
Êags
);

2167 
	`wake_up_¥o˚ss
(
Êush_mgr
->
d´m⁄
);

2168 
	}
}

2171 
	$bio_∂uggög
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
ømbuf„r
 *
ømbuf
,

2172 
bio
 *bio, 
u32
 
upd©e_mb_idx
){

2173 
devno
 = 
	`gë_devno
(
su≥r
, 
upd©e_mb_idx
);

2174 
Êags
, 
f
;

2176 
	`•ö_lock_úqßve
(&
su≥r
->
£gbuf_mgr
.
lock
, 
Êags
);

2177 
	`•ö_lock_úqßve
(&
ømbuf
->
lock
, 
f
);

2178 
ømbuf
->
bios
[
upd©e_mb_idx
%
STRIPE_SZ
] = 
bio
;

2179 
	`BUG_ON
(
	`©omic_öc_ªtu∫
(&
ømbuf
->
bios_cou¡
[
devno
])>
CHUNK_SZ
);

2180 
	`BUG_ON
(
	`©omic_öc_ªtu∫
(&
ømbuf
->
bios_tŸÆ_cou¡
)>
STRIPE_SZ
);

2182 
	`•ö_u∆ock_úqª°‹e
(&
ømbuf
->
lock
, 
f
);

2183 
	`•ö_u∆ock_úqª°‹e
(&
su≥r
->
£gbuf_mgr
.
lock
, 
Êags
);

2185 
	}
}

2187 
	$gë_desúed_size
(
dm§c_su≥r
 *
su≥r
, 
£g_id
){

2188 
size
 = 
CHUNK_SZ
 * ((
£g_id
 % (
NUM_SSD
-1)) + 1);

2190 
size
 = 
CHUNK_SZ
 * 1;

2191  
size
;

2192 
	}
}

2194 
	$¥o˚ss_wrôe_ªque°
(
dm§c_su≥r
 *
su≥r
,

2195 
bio
 *bio,

2196 
∑ge
 *page,

2197 
£˘‹_t
 
key
,

2198 
is_dúty
,

2199 
f
,

2200 
ˇche_ty≥
,

2201 
u32
 
¸c32


2204 
£gmít_hódî
 *
£g
;

2205 
mëablock
 *
√w_mb
;

2206 
ømbuf„r
 *
ømbuf
;

2207 
boﬁ
 
√ed_ª‰esh
 = 
Ál£
;

2208 
boﬁ
 
√ed_summ¨y
 = 
Ál£
;

2209 *
±r
;

2210 
u32
 
tŸÆ_cou¡
 = 0;

2211 
u32
 
mb_idx
;

2212 
u32
 
£g_Àngth
;

2213 
©omic_t
 
bios_°¨t
[
MAX_CACHE_DEVS
];

2214 
©omic_t
 
bios_cou¡
[
MAX_CACHE_DEVS
];

2215 
u32
 
∑πül_ã°
 = 0;

2216 
u64
 
globÆ_£g_£quí˚
;

2218 
√w_mb
 = 
	`Æloc_mb_d©a
(
su≥r
, 
key
, 
ˇche_ty≥
, !
is_dúty
, &
tŸÆ_cou¡
);

2219 if(
	`ã°_bô
(
MB_DIRTY
, &
√w_mb
->
mb_Êags
)!=
is_dúty
){

2220 
	`¥ötk
(" invÆid dúty fœg = %d %dÅŸÆ_cou¡ = %d \n", 
	`ã°_bô
(
MB_DIRTY
, &
√w_mb
->
mb_Êags
), 
is_dúty
, 
tŸÆ_cou¡
);

2221 
	`¥ötk
(" cachêty≥ = %d \n", 
ˇche_ty≥
);

2224 
mb_idx
 = 
√w_mb
->
idx
;

2225 
£g
 = 
su≥r
->
cuºít_£g
[
ˇche_ty≥
];

2226 
ømbuf
 = 
su≥r
->
£gbuf_mgr
.
cuºít_ømbuf
[
ˇche_ty≥
];

2228 #i‡
SUMMARY_LOCATION
 =
USE_LAST_SUMMARY


2229 if(
	`√ed_chunk_summ¨y
(
su≥r
, 
mb_idx
+
NUM_SUMMARY
)){

2230 
u32
 
summ¨y_idx
 = 
	`d©a_to_summ¨y_idx
(
su≥r
, 
mb_idx
);

2231 
	`Æloc_mb_summ¨y
(
su≥r
, 
£g
, 
ˇche_ty≥
, 
summ¨y_idx
, &
tŸÆ_cou¡
);

2232 
	`öôülize_mb_summ¨y
(
su≥r
, 
£g
, 
ˇche_ty≥
, 
summ¨y_idx
, 1);

2233 
√ed_summ¨y
 = 
åue
;

2238 if(
su≥r
->
∑øm
.
bio_∂uggög
){

2239 
	`bio_∂uggög
(
su≥r
, 
£g
, 
ømbuf
, 
bio
, 
mb_idx
);

2240 #i‡
SUMMARY_LOCATION
 =
USE_LAST_SUMMARY


2241 if(
√ed_summ¨y
){

2242 
j
;

2243 
j
 = 0;j < 
NUM_SUMMARY
;j++)

2244 
	`bio_∂uggög
(
su≥r
, 
£g
, 
ømbuf
, 
NULL
, 
mb_idx
 + 1 + 
j
);

2253 if(
∑πül_ã°
 || 
	`√ed_ª‰esh_£gmít
(
su≥r
, 
ˇche_ty≥
, 
tŸÆ_cou¡
)){

2254 if(!
∑πül_ã°
)

2255 
su≥r
->
£gbuf_mgr
.
cuºít_ømbuf
[
ˇche_ty≥
] = 
NULL
;

2257 
√ed_ª‰esh
 = 
åue
;

2258 
globÆ_£g_£quí˚
 = 
	`©omic64_öc_ªtu∫
(&
su≥r
->
Êush_mgr
.global_seg_sequence);

2260 if(
∑πül_ã°
){

2262 
	`Æloc_∑πül_summ¨y
(
su≥r
, 
£g
, 
ømbuf
, 
ˇche_ty≥
);

2265 
	`make_bios_∑rôy
(
su≥r
, 
£g
, 
ømbuf
, 0);

2266 
	`make_bios_ve˘‹
(
su≥r
, 
£g
, 
ømbuf
, 
bios_°¨t
, 
bios_cou¡
);

2267 
£g_Àngth
 = 
	`©omic_ªad
(&
£g
->
Àngth
);

2269 
	`¥ötk
(" seg id = %d, segÜígth = %d vÆid cou¡ = %d(dúty = %d, cÀ™ = %d), dummy = %d \n", ()
£g
->
£g_id
, 
£g_Àngth
,

2270 
	`©omic_ªad
(&
£g
->
vÆid_cou¡
),

2271 
	`©omic_ªad
(&
£g
->
vÆid_dúty_cou¡
),

2272 
	`©omic_ªad
(&
£g
->
vÆid_˛ón_cou¡
),

2273 
	`©omic_ªad
(&
£g
->
dummy_cou¡
));

2276 
	`UNLOCK
(
su≥r
, 
f
);

2283 if(
∑ge
){

2284 
±r
 = 
	`∑ge_addªss
(
∑ge
);

2285 
	`upd©e_d©a_ö_mb
(
su≥r
, 
mb_idx
, 
£g
, 
ømbuf
, 
ˇche_ty≥
, 
±r
, 
¸c32
);

2287 
±r
 = 
NULL
;

2288 
	`upd©e_d©a_ö_mb
(
su≥r
, 
mb_idx
, 
£g
, 
ømbuf
, 
ˇche_ty≥
, 
±r
, 0);

2291 
	`BUG_ON
(
ˇche_ty≥
!=
£g
->
£g_ty≥
);

2292 if(
√ed_ª‰esh
){

2293 
	`BUG_ON
(
	`ã°_bô
(
SEG_SEALED
, &
£g
->
Êags
));

2296 if(
su≥r
->
∑øm
.
bio_∂uggög
){

2297 
	`©omic_dec
(&
£g
->
num_fûlög
);

2298 if(
bio
)

2299 
	`©omic_öc
(&
su≥r
->
ˇche_°©
.
öÊight_bios
);

2300 
	`©omic_öc
(&
su≥r
->
ˇche_°©
.
tŸÆ_bios
);

2302 if(
√ed_ª‰esh
 && !
	`ã°_bô
(
SEG_SEALED
, &
£g
->
Êags
)){

2305 
	`make_Êush_övoke_job
(
su≥r
, 
£g
, 
ømbuf
, 
£g_Àngth
, 
bios_°¨t
, 
bios_cou¡
,

2306 
ˇche_ty≥
, 0, 0, 1, 
globÆ_£g_£quí˚
);

2316 
	`¥ötk
("Ço queueÇot supported ... \n");

2317 
	`BUG_ON
(1);

2320  
DM_MAPIO_SUBMITTED
;

2321 
	}
}

2324 
	$¥o˚ss_ªad_miss_ªque°
(
dm§c_su≥r
 *
su≥r
, 
bio
 *bio, 
f
){

2325 
dm_dev
 *
‹igö_dev
 = 
su≥r
->
dev_öfo
.origin_dev;

2327 
	`UNLOCK
(
su≥r
, 
f
);

2329 
	`bio_ªm≠
(
bio
, 
‹igö_dev
, bio->
bi_£˘‹
);

2330 
	`ªad_ˇchög_make_job
(
su≥r
, 
NULL
, NULL, 
bio
, NULL);

2332  
DM_MAPIO_SUBMITTED
;

2334 
	}
}

2336 
	$¥o˚ss_ªad_hô_ªque°
(
dm§c_su≥r
 *
su≥r
, 
bio
 *bio,

2337 
£gmít_hódî
 *
£g
,

2338 
mëablock
 *
mb
,

2339 
f
){

2341 
bio_˘x
 *
m≠_c⁄ãxt
;

2342 
dm_èrgë
 *
ti
 = 
su≥r
->ti;

2343 
u32
 
tmp32
;

2345 
m≠_c⁄ãxt
 = 
	`dm_≥r_bio_d©a
(
bio
, 
ti
->
≥r_bio_d©a_size
);

2347 if(
	`ã°_bô
(
SEG_SEALED
, &
£g
->
Êags
)){

2348 
	`£t_bô
(
SEG_HIT
, &
£g
->
Êags
);

2350 if(!
	`ã°_bô
(
MB_HIT
, &
mb
->
mb_Êags
)){

2351 
	`£t_bô
(
MB_HIT
, &
mb
->
mb_Êags
);

2352 
	`©omic_öc
(&
£g
->
hŸ_cou¡
);

2353 if(!
	`ã°_bô
(
MB_DIRTY
, &
mb
->
mb_Êags
))

2354 
	`©omic_öc
(&
£g
->
hŸ_˛ón_cou¡
);

2358 
	`©omic_öc
(&
£g
->
num_ªad_öÊight
);

2359 
	`UNLOCK
(
su≥r
, 
f
);

2361 
m≠_c⁄ãxt
->
±r
 = 
£g
;

2363 
	`div_u64_ªm
(
bio
->
bi_£˘‹
, 1 << 3, &
tmp32
);

2364 if(
tmp32
){

2365 
	`¥ötk
("Ñód hô:Ö¨tü»ªad: se˘‹ %d off£à%d, sizê%d \n", ()
bio
->
bi_£˘‹
, 
tmp32
,

2366 
bio
->
bi_size
);

2367 
	`¥ötk
("Ñód hô:Ö¨tü»ªad: mb->idx %d \n", 
mb
->
idx
);

2370 
	`bio_ªm≠
(
bio
,

2371 
	`gë_dmdev
(
su≥r
, 
mb
->
idx
),

2372 
	`gë_£˘‹
(
su≥r
, 
£g
->
£g_id
, 
mb
->
idx
)

2373 + 
tmp32
);

2375 
	`gíîic_make_ªque°
(
bio
);

2377  
DM_MAPIO_SUBMITTED
;

2378 
	}
}

2381 #i‡
deföed
(
CONFIG_BCACHE
Ë|| deföed(
CONFIG_BCACHE_MODULE
)

2382 
	#ewma_add
(
ewma
, 
vÆ
, 
weight
, 
Á˘‹
) \

2384 (
ewma
Ë*(
weight
) - 1; \

2385 (
ewma
Ë+(
vÆ
Ë<< 
Á˘‹
; \

2386 (
ewma
Ë/(
weight
); \

2387 (
ewma
Ë>> 
Á˘‹
; \

2388 })

	)

2391 
hli°_hód
 *
	$iohash
(
£q_io_dëe˘‹
 *
dc
, 
uöt64_t
 
k
)

2393  &
dc
->
io_hash
[
	`hash_64
(
k
, 
RECENT_IO_BITS
)];

2394 
	}
}

2396 
	$add_£quítül
(
èsk_°ru˘
 *
t
)

2398 
	`ewma_add
(
t
->
£quítül_io_avg
,

2399 
t
->
£quítül_io
, 8, 0);

2401 
t
->
£quítül_io
 = 0;

2402 
	}
}

2408 
boﬁ
 
	$dëe˘_£quítül_io
(
dm§c_su≥r
 *
su≥r
, 
bio
 *bio){

2409 
io
 *
i
;

2410 
£˘‹s
;

2411 
u£_mîge
 = 1;

2412 #i‡
	`deföed
(
CONFIG_BCACHE
Ë|| deföed(
CONFIG_BCACHE_MODULE
)

2413 
Êags
;

2415 
£q_io_dëe˘‹
 *
£q_dëe˘‹
 = &
su≥r
->seq_detector;

2416 
boﬁ
 
r
 = 
Ál£
;

2418 if(!
su≥r
->
∑øm
.
£quítül_íabÀ
){

2419  
Ál£
;

2421 i‡(
bio
->
bi_rw
 & 
REQ_DISCARD
) {

2422  
Ál£
;

2425 
	`•ö_lock_úqßve
(&
£q_dëe˘‹
->
£q_lock
, 
Êags
);

2426 i‡(
u£_mîge
) {

2428 
	`hli°_f‹_óch_íåy
(
i
, 
	`iohash
(
£q_dëe˘‹
, 
bio
->
bi_£˘‹
), 
hash
)

2429 i‡(
i
->
œ°
 =
bio
->
bi_£˘‹
 &&

2430 
	`time_bef‹e
(
jiffõs
, 
i
->jiffies))

2431 
found
;

2433 
i
 = 
	`li°_fú°_íåy
(&
£q_dëe˘‹
->
io_Ãu
, 
io
, 
Ãu
);

2435 
	`add_£quítül
(
cuºít
);

2436 
i
->
£quítül
 = 0;

2437 
found
:

2438 i‡(
i
->
£quítül
 + 
bio
->
bi_size
 > i->sequential)

2439 
i
->
£quítül
 +
bio
->
bi_size
;

2441 
i
->
œ°
 = 
	`bio_íd_£˘‹
(
bio
);

2442 
i
->
jiffõs
 = jiffõ†+ 
	`m£cs_to_jiffõs
(5000);

2443 
cuºít
->
£quítül_io
 = 
i
->
£quítül
;

2445 
	`hli°_dñ
(&
i
->
hash
);

2446 
	`hli°_add_hód
(&
i
->
hash
, 
	`iohash
(
£q_dëe˘‹
, i->
œ°
));

2447 
	`li°_move_èû
(&
i
->
Ãu
, &
£q_dëe˘‹
->
io_Ãu
);

2450 
cuºít
->
£quítül_io
 = 
bio
->
bi_size
;

2451 
	`add_£quítül
(
cuºít
);

2453 
	`•ö_u∆ock_úqª°‹e
(&
£q_dëe˘‹
->
£q_lock
, 
Êags
);

2455 
£˘‹s
 = 
	`max
(
cuºít
->
£quítül_io
,

2456 
cuºít
->
£quítül_io_avg
) >> 9;

2458 i‡(
su≥r
->
∑øm
.
£quítül_cutoff
 &&

2459 
£˘‹s
 >
su≥r
->
∑øm
.
£quítül_cutoff
 >> 9) {

2460 
r
 = 
åue
;

2464  
r
;

2465 
	}
}

2468 
ölöe
 
boﬁ
 
	$should_√ed_ª‰esh_£g
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
){

2469 
boﬁ
 
√ed_ª‰esh
 = 
Ál£
;

2470 
cou¡
;

2472 
cou¡
 = 
	`ma_gë_cou¡
(
su≥r
, 
ˇche_ty≥
);

2473 if(
	`√ed_ª‰esh_£gmít
(
su≥r
, 
ˇche_ty≥
, 
cou¡
))

2474 
√ed_ª‰esh
 = 
åue
;

2475  
√ed_ª‰esh
;

2476 
	}
}

2479 
	$åy_waô_‰ì_£g
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
){

2481 if((
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
£g_Æloc_cou¡
)<=

2482 
MIGRATE_HIGHWATER
 - (MIGRATE_HIGHWATER - 
MIGRATE_LOWWATER
)/2

2483 ||
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
group_Æloc_cou¡
)<=1)

2484 && 
	`©omic_ªad
(&
su≥r
->
migøã_mgr
.
migøã_åiggîed
)){

2488 if(
	`should_√ed_ª‰esh_£g
(
su≥r
, 
ˇche_ty≥
)){

2489 #ifde‡
FORCE_UMAX


2490 if(
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
£g_Æloc_cou¡
)<
MIGRATE_LOWWATER
 ||

2491 
	`gë_cuº_utû
(
su≥r
Ë> su≥r->
∑øm
.
u_max
 ||

2492 
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
group_Æloc_cou¡
)<=1){

2494 if(
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
£g_Æloc_cou¡
)<
MIGRATE_LOWWATER
 ||

2495 
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
group_Æloc_cou¡
)<=1){

2497 if(!
	`©omic_ªad
(&
su≥r
->
migøã_mgr
.
migøã_åiggîed
)){

2498 
	`©omic_£t
(&
su≥r
->
migøã_mgr
.
migøã_åiggîed
, 1);

2499 
su≥r
->
migøã_mgr
.
Ælow_migøã
 = 
åue
;

2500 
	`wake_up_¥o˚ss
(
su≥r
->
migøã_mgr
.
d´m⁄
);

2506 if(
	`ˇn_gë_‰ì_£gmít
(
su≥r
, 
ˇche_ty≥
, 0)){

2507 
	`Æloc_√w_£gmít
(
su≥r
, 
ˇche_ty≥
, 
Ál£
);

2514 
	}
}

2517 
	$should_by∑ss_bio
(
dm§c_su≥r
 *
su≥r
,

2518 
£gmít_hódî
 *
£g
,

2519 
mëablock
 *
mb
,

2520 
bio
 *bio,

2521 
is_wrôe
){

2523 
bio_˘x
 *
m≠_c⁄ãxt
 =

2524 
	`dm_≥r_bio_d©a
(
bio
, 
su≥r
->
ti
->
≥r_bio_d©a_size
);

2525 
boﬁ
 
ˇn_by∑ss
 = 
Ál£
;

2526 
boﬁ
 
£q_io
;

2527 
boﬁ
 
cﬁd_io
 = 
Ál£
;

2529 if(
is_wrôe
){

2530 if(!
m≠_c⁄ãxt
->
hŸ_io
 && 
	`gë_cuº_utû
(
su≥r
Ë> su≥r->
∑øm
.
u_max
){

2531 
cﬁd_io
 = 
åue
;

2534 if(!
m≠_c⁄ãxt
->
hŸ_io
 && 
	`gë_cuº_utû
(
su≥r
Ë> su≥r->
∑øm
.
u_max
){

2535 
cﬁd_io
 = 
åue
;

2539 
£q_io
 = (
boﬁ
)
m≠_c⁄ãxt
->seq_io;

2540 if(
£q_io
 || 
cﬁd_io
){

2541 
boﬁ
 
ªm≠≥d
 = 
Ál£
;

2543 if(!
mb
){

2544 
ªm≠≥d
 = 
åue
;

2546 if(
is_wrôe
){

2547 
	`BUG_ON
–!
	`ã°_bô
(
MB_SEAL
, &
mb
->
mb_Êags
Ë&& 
	`is_gc_°rùe
(
£g
->
£g_ty≥
));

2548 
	`övÆid©e_¥evious_ˇche
(
su≥r
, 
£g
, 
mb
);

2549 
ªm≠≥d
 = 
åue
;

2553 if(
ªm≠≥d
){

2554 if(
cﬁd_io
)

2555 
	`©omic_öc
(&
su≥r
->
w°©
.
cﬁd_by∑ss_cou¡
);

2556 if(
£q_io
)

2557 
	`©omic_öc
(&
su≥r
->
w°©
.
£q_by∑ss_cou¡
);

2559 
ˇn_by∑ss
 = 
åue
;

2560 
do_by∑ss
;

2564 if(
	`©omic_ªad
(&
su≥r
->
ªsize_mode
)){

2565 if(!
mb
){

2566 
ˇn_by∑ss
 = 
åue
;

2568 
	`¥ötk
(" data is found\n");

2569 
	`BUG_ON
(1);

2573 if(
	`©omic_ªad
(&
su≥r
->
degøded_mode
)){

2574 if(!
mb
){

2575 
ˇn_by∑ss
 = 
åue
;

2577 if(
is_wrôe
){

2578 
	`övÆid©e_¥evious_ˇche
(
su≥r
, 
£g
, 
mb
);

2579 
ˇn_by∑ss
 = 
åue
;

2581 if(
	`ã°_bô
(
MB_BROKEN
, &
mb
->
mb_Êags
)){

2582 
	`¥ötk
("ÇeedÑeconstructÑead \n");

2588 
do_by∑ss
:

2590 if(
ˇn_by∑ss
){

2595 
	}
}

2598 
	$åy_gë_‰ì_£gmít
(
dm§c_su≥r
 *
su≥r
, 
boﬁ
 
found
, 
rw
){

2599 
ˇche_ty≥
;

2601 if(
su≥r
->
∑øm
->
°rùög_pﬁicy
==
MIXED_STRIPING
)

2602 
rw
 = 1;

2604 if(
rw
){

2605 
ˇche_ty≥
 = 
su≥rUF
;

2607 
ˇche_ty≥
 =
RBUF
;

2610 if(
	`should_√ed_ª‰esh_£g
(
su≥r
, 
rw
)){

2611 if(
	`ˇn_gë_‰ì_£gmít
(
su≥r
, 
ˇche_ty≥
)){

2612 
	`BUG_ON
(
	`©omic_ªad
(&
su≥r
->
ømbuf_öa˘ive_cou¡
)==0);

2613 
	`Æloc_√w_£gmít
(
su≥r
, 
ˇche_ty≥
, 
Ál£
);

2620 
	}
}

2625 
	$upd©e_gho°_buf„r
(
dm§c_su≥r
 *
su≥r
, 
£˘‹_t
 
£˘‹
, 
is_wrôe
, *
is_hŸ
){

2626 
ˇche_m™agî
 *
Ãu_m™agî
 = 
su≥r
->lru_manager;

2627 
Ãu_node
 *
 
 = 
NULL
;

2629 
 
 = 
	`CACHE_SEARCH
(
Ãu_m™agî
, 
£˘‹
);

2630 if(!
 
){

2631 
 
 = 
	`CACHE_REPLACE
(
Ãu_m™agî
, 0);

2632 
 
 = 
	`CACHE_ALLOC
(
Ãu_m™agî
,Ün, 
£˘‹
);

2633 
	`CACHE_INSERT
(
Ãu_m™agî
, 
 
);

2634 *
is_hŸ
 = 0;

2636 *
is_hŸ
 = 1;

2637 
 
 = 
	`CACHE_REMOVE
(
Ãu_m™agî
,Ün);

2638 
	`CACHE_INSERT
(
Ãu_m™agî
, 
 
);

2639 if(
is_wrôe
)

2640 
 
->
˙_wrôe_hô
++;

2642 
 
->
˙_ªad_hô
++;

2644 if(
is_wrôe
)

2645 
 
->
˙_wrôe_ªf
++;

2647 
 
->
˙_ªad_ªf
++;

2649 if(
is_wrôe
){

2650 if(*
is_hŸ
)

2653 if(
 
->
˙_wrôe_ªf
==0&& ->
˙_ªad_ªf
>1)

2658 
	}
}

2661 
	$upd©e_°©
(
dm§c_su≥r
 *
su≥r
, 
mëablock
 *
mb
, 
is_wrôe
){

2662 
su≥r
->
w°©
.
cou¡
++;

2663 if(
is_wrôe
)

2664 
su≥r
->
w°©
.
wrôe_cou¡
++;

2666 
su≥r
->
w°©
.
ªad_cou¡
++;

2668 i‡(
mb
) {

2669 
su≥r
->
w°©
.
hô
++;

2670 if(
is_wrôe
)

2671 
su≥r
->
w°©
.
wrôe_hô
++;

2673 
su≥r
->
w°©
.
ªad_hô
++;

2675 
	}
}

2677 
	$¥ïro˚ss_≥ndög_bio
(
dm§c_su≥r
 *
su≥r
,

2678 
£gmít_hódî
 *
£g
,

2679 
bio
 *bio,

2680 
mëablock
 *
mb
,

2681 
is_wrôe
)

2683 
ªs
 = 0;

2685 if(
mb
){

2687 if(
	`u∆ikñy
(
	`ã°_bô
(
SEG_MIGRATING
, &
£g
->
Êags
))){

2688 
ªs
 = 
RES_MIG
;

2689 
≥ndög_¥o˚ss
;

2692 if(
	`u∆ikñy
(
	`ã°_bô
(
SEG_PARTIAL
, &
£g
->
Êags
) ||

2693 
	`ã°_bô
(
SEG_RECOVERY
, &
£g
->
Êags
) ))

2695 
ªs
 = 
RES_PARTIAL
;

2696 
≥ndög_¥o˚ss
;

2699 if(
	`u∆ikñy
(!
	`ã°_bô
(
MB_SEAL
, &
mb
->
mb_Êags
))){

2700 if(!
is_wrôe
){

2701 
ªs
 = 
RES_SEAL
;

2702 
≥ndög_¥o˚ss
;

2708 if(
	`u∆ikñy
(
	`©omic_ªad
(&
su≥r
->
ªsize_mode
))){

2709 
≥ndög_¥o˚ss
;

2713 if(
	`u∆ikñy
(
	`should_by∑ss_bio
(
su≥r
, 
£g
, 
mb
, 
bio
, 
is_wrôe
) &&

2714 !(
bio
->
bi_rw
 & 
REQ_DISCARD
))){

2715 
ªs
 = 
RES_BYPASS
;

2716 
by∑ss_¥o˚ss
;

2720 if(
is_wrôe
){

2721 if(
su≥r
->
cuºít_group
 && 
	`©omic_ªad
(&su≥r->cuºít_group->
‰ì_£g_cou¡
)==0){

2722 if(
	`should_√ed_ª‰esh_£g
(
su≥r
, 
WCBUF
) &&

2723 !
	`should_√ed_ª‰esh_£g
(
su≥r
, 
RCBUF
)){

2724 
	`¥ötk
(" * dirty seg write:Çeed fill RCBUF with dummy ... \n");

2728 if(
	`åy_waô_‰ì_£g
(
su≥r
, 
WCBUF
)){

2729 
ªs
 = 
RES_NOFREE1
;

2730 
≥ndög_¥o˚ss
;

2736 
≥ndög_¥o˚ss
:

2737  
ªs
;

2739 
by∑ss_¥o˚ss
:

2740  
ªs
;

2742 
	}
}

2745 
	$lookup_døm_ˇche
(
dm§c_su≥r
 *
su≥r
, 
£˘‹_t
 
£˘‹
){

2746 
ˇche_m™agî
 *
Ãu_m™agî
 = 
su≥r
->
˛ón_døm_ˇche_m™agî
;

2747 
Ãu_node
 *
 
 = 
NULL
;

2749 
 
 = 
	`CACHE_SEARCH
(
Ãu_m™agî
, 
£˘‹
);

2750 if(!
 
){

2751 
 
 = 
	`CACHE_REPLACE
(
Ãu_m™agî
, 0);

2752 
 
 = 
	`CACHE_ALLOC
(
Ãu_m™agî
,Ün, 
£˘‹
);

2753 
	`CACHE_INSERT
(
Ãu_m™agî
, 
 
);

2754 
	`©omic_£t
(&
 
->
£Æed
, 0);

2756 
 
 = 
	`CACHE_REMOVE
(
Ãu_m™agî
,Ün);

2757 
	`CACHE_INSERT
(
Ãu_m™agî
, 
 
);

2758 
 
->
˙_ªad_hô
++;

2761 
 
->
˙_ªad_ªf
++;

2764 
	}
}

2767 
	$¥o˚ss_ªad_ªque°
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
,

2768 
mëablock
 *
mb
, 
bio
 *bio, 
£˘‹_t
 
key
, 
f
){

2769 
ˇche_m™agî
 *
˛ón_ˇche
 = 
su≥r
->
˛ón_døm_ˇche_m™agî
;

2770 
Ãu_node
 *
 
 = 
NULL
;

2771 
Ãu_Êags
;

2772 
døm_hô
 = 0;

2773 
£Æed
 = 0;

2774 
ªs
;

2776 if(!
mb
 && 
su≥r
->
∑øm
.
íabÀ_ªad_ˇche
){

2777 
	`•ö_lock_úqßve
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

2778 
 
 = 
	`CACHE_SEARCH
(
˛ón_ˇche
, 
key
);

2779 if(!
 
){

2780 
døm_hô
 = 0;

2782 if(
˛ón_ˇche
->
cm_‰ì
){

2783 
 
 = 
	`CACHE_ALLOC
(
˛ón_ˇche
,Ün, 
key
);

2784 
	`CACHE_INSERT
(
˛ón_ˇche
, 
 
);

2785 
	`©omic_£t
(&
 
->
£Æed
, 0);

2786 
	`©omic_£t
(&
 
->
locked
, 0);

2790 
	`¥ötk
(" hit in dram ... \n");

2791 
døm_hô
 = 1;

2792 
 
 = 
	`CACHE_REMOVE
(
˛ón_ˇche
,Ün);

2793 
	`CACHE_INSERT
(
˛ón_ˇche
, 
 
);

2794 
 
->
˙_ªad_hô
++;

2797 if(
 
){

2798 if(
	`©omic_ªad
(&
 
->
£Æed
))

2799 
£Æed
 = 1;

2801 
£Æed
 = 0;

2803 
	`•ö_u∆ock_úqª°‹e
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

2805 if(!
 
){

2806 
	`UNLOCK
(
su≥r
, 
f
);

2808 
	`bio_ªm≠
(
bio
, 
su≥r
->
dev_öfo
.
‹igö_dev
, bio->
bi_£˘‹
);

2809 
	`gíîic_make_ªque°
(
bio
);

2810  
DM_MAPIO_SUBMITTED
;

2814 if(
døm_hô
){

2815 
	`BUG_ON
(
mb
);

2816 if(
£Æed
){

2817 
	`UNLOCK
(
su≥r
, 
f
);

2818 
	`BUG_ON
(1);

2819 
	`¥ötk
(" døm hô sóÀd %d .. \n", ()
key
);

2820 
	`bio_ídio
(
bio
, 0);

2821  
DM_MAPIO_SUBMITTED
;

2823 
	`UNLOCK
(
su≥r
, 
f
);

2824 
	`¥ötk
(" døm hô buànŸ sóÀd..≥ndög queuê%d \n", ()
key
);

2825 
	`BUG_ON
(1);

2826 
ªs
 = 
RES_DRAM
;

2830 i‡(!
mb
) {

2832  
	`¥o˚ss_ªad_miss_ªque°
(
su≥r
, 
bio
, 
f
);

2835  
	`¥o˚ss_ªad_hô_ªque°
(
su≥r
, 
bio
, 
£g
, 
mb
, 
f
);

2839 
	}
}

2841 
	$m≠_≥ndög_bio
(
dm§c_su≥r
 *
su≥r
, 
bio
 *bio)

2843 
dm_èrgë
 *
ti
 = 
su≥r
->ti;

2844 
£gmít_hódî
 *
£g
 = 
NULL
;

2845 
mëablock
 *
mb
 = 
NULL
;

2846 
bio_˘x
 *
m≠_c⁄ãxt
 = 
NULL
;

2848 
ˇche_m™agî
 *
˛ón_ˇche
 = 
su≥r
->
˛ón_døm_ˇche_m™agî
;

2849 
Ãu_node
 *
 
 = 
NULL
;

2850 
Ãu_Êags
;

2852 
£˘‹_t
 
key
;

2853 
ªs
 = 0;

2854 
is_wrôe
;

2855 
f
;

2857 
m≠_c⁄ãxt
 = 
	`dm_≥r_bio_d©a
(
bio
, 
ti
->
≥r_bio_d©a_size
);

2859 if(
	`©omic_ªad
(&
su≥r
->
migøã_mgr
.
background_gc_⁄
)){

2860 
	`©omic_£t
(&
su≥r
->
migøã_mgr
.
background_gc_⁄
, 0);

2863 
is_wrôe
 = 
	`bio_d©a_dú
(
bio
);

2864 
key
 = 
	`ˇlc_ˇche_Æignmít
(
su≥r
, 
bio
->
bi_£˘‹
);

2867 if(
bio
){

2868 if(
is_wrôe
){

2869 
	`¥ötk
(" wrôe: m≠ biÿ£˘‹ = %d cou¡ = %d \n", ()
bio
->
bi_£˘‹
, ()bio->
bi_size
);

2871 
	`¥ötk
("Ñód: m≠ biÿ£˘‹ = %d cou¡ = %d \n", ()
bio
->
bi_£˘‹
, ()bio->
bi_size
);

2876 
	`LOCK
(
su≥r
, 
f
);

2877 
mb
 = 
	`ht_lookup
(
su≥r
, 
key
);

2878 i‡(
mb
) {

2879 
£g
 = 
	`gë_£gmít_hódî_by_mb_idx
(
su≥r
, 
mb
->
idx
);

2882 
	`upd©e_°©
(
su≥r
, 
mb
, 
is_wrôe
);

2886 
ªs
 = 
	`¥ïro˚ss_≥ndög_bio
(
su≥r
, 
£g
, 
bio
, 
mb
, 
is_wrôe
);

2887 if(
ªs
 &&Ñe†< 
RES_BYPASS
)

2888 
≥ndög_¥o˚ss
;

2889 if(
ªs
 =
RES_BYPASS
)

2890 
by∑ss_¥o˚ss
;

2892 if(
su≥r
->
∑øm
.
íabÀ_ªad_ˇche
){

2893 
	`•ö_lock_úqßve
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

2894 
 
 = 
	`CACHE_SEARCH
(
˛ón_ˇche
, 
key
);

2895 if(
 
){

2896 if(
mb
)

2897 
	`¥ötk
(" WARN: hit in both SSDánd DRAM \n");

2899 if(
is_wrôe
){

2900 if(
	`©omic_ªad
(&
 
->
locked
)){

2902 
ªs
 = 
RES_DRAM
;

2904 
	`•ö_u∆ock_úqª°‹e
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

2905 
≥ndög_¥o˚ss
;

2909 
 
 = 
	`CACHE_REMOVE
(
˛ón_ˇche
,Ün);

2910 if(
	`©omic_ªad
(&
 
->
£Æed
)){

2911 
	`©omic_dec
(&
˛ón_ˇche
->
cm_£Æed_cou¡
);

2913 
	`li°_add
(&
 
->
˙_li°
, &
˛ón_ˇche
->
cm_‰ì_hód
);

2915 if(!
	`©omic_ªad
(&
 
->
£Æed
)||©omic_ªad(& ->
locked
)){

2916 
ªs
 = 
RES_DRAM
;

2917 
	`•ö_u∆ock_úqª°‹e
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

2918 
≥ndög_¥o˚ss
;

2921 
 
 = 
	`CACHE_REMOVE
(
˛ón_ˇche
,Ün);

2922 
	`CACHE_INSERT
(
˛ón_ˇche
, 
 
);

2923 
	`•ö_u∆ock_úqª°‹e
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

2924 
	`UNLOCK
(
su≥r
, 
f
);

2926 
	`bio_ídio
(
bio
, 0);

2927  
DM_MAPIO_SUBMITTED
;

2931 
	`•ö_u∆ock_úqª°‹e
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

2934 i‡(!
is_wrôe
) {

2936  
	`¥o˚ss_ªad_ªque°
(
su≥r
, 
£g
, 
mb
, 
bio
, 
key
, 
f
);

2949 
m≠_c⁄ãxt
->
öÊight
 = 1;

2950 
	`©omic_öc
(&
su≥r
->
ˇche_°©
.
öÊight_ios
);

2951 
	`©omic_öc
(&
su≥r
->
ˇche_°©
.
tŸÆ_ios
);

2954 i‡(
mb
) {

2955 
	`BUG_ON
(
£g
->
£g_ty≥
==
GRBUF
&&!
	`ã°_bô
(
MB_SEAL
, &
mb
->
mb_Êags
));

2956 
	`övÆid©e_¥evious_ˇche
(
su≥r
, 
£g
, 
mb
);

2968  
	`¥o˚ss_wrôe_ªque°
(
su≥r
, 
bio
, 
	`bio_∑ge
(bio), 
key
, 1, 
f
, 
WCBUF
, 
m≠_c⁄ãxt
->
¸c32
);

2970 
	`bio_ídio
(
bio
, 0);

2974 
≥ndög_¥o˚ss
:

2975 
	`UNLOCK
(
su≥r
, 
f
);

2976  -
ªs
;

2978 
by∑ss_¥o˚ss
:

2979 
	`UNLOCK
(
su≥r
, 
f
);

2980 
	`bio_ªm≠
(
bio
, 
su≥r
->
dev_öfo
.
‹igö_dev
, bio->
bi_£˘‹
);

2981 
	`gíîic_make_ªque°
(
bio
);

2982  
DM_MAPIO_SUBMITTED
;

2983 
	}
}

2985 
	$≥ndög_bio_add
(
dm§c_su≥r
 *
su≥r
, 
bio
 *bio){

2986 
≥ndög_m™agî
 *
≥ndög_mgr
 = &
su≥r
->pending_mgr;

2987 
f
;

2989 
time•ec
 
ts
;

2992 
	`•ö_lock_úqßve
(&
≥ndög_mgr
->
lock
, 
f
);

2994 
	`bio_li°_add
(&
≥ndög_mgr
->
bios
, 
bio
);

2995 
	`©omic64_öc
(&
≥ndög_mgr
->
io_cou¡
);

2997 if(
	`bio_d©a_dú
(
bio
)){

2999 
	`gën°imeofday
(&
ts
);

3000 
≥ndög_mgr
->
¨rivÆ_times
[
	`©omic_ªad
(&≥ndög_mgr->
¨rivÆ_cur
)].
tv_£c
 = 
ts
.tv_sec;

3001 
≥ndög_mgr
->
¨rivÆ_times
[
	`©omic_ªad
(&≥ndög_mgr->
¨rivÆ_cur
)].
tv_n£c
 = 
ts
.tv_nsec;

3003 
	`©omic_öc
(&
≥ndög_mgr
->
¨rivÆ_cou¡
);

3005 if(
	`©omic_öc_ªtu∫
(&
≥ndög_mgr
->
¨rivÆ_cur
)==
STRIPE_SZ
){

3006 
	`©omic_£t
(&
≥ndög_mgr
->
¨rivÆ_cur
, 0);

3009 if(
	`©omic_ªad
(&
≥ndög_mgr
->
¨rivÆ_cur
)=˜tomic_ªad(&≥ndög_mgr->
¨rivÆ_°¨t
)){

3010 if(
	`©omic_öc_ªtu∫
(&
≥ndög_mgr
->
¨rivÆ_°¨t
)==
STRIPE_SZ
){

3011 
	`©omic_£t
(&
≥ndög_mgr
->
¨rivÆ_°¨t
, 0);

3019 
	`•ö_u∆ock_úqª°‹e
(&
≥ndög_mgr
->
lock
, 
f
);

3020 
	}
}

3022 
boﬁ
 
	$≥ndög_bio_em±y
(
dm§c_su≥r
 *
su≥r
){

3023 
≥ndög_m™agî
 *
≥ndög_mgr
 = &
su≥r
->pending_mgr;

3024 
em±y
 = 0;

3025 
f
;

3027 
	`•ö_lock_úqßve
(&
≥ndög_mgr
->
lock
, 
f
);

3028 if(
	`bio_li°_em±y
(&
≥ndög_mgr
->
bios
))

3029 
em±y
 = 1;

3030 
	`•ö_u∆ock_úqª°‹e
(&
≥ndög_mgr
->
lock
, 
f
);

3032 
	`•ö_lock_úqßve
(&
≥ndög_mgr
->
b¨rõr_lock
, 
f
);

3033 if(
	`bio_li°_em±y
(&
≥ndög_mgr
->
b¨rõr_ios
))

3034 
em±y
 += 1;

3036 
	`•ö_u∆ock_úqª°‹e
(&
≥ndög_mgr
->
b¨rõr_lock
, 
f
);

3039 if(
em±y
==2)

3043 
	}
}

3045 
	$≥ndög_w‹kî_scheduÀ
(
dm§c_su≥r
 *
su≥r
){

3046 if(
	`©omic64_ªad
(&
su≥r
->
≥ndög_mgr
.
io_cou¡
) ||

3047 
	`©omic_ªad
(&
su≥r
->
˛ón_døm_ˇche_m™agî
->
cm_£Æed_cou¡
)){

3048 
	`queue_w‹k
(
su≥r
->
≥ndög_mgr
.
wq
, &su≥r->≥ndög_mgr.
w‹k
);

3050 
	}
}

3052 
	$√ed_˛ón_£g_wrôe
(
dm§c_su≥r
 *
su≥r
){

3053 
ˇche_m™agî
 *
˛ón_ˇche
 = 
su≥r
->
˛ón_døm_ˇche_m™agî
;

3055 if(!
su≥r
->
∑øm
.
íabÀ_ªad_ˇche
)

3058 if((
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
£g_Æloc_cou¡
)<=

3059 
MIGRATE_HIGHWATER
 - (MIGRATE_HIGHWATER - 
MIGRATE_LOWWATER
)/2

3060 ||
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
group_Æloc_cou¡
)<=2)

3061 && 
	`©omic_ªad
(&
su≥r
->
migøã_mgr
.
migøã_åiggîed
)){

3067 if(
	`©omic_ªad
(&
˛ón_ˇche
->
cm_£Æed_cou¡
)>=
STRIPE_SZ
){

3072 
	}
}

3074 
	$˛ón_£g_wrôe
(
dm§c_su≥r
 *
su≥r
, 
√ed_cou¡
, 
ˇche_ty≥
){

3075 
ˇche_m™agî
 *
˛ón_ˇche
 = 
su≥r
->
˛ón_døm_ˇche_m™agî
;

3076 
Ãu_node
 *
 
, *
ãmp
;

3077 
li°_hód
 
˛ón_£g_hód
;

3078 
£gmít_hódî
 *
£g
;

3079 
mëablock
 *
mb
;

3080 
Êags
;

3081 
Ãu_Êags
;

3082 
cou¡
 = 0;

3085 if(
STRIPING_POLICY
==
MIXED_STRIPING
){

3086 
ˇche_ty≥
 = 
WCBUF
;

3087 
√ed_cou¡
 = 
	`gë_d©a_max_cou¡
(
su≥r
, 
WCBUF
);

3089 
ˇche_ty≥
 = 
RCBUF
;

3090 
√ed_cou¡
 = 
	`gë_d©a_max_cou¡
(
su≥r
, 
RCBUF
);

3092 if(
su≥r
->
cuºít_group
 && 
	`©omic_ªad
(&su≥r->cuºít_group->
‰ì_£g_cou¡
)==0){

3093 if(!
	`should_√ed_ª‰esh_£g
(
su≥r
, 
WCBUF
) &&

3094 
	`should_√ed_ª‰esh_£g
(
su≥r
, 
RCBUF
)){

3095 
ˇche_ty≥
 = 
WCBUF
;

3096 
√ed_cou¡
 = 
	`ma_gë_‰ì
(
su≥r
, 
WCBUF
);

3097 
	`¥ötk
(" * cÀ™ seg wrôe:Çìd fû»WCBUF wôh dummy ... cou¡ = %d \n", 
√ed_cou¡
);

3103 
	`INIT_LIST_HEAD
(&
˛ón_£g_hód
);

3105 
	`LOCK
(
su≥r
, 
Êags
);

3106 
	`•ö_lock_úqßve
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

3107 
	`li°_f‹_óch_íåy_ß„
(
 
, 
ãmp
, &
˛ón_ˇche
->
cm_hód
, 
˙_li°
){

3108 if(
	`©omic_ªad
(&
 
->
£Æed
)){

3110 
	`©omic_£t
(&
 
->
locked
, 1);

3111 
	`li°_add_èû
(&
 
->
˙_wrôe_li°
, &
˛ón_£g_hód
);

3113 if(++
cou¡
==
√ed_cou¡
)

3116 
cou¡
++;

3121 
	`•ö_u∆ock_úqª°‹e
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

3122 
	`UNLOCK
(
su≥r
, 
Êags
);

3124 if(
cou¡
!=
√ed_cou¡
)

3125 
	`¥ötk
("˛ó¿d©®cou¡ = %d,Çìd cou¡ = %d \n", 
cou¡
, 
√ed_cou¡
 );

3129 
	`li°_f‹_óch_íåy_ß„
(
 
, 
ãmp
, &
˛ón_£g_hód
, 
˙_wrôe_li°
){

3130 
	`LOCK
(
su≥r
, 
Êags
);

3131 if(
	`should_√ed_ª‰esh_£g
(
su≥r
, 
ˇche_ty≥
)){

3132 
RETRY
:

3134 if(
	`åy_waô_‰ì_£g
(
su≥r
, 
ˇche_ty≥
)){

3135 
	`UNLOCK
(
su≥r
, 
Êags
);

3137 
	`¥ötk
(" clean_seg_write:Ço more free group = %d segs %d, migrate = %dÑam buf ...%d \n",

3138 
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
group_Æloc_cou¡
),

3139 
	`©omic_ªad
(&
su≥r
->
£g_Æloˇt‹
.
£g_Æloc_cou¡
),

3140 
	`©omic_ªad
(&
su≥r
->
migøã_mgr
.
migøã_åiggîed
),

3141 
	`©omic_ªad
(&
su≥r
->
£gbuf_mgr
.
öa˘ive_∑ge_cou¡
));

3142 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(1000));

3143 
	`LOCK
(
su≥r
, 
Êags
);

3144 
RETRY
;

3149 
mb
 = 
	`ht_lookup
(
su≥r
, 
 
->
˙_blkno
);

3150 i‡(
mb
) {

3151 
£g
 = 
	`gë_£gmít_hódî_by_mb_idx
(
su≥r
, 
mb
->
idx
);

3153 
	`¥ötk
(" WARN: clean write data hit in seg = %d idx = %d(dirty=%d, valid= %d,Åype = %d \n",

3154 ()
£g
->
£g_id
, 
mb
->
idx
,

3155 
	`ã°_bô
(
MB_DIRTY
, &
mb
->
mb_Êags
),

3156 
	`ã°_bô
(
MB_VALID
, &
mb
->
mb_Êags
),

3157 
£g
->
£g_ty≥
);

3159 
	`övÆid©e_¥evious_ˇche
(
su≥r
, 
£g
, 
mb
);

3162 
	`¥o˚ss_wrôe_ªque°
(
su≥r
, 
NULL
, 
 
->
˙_∑ge
,Ün->
˙_blkno
, 0, 
Êags
, 
ˇche_ty≥
,Ün->
¸c32
);

3168 if(
STRIPING_POLICY
!=
MIXED_STRIPING
 && !
	`should_√ed_ª‰esh_£g
(
su≥r
, 
ˇche_ty≥
)){

3169 
	`¥ötk
(" WARN: cÀ™ såùêi†nŸ fuŒy fûÀd wôh cÀ™ d©®%d \n", 
	`ma_gë_cou¡
(
su≥r
, 
ˇche_ty≥
));

3173 
	`LOCK
(
su≥r
, 
Êags
);

3174 
	`•ö_lock_úqßve
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

3175 
	`li°_f‹_óch_íåy_ß„
(
 
, 
ãmp
, &
˛ón_£g_hód
, 
˙_wrôe_li°
){

3176 
	`CACHE_REMOVE
(
˛ón_ˇche
, 
 
);

3177 
	`©omic_dec
(&
˛ón_ˇche
->
cm_£Æed_cou¡
);

3178 
	`li°_add
(&
 
->
˙_li°
, &
˛ón_ˇche
->
cm_‰ì_hód
);

3179 
	`li°_dñ
(&
 
->
˙_wrôe_li°
);

3180 
	`©omic_£t
(&
 
->
locked
, 0);

3184 
	`•ö_u∆ock_úqª°‹e
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

3185 
	`UNLOCK
(
su≥r
, 
Êags
);

3187  
cou¡
;

3188 
	}
}

3190 
	$åy_˛ón_£g_wrôe
(
dm§c_su≥r
 *
su≥r
){

3192 
˛ón_wrôe_cou¡
;

3193 
tŸÆ_wrôe_cou¡
 = 0;

3194 
ˇche_ty≥
;

3196 if(
	`√ed_˛ón_£g_wrôe
(
su≥r
Ë&& su≥r->
∑øm
.
íabÀ_ªad_ˇche
){

3197 
¥o˚ss_cou¡
;

3201 if(
STRIPING_POLICY
==
MIXED_STRIPING
)

3202 
ˇche_ty≥
 = 
WCBUF
;

3204 
ˇche_ty≥
 = 
RCBUF
;

3206 
˛ón_wrôe_cou¡
 = 
	`gë_d©a_max_cou¡
(
su≥r
, 
ˇche_ty≥
);

3208 if(
su≥r
->
cuºít_group
 && 
	`©omic_ªad
(&su≥r->cuºít_group->
‰ì_£g_cou¡
)==0){

3209 if(!
	`should_√ed_ª‰esh_£g
(
su≥r
, 
WCBUF
) &&

3210 
	`should_√ed_ª‰esh_£g
(
su≥r
, 
RCBUF
)){

3211 
ˇche_ty≥
 = 
WCBUF
;

3212 
˛ón_wrôe_cou¡
 = 
	`ma_gë_‰ì
(
su≥r
, 
WCBUF
);

3217 
¥o˚ss_cou¡
 = 
	`˛ón_£g_wrôe
(
su≥r
, 
˛ón_wrôe_cou¡
, 
ˇche_ty≥
);

3218 if(
¥o˚ss_cou¡
 !
˛ón_wrôe_cou¡
){

3221 
tŸÆ_wrôe_cou¡
 +
˛ón_wrôe_cou¡
;

3228  
tŸÆ_wrôe_cou¡
;

3229 
	}
}

3231 
	$gë_∑πül_£g_Àngth
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
){

3232 
f
;

3233 
ømbuf„r
 *
ømbuf
;

3234 
Àngth
;

3236 
	`LOCK
(
su≥r
, 
f
);

3237 
ømbuf
 = 
su≥r
->
£gbuf_mgr
.
cuºít_ømbuf
[
ˇche_ty≥
];

3238 if(!
ømbuf
)

3239 
Àngth
 = 0;

3241 
Àngth
 = 
	`©omic_ªad
(&
ømbuf
->
bios_tŸÆ_cou¡
Ë-átomic_ªad(&ømbuf->
bios_tŸÆ_°¨t
);

3242 
	`UNLOCK
(
su≥r
, 
f
);

3244  
Àngth
;

3245 
	}
}

3247 
	$≥ndög_w‹kî
(
w‹k_°ru˘
 *
w‹k
){

3248 
≥ndög_m™agî
 *
≥ndög_mgr
 =

3249 
	`c⁄èöî_of
(
w‹k
, 
≥ndög_m™agî
,

3250 
w‹k
);

3251 
dm§c_su≥r
 *
su≥r
 = 
≥ndög_mgr
->super;

3252 
bio_li°
 
loˇl_li°
;

3253 
bio
 *bio;

3254 
f
;

3255 
ªåy_ªas⁄s
[
RES_COUNT
];

3256 
loˇl_cou¡
 = 0;

3257 
i
;

3258 
is_wrôe
 = 0;

3259 
˛ón_wrôe_cou¡
 = 0;

3261 
i
=0;i<
RES_COUNT
;i++){

3262 
ªåy_ªas⁄s
[
i
] = 0;

3265 
	`bio_li°_öô
(&
loˇl_li°
);

3268 
ªas⁄
;

3270 
	`•ö_lock_úqßve
(&
≥ndög_mgr
->
lock
, 
f
);

3271 
bio
 = 
	`bio_li°_p›
(&
≥ndög_mgr
->
bios
);

3272 if(
bio
)

3273 
	`©omic64_dec
(&
≥ndög_mgr
->
io_cou¡
);

3274 
	`•ö_u∆ock_úqª°‹e
(&
≥ndög_mgr
->
lock
, 
f
);

3276 if(!
bio
)

3279 if(
	`bio_d©a_dú
(
bio
))

3280 
is_wrôe
 = 1;

3282 
ªas⁄
 = 
	`m≠_≥ndög_bio
(
su≥r
, 
bio
);

3283 if(
ªas⁄
<0){

3284 
	`bio_li°_add
(&
loˇl_li°
, 
bio
);

3285 
loˇl_cou¡
++;

3286 
ªåy_ªas⁄s
[
ªas⁄
*-1]++;

3290 
˛ón_wrôe_cou¡
 +
	`åy_˛ón_£g_wrôe
(
su≥r
);

3293 
˛ón_wrôe_cou¡
 +
	`åy_˛ón_£g_wrôe
(
su≥r
);

3295 if(
loˇl_cou¡
){

3301 
	`•ö_lock_úqßve
(&
≥ndög_mgr
->
lock
, 
f
);

3302 
	`bio_li°_mîge
(&
≥ndög_mgr
->
bios
, &
loˇl_li°
);

3303 
i
=0;i<
loˇl_cou¡
;i++){

3304 
	`©omic64_öc
(&
≥ndög_mgr
->
io_cou¡
);

3306 
	`•ö_u∆ock_úqª°‹e
(&
≥ndög_mgr
->
lock
, 
f
);

3311 if(
˛ón_wrôe_cou¡
 || (!
loˇl_cou¡
 && 
is_wrôe
) ||

3312 (
ªåy_ªas⁄s
[
RES_SEAL
] && 
	`gë_∑πül_£g_Àngth
(
su≥r
, 
WCBUF
))){

3314 
	`upd©e_sync_dódlöe
(
su≥r
);

3324 
	}
}

3327 
	$dm§c_m≠
(
dm_èrgë
 *
ti
, 
bio
 *bio)

3329 
£gmít_hódî
 *
	`unöôülized_v¨
(
£g
);

3330 
bio_˘x
 *
m≠_c⁄ãxt
;

3331 
£˘‹_t
 
bio_cou¡
;

3332 
boﬁ
 
bio_fuŒsize
;

3333 
dm§c_su≥r
 *
su≥r
 = 
ti
->
¥iv©e
;

3334 
≥ndög_m™agî
 *
≥ndög_mgr
 = &
su≥r
->pending_mgr;

3335 #i‚de‡
USE_PENDING_WORKER


3336 
ªt
 = 0;

3339 
m≠_c⁄ãxt
 = 
	`dm_≥r_bio_d©a
(
bio
, 
ti
->
≥r_bio_d©a_size
);

3340 
m≠_c⁄ãxt
->
±r
 = 
NULL
;

3341 
m≠_c⁄ãxt
->
öÊight
 = 0;

3343 i‡(
bio
->
bi_rw
 & 
REQ_DISCARD
) {

3344 
dm_dev
 *
‹igö_dev
 = 
su≥r
->
dev_öfo
.origin_dev;

3345 
	`bio_ªm≠
(
bio
, 
‹igö_dev
, bio->
bi_£˘‹
);

3346 
	`¥ötk
(" WARN: discard command ... \n");

3347  
DM_MAPIO_REMAPPED
;

3351 i‡(
bio
->
bi_rw
 & 
REQ_FLUSH
) {

3353 
	`BUG_ON
(
bio
->
bi_size
);

3354 
	`bio_ídio
(
bio
, 0);

3355  
DM_MAPIO_SUBMITTED
;

3357 
	`queue_b¨rõr_io
(
su≥r
, 
bio
);

3358 
	`upd©e_sync_dódlöe
(
su≥r
);

3359  
DM_MAPIO_SUBMITTED
;

3365 
bio
->
bi_rw
 &~
REQ_SYNC
;

3366 
bio_cou¡
 = 
bio
->
bi_size
 >> 
SECTOR_SHIFT
;

3367 
bio_fuŒsize
 = (
bio_cou¡
 == (1 << 3));

3369 if(!
bio_fuŒsize
)

3370 
	`¥ötk
(" biÿcou¡ = %d se˘‹†\n", ()
bio_cou¡
);

3372 
	`wp_upd©e
(
su≥r
, 
	`bio_d©a_dú
(
bio
), 
REQ_CATEGORY_NORMAL
);

3374 
m≠_c⁄ãxt
->
£q_io
 = 
Ál£
;

3375 #i‡
	`deföed
(
CONFIG_BCACHE
Ë|| deföed(
CONFIG_BCACHE_MODULE
)

3376 
m≠_c⁄ãxt
->
£q_io
 = 
	`dëe˘_£quítül_io
(
su≥r
, 
bio
);

3380 if((
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_VERT
 ||

3381 
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_HORI
)){

3382 if(
	`bio_d©a_dú
(
bio
)){

3389 if(
m≠_c⁄ãxt
->
£q_io
){

3390 
	`©omic_öc
(&
su≥r
->
w°©
.
by∑ss_wrôe_cou¡
);

3393 if(
	`bio_d©a_dú
(
bio
)){

3394 *
±r
 = 
	`km≠_©omic
(
	`bio_∑ge
(
bio
));

3395 
m≠_c⁄ãxt
->
¸c32
 = 
	`¸c32
(17, 
±r
, 
PAGE_SIZE
);

3396 
	`kunm≠_©omic
(
±r
);

3399 
m≠_c⁄ãxt
->
hŸ_io
 = 0;

3401 if(
su≥r
->
∑øm
.
hŸ_idítifiˇti⁄
){

3402 if(!
m≠_c⁄ãxt
->
£q_io
){

3403 
∑gío
 = 
	`ˇlc_ˇche_Æignmít
(
su≥r
, 
bio
->
bi_£˘‹
);

3404 
	`hŸ_fûãr_upd©e
(
su≥r
, 
bio
->
bi_£˘‹
);

3405 
m≠_c⁄ãxt
->
hŸ_io
 = 
	`hŸ_fûãr_check
(
su≥r
, 
∑gío
);

3408 
m≠_c⁄ãxt
->
hŸ_io
 = 1;

3412 if(!
	`bio_d©a_dú
(
bio
)){

3413 
mëablock
 *
mb
 = 
NULL
;

3414 
£gmít_hódî
 *
£g
 = 
NULL
;

3415 
f
;

3416 
ªt
;

3418 
£˘‹_t
 
key
 = 
	`ˇlc_ˇche_Æignmít
(
su≥r
, 
bio
->
bi_£˘‹
);

3420 
	`LOCK
(
su≥r
, 
f
);

3421 
mb
 = 
	`ht_lookup
(
su≥r
, 
key
);

3422 i‡(!
mb
) {

3423 if(
su≥r
->
∑øm
.
íabÀ_ªad_ˇche
){

3424 
ˇche_m™agî
 *
˛ón_ˇche
 = 
su≥r
->
˛ón_døm_ˇche_m™agî
;

3425 
Ãu_Êags
;

3426 
Ãu_node
 *
 
 = 
NULL
;

3428 
	`•ö_lock_úqßve
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

3429 
 
 = 
	`CACHE_SEARCH
(
˛ón_ˇche
, 
key
);

3430 if(
 
 && 
	`©omic_ªad
(& ->
£Æed
Ë&& !©omic_ªad(& ->
locked
)){

3431 
	`•ö_u∆ock_úqª°‹e
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

3432 
	`UNLOCK
(
su≥r
, 
f
);

3433 
	`bio_ídio
(
bio
, 0);

3434  
DM_MAPIO_SUBMITTED
;

3435 }if(!
 
){

3436 if(
˛ón_ˇche
->
cm_‰ì
){

3437 
 
 = 
	`CACHE_ALLOC
(
˛ón_ˇche
,Ün, 
key
);

3438 
	`CACHE_INSERT
(
˛ón_ˇche
, 
 
);

3439 
	`©omic_£t
(&
 
->
£Æed
, 0);

3440 
	`©omic_£t
(&
 
->
locked
, 0);

3441 
	`•ö_u∆ock_úqª°‹e
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

3442  
	`¥o˚ss_ªad_miss_ªque°
(
su≥r
, 
bio
, 
f
);

3445 
	`•ö_u∆ock_úqª°‹e
(&
˛ón_ˇche
->
lock
, 
Ãu_Êags
);

3449 
£g
 = 
	`gë_£gmít_hódî_by_mb_idx
(
su≥r
, 
mb
->
idx
);

3450 
ªt
 = 
	`¥ïro˚ss_≥ndög_bio
(
su≥r
, 
£g
, 
bio
, 
mb
, 0);

3451 if(
ªt
==0){

3452 
	`upd©e_°©
(
su≥r
, 
mb
, 0);

3453 
	`¥o˚ss_ªad_hô_ªque°
(
su≥r
, 
bio
, 
£g
, 
mb
, 
f
);

3454  
DM_MAPIO_SUBMITTED
;

3458 
	`UNLOCK
(
su≥r
, 
f
);

3462 #ifde‡
USE_PENDING_WORKER


3464 
	`≥ndög_bio_add
(
su≥r
, 
bio
);

3465 
	`queue_w‹k
(
≥ndög_mgr
->
wq
, &≥ndög_mgr->
w‹k
);

3468 if(!
	`©omic64_ªad
(&
≥ndög_mgr
->
io_cou¡
)){

3469 
ªt
 = 
	`m≠_≥ndög_bio
(
su≥r
, 
bio
);

3470 if(
ªt
<0){

3471 
	`≥ndög_bio_add
(
su≥r
, 
bio
);

3472 
	`queue_w‹k
(
≥ndög_mgr
->
wq
, &≥ndög_mgr->
w‹k
);

3475 
	`≥ndög_bio_add
(
su≥r
, 
bio
);

3476 
	`queue_w‹k
(
≥ndög_mgr
->
wq
, &≥ndög_mgr->
w‹k
);

3480  
DM_MAPIO_SUBMITTED
;

3481 
	}
}

3484 
	$do_background_gc
(
dm§c_su≥r
 *
su≥r
){

3485 
migøti⁄_m™agî
 *
migøã_mgr
 = &
su≥r
->migrate_mgr;

3487 
migøã_mgr
->
Ælow_migøã
 = 1;

3488 
	`©omic_£t
(&
migøã_mgr
->
background_gc_⁄
, 1);

3489 if(!
	`©omic_ªad
(&
migøã_mgr
->
migøã_åiggîed
)){

3490 
	`©omic_£t
(&
migøã_mgr
->
migøã_åiggîed
, 1);

3491 
	`wake_up_¥o˚ss
(
migøã_mgr
->
d´m⁄
);

3493 
	}
}

3495 
	$do_grow
(
dm§c_su≥r
 *
su≥r
){

3497 
i
;

3498 
‹g_ˇches
 = 
NUM_SSD
;

3499 
‹g_°rùe_sz
 = 
STRIPE_SZ
;

3500 
ømbuf„r
 *
ømbuf
[
NBUF
];

3501 
£gmít_hódî
 *
£gs
[
NBUF
];

3502 
£gmít_hódî
 *
£g
;

3503 
group_hódî
 *
group
;

3504 
f
;

3505 
œrge_¨øy
 *
mëablock_¨øy
;

3507 if(!
su≥r
->
dev_öfo
.
num_•¨e_ˇche_devs
){

3508 
	`¥ötk
(" No more drive for growing \n");

3511 
	`©omic_£t
(&
su≥r
->
ªsize_mode
, 1);

3513 
	`©omic_ªad
(&
su≥r
->
ˇche_°©
.
öÊight_ios
)){

3514 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(1000));

3517 
su≥r
->
migøã_mgr
.
Ælow_migøã
 = 0;

3519 
	`©omic_ªad
(&
su≥r
->
migøã_mgr
.
mig_öÊights
)){

3520 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(1000));

3523 
	`©omic_ªad
(&
su≥r
->
Êush_mgr
.
övoke_cou¡
)){

3524 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(1000));

3527 
	`©omic_ªad
(&
su≥r
->
migøã_mgr
.
migøã_åiggîed
))

3528 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(1000));

3530 
	`©omic64_ªad
(&
su≥r
->
≥ndög_mgr
.
io_cou¡
))

3531 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(1000));

3533 
	`LOCK
(
su≥r
, 
f
);

3534 
i
 = 0;ò< 
NBUF
-1;i++){

3535 if(
su≥r
->
cuºít_£g
[
i
] && 
	`©omic_ªad
(&su≥r->cuºít_£g[i]->
Àngth
)){

3536 
£gs
[
i
] = 
su≥r
->
cuºít_£g
[i];

3537 
ømbuf
[
i
] = 
su≥r
->
£gbuf_mgr
.
cuºít_ømbuf
[i];

3539 
£gs
[
i
] = 
NULL
;

3540 
ømbuf
[
i
] = 
NULL
;

3543 
	`UNLOCK
(
su≥r
, 
f
);

3545 
i
 = 0;ò< 
NBUF
-1;i++){

3546 if(
£gs
[
i
]){

3547 
	`¥ötk
(" makêÊush job segÅy≥ = %d, seg id %dÜígth = %d \n", 
i
, ()
£gs
[i]->
£g_id
, ()
	`©omic_ªad
(&£gs[i]->
Àngth
));

3552 
	`©omic_ªad
(&
su≥r
->
Êush_mgr
.
övoke_cou¡
)){

3553 
Êush_övoke_job
 *
job
;

3554 
£gmít_hódî
 *
£g
;

3555 
Êags
;

3556 
	`•ö_lock_úqßve
(&
su≥r
->
Êush_mgr
.
lock
, 
Êags
);

3557 
	`li°_f‹_óch_íåy
(
job
, &
su≥r
->
Êush_mgr
.
queue
, 
li°
){

3558 
£g
 = 
job
->seg;

3559 
	`¥ötk
(" makêÊush job segÅy≥ = %d, seg id %dÜígth = %d \n", 
£g
->
£g_ty≥
, ()£g->
£g_id
, ()
	`©omic_ªad
(&£g->
Àngth
));

3561 
	`•ö_u∆ock_úqª°‹e
(&
su≥r
->
Êush_mgr
.
lock
, 
Êags
);

3563 
	`¥ötk
(" flush queuêcou¡ = %d \n", ()
	`©omic_ªad
(&
su≥r
->
Êush_mgr
.
övoke_cou¡
));

3564 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(1000));

3567 
	`¥ötk
(" Resizing metadata ... \n");

3569 
i
 = 0;ò< 
NBUF
-1;i++){

3570 if(
£gs
[
i
]){

3571 
	`¥ötk
(" ch™gê°©u†£gÅy≥ = %d, seg id %dÜígth = %d \n", 
i
, ()
£gs
[i]->
£g_id
, ()
	`©omic_ªad
(&£gs[i]->
Àngth
));

3573 
£g
 = 
£gs
[
i
];

3574 
	`ch™ge_£g_°©us
(
su≥r
, 
£g
, 
	`©omic_ªad
(&£g->
Àngth
), 1);

3578 
	`¥ötk
(" metablockálloc \n");

3579 
mëablock_¨øy
 =

3580 
	`œrge_¨øy_Æloc
((
mëablock
), 
NUM_BLOCKS_PER_SSD
);

3581 i‡(!
mëablock_¨øy
) {

3582 
	`WBERR
();

3586 
	`LOCK
(
su≥r
, 
f
);

3588 
su≥r
->
dev_öfo
.
ˇche_dev
[
NUM_SSD
] = su≥r->dev_öfo.
•¨e_ˇche_dev
[0];

3589 
NUM_SSD
++;

3591 
group
 = 
su≥r
->
cuºít_group
;

3592 if(
group
){

3593 
	`©omic_£t
(&
group
->
num_u£d_ssd
, 
NUM_SSD
);

3596 
i
 = 0;ò< 
su≥r
->
dev_öfo
.
num_•¨e_ˇche_devs
-1;i++){

3597 
su≥r
->
dev_öfo
.
•¨e_ˇche_dev
[
i
] = super->dev_info.spare_cache_dev[i+1];

3599 
su≥r
->
dev_öfo
.
•¨e_ˇche_dev
[
i
] = 
NULL
;

3600 
su≥r
->
dev_öfo
.
num_•¨e_ˇche_devs
--;

3601 
	`¥ötk
(" Num S∑ª SSD†%d \n", 
su≥r
->
dev_öfo
.
num_•¨e_ˇche_devs
);

3604 
su≥r
->
mëablock_¨øy
[
NUM_SSD
-1] =

3605 
	`œrge_¨øy_Æloc
((
mëablock
), 
NUM_BLOCKS_PER_SSD
);

3606 i‡(!
su≥r
->
mëablock_¨øy
[
NUM_SSD
-1]) {

3607 
	`WBERR
();

3611 
su≥r
->
mëablock_¨øy
[
NUM_SSD
-1] = metablock_array;

3614 
	`¥ötk
(" init meta block ... \n");

3615 
i
 = 0; i < 
NUM_BLOCKS
; i++) {

3616 
mëablock
 *
mb
 = 
	`mb_©
(
su≥r
, 
i
);

3617 
ssdno
 = 
	`gë_devno
(
su≥r
, 
i
);

3619 
mb
->
idx
 = 
i
;

3621 if(
ssdno
 =
NUM_SSD
-1){

3622 
	`INIT_HLIST_NODE
(&
mb
->
ht_li°
);

3623 
	`˛ór_bô
(
MB_DIRTY
, &
mb
->
mb_Êags
);

3624 
	`˛ór_bô
(
MB_VALID
, &
mb
->
mb_Êags
);

3625 
	`˛ór_bô
(
MB_SEAL
, &
mb
->
mb_Êags
);

3626 
	`˛ór_bô
(
MB_PARITY
, &
mb
->
mb_Êags
);

3627 
	`˛ór_bô
(
MB_BROKEN
, &
mb
->
mb_Êags
);

3628 
	`˛ór_bô
(
MB_SUMMARY
, &
mb
->
mb_Êags
);

3629 
	`˛ór_bô
(
MB_PARITY_NEED
, &
mb
->
mb_Êags
);

3630 
	`˛ór_bô
(
MB_PARITY_WRITTEN
, &
mb
->
mb_Êags
);

3631 
	`˛ór_bô
(
MB_HIT
, &
mb
->
mb_Êags
);

3632 
	`˛ór_bô
(
MB_SKIP
, &
mb
->
mb_Êags
);

3633 
	`˛ór_bô
(
MB_DUMMY
, &
mb
->
mb_Êags
);

3634 
	`hli°_add_hód
(&
mb
->
ht_li°
, &
su≥r
->
nuŒ_hód
->ht_list);

3638 if(
	`USE_ERASURE_CODE
(&
su≥r
->
∑øm
))

3639 
	`øid_c⁄f_öô
(
su≥r
, &su≥r->
øid_c⁄f
);

3641 
i
 = 0;ò< 
NBUF
;i++){

3642 
	`Æloc_ømbuf_∑ge
(
su≥r
, su≥r->
£gbuf_mgr
.
cuºít_ømbuf
[
i
], i);

3646 
i
 = 0;ò< 
NBUF
-1;i++){

3647 if(
£gs
[
i
]){

3648 
	`¥ötk
("áŒo¯√w segmíà... %d \n", 
i
);

3649 
	`Æloc_√w_£gmít
(
su≥r
, 
i
, 
Ál£
);

3651 
	`¥ötk
(" m®öô ... %d \n", 
i
);

3652 if(
su≥r
->
cuºít_£g
[
i
]) {

3653 
	`¥ötk
(" maÑeset .. \n");

3654 
	`ma_ª£t
(
su≥r
, su≥r->
cuºít_£g
[
i
]->
£g_id
, i);

3656 
	`¥ötk
(" m®öô ... %d \n", 
i
);

3660 
	`¥ötk
("ássigneÇew segment .. \n");

3661 
	`assign_√w_£gmít
(
su≥r
);

3664 
	`UNLOCK
(
su≥r
, 
f
);

3666 
	`©omic_£t
(&
su≥r
->
ªsize_mode
, 0);

3667 
	`¥ötk
(" Growing drives is complete\n");

3668 
	`¥ötk
(" Nÿo‡ˇches: (%d->%d)\n", 
‹g_ˇches
, 
NUM_SSD
);

3669 
	`¥ötk
(" Såùêsiz : (%d->%d)\n", 
‹g_°rùe_sz
, 
STRIPE_SZ
);

3670 
	`¥öt_Æloc_queue
(
su≥r
);

3672 
	}
}

3675 
	$dm§c_íd_io
(
dm_èrgë
 *
ti
, 
bio
 *bio, 
îr‹
)

3677 
dm§c_su≥r
 *
su≥r
 = 
ti
->
¥iv©e
;

3678 
£gmít_hódî
 *
£g
;

3679 
bio_˘x
 *
m≠_c⁄ãxt
 =

3680 
	`dm_≥r_bio_d©a
(
bio
, 
ti
->
≥r_bio_d©a_size
);

3682 if(
m≠_c⁄ãxt
->
öÊight
){

3683 
	`©omic_dec
(&
su≥r
->
ˇche_°©
.
öÊight_ios
);

3686 i‡(!
m≠_c⁄ãxt
->
±r
)

3689 
£g
 = 
m≠_c⁄ãxt
->
±r
;

3690 
	`©omic_dec
(&
£g
->
num_ªad_öÊight
);

3694 
	}
}

3696 
	$c⁄sume_es£¡ül_¨gv
(
dm§c_su≥r
 *
su≥r
, 
¨gc
, **
¨gv
)

3698 
dm_¨g
 
_¨gs
[] = {

3700 {1, 
MAX_CACHE_DEVS
, "invalidÇum caches devs"},

3703 
dm_èrgë
 *
ti
 = 
su≥r
->ti;

3704 
dm_¨g_£t
 
as
;

3705 c⁄° *
°r
;

3706 
tmp
;

3707 
r
 = 0, 
i
 = 0;

3709 
as
.
¨gc
 =árgc;

3710 
as
.
¨gv
 =árgv;

3712 
r
 = 
	`dm_ªad_¨g
(
_¨gs
, &
as
, &
tmp
, &
ti
->
îr‹
);

3713 i‡(
r
)

3714  
r
;

3716 
°r
 = 
	`dm_shi·_¨g
(&
as
);

3717 
	`°r˝y
(
su≥r
->
dev_öfo
.
‹igö_«me
, 
°r
);

3719 
r
 = 
	`dm_ªad_¨g
(&
_¨gs
[1], &
as
, &
tmp
, &
ti
->
îr‹
);

3720 i‡(
r
)

3721  
r
;

3723 
su≥r
->
dev_öfo
.
num_ˇche_devs
 = 
tmp
;

3724 
i
 = 0;ò< 
tmp
;i++){

3725 
	`°r˝y
(
su≥r
->
dev_öfo
.
ˇche_«me
[
i
], 
	`dm_shi·_¨g
(&
as
));

3728  
r
;

3729 
	}
}

3731 
	#c⁄sume_kv
(
«me
, 
ƒ
) \

3732 i‡(!
	`°rˇ£cmp
(
key
, #name)) { \

3733 i‡(!
¨gc
) \

3735 
r
 = 
	`dm_ªad_¨g
(
_¨gs
 + (
ƒ
), 
as
, &
tmp
, &
ti
->
îr‹
); \

3736 i‡(
r
) \

3738 
su≥r
->
∑øm
.
«me
 = 
tmp
; \

3739 
	`¥ötk
(" %†%u \n", #«me, 
tmp
);\

3740 }

	)

3742 
	#c⁄sume_kv_°r
(
«me
, 
ƒ
) \

3743 i‡(!
	`°rˇ£cmp
(
key
, #name)) { \

3744 *
°r
; \

3745 i‡(!
¨gc
) \

3747 
°r
 = 
	`dm_shi·_¨g
(
as
);\

3748 
	`¥ötk
(" %†%†\n", #«me, 
°r
);\

3749 }

	)

3753 
	$do_add_•¨e
(
dm§c_su≥r
 *
su≥r
, 
dm_¨g_£t
 *
as
, 
¨gc
){

3754 
dm_èrgë
 *
ti
 = 
su≥r
->ti;

3755 
dm_dev
 *
dev
;

3756 *
°r
;

3757 
r
 = 0;

3759 i‡(!
¨gc
)

3762 
°r
 = (*)
	`dm_shi·_¨g
(
as
);

3763 
	`¥ötk
("ádd_•¨ê%†[%d] \n", 
°r
, ()
su≥r
->
dev_öfo
.
num_•¨e_ˇche_devs
);

3764 
r
 = 
	`dm_gë_devi˚
(
ti
, 
°r
, 
	`dm_èbÀ_gë_mode
—i->
èbÀ
),

3765 &
su≥r
->
dev_öfo
.
•¨e_ˇche_dev
[su≥r->dev_öfo.
num_•¨e_ˇche_devs
]);

3766 i‡(
r
) {

3767 
ti
->
îr‹
 = "couldn't get spare dev";

3768 
	`¥ötk
(" couldn'àgë s∑ª dev %s\n", 
°r
);

3769  
r
;

3772 
dev
 = 
su≥r
->
dev_öfo
.
•¨e_ˇche_dev
[su≥r->dev_öfo.
num_•¨e_ˇche_devs
];

3773 if(
	`dm§c_devsize_£˘‹s
(
dev
)<
su≥r
->
dev_öfo
.
≥r_ssd_£˘‹s
){

3774 
	`dm_put_devi˚
(
ti
, 
dev
);

3775 
ti
->
îr‹
 = "spare drv is smallerÅhan current drv!";

3776 
	`¥ötk
(" s∑ª drivêi†smÆÀ∏th™ cuºíàdrivê%s\n", 
°r
);

3777  
r
;

3781 
su≥r
->
dev_öfo
.
num_•¨e_ˇche_devs
++;

3784 
	}
}

3786 
	$do_c⁄sume_tu«bÀ_¨gv
(
dm_èrgë
 *
ti
,

3787 
dm_¨g_£t
 *
as
, 
¨gc
)

3789 
dm_¨g
 
_¨gs
[] = {

3798 {
SEQ_CUTOFF_MIN
, 
SEQ_CUTOFF_MAX
, "invalid sequential_cutoff size (bytes)"},

3812 
dm§c_su≥r
 *
su≥r
 = 
ti
->
¥iv©e
;

3813 
r
 = 0;

3814 
tmp
;

3816 
¨gc
) {

3817 c⁄° *
key
 = 
	`dm_shi·_¨g
(
as
);

3818 
¨gc
--;

3820 
r
 = -
EINVAL
;

3822 
	`c⁄sume_kv
(
sync_öãrvÆ
, 6);

3823 
	`c⁄sume_kv
(
£quítül_íabÀ
, 7);

3824 
	`c⁄sume_kv
(
£quítül_cutoff
, 8);

3825 
	`c⁄sume_kv
(
vi˘im_pﬁicy
, 9);

3826 
	`c⁄sume_kv
(
ª˛aim_pﬁicy
, 10);

3827 
	`c⁄sume_kv
(
u_max
, 11);

3828 
	`c⁄sume_kv
(
gc_wôh_dútysync
, 12);

3829 
	`c⁄sume_kv
(
max_migøã_öÊights
, 13);

3830 
	`c⁄sume_kv
(
migøã_loww©î
, 14);

3831 
	`c⁄sume_kv
(
migøã_highw©î
, 15);

3832 
	`c⁄sume_kv
(
hô_bôm≠_ty≥
, 16);

3833 
	`c⁄sume_kv
(
bio_∂uggög
, 17);

3834 
	`c⁄sume_kv
(
íabÀ_ªad_ˇche
, 18);

3835 
	`c⁄sume_kv
(
hŸ_idítifiˇti⁄
, 19);

3837 if(
su≥r
->
∑øm
.
migøã_loww©î
>=su≥r->∑øm.
migøã_highw©î
){

3838 
su≥r
->
∑øm
.
migøã_loww©î
 = su≥r->∑øm.
migøã_highw©î
;

3839 
su≥r
->
∑øm
.
migøã_highw©î
++;

3842 i‡(!
	`°rˇ£cmp
(
key
, "add_spare")) {

3843 
r
 = 
	`do_add_•¨e
(
su≥r
, 
as
, 
¨gc
);

3844 if(
r
)

3845  
r
;

3849 i‡(!
	`°rˇ£cmp
(
key
, "grow")) {

3850 
r
 = 0;

3851 
	`¥ötk
(" growing # of drives \n");

3852 
	`do_grow
(
su≥r
);

3855 i‡(!
	`°rˇ£cmp
(
key
, "gc")) {

3856 
r
 = 0;

3857 
	`¥ötk
(" background GC \n");

3858 
	`do_background_gc
(
su≥r
);

3861 i‡(!
r
) {

3862 
¨gc
--;

3864 
ti
->
îr‹
 = "invalid optional key";

3869  
r
;

3870 
	}
}

3875 
	$x‹_8ªgs_4_2
(
byãs
, *
p1
, *
p2
,

3876 *
p3
, *
p4
)

3878 
löes
 = 
byãs
 / ( ()) / 8;

3881 
p1
[0] ^
p2
[0] ^ 
p3
[0] ^ 
p4
[0];

3882 
p1
[1] ^
p2
[1] ^ 
p3
[1] ^ 
p4
[1];

3883 
p1
[2] ^
p2
[2] ^ 
p3
[2] ^ 
p4
[2];

3884 
p1
[3] ^
p2
[3] ^ 
p3
[3] ^ 
p4
[3];

3885 
p1
[4] ^
p2
[4] ^ 
p3
[4] ^ 
p4
[4];

3886 
p1
[5] ^
p2
[5] ^ 
p3
[5] ^ 
p4
[5];

3887 
p1
[6] ^
p2
[6] ^ 
p3
[6] ^ 
p4
[6];

3888 
p1
[7] ^
p2
[7] ^ 
p3
[7] ^ 
p4
[7];

3890 
p1
 += 8;

3891 
p2
 += 8;

3892 
p3
 += 8;

3893 
p4
 += 8;

3894 } --
löes
 > 0);

3895 
	}
}

3898 
	$x‹_blocks2
(
§c_cou¡
, 
byãs
, *
de°
, **
§cs
)

3900 *
p1
, *
p2
, *
p3
;

3901 
p1
 = (*Ë
§cs
[0];

3902 
p2
 = (*Ë
§cs
[1];

3903 
p3
 = (*Ë
§cs
[2];

3904 
	`x‹_8ªgs_4_2
(
byãs
, 
de°
, 
p1
, 
p2
, 
p3
);

3905 
	}
}

3907 
	$øid6_duÆ_ªcov
(
disks
, 
size_t
 
byãs
, 
Áûa
, 
Áûb
, **
±rs
)

3909 i‡–
Áûa
 > 
Áûb
 ) {

3910 
tmp
 = 
Áûa
;

3911 
Áûa
 = 
Áûb
;

3912 
Áûb
 = 
tmp
;

3915 i‡–
Áûb
 =
disks
-1 ) {

3916 i‡–
Áûa
 =
disks
-2 ) {

3918 
øid6_ˇŒ
.
	`gí_syndrome
(
disks
, 
byãs
, 
±rs
);

3925 i‡–
Áûb
 =
disks
-2 ) {

3927 
	`øid6_d©≠_ªcov
(
disks
, 
byãs
, 
Áûa
, 
±rs
);

3930 
	`øid6_2d©a_ªcov
(
disks
, 
byãs
, 
Áûa
, 
Áûb
, 
±rs
);

3933 
	}
}

3935 
	$pq_ã°
(
dm§c_su≥r
 *
su≥r
){

3936 
	#NUM_DISKS
 5

	)

3937 *
§c
[
NUM_DISKS
];

3938 *
d°
;

3939 
i
;

3940 *
öç
;

3942 
	`¥ötk
(" PQÅest ... \n");

3944 
i
 = 0;ò< 
NUM_DISKS
;i++){

3945 
§c
[
i
] = (*Ë
	`gë_zî€d_∑ge
(
GFP_KERNEL
 | 
__GFP_NOTRACK
);

3946 
öç
 = (*)
§c
[
i
];

3947 *
öç
 = 
i
*80 + 20;

3950 
i
 = 0;ò< 
NUM_DISKS
-2;i++){

3951 
öç
 = (*)
§c
[
i
];

3952 
	`¥ötk
(" %d: %d \n", 
i
, *
öç
);

3955 
d°
 = 
§c
[
NUM_DISKS
-1];

3956 
	`mem£t
(
d°
, 0xì, 
SRC_PAGE_SIZE
);

3958 
d°
 = 
§c
[
NUM_DISKS
-2];

3959 
	`mem£t
(
d°
, 0xì, 
SRC_PAGE_SIZE
);

3961 
øid6_ˇŒ
.
	`gí_syndrome
(
NUM_DISKS
, 
SRC_PAGE_SIZE
, 
§c
);

3963 
öç
 = (*)
§c
[0];

3964 *
öç
 = 0;

3965 
öç
 = (*)
§c
[1];

3966 *
öç
 = 0;

3968 
i
 = 0;ò< 
NUM_DISKS
-2;i++){

3969 
öç
 = (*)
§c
[
i
];

3970 
	`¥ötk
(" %d: %d \n", 
i
, *
öç
);

3973 
	`øid6_duÆ_ªcov
(
NUM_DISKS
, 
SRC_PAGE_SIZE
, 0, 1, (**Ë&
§c
);

3975 
i
 = 0;ò< 
NUM_DISKS
-2;i++){

3976 
öç
 = (*)
§c
[
i
];

3977 
	`¥ötk
(" %d: %d \n", 
i
, *
öç
);

3980 
i
 = 0;ò< 
NUM_DISKS
;i++)

3981 
	`‰ì_∑ge
(()
§c
[
i
]);

3983 
	}
}

3985 
	$x‹_ã°
(
dm§c_su≥r
 *
su≥r
){

3986 
	#SRC_LEN
 3

	)

3987 *
§c
[
SRC_LEN
+1];

3988 *
§c2
[
SRC_LEN
+1];

3989 *
d°
;

3990 *
ãmp
;

3991 
i
;

3992 *
öç
;

3995 
i
 = 0;ò< 
SRC_LEN
+1;i++){

3996 
§c
[
i
] = (*Ë
	`gë_zî€d_∑ge
(
GFP_KERNEL
 | 
__GFP_NOTRACK
);

3997 
öç
 = (*)
§c
[
i
];

3998 *
öç
 = 
i
*80 + 20;

4001 
d°
 = 
§c
[
SRC_LEN
];

4002 
öç
 = (*)
d°
;

4003 *
öç
 = 0;

4004 
	`mem£t
(
d°
, 0xFF, 
SRC_PAGE_SIZE
);

4006 
ãmp
 = (*Ë
	`gë_zî€d_∑ge
(
GFP_KERNEL
 | 
__GFP_NOTRACK
);

4007 
öç
 = (*)
ãmp
;

4008 *
öç
 = 0;

4009 
	`mem£t
(
ãmp
, 0xFF, 
SRC_PAGE_SIZE
);

4012 
	`x‹_blocks
(
SRC_LEN
, 
SRC_PAGE_SIZE
, 
d°
, 
§c
);

4013 
	`x‹_blocks
(
SRC_LEN
, 
SRC_PAGE_SIZE
, 
ãmp
, 
§c
);

4015 
i
 = 0;ò< 
SRC_LEN
+1;i++){

4016 
öç
 = (*)
§c
[
i
];

4017 
	`¥ötk
(" %d d©®%u %d \n", 
i
,

4018 
	`¸c32_À
(
CRC_SEED
, 
§c
[
i
], 
SRC_PAGE_SIZE
), *
öç
);

4021 
öç
 = (*)
d°
;

4022 
	`¥ötk
(" dst data %u %d \n",

4023 
	`¸c32_À
(
CRC_SEED
, 
d°
, 
SRC_PAGE_SIZE
), *
öç
);

4024 
öç
 = (*)
ãmp
;

4025 
	`¥ötk
("Åemp data %u %d \n",

4026 
	`¸c32_À
(
CRC_SEED
, 
ãmp
, 
SRC_PAGE_SIZE
), *
öç
);

4028 
i
 = 0;ò< 
SRC_LEN
;i++){

4029 
§c2
[
i
] = 
§c
[i+1];

4032 
	`mem£t
(
ãmp
, 0xFF, 
SRC_PAGE_SIZE
);

4033 
	`x‹_blocks
(
SRC_LEN
, 
SRC_PAGE_SIZE
, 
ãmp
, 
§c2
);

4035 
öç
 = (*)
ãmp
;

4036 
	`¥ötk
("Ñecovered data %u %d \n",

4037 
	`¸c32_À
(
CRC_SEED
, 
ãmp
, 
SRC_PAGE_SIZE
), *
öç
);

4039 if(
	`memcmp
(
ãmp
, 
§c
[0], 
SRC_PAGE_SIZE
)){

4040 
	`¥ötk
(" ***Öarity mismatch ******\n");

4043 
i
 = 0;ò< 
SRC_LEN
+1;i++)

4044 
	`‰ì_∑ge
(()
§c
[
i
]);

4046 
	`‰ì_∑ge
(()
ãmp
);

4047 
	}
}

4049 
	$£t_deÁu…_∑øm
(
dm§c_su≥r
 *
su≥r
, 
dm§c_∑øm
 *
∑øm
){

4051 
∑øm
->
íabÀ_ªad_ˇche
 = 1;

4053 
∑øm
->
îasuª_code
 = 
ERASURE_CODE_NONE
;

4056 
∑øm
->
∑rôy_Æloˇti⁄
 = 
PARITY_ALLOC_FIXED
;

4060 
∑øm
->
d©a_Æloˇti⁄
 = 
DATA_ALLOC_HORI
;

4061 
∑øm
->
Æig√d_io_dummy
 = 
ALIGNED_IO_DUMMY
;

4066 
∑øm
->
°rùög_pﬁicy
 = 
SEPAR_STRIPING
;

4069 
∑øm
->
hô_bôm≠_ty≥
 = 
HIT_BITMAP_PER_STRIPE
;

4071 
∑øm
->
gc_wôh_dútysync
 = 
GC_WITHOUT_DIRTY_SYNC
;

4072 
∑øm
->
£quítül_íabÀ
 = 1;

4073 
∑øm
->
u_max
 = 
DEFAULT_U_MAX
;

4075 
∑øm
->
chunk_size
 = 2048;

4076 
∑øm
->
ømbuf_poﬁ_amou¡
 = 2048;

4077 
∑øm
->
ª˛aim_pﬁicy
 = 
RECLAIM_DESTAGE
;

4078 
∑øm
->
bio_∂uggög
 = 0;

4079 
∑øm
->
hŸ_idítifiˇti⁄
 = 1;

4080 
∑øm
->
£quítül_cutoff

SEQ_CUTOFF
;

4082 
∑øm
->
max_migøã_öÊights
 = 
MAX_MIGRATE_INFLIGHT_NUM
;

4086 
su≥r
->
∑øm
.
checkî_öãrvÆ
 = 20;

4091 
	}
}

4093 
	$øid_c⁄f_öô
(
dm§c_su≥r
 *
su≥r
, 
r5c⁄f
 *
c⁄f
){

4095 
	`mem£t
(
c⁄f
, 0x00, (
r5c⁄f
));

4097 
c⁄f
->
Æg‹ôhm
 = 
ALGORITHM_LEFT_SYMMETRIC
;

4098 
c⁄f
->
chunk_£˘‹s
 = 
CHUNK_SZ_SECTOR
;

4100 if(
	`USE_ERASURE_PARITY
(&
su≥r
->
∑øm
)){

4101 if(
su≥r
->
∑øm
.
∑rôy_Æloˇti⁄
==
PARITY_ALLOC_FIXED
){

4102 
c⁄f
->
Àvñ
 = 4;

4103 
c⁄f
->
øid_disks
 = 
NUM_SSD
-1;

4105 
c⁄f
->
Àvñ
 = 5;

4106 
c⁄f
->
øid_disks
 = 
NUM_SSD
;

4110 if(
	`USE_ERASURE_RAID6
(&
su≥r
->
∑øm
)){

4111 
c⁄f
->
Àvñ
 = 6;

4112 
c⁄f
->
øid_disks
 = 
NUM_SSD
;

4115 
	}
}

4117 
	$ª£t_¨rivÆ_time
(
dm§c_su≥r
 *
su≥r
){

4118 
≥ndög_m™agî
 *
≥ndög_mgr
 = &
su≥r
->pending_mgr;

4119 
i
;

4121 
i
 = 0;ò< 
MAX_ARRIVAL_TIME
;i++){

4122 
≥ndög_mgr
->
¨rivÆ_times
[
i
].
tv_£c
 = 0;

4123 
≥ndög_mgr
->
¨rivÆ_times
[
i
].
tv_n£c
 = 0;

4126 
	`©omic_£t
(&
≥ndög_mgr
->
¨rivÆ_°¨t
, 0);

4127 
	`©omic_£t
(&
≥ndög_mgr
->
¨rivÆ_cou¡
, 0);

4128 
	`©omic_£t
(&
≥ndög_mgr
->
¨rivÆ_cur
, 0);

4129 
	}
}

4131 
	$≥ndög_mgr_öô
(
dm§c_su≥r
 *
su≥r
){

4132 
≥ndög_m™agî
 *
≥ndög_mgr
 = &
su≥r
->pending_mgr;

4133 
r
 = 0;

4135 
≥ndög_mgr
->
su≥r
 = super;

4136 
	`•ö_lock_öô
(&
≥ndög_mgr
->
b¨rõr_lock
);

4137 
	`bio_li°_öô
(&
≥ndög_mgr
->
b¨rõr_ios
);

4138 
	`©omic_£t
(&
≥ndög_mgr
->
b¨rõr_cou¡
, 0);

4140 
	`•ö_lock_öô
(&
≥ndög_mgr
->
lock
);

4141 
	`©omic64_£t
(&
≥ndög_mgr
->
io_cou¡
, 0);

4142 
	`bio_li°_öô
(&
≥ndög_mgr
->
bios
);

4144 
	`ª£t_¨rivÆ_time
(
su≥r
);

4148 
≥ndög_mgr
->
wq
 = 
	`¸óã_sögÀthªad_w‹kqueue
("pending_wq");

4149 i‡(!
≥ndög_mgr
->
wq
) {

4150 
	`WBERR
("failedÅoállocÑead caching wq");

4151 
r
 = -1;

4152 
bad_öô
;

4155 
	`INIT_WORK
(&
≥ndög_mgr
->
w‹k
, 
≥ndög_w‹kî
);

4157 
≥ndög_mgr
->
wb_job_poﬁ
 = 
	`mempoﬁ_¸óã_kmÆloc_poﬁ
(
STRIPE_SZ
,

4158 (
wb_job
));

4159 i‡(!
≥ndög_mgr
->
wb_job_poﬁ
) {

4160 
r
 = -
ENOMEM
;

4161 
	`WBERR
("couldn'tálloc flush jobÖool");

4162 
bad_öô
;

4165 
≥ndög_mgr
->
öôülized
 = 1;

4166 
bad_öô
:

4167  
r
;

4168 
	}
}

4170 
	$≥ndög_mgr_exô
(
dm§c_su≥r
 *
su≥r
){

4171 if(!
su≥r
->
≥ndög_mgr
.
öôülized
)

4174 
	`de°roy_w‹kqueue
(
su≥r
->
≥ndög_mgr
.
wq
);

4175 
	`mempoﬁ_de°roy
(
su≥r
->
≥ndög_mgr
.
wb_job_poﬁ
);

4176 
	}
}

4178 
	$£q_dëe˘‹_öô
(
dm§c_su≥r
 *
su≥r
){

4179 
£q_io_dëe˘‹
 *
£q_dëe˘‹
 = &
su≥r
->seq_detector;

4180 
io
 *io;

4182 
	`INIT_LIST_HEAD
(&
£q_dëe˘‹
->
io_Ãu
);

4184 
	`•ö_lock_öô
(&
£q_dëe˘‹
->
£q_lock
);

4185 
io
 = 
£q_dëe˘‹
->io; iÿ< seq_dëe˘‹->iÿ+ 
RECENT_IO
; io++) {

4186 
	`li°_add
(&
io
->
Ãu
, &
£q_dëe˘‹
->
io_Ãu
);

4187 
	`hli°_add_hód
(&
io
->
hash
, 
£q_dëe˘‹
->
io_hash
 + 
RECENT_IO
);

4189 
	}
}

4191 
	$°©_öô
(
dm§c_su≥r
 *
su≥r
){

4192 
su≥r
->
w°©
.
cou¡
=0;

4193 
su≥r
->
w°©
.
hô
=0;

4194 
su≥r
->
w°©
.
ªad_cou¡
=0;

4195 
su≥r
->
w°©
.
ªad_hô
=0;

4196 
su≥r
->
w°©
.
wrôe_cou¡
=0;

4197 
su≥r
->
w°©
.
wrôe_hô
=0;

4198 
	`©omic_£t
(&
su≥r
->
w°©
.
de°age_cou¡
, 0);

4199 
	`©omic_£t
(&
su≥r
->
w°©
.
gc_cou¡
, 0);

4200 
	`©omic_£t
(&
su≥r
->
w°©
.
tŸÆ_migøti⁄
, 0);

4201 
	`©omic_£t
(&
su≥r
->
w°©
.
cﬁd_by∑ss_cou¡
, 0);

4202 
	`©omic_£t
(&
su≥r
->
w°©
.
£q_by∑ss_cou¡
, 0);

4204 
	`©omic64_£t
(&
su≥r
->
w°©
.
avîage_¨rivÆ_time
, 0);

4205 
	`©omic64_£t
(&
su≥r
->
w°©
.
avîage_¨rivÆ_cou¡
, 0);

4206 
	}
}

4208 
	$£g_Æloˇt‹_öô
(
dm§c_su≥r
 *
su≥r
){

4209 
£gmít_Æloˇt‹
 *
£g_Æloˇt‹
 = &
su≥r
->seg_allocator;

4211 
	`öô_waôqueue_hód
(&
£g_Æloˇt‹
->
Æloc_waô_queue
);

4213 
	`INIT_LIST_HEAD
(&
£g_Æloˇt‹
->
group_Æloc_queue
);

4214 
	`INIT_LIST_HEAD
(&
£g_Æloˇt‹
->
group_migøã_queue
);

4215 
	`INIT_LIST_HEAD
(&
£g_Æloˇt‹
->
group_u£d_queue
);

4216 
	`INIT_LIST_HEAD
(&
£g_Æloˇt‹
->
group_£Æed_queue
);

4218 
	`©omic_£t
(&
£g_Æloˇt‹
->
group_Æloc_cou¡
, 0);

4219 
	`©omic_£t
(&
£g_Æloˇt‹
->
group_migøã_cou¡
, 0);

4220 
£g_Æloˇt‹
->
group_u£d_cou¡
 = 0;

4221 
£g_Æloˇt‹
->
group_£Æed_cou¡
 = 0;

4223 
	`INIT_LIST_HEAD
(&
£g_Æloˇt‹
->
£g_Æloc_queue
);

4224 
	`INIT_LIST_HEAD
(&
£g_Æloˇt‹
->
£g_migøã_queue
);

4225 
	`INIT_LIST_HEAD
(&
£g_Æloˇt‹
->
£g_u£d_queue
);

4226 
	`INIT_LIST_HEAD
(&
£g_Æloˇt‹
->
£g_£Æed_queue
);

4228 
	`©omic_£t
(&
£g_Æloˇt‹
->
£g_Æloc_cou¡
, 0);

4229 
	`©omic_£t
(&
£g_Æloˇt‹
->
£g_migøã_cou¡
, 0);

4230 
£g_Æloˇt‹
->
£g_u£d_cou¡
 = 0;

4231 
£g_Æloˇt‹
->
£g_£Æed_cou¡
 = 0;

4232 
	}
}

4235 
	$Êush_mgr_öô
(
dm§c_su≥r
 *
su≥r
){

4236 
Êush_m™agî
 *
Êush_mgr
 = &
su≥r
->flush_mgr;

4237 
r
 = 0;

4239 
	`•ö_lock_öô
(&
Êush_mgr
->
lock
);

4240 
	`©omic_£t
(&
Êush_mgr
->
övoke_cou¡
, 0);

4241 
	`©omic_£t
(&
Êush_mgr
->
io_cou¡
, 0);

4242 
	`©omic64_£t
(&
Êush_mgr
->
globÆ_£g_£quí˚
, 0);

4243 
	`INIT_LIST_HEAD
(&
Êush_mgr
->
queue
);

4245 
r
 = 
	`¸óã_d´m⁄
(
su≥r
, &
Êush_mgr
->
d´m⁄
, 
Êush_mëa_¥oc
, "flush_meta_daemon");

4246 if(
r
)

4247 
bad_öô
;

4249 
Êush_mgr
->
övoke_poﬁ
 = 
	`mempoﬁ_¸óã_kmÆloc_poﬁ
(100,

4250 (
Êush_övoke_job
));

4251 i‡(!
Êush_mgr
->
övoke_poﬁ
) {

4252 
r
 = -
ENOMEM
;

4253 
	`WBERR
("couldn'tálloc flush jobÖool");

4254 
bad_öô
;

4257 
Êush_mgr
->
öôülized
 = 1;

4259  
r
;

4261 
bad_öô
:

4262  
r
;

4264 
	}
}

4266 
	$Êush_mgr_deöô
(
dm§c_su≥r
 *
su≥r
){

4267 if(!
su≥r
->
Êush_mgr
.
öôülized
)

4270 
	`¥ötk
(" flushÖartial meta .. \n");

4271 
	`Êush_∑πül_mëa
(
su≥r
, 
WHBUF
);

4272 
	`¥ötk
(" flushÖartial meta .. \n");

4273 
	`Êush_∑πül_mëa
(
su≥r
, 
WCBUF
);

4274 
	`¥ötk
("Énd flushÖartial meta .. \n");

4276 
	`©omic_ªad
(&
su≥r
->
Êush_mgr
.
övoke_cou¡
)){

4277 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(1000));

4280 
	`©omic_ªad
(&
su≥r
->
Êush_mgr
.
io_cou¡
)){

4281 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(1000));

4284 
	`kthªad_°›
(
su≥r
->
Êush_mgr
.
d´m⁄
);

4285 
	`mempoﬁ_de°roy
(
su≥r
->
Êush_mgr
.
övoke_poﬁ
);

4287 
	}
}

4289 
	$migøã_mgr_öô
(
dm§c_su≥r
 *
su≥r
){

4290 
migøti⁄_m™agî
 *
migøã_mgr
 = &
su≥r
->migrate_mgr;

4291 
r
;

4293 
migøã_mgr
->
su≥r
 = super;

4294 
migøã_mgr
->
Ælow_migøã
 = 
Ál£
;

4296 
	`•ö_lock_öô
(&
migøã_mgr
->
mig_queue_lock
);

4297 
	`•ö_lock_öô
(&
migøã_mgr
->
group_queue_lock
);

4299 
	`INIT_LIST_HEAD
(&
migøã_mgr
->
migøã_queue
);

4300 
	`INIT_LIST_HEAD
(&
migøã_mgr
->
mig_queue
);

4301 
	`INIT_LIST_HEAD
(&
migøã_mgr
->
c›y_queue
);

4302 
	`INIT_LIST_HEAD
(&
migøã_mgr
->
group_queue
);

4304 
	`¸óã_d´m⁄
(
su≥r
, &
migøã_mgr
->
d´m⁄
, 
migøã_¥oc
, "migrate_daemon");

4306 
migøã_mgr
->
mig_wq
 = 
	`Æloc_w‹kqueue
("mig_wq",

4307 
WQ_NON_REENTRANT
 | 
WQ_MEM_RECLAIM
, 1);

4308 i‡(!
migøã_mgr
->
mig_wq
) {

4309 
	`WBERR
("failedÅoálloc mig wq");

4310 
r
 = -1;

4311 
bad_wq
;

4313 
	`INIT_WORK
(&
migøã_mgr
->
mig_w‹k
, 
do_mig_w‹kî
);

4315 
	`©omic_£t
(&
migøã_mgr
->
migøã_queue_cou¡
, 0);

4316 
	`©omic_£t
(&
migøã_mgr
->
mig_öÊights
, 0);

4318 
	`©omic_£t
(&
migøã_mgr
->
migøã_åiggîed
, 0);

4319 
	`©omic_£t
(&
migøã_mgr
->
background_gc_⁄
, 0);

4321 
migøã_mgr
->
gc_cur_£g
 = 
NULL
;

4322 
migøã_mgr
->
gc_cur_off£t
 = 0;

4323 
migøã_mgr
->
gc_Æloc_cou¡
= 0;

4325 
migøã_mgr
->
c›y_job_poﬁ
 = 
	`mempoﬁ_¸óã_kmÆloc_poﬁ
(100,

4326 (
c›y_job
));

4327 i‡(!
migøã_mgr
->
c›y_job_poﬁ
) {

4328 
r
 = -
ENOMEM
;

4329 
	`WBERR
("couldn'tálloc copy jobÖool");

4330 
bad_c›y_job_poﬁ
;

4333 
migøã_mgr
->
group_job_poﬁ
 = 
	`mempoﬁ_¸óã_kmÆloc_poﬁ
(1024,

4334 (
c›y_job_group
));

4335 i‡(!
migøã_mgr
->
group_job_poﬁ
) {

4336 
r
 = -
ENOMEM
;

4337 
	`WBERR
("couldn'tálloc copy jobÖool");

4338 
bad_group_job_poﬁ
;

4341 
	`©omic_£t
(&
migøã_mgr
->
c›y_job_cou¡
, 0);

4342 
	`©omic_£t
(&
migøã_mgr
->
group_job_cou¡
, 0);

4343 
	`©omic_£t
(&
migøã_mgr
->
group_job_£q
, 0);

4345 
su≥r
->
∑øm
.
migøã_loww©î
 = 
	`©omic_ªad
(&su≥r->
£gbuf_mgr
.
tŸÆ_∑ge_cou¡
)/
STRIPE_SZ
;

4346 if(
su≥r
->
∑øm
.
migøã_loww©î
<2)

4347 
su≥r
->
∑øm
.
migøã_loww©î
 = 2;

4348 
su≥r
->
∑øm
.
migøã_highw©î
 = 
	`©omic_ªad
(&su≥r->
£gbuf_mgr
.
tŸÆ_∑ge_cou¡
)/
STRIPE_SZ
/4*6;

4350 
migøã_mgr
->
öôülized
 = 1;

4354 
bad_group_job_poﬁ
:

4355 
	`mempoﬁ_de°roy
(
migøã_mgr
->
c›y_job_poﬁ
);

4356 
bad_c›y_job_poﬁ
:

4357 
	`de°roy_w‹kqueue
(
migøã_mgr
->
mig_wq
);

4358 
bad_wq
:

4361 
	}
}

4363 
	$migøã_mgr_deöô
(
dm§c_su≥r
 *
su≥r
){

4364 
migøti⁄_m™agî
 *
migøã_mgr
 = &
su≥r
->migrate_mgr;

4366 if(!
migøã_mgr
->
öôülized
)

4369 
	`wake_up_¥o˚ss
(
migøã_mgr
->
d´m⁄
);

4371 
	`¥ötk
(" wait forÅriggered off\n");

4372 
	`©omic_ªad
(&
migøã_mgr
->
migøã_åiggîed
))

4373 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`u£cs_to_jiffõs
(1000));

4375 
	`¥ötk
(" wait for inflights \n");

4379 
migøã_mgr
->
Ælow_migøã
 = 
Ál£
;

4380 
	`©omic_£t
(&
migøã_mgr
->
migøã_åiggîed
, 0);

4381 
	`©omic_£t
(&
su≥r
->
migøã_mgr
.
background_gc_⁄
, 0);

4383 
	`¥ötk
(" wait for inflights \n");

4387 
	`kthªad_°›
(
migøã_mgr
->
d´m⁄
);

4388 
	`Êush_w‹k
(&
migøã_mgr
->
mig_w‹k
);

4389 
	`ˇn˚l_w‹k_sync
(&
migøã_mgr
->
mig_w‹k
);

4390 
	`mempoﬁ_de°roy
(
migøã_mgr
->
c›y_job_poﬁ
);

4393 
migøã_mgr
->
öôülized
 = 0;

4394 
	}
}

4397 #i‡(
USE_SEG_WRITER
 == 1)

4398 
	$£g_wrôe_mgr_öô
(
dm§c_su≥r
 *
su≥r
){

4399 
£g_wrôe_m™agî
 *
£g_wrôe_mgr
;

4400 
r
 = 0;

4401 
i
 = 0;

4403 
i
 = 0;ò< 
MAX_CACHE_DEVS
;i++){

4404 
£g_wrôe_mgr
 = &
su≥r
->£g_wrôe_mgr[
i
];

4405 
£g_wrôe_mgr
->
su≥r
 = super;

4407 
	`©omic_£t
(&
£g_wrôe_mgr
->
cou¡
, 0);

4408 
	`•ö_lock_öô
(&
£g_wrôe_mgr
->
•ölock
);

4409 
	`INIT_LIST_HEAD
(&
£g_wrôe_mgr
->
hód
);

4411 
£g_wrôe_mgr
->
wq

	`Æloc_w‹kqueue
("reacaching_wq",

4412 
WQ_NON_REENTRANT
 | 
WQ_MEM_RECLAIM
, 1);

4413 i‡(!
£g_wrôe_mgr
->
wq
) {

4414 
	`WBERR
("failedÅoállocÑead caching wq");

4415 
r
 = -1;

4416 
bad_öô
;

4418 
	`INIT_WORK
(&
£g_wrôe_mgr
->
w‹k
, 
£g_wrôe_w‹kî
);

4420 
£g_wrôe_mgr
->
öôülized
 = 1;

4423  
r
;

4425 
bad_öô
:

4426  
r
;

4427 
	}
}

4429 
	$£g_wrôe_mgr_deöô
(
dm§c_su≥r
 *
su≥r
){

4430 
£g_wrôe_m™agî
 *
£g_wrôe_mgr
;

4431 
i
;

4433 
i
 = 0;ò< 
MAX_CACHE_DEVS
;i++){

4434 
£g_wrôe_mgr
 = &
su≥r
->£g_wrôe_mgr[
i
];

4435 if(!
£g_wrôe_mgr
->
öôülized
)

4438 
	`de°roy_w‹kqueue
(
£g_wrôe_mgr
->
wq
);

4440 
	}
}

4443 
	$ªad_miss_mgr_öô
(
dm§c_su≥r
 *
su≥r
){

4444 
ªad_miss_m™agî
 *
ªad_miss_mgr
 = &
su≥r
->read_miss_mgr;

4445 
r
 = 0;

4447 
ªad_miss_mgr
->
su≥r
 = super;

4449 
	`öô_ªad_ˇchög_job_li°
(
su≥r
);

4450 
ªad_miss_mgr
->
wq

	`Æloc_w‹kqueue
("reacaching_wq",

4451 
WQ_NON_REENTRANT
 | 
WQ_MEM_RECLAIM
, 1);

4452 i‡(!
ªad_miss_mgr
->
wq
) {

4453 
	`WBERR
("failedÅoállocÑead caching wq");

4454 
r
 = -1;

4455 
bad_öô
;

4457 
	`INIT_WORK
(&
ªad_miss_mgr
->
w‹k
, 
do_ªad_ˇchög_w‹kî
);

4459 
ªad_miss_mgr
->
job_poﬁ
 = 
	`mempoﬁ_¸óã_kmÆloc_poﬁ
(
STRIPE_SZ
,

4460 (
ªad_ˇchög_job
));

4461 i‡(!
ªad_miss_mgr
->
job_poﬁ
) {

4462 
r
 = -
ENOMEM
;

4463 
	`WBERR
("couldn'tálloc flush jobÖool");

4464 
bad_öô
;

4467 
ªad_miss_mgr
->
öôülized
 = 1;

4468  
r
;

4470 
bad_öô
:

4471  
r
;

4472 
	}
}

4474 
	$ªad_miss_mgr_deöô
(
dm§c_su≥r
 *
su≥r
){

4475 
ªad_miss_m™agî
 *
ªad_miss_mgr
 = &
su≥r
->read_miss_mgr;

4477 if(!
ªad_miss_mgr
->
öôülized
)

4482 
	`de°roy_w‹kqueue
(
ªad_miss_mgr
->
wq
);

4484 
	`mempoﬁ_de°roy
(
ªad_miss_mgr
->
job_poﬁ
);

4485 
	}
}

4487 
hπimî_ª°¨t
 
	$sync_timî_ˇŒback
–
hπimî
 *
timî
 )

4489 
sync_m™agî
 *
sync_mgr
 = 
	`c⁄èöî_of
(
timî
, sync_m™agî, 
hr_timî
);

4490 
dm§c_su≥r
 *
su≥r
 = 
sync_mgr
->super;

4494 if(!
	`©omic_ªad
(&
su≥r
->
migøã_mgr
.
migøã_åiggîed
)){

4495 if(!
	`©omic64_ªad
(&
su≥r
->
≥ndög_mgr
.
io_cou¡
)){

4496 
	`Êush_∑πül_mëa
(
su≥r
, 
WHBUF
);

4497 
	`Êush_∑πül_mëa
(
su≥r
, 
WCBUF
);

4501 
	`scheduÀ_w‹k
(&
su≥r
->
sync_mgr
.
w‹k
);

4504  
HRTIMER_NORESTART
;

4505 
	}
}

4507 
	$sync_mgr_öô
(
dm§c_su≥r
 *
su≥r
){

4508 
sync_m™agî
 *
sync_mgr
 = &
su≥r
->sync_mgr;

4510 
	`•ö_lock_öô
(&
sync_mgr
->
lock
);

4511 
sync_mgr
->
su≥r
 = super;

4512 
su≥r
->
∑øm
.
sync_öãrvÆ
 = 
DEFAULT_ARRIVAL_US
;

4514 
	`hπimî_öô
–&
sync_mgr
->
hr_timî
, 
CLOCK_MONOTONIC
, 
HRTIMER_MODE_REL
 );

4515 
sync_mgr
->
hr_timî
.
fun˘i⁄
 = &
sync_timî_ˇŒback
;

4519 
	`INIT_WORK
(&
sync_mgr
->
w‹k
, 
sync_¥oc
);

4521 
sync_mgr
->
öôülized
 = 1;

4524 
	}
}

4526 
	$sync_mgr_deöô
(
dm§c_su≥r
 *
su≥r
){

4527 
sync_m™agî
 *
sync_mgr
 = &
su≥r
->sync_mgr;

4529 if(!
sync_mgr
->
öôülized
)

4533 
	`Êush_w‹k
(&
sync_mgr
->
w‹k
);

4534 
	`ˇn˚l_w‹k_sync
(&
sync_mgr
->
w‹k
);

4535 
	}
}

4537 
	$gë_avg_¨rivÆ_time
(
dm§c_su≥r
 *
su≥r
){

4538 
≥ndög_m™agî
 *
≥ndög_mgr
 = &
su≥r
->pending_mgr;

4539 
f
;

4540 
cou¡
;

4541 
i
;

4542 
°¨t
;

4543 
√xt
;

4545 
time•ec
 *
°¨t_ts
, *
√xt_ts
, 
diff_ts
;

4546 
ns
 = 0;

4547 
avg_us
 = 
DEFAULT_ARRIVAL_US
;

4549 
	`•ö_lock_úqßve
(&
≥ndög_mgr
->
lock
, 
f
);

4550 
cou¡
 = 
	`©omic_ªad
(&
≥ndög_mgr
->
¨rivÆ_cou¡
);

4551 if(
cou¡
<=1){

4553 
avg_us
 = 
su≥r
->
∑øm
.
sync_öãrvÆ
;

4554 
RESET
;

4557 
avg_us
 = 
su≥r
->
∑øm
.
sync_öãrvÆ
;

4558 
RESET
;

4560 
°¨t
 = 
	`©omic_ªad
(&
≥ndög_mgr
->
¨rivÆ_°¨t
);

4562 
i
 = 0;ò< 
cou¡
-1;i++){

4563 
√xt
 = (
°¨t
 + 1Ë% 
STRIPE_SZ
;

4564 
°¨t_ts
 = &
≥ndög_mgr
->
¨rivÆ_times
[
°¨t
];

4565 
√xt_ts
 = &
≥ndög_mgr
->
¨rivÆ_times
[
√xt
];

4567 
diff_ts
.
tv_£c
 = 
√xt_ts
->tv_£¯- 
°¨t_ts
->tv_sec;

4568 
diff_ts
.
tv_n£c
 = 
√xt_ts
->tv_n£¯- 
°¨t_ts
->tv_nsec;

4569 
ns
 +
diff_ts
.
tv_£c
 * 
NSEC_PER_SEC
 + diff_ts.
tv_n£c
;

4571 
°¨t
 = (°¨à+ 1)% 
STRIPE_SZ
;

4574 
avg_us
 = 
ns
/(
cou¡
-1)/1000;

4575 
RESET
:

4576 
	`ª£t_¨rivÆ_time
(
su≥r
);

4577 
	`•ö_u∆ock_úqª°‹e
(&
≥ndög_mgr
->
lock
, 
f
);

4579 
	`©omic64_add
(
avg_us
, &
su≥r
->
w°©
.
avîage_¨rivÆ_time
);

4580 
	`©omic64_öc
–&
su≥r
->
w°©
.
avîage_¨rivÆ_cou¡
);

4583  
avg_us
;

4584 
	}
}

4586 
	$upd©e_sync_dódlöe
(
dm§c_su≥r
 *
su≥r
)

4588 
sync_m™agî
 *
sync_mgr
 = &
su≥r
->sync_mgr;

4589 
u£c
;

4592 
u£c
 = 
	`gë_avg_¨rivÆ_time
(
su≥r
);

4597 
sync_mgr
->
≥riod
 = 
	`ktime_£t
(0, 
u£c
*1000);

4598 
	`hπimî_°¨t
–&
sync_mgr
->
hr_timî
, sync_mgr->
≥riod
, 
HRTIMER_MODE_REL
 );

4599 
	}
}

4601 
	$wp_¥öt_i›s
(
dm§c_su≥r
 *
su≥r
){

4602 
w‹klﬂd_¥edi˘‹
 *
wp
 = &
su≥r
->wp;

4603 
i
;

4605 
i
 = 0;ò< 
wp
->
num_wödow
;i++){

4606 
io_°©_t
 *
io°©
 = &
wp
->io°©[
i
];

4608 
	`¥ötk
(" [*%d:%d:%dMB/s]\n", 
i
, ()
	`©omic64_ªad
(&
io°©
->
i›s
[
REQ_CATEGORY_TOTAL
][
REQ_TYPE_TOTAL
]),

4609 ()
	`©omic64_ªad
(&
io°©
->
i›s
[
REQ_CATEGORY_TOTAL
][
REQ_TYPE_TOTAL
])/256);

4614 
	`¥ötk
("\n");

4616 
	}
}

4618 
u32
 
	$wp_gë_i›s
(
dm§c_su≥r
 *
su≥r
, 
u32
 *
bw_mb
, 
ˇãg‹y
, 
ty≥
){

4619 
w‹klﬂd_¥edi˘‹
 *
wp
 = &
su≥r
->wp;

4620 
u32
 
°¨t_wödow
;

4621 
u32
 
cur_wödow
;

4622 
u32
 
cur_i›s
;

4623 
io_°©_t
 *
io°©
;

4624 
Êags
;

4625 
i
;

4627 
cur_i›s
 = 0;

4629 
	`•ö_lock_úqßve
(&
wp
->
lock
, 
Êags
);

4631 
cur_wödow
 = 
	`©omic_ªad
(&
wp
->cur_window);

4632 
°¨t_wödow
 = 
	`©omic_ªad
(&
wp
->start_window);

4634 
i
 = 0;ò< 
wp
->
num_wödow
;i++){

4635 if(
°¨t_wödow
==
cur_wödow
)

4637 
io°©
 = &
wp
->io°©[
°¨t_wödow
];

4638 
cur_i›s
 +(
u32
)
	`©omic64_ªad
(&
io°©
->
i›s
[
ˇãg‹y
][
ty≥
]);

4639 
°¨t_wödow
 = (°¨t_wödow + 1Ë% 
wp
->
num_wödow
;

4642 
	`•ö_u∆ock_úqª°‹e
(&
wp
->
lock
, 
Êags
);

4643 
cur_i›s
 /(
wp
->
num_wödow
/wp->
wödow_≥r_£c
);

4645 if(
bw_mb
)

4646 *
bw_mb
 = 
cur_i›s
/256;

4648  
cur_i›s
;

4649 
	}
}

4651 
hπimî_ª°¨t
 
	$wp_di•œy
–
hπimî
 *
timî
 )

4653 
w‹klﬂd_¥edi˘‹
 *
wp
 = 
	`c⁄èöî_of
(
timî
, w‹klﬂd_¥edi˘‹, 
hr_timî_mëî
);

4655 if(
wp
->
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_HORI
){

4656 
	`¥ötk
(" CurBW: Total=%d, Write=%d, GCWrite=%d GCRead=%d MB/s\n",

4657 
	`wp_gë_i›s
(
wp
->
su≥r
, 
NULL
, 
REQ_CATEGORY_TOTAL
, 
REQ_TYPE_WRITE
)/256,

4658 
	`wp_gë_i›s
(
wp
->
su≥r
, 
NULL
, 
REQ_CATEGORY_NORMAL
, 
REQ_TYPE_WRITE
)/256,

4659 
	`wp_gë_i›s
(
wp
->
su≥r
, 
NULL
, 
REQ_CATEGORY_GC
, 
REQ_TYPE_WRITE
)/256,

4660 
	`wp_gë_i›s
(
wp
->
su≥r
, 
NULL
, 
REQ_CATEGORY_GC
, 
REQ_TYPE_READ
)/256);

4663 
	`hπimî_f‹w¨d_now
(
timî
, 
wp
->
di•œy_≥riod
);

4665  
HRTIMER_RESTART
;

4666 
	}
}

4668 
hπimî_ª°¨t
 
	$wp_ˇŒback
–
hπimî
 *
timî
 )

4670 
w‹klﬂd_¥edi˘‹
 *
wp
 = 
	`c⁄èöî_of
(
timî
, w‹klﬂd_¥edi˘‹, 
hr_timî_åack
);

4671 
io_°©_t
 *
io°©
;

4672 
i
, 
j
;

4673 
Êags
;

4677 
	`•ö_lock_úqßve
(&
wp
->
lock
, 
Êags
);

4678 
	`©omic_£t
(&
wp
->
cur_wödow
, ((
	`©omic_ªad
(&wp->cur_wödowË+ 1Ë% wp->
num_wödow
));

4679 if(
	`©omic_ªad
(&
wp
->
cur_wödow
)=˜tomic_ªad(&wp->
°¨t_wödow
)){

4680 
	`©omic_£t
(&
wp
->
°¨t_wödow
, ((
	`©omic_ªad
(&wp->°¨t_wödowË+ 1Ë% wp->
num_wödow
));

4683 
io°©
 = &
wp
->io°©[
	`©omic_ªad
(&wp->
cur_wödow
)];

4684 
i
 = 0;ò< 
REQ_CATEGORY_NUM
;i++){

4685 
j
 = 0;j < 
REQ_TYPE_NUM
;j++){

4686 
	`©omic64_£t
(&
io°©
->
i›s
[
i
][
j
], 0);

4689 
	`•ö_u∆ock_úqª°‹e
(&
wp
->
lock
, 
Êags
);

4691 
	`hπimî_f‹w¨d_now
(
timî
, 
wp
->
åack_≥riod
);

4693  
HRTIMER_RESTART
;

4694 
	}
}

4696 
	$wp_upd©e
(
dm§c_su≥r
 *
su≥r
, 
is_wrôe
, 
ˇãg‹y
){

4697 
w‹klﬂd_¥edi˘‹
 *
wp
 = &
su≥r
->wp;

4698 
io_°©_t
 *
io°©
 = &
wp
->io°©[
	`©omic_ªad
(&wp->
cur_wödow
)];

4700 
	`©omic64_öc
(&
io°©
->
i›s
[
ˇãg‹y
][
is_wrôe
]);

4701 
	`©omic64_öc
(&
io°©
->
i›s
[
ˇãg‹y
][
REQ_TYPE_TOTAL
]);

4703 
	`©omic64_öc
(&
io°©
->
i›s
[
REQ_CATEGORY_TOTAL
][
is_wrôe
]);

4704 
	`©omic64_öc
(&
io°©
->
i›s
[
REQ_CATEGORY_TOTAL
][
REQ_TYPE_TOTAL
]);

4705 
	}
}

4707 
	$wp_öô
(
dm§c_su≥r
 *
su≥r
)

4709 
w‹klﬂd_¥edi˘‹
 *
wp
 = &
su≥r
->wp;

4710 
i
, 
j
;

4711 
u32
 
åack_ms
;

4713 
wp
->
su≥r
 = super;

4714 
åack_ms
 = 100;

4715 
wp
->
wödow_≥r_£c
 = (
MSEC_PER_SEC
/
åack_ms
);

4716 
wp
->
num_wödow
 = wp->
wödow_≥r_£c
*2;

4717 if(
wp
->
num_wödow
>
MAX_WINDOW_NUM
)

4718 
wp
->
num_wödow
 = 
MAX_WINDOW_NUM
;

4720 
wp
->
åack_≥riod
 = 
	`ktime_£t
(0, 
åack_ms
*
NSEC_PER_MSEC
);

4721 
	`¥ötk
(" W‹klﬂd Pîdi˘‹:ÅøckögÖîiod = %dms\n", 
åack_ms
);

4723 
	`•ö_lock_öô
(&
wp
->
lock
);

4725 
	`hπimî_öô
–&
wp
->
hr_timî_åack
, 
CLOCK_MONOTONIC
, 
HRTIMER_MODE_REL
 );

4726 
wp
->
hr_timî_åack
.
fun˘i⁄
 = &
wp_ˇŒback
;

4727 
	`hπimî_°¨t
–&
wp
->
hr_timî_åack
, wp->
åack_≥riod
, 
HRTIMER_MODE_REL
 );

4729 
	`hπimî_öô
–&
wp
->
hr_timî_mëî
, 
CLOCK_MONOTONIC
, 
HRTIMER_MODE_REL
 );

4730 
wp
->
hr_timî_mëî
.
fun˘i⁄
 = &
wp_di•œy
;

4731 
wp
->
di•œy_≥riod
 = 
	`ktime_£t
(1, 0);

4732 
	`hπimî_°¨t
–&
wp
->
hr_timî_mëî
, wp->
di•œy_≥riod
, 
HRTIMER_MODE_REL
 );

4734 
i
 = 0;ò< 
wp
->
num_wödow
;i++){

4735 
io_°©_t
 *
io°©
 = &
wp
->io°©[
i
];

4736 
j
 = 0;j < 
REQ_TYPE_NUM
;j++){

4737 
	`©omic64_£t
(&
io°©
->
i›s
[
i
][
j
], 0);

4741 
	`©omic_£t
(&
wp
->
cur_wödow
,0);

4742 
	`©omic_£t
(&
wp
->
°¨t_wödow
,0);

4745 
wp
->
öôülized
 = 1;

4748 
	}
}

4750 
	$wp_˛ónup
(
dm§c_su≥r
 *
su≥r
)

4752 
w‹klﬂd_¥edi˘‹
 *
wp
 = &
su≥r
->wp;

4753 
ªt
;

4755 if(
wp
->
öôülized
==0)

4758 
ªåy
:

4759 
ªt
 = 
	`hπimî_ˇn˚l
–&
wp
->
hr_timî_åack
 );

4760 i‡(
ªt
) {

4761 
ªåy
;

4764 
ªt
 = 
	`hπimî_ˇn˚l
–&
wp
->
hr_timî_mëî
 );

4765 i‡(
ªt
) {

4766 
ªåy
;

4769 
wp
->
öôülized
 = 0;

4772 
	}
}

4776 
	$put_devi˚s
(
dm§c_su≥r
 *
su≥r
){

4777 
dm_èrgë
 *
ti
 = 
su≥r
->ti;

4778 
devi˚_öfo
 *
dev_öfo
 = &
su≥r
->dev_info;

4779 
dm_dev
 *
dev
;

4780 
i
;

4782 
dev
 = 
dev_öfo
->
‹igö_dev
;

4783 if(
dev
){

4784 
	`dm_put_devi˚
(
ti
, 
dev
);

4786 
dev_öfo
->
‹igö_dev
 = 
NULL
;;

4788 
i
 = 0;ò< 
dev_öfo
->
num_ˇche_devs
;i++){

4789 
dev
 = 
dev_öfo
->
ˇche_dev
[
i
];

4790 if(
dev
)

4791 
	`dm_put_devi˚
(
ti
, 
dev
);

4792 
dev_öfo
->
ˇche_dev
[
i
] = 
NULL
;

4795 
i
 = 0;ò< 
su≥r
->
dev_öfo
.
num_•¨e_ˇche_devs
;i++){

4796 
dev
 = 
dev_öfo
->
•¨e_ˇche_dev
[
i
];

4797 if(
dev
)

4798 
	`dm_put_devi˚
(
ti
, 
dev
);

4799 
dev_öfo
->
•¨e_ˇche_dev
[
i
] = 
NULL
;

4801 
	}
}

4803 
	$gë_devi˚s
(
dm§c_su≥r
 *
su≥r
){

4804 
dm_èrgë
 *
ti
 = 
su≥r
->ti;

4805 
devi˚_öfo
 *
dev_öfo
 = &
su≥r
->dev_info;

4806 
i
;

4807 
r
;

4808 *
°r
;

4810 
°r
 = 
dev_öfo
->
‹igö_«me
;

4811 
r
 = 
	`dm_gë_devi˚
(
ti
, 
°r
, 
	`dm_èbÀ_gë_mode
—i->
èbÀ
),

4812 &
su≥r
->
dev_öfo
.
‹igö_dev
);

4813 if(
r
){

4814 
ti
->
îr‹
 = "couldn't get origin dev";

4815  
r
;

4818 
i
 = 0;ò< 
dev_öfo
->
num_ˇche_devs
;i++){

4819 
°r
 = 
dev_öfo
->
ˇche_«me
[
i
];

4820 
r
 = 
	`dm_gë_devi˚
(
ti
, 
°r
, 
	`dm_èbÀ_gë_mode
—i->
èbÀ
),

4821 &
su≥r
->
dev_öfo
.
ˇche_dev
[
i
]);

4822 i‡(
r
) {

4823 
ti
->
îr‹
 = "couldn't get cache dev";

4824 
	`¥ötk
–"couldn'àgë cachêdev %†\n", 
°r
);

4825 
bad
;

4831 
bad
:

4832 
	`put_devi˚s
(
su≥r
);

4834  
r
;

4835 
	}
}

4837 
	$ˇlc_√ed_num_ssds
(
dm§c_su≥r
 *
su≥r
){

4838 
u32
 
cur_bw_mb
;

4839 
u32
 
ªmaö_bw
;

4840 
u32
 
√ed_ssds
;

4842 
	`wp_gë_i›s
(
su≥r
, &
cur_bw_mb
, 
REQ_CATEGORY_TOTAL
, 
REQ_TYPE_WRITE
);

4844 
√ed_ssds
 = 
cur_bw_mb
 / 
su≥r
->
dev_öfo
.
≥r_ˇche_bw
 + 1;

4845 
ªmaö_bw
 = 
cur_bw_mb
 % 
su≥r
->
dev_öfo
.
≥r_ˇche_bw
;

4846 if(
ªmaö_bw
 > 
cur_bw_mb
 / 
su≥r
->
dev_öfo
.
≥r_ˇche_bw
)

4847 
√ed_ssds
++;

4849 if(
√ed_ssds
> 
NUM_SSD
)

4850 
√ed_ssds
 = 
NUM_SSD
;

4852 if(
√ed_ssds
<2)

4853 
√ed_ssds
 = 2;

4855 
	`¥ötk
(" bw_mb = %d, NUM SSD†%d \n", 
cur_bw_mb
, 
√ed_ssds
);

4857  
√ed_ssds
;

4858 
	}
}

4860 
	$devöfo_öô
(
dm§c_su≥r
 *
su≥r
, 
num_ssd
){

4861 
i
;

4862 
r
 = 0;

4864 
su≥r
->
dev_öfo
.
num_•¨e_ˇche_devs
 = 0;

4865 
i
 = 0;ò< 
MAX_CACHE_DEVS
;i++){

4866 
su≥r
->
dev_öfo
.
•¨e_ˇche_dev
[
i
] = 
NULL
;

4869 if(
	`USE_ERASURE_RAID6
(&
su≥r
->
∑øm
)){

4870 if(
NUM_SSD
<4){

4871 
	`¥ötk
(" NUM SSD i†toÿsmÆ»%d \n", 
NUM_SSD
);

4872 
r
 = -1;

4874 }if(
	`USE_ERASURE_PARITY
(&
su≥r
->
∑øm
)){

4875 if(
NUM_SSD
<2){

4876 
	`¥ötk
(" NUM SSD i†toÿsmÆ»%d \n", 
NUM_SSD
);

4877 
r
 = -1;

4881 if(
	`NO_USE_ERASURE_CODE
(&
su≥r
->
∑øm
))

4882 
NUM_DATA_SSD
 = 
NUM_SSD
;

4883 if(
	`USE_ERASURE_PARITY
(&
su≥r
->
∑øm
))

4884 
NUM_DATA_SSD
 = 
NUM_SSD
-1;

4886 
NUM_DATA_SSD
 = 
NUM_SSD
-2;

4888 
su≥r
->
dev_öfo
.
≥r_ˇche_bw
 = 200;

4889  
r
;

4890 
	}
}

4892 
	$hŸ_fûãr_check
(
dm§c_su≥r
 *
su≥r
, 
∑gío
){

4893 
hŸ_d©a_fûãr
 *
hŸ_fûãr
 = &
su≥r
->hot_filter;

4894 
Êags
;

4895 *
cur_bôm≠_±r
;

4896 
off£t
[8];

4897 
hŸ_cou¡
 = 0;

4898 
i
;

4901 
off£t
[0] = 
	`¸c32
(17, (*)&
∑gío
, ()Ë% 
hŸ_fûãr
->
num_bôs_≥r_èbÀ
;

4902 
off£t
[1] = 
	`jhash_1w‹d
(
∑gío
, 0xbìfË% 
hŸ_fûãr
->
num_bôs_≥r_èbÀ
;

4903 
off£t
[2] = 
	`hash_32
(
∑gío
, 32Ë% 
hŸ_fûãr
->
num_bôs_≥r_èbÀ
;

4905 
	`•ö_lock_úqßve
(&
hŸ_fûãr
->
lock
, 
Êags
);

4906 
i
 = 0;ò< 
hŸ_fûãr
->
bôm≠_èbÀ_num
;i++){

4907 
cur_bôm≠_±r
 = 
hŸ_fûãr
->
bôm≠
[
i
];

4908 if(
	`ã°_bô
(
off£t
[0], 
cur_bôm≠_±r
) &&

4909 
	`ã°_bô
(
off£t
[1], 
cur_bôm≠_±r
) &&

4910 
	`ã°_bô
(
off£t
[2], 
cur_bôm≠_±r
))

4912 
hŸ_cou¡
++;

4915 
	`•ö_u∆ock_úqª°‹e
(&
hŸ_fûãr
->
lock
, 
Êags
);

4917 if(
hŸ_cou¡
>=
hŸ_fûãr
->
hŸ_thªshﬁd
)

4922 
	}
}

4924 
	$hŸ_fûãr_upd©e
(
dm§c_su≥r
 *
su≥r
, 
∑gío
){

4925 
hŸ_d©a_fûãr
 *
hŸ_fûãr
 = &
su≥r
->hot_filter;

4926 
Êags
;

4927 *
cur_bôm≠
;

4928 
off£t
[8];

4931 
off£t
[0] = 
	`¸c32
(17, (*)&
∑gío
, ()Ë% 
hŸ_fûãr
->
num_bôs_≥r_èbÀ
;

4932 
off£t
[1] = 
	`jhash_1w‹d
(
∑gío
, 0xbìfË% 
hŸ_fûãr
->
num_bôs_≥r_èbÀ
;

4933 
off£t
[2] = 
	`hash_32
(
∑gío
, 32Ë% 
hŸ_fûãr
->
num_bôs_≥r_èbÀ
;

4935 
	`•ö_lock_úqßve
(&
hŸ_fûãr
->
lock
, 
Êags
);

4936 
cur_bôm≠
 = 
hŸ_fûãr
->
bôm≠
[hŸ_fûãr->
cur_èbÀ
];

4937 
	`£t_bô
(
off£t
[0], 
cur_bôm≠
);

4938 
	`£t_bô
(
off£t
[1], 
cur_bôm≠
);

4939 
	`£t_bô
(
off£t
[2], 
cur_bôm≠
);

4941 
hŸ_fûãr
->
io_cou¡
++;

4942 if(
hŸ_fûãr
->
io_cou¡
 =hŸ_fûãr->
deˇy_≥riod
){

4943 
hŸ_fûãr
->
io_cou¡
 = 0;

4944 
hŸ_fûãr
->
cur_èbÀ
 = (hŸ_fûãr->cur_èbÀ + 1Ë% hŸ_fûãr->
bôm≠_èbÀ_num
;

4945 if(
hŸ_fûãr
->
cur_èbÀ
 =hŸ_fûãr->
œ°_èbÀ
){

4946 
hŸ_fûãr
->
œ°_èbÀ
 = (hŸ_fûãr->œ°_èbÀ + 1Ë% hŸ_fûãr->
bôm≠_èbÀ_num
;

4948 
	`mem£t
(
hŸ_fûãr
->
bôm≠
[hŸ_fûãr->
cur_èbÀ
], 0x00, hŸ_fûãr->
num_byãs_≥r_èbÀ
);

4950 
	`•ö_u∆ock_úqª°‹e
(&
hŸ_fûãr
->
lock
, 
Êags
);

4952 
	}
}

4954 
	#˚û
(
n
, 
d
Ë((“Ë< 0Ë? (-((-“))/(d))Ë: (n)/(dË+ (“)%(dË!0))

	)

4956 
	$hŸ_fûãr_öô
(
dm§c_su≥r
 *
su≥r
){

4957 
hŸ_d©a_fûãr
 *
hŸ_fûãr
 = &
su≥r
->hot_filter;

4958 
i
;

4960 
	`•ö_lock_öô
(&
hŸ_fûãr
->
lock
);

4962 
hŸ_fûãr
->
cur_èbÀ
 = 0;

4963 
hŸ_fûãr
->
œ°_èbÀ
 = 0;

4964 
hŸ_fûãr
->
hash_num
 = 3;

4965 
hŸ_fûãr
->
hŸ_thªshﬁd
 = 2;

4966 
hŸ_fûãr
->
deˇy_≥riod
 = 
NUM_BLOCKS
/2;

4968 
hŸ_fûãr
->
bôm≠_èbÀ_num
 = 
MAX_BITMAP_TABLE
;

4969 
hŸ_fûãr
->
num_bôs_≥r_èbÀ
 = 
NUM_BLOCKS
 * hŸ_fûãr->
hash_num
;

4970 
hŸ_fûãr
->
num_byãs_≥r_èbÀ
 = 
	`˚û
(hŸ_fûãr->
num_bôs_≥r_èbÀ
, 8);

4971 
	`¥ötk
("Çum bô†≥∏èbÀ = %d \n", 
hŸ_fûãr
->
num_bôs_≥r_èbÀ
);

4973 
i
 = 0;ò<
hŸ_fûãr
->
bôm≠_èbÀ_num
;i++){

4974 
	`¥ötk
(" HŸ Fûãr[%d]: byã†≥∏èbÀ = %dKB \n", 
i
, 
hŸ_fûãr
->
num_byãs_≥r_èbÀ
/1024);

4975 
hŸ_fûãr
->
bôm≠
[
i
] = 
	`vmÆloc
(hŸ_fûãr->
num_byãs_≥r_èbÀ
);

4976 if(!
hŸ_fûãr
->
bôm≠
[
i
]){

4977 
	`¥ötk
(" vmallocÉrror \n");

4980 
	`mem£t
(
hŸ_fûãr
->
bôm≠
[
i
], 0x00, hŸ_fûãr->
num_byãs_≥r_èbÀ
);

4984 
	}
}

4986 
	$hŸ_fûãr_deöô
(
dm§c_su≥r
 *
su≥r
){

4987 
hŸ_d©a_fûãr
 *
hŸ_fûãr
 = &
su≥r
->hot_filter;

4988 
i
;

4990 
i
 = 0;ò<
hŸ_fûãr
->
bôm≠_èbÀ_num
;i++){

4991 if(
hŸ_fûãr
->
bôm≠
[
i
])

4992 
	`v‰ì
(
hŸ_fûãr
->
bôm≠
[
i
]);

4994 
	}
}

4996 
	#CREATE_DAEMON
(
«me
) \

4998 
su≥r
->
«me
##
_d´m⁄
 = 
	`kthªad_¸óã
“ame##
_¥oc
, super, \

5000 i‡(
	`IS_ERR
(
su≥r
->
«me
##
_d´m⁄
)) { \

5001 
r
 = 
	`PTR_ERR
(
su≥r
->
«me
##
_d´m⁄
); \

5002 
su≥r
->
«me
##
_d´m⁄
 = 
NULL
; \

5003 
	`WBERR
("couldn't spawn" #name "daemon"); \

5004 
bad_
##
«me
##
_d´m⁄
; \

5006 
	`wake_up_¥o˚ss
(
su≥r
->
«me
##
_d´m⁄
); \

5007 } 0)

	)

5012 
	$¥öt_∑øm
(
dm§c_su≥r
 *
su≥r
){

5014 
	`¥ötk
(" SRC PagêSizê%d \n", 
SRC_PAGE_SIZE
);

5015 
	`¥ötk
(" SRC Se˘‹†≥∏Pagê%d \n", 
SRC_SECTORS_PER_PAGE
);

5016 
	`¥ötk
(" SRC Se˘‹†≥∏PagêShi· = %d \n", 
SRC_SECTORS_PER_PAGE_SHIFT
);

5018 if(
SUMMARY_SCHEME
==
SUMMARY_PER_CHUNK
)

5019 
	`¥ötk
(" Summary Scheme: Per Chunk\n");

5021 
	`¥ötk
(" Summary Scheme: Per Stripe (Unsupported)\n");

5022 
	`BUG_ON
(1);

5025 if(
	`NO_USE_ERASURE_CODE
(&
su≥r
->
∑øm
))

5026 
	`¥ötk
(" Erasure Code: None\n");

5027 if(
	`USE_ERASURE_PARITY
(&
su≥r
->
∑øm
))

5028 
	`¥ötk
(" Erasure Code: Parity\n");

5030 
	`¥ötk
(" Erasure Code: RAID-6\n");

5033 if(
su≥r
->
∑øm
.
∑rôy_Æloˇti⁄
==
PARITY_ALLOC_FIXED
)

5034 
	`¥ötk
(" Parity Allocation: Fixed\n");

5036 
	`¥ötk
(" Parity Allocation: Rotated\n");

5038 if(
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_HORI
)

5039 
	`¥ötk
(" Data Allocation: Horizontal\n");

5040 if(
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_VERT
)

5041 
	`¥ötk
(" Data Allocation: Vertical\n");

5042 if(
su≥r
->
∑øm
.
d©a_Æloˇti⁄
==
DATA_ALLOC_FLEX_VERT
)

5043 
	`¥ötk
(" Data Allocation: Flexible Vertical \n");

5045 
	`¥ötk
(" Data Allocation: Flexible Horizontal\n");

5047 if(
su≥r
->
∑øm
.
°rùög_pﬁicy
==
SEPAR_STRIPING
)

5048 
	`¥ötk
(" Striping Policy: Separated\n");

5050 
	`¥ötk
(" Striping Policy: Mixed\n");

5052 if(
su≥r
->
∑øm
.
hô_bôm≠_ty≥
==
HIT_BITMAP_PER_STRIPE
)

5053 
	`¥ötk
(" Hit Bitmap Type: Per Stripe\n");

5055 
	`¥ötk
(" Hit Bitmap Type: Per Block\n");

5057 if(
su≥r
->
∑øm
.
ª˛aim_pﬁicy
==
RECLAIM_SELECTIVE
)

5058 
	`¥ötk
(" Reclaim Policy: Selective \n");

5059 if(
su≥r
->
∑øm
.
ª˛aim_pﬁicy
==
RECLAIM_GC
)

5060 
	`¥ötk
(" Reclaim Policy: GC\n");

5062 
	`¥ötk
(" Reclaim Policy: Destage\n");

5064 if(
su≥r
->
∑øm
.
vi˘im_pﬁicy
==
VICTIM_GREEDY
)

5065 
	`¥ötk
(" Victim Policy: Greedy\n");

5066 if(
su≥r
->
∑øm
.
vi˘im_pﬁicy
==
VICTIM_CLOCK
)

5067 
	`¥ötk
(" Victim Policy: Clock\n");

5069 
	`¥ötk
(" Victim Policy: LRU\n");

5071 
	`¥ötk
(" Chunk sizê%d,(%dKBË\n", 
su≥r
->
∑øm
.
chunk_size
, 
SECTOR_SIZE
 * super->param.chunk_size/1024);

5072 
	`¥ötk
(" Num Summ¨y = %d\n", 
su≥r
->
∑øm
.
num_summ¨y_≥r_chunk
);

5073 
	`¥ötk
(" Mëablock sizê%d \n", ()(
mëablock
));

5074 
	`¥ötk
(" GC Low W©î = %d Segmít†\n", 
MIGRATE_LOWWATER
);

5075 
	`¥ötk
(" GC HIGH W©î = %d Segmít†\n", 
MIGRATE_HIGHWATER
);

5076 
	`¥ötk
(" Dúty Seg Buf„∏Timeout%d u†\n", 
su≥r
->
∑øm
.
sync_öãrvÆ
);

5077 
	}
}

5079 
__mu°_check
 
	$ªsume_m™agîs
(
dm§c_su≥r
 *
su≥r
)

5081 
r
 = 0;

5083 
r
 = 
	`öô_ømbuf_poﬁ
(
su≥r
);

5084 if(
r
)

5085  
r
;

5087 
r
 = 
	`öô_£gmít_hódî_¨øy
(
su≥r
);

5088 if(
r
)

5089  
r
;

5091 
r
 = 
	`ht_em±y_öô
(
su≥r
);

5092 if(
r
)

5093  
r
;

5096 
r
 = 
	`migøã_mgr_öô
(
su≥r
);

5097 if(
r
)

5098  
r
;

5101 
r
 = 
	`Êush_mgr_öô
(
su≥r
);

5102 if(
r
)

5103  
r
;

5105 
r
 = 
	`sync_mgr_öô
(
su≥r
);

5106 if(
r
)

5107  
r
;

5109 
r
 = 
	`ªad_miss_mgr_öô
(
su≥r
);

5110 if(
r
)

5111  
r
;

5113 
r
 = 
	`≥ndög_mgr_öô
(
su≥r
);

5114 if(
r
)

5115  
r
;

5117 #i‡(
USE_SEG_WRITER
 == 1)

5118 
r
 = 
	`£g_wrôe_mgr_öô
(
su≥r
);

5119 if(
r
)

5120  
r
;

5123 
r
 = 
	`¸óã_d´m⁄
(
su≥r
, &su≥r->
checkî_d´m⁄
, 
checkî_¥oc
, "checker_daemon");

5124 if(
r
)

5125  
r
;

5127 
r
 = 
	`wp_öô
(
su≥r
);

5128 if(
r
)

5129  
r
;

5131 if(
su≥r
->
∑øm
.
íabÀ_ªad_ˇche
){

5132 
	`¥ötk
(" cÀ™ døm buf„∏sizê%dMB \n", 
su≥r
->
∑øm
.
ømbuf_poﬁ_amou¡
/256);

5133 
	`Ãu_öô
(&
su≥r
->
˛ón_døm_ˇche_m™agî
, "LRU", su≥r->
∑øm
.
ømbuf_poﬁ_amou¡
, 1, 0);

5136 #ifde‡
USE_GHOST_BUFFER


5137 if(
su≥r
->
∑øm
.
hŸ_idítifiˇti⁄
){

5139 
r
 = 
	`hŸ_fûãr_öô
(
su≥r
);

5140 if(
r
)

5141  
r
;

5145 
	`£g_Æloˇt‹_öô
(
su≥r
);

5146 
	`£q_dëe˘‹_öô
(
su≥r
);

5147 
r
 = 
	`mu…i_Æloˇt‹_öô
(
su≥r
);

5149  
r
;

5150 
	}
}

5152 
	$°›_m™agîs
(
dm§c_su≥r
 *
su≥r
){

5154 
	`¥ötk
(" Stopping check mgr \n");

5155 if(
su≥r
->
checkî_d´m⁄
){

5156 
	`wake_up_¥o˚ss
(
su≥r
->
checkî_d´m⁄
);

5157 
	`kthªad_°›
(
su≥r
->
checkî_d´m⁄
);

5160 
	`wp_˛ónup
(
su≥r
);

5162 
	`¥ötk
(" Stopping sync damone \n");

5163 
	`sync_mgr_deöô
(
su≥r
);

5165 
	`¥ötk
(" Stopping migrate damone \n");

5166 
	`migøã_mgr_deöô
(
su≥r
);

5168 
	`¥ötk
(" Stopping flush mgr \n");

5169 
	`Êush_mgr_deöô
(
su≥r
);

5171 
	`¥ötk
(" StoppingÑead miss damone \n");

5172 
	`ªad_miss_mgr_deöô
(
su≥r
);

5173 #i‡(
USE_SEG_WRITER
 == 1)

5174 
	`£g_wrôe_mgr_deöô
(
su≥r
);

5176 
	`¥ötk
(" StoppingÖending damone \n");

5177 
	`≥ndög_mgr_exô
(
su≥r
);

5179 
	`‰ì_ømbuf_poﬁ
(
su≥r
);

5180 
	`‰ì_£gmít_hódî_¨øy
(
su≥r
);

5181 
	`‰ì_ht
(
su≥r
);

5183 
	`mu…i_Æloˇt‹_deöô
(
su≥r
);

5185 if(
su≥r
->
∑øm
.
íabÀ_ªad_ˇche
){

5186 if(
su≥r
->
˛ón_døm_ˇche_m™agî
)

5187 
	`Ãu_deöô
(
su≥r
->
˛ón_døm_ˇche_m™agî
);

5190 #ifde‡
USE_GHOST_BUFFER


5191 if(
su≥r
->
∑øm
.
hŸ_idítifiˇti⁄
){

5194 
	`hŸ_fûãr_deöô
(
su≥r
);

5197 
	`¥ötk
(" Stoppingáll manages \n");

5198 
	}
}

5205 
	$dm§c_˘r
(
dm_èrgë
 *
ti
, 
¨gc
, **
¨gv
)

5207 
dm§c_su≥r
 *
su≥r
;

5208 
r
 = 0;

5210 
r
 = 
	`dm_£t_èrgë_max_io_Àn
(
ti
, (
SRC_SECTORS_PER_PAGE
));

5211 i‡(
r
) {

5212 
ti
->
îr‹
 = "failedÅo set max_io_len";

5213  
r
;

5216 
su≥r
 = 
	`kzÆloc
((*su≥r), 
GFP_KERNEL
);

5217 i‡(!
su≥r
) {

5218 
ti
->
îr‹
 = "couldn'tállocate super";

5219  -
ENOMEM
;

5222 
ti
->
Êush_suµ‹ãd
 = 
åue
;

5223 
ti
->
disˇrds_suµ‹ãd
 = 
Ál£
;

5224 
ti
->
num_Êush_bios
 = 1;

5225 
ti
->
num_disˇrd_bios
 = 1;

5226 
ti
->
disˇrd_zî€s_d©a_unsuµ‹ãd
 = 
åue
;

5227 
ti
->
≥r_bio_d©a_size
 = (
bio_˘x
);

5228 
ti
->
¥iv©e
 = 
su≥r
;

5230 
su≥r
->
ti
 =Åi;

5231 
	`•ö_lock_öô
(&
su≥r
->
io_lock
);

5233 
su≥r
->
io_˛õ¡
 = 
	`dm_io_˛õ¡_¸óã
();

5234 i‡(
	`IS_ERR
(
su≥r
->
io_˛õ¡
)) {

5235 
	`WBERR
("failedÅoálloc io_client");

5236 
r
 = 
	`PTR_ERR
(
su≥r
->
io_˛õ¡
);

5237 
bad_öô
;

5240 
	`£t_deÁu…_∑øm
(
su≥r
, &su≥r->
∑øm
);

5242 
r
 = 
	`c⁄sume_es£¡ül_¨gv
(
su≥r
, 
¨gc
, 
¨gv
);

5243 if(
r
){

5244 
bad_öô
;

5247 
r
 = 
	`gë_devi˚s
(
su≥r
);

5248 if(
r
){

5249 
bad_öô
;

5252 
r
 = 
	`sˇn_su≥rblock
(
su≥r
);

5253 i‡(
r
) {

5254 
ti
->
îr‹
 = "failedÅoáudit cache device";

5255 
bad_öô
;

5258 
r
 = 
	`devöfo_öô
(
su≥r
, su≥r->
dev_öfo
.
num_ˇche_devs
);

5259 i‡(
r
) {

5260 
ti
->
îr‹
 = "failedÅo init devinfo";

5261 
bad_öô
;

5264 if(
	`USE_ERASURE_CODE
(&
su≥r
->
∑øm
))

5265 
	`øid_c⁄f_öô
(
su≥r
, &su≥r->
øid_c⁄f
);

5267 
r
 = 
	`ªsume_m™agîs
(
su≥r
);

5268 i‡(
r
) {

5269 
ti
->
îr‹
 = "failedÅoÑesume managers";

5270 
bad_öô
;

5273 
r
 = 
	`sˇn_mëad©a
(
su≥r
);

5274 i‡(
r
) {

5275 
ti
->
îr‹
 = " failedÅoÑecovery metadata in SSDs";

5276 
bad_öô
;

5279 
	`°©_öô
(
su≥r
);

5280 
	`¥öt_∑øm
(
su≥r
);

5282 
	`¥ötk
(" DM-SRC has been successfuly started. \n");

5283  
r
;

5285 
bad_öô
:

5287 
	`dm§c_då
(
ti
);

5289  
r
;

5290 
	}
}

5293 
	$dm§c_då
(
dm_èrgë
 *
ti
)

5295 
dm§c_su≥r
 *
su≥r
 = 
ti
->
¥iv©e
;

5297 
	`°›_m™agîs
(
su≥r
);

5298 
	`put_devi˚s
(
su≥r
);

5299 if(
su≥r
->
io_˛õ¡
)

5300 
	`dm_io_˛õ¡_de°roy
(
su≥r
->
io_˛õ¡
);

5301 
	`k‰ì
(
su≥r
);

5302 
ti
->
¥iv©e
 = 
NULL
;

5304 
	`¥ötk
(" DM-SRC has beenÑemoved.\n");

5305 
	}
}

5308 
	$dm§c_ªsume
(
dm_èrgë
 *
ti
Ë{
	}
}

5310 
	$dm§c_mesßge
(
dm_èrgë
 *
ti
, 
¨gc
, **
¨gv
)

5312 
dm_¨g_£t
 
as
;

5313 
as
.
¨gc
 =árgc;

5314 
as
.
¨gv
 =árgv;

5316  
	`do_c⁄sume_tu«bÀ_¨gv
(
ti
, &
as
, 2);

5317 
	}
}

5319 
	$dm§c_mîge
(
dm_èrgë
 *
ti
, 
bvec_mîge_d©a
 *
bvm
,

5320 
bio_vec
 *
biovec
, 
max_size
)

5322 
dm§c_su≥r
 *
su≥r
 = 
ti
->
¥iv©e
;

5323 
dm_dev
 *
devi˚
 = 
su≥r
->
dev_öfo
.
‹igö_dev
;

5324 
ªque°_queue
 *
q
 = 
	`bdev_gë_queue
(
devi˚
->
bdev
);

5326 i‡(!
q
->
mîge_bvec_‚
)

5327  
max_size
;

5329 
bvm
->
bi_bdev
 = 
devi˚
->
bdev
;

5330  
	`mö
(
max_size
, 
q
->
	`mîge_bvec_‚
(q, 
bvm
, 
biovec
));

5331 
	}
}

5333 
	$dm§c_ôî©e_devi˚s
(
dm_èrgë
 *
ti
,

5334 
ôî©e_devi˚s_ˇŒout_‚
 
‚
, *
d©a
)

5336 
dm§c_su≥r
 *
su≥r
;

5337 
dm_dev
 *
‹ig
;

5338 
£˘‹_t
 
°¨t
 = 0;

5339 
£˘‹_t
 
Àn
;

5341 
su≥r
 = 
ti
->
¥iv©e
;

5342 
‹ig
 = 
su≥r
->
dev_öfo
.
‹igö_dev
;

5343 if(
‹ig
){

5344 
Àn
 = 
su≥r
->
dev_öfo
.
‹igö_£˘‹s
;

5345  
	`‚
(
ti
, 
‹ig
, 
°¨t
, 
Àn
, 
d©a
);

5348 
	}
}

5350 
èrgë_ty≥
 
	gdm§c_èrgë
 = {

5351 .
«me
 = "dmsrc",

5352 .
	gvîsi⁄
 = {0, 1, 0},

5353 .
	gmoduÀ
 = 
THIS_MODULE
,

5354 .
	gm≠
 = 
dm§c_m≠
,

5355 .
	gíd_io
 = 
dm§c_íd_io
,

5356 .
	g˘r
 = 
dm§c_˘r
,

5357 .
	gdå
 = 
dm§c_då
,

5358 .
	gªsume
 = 
dm§c_ªsume
,

5359 .
	gmîge
 = 
dm§c_mîge
,

5360 .
	gmesßge
 = 
dm§c_mesßge
,

5361 .
	gôî©e_devi˚s
 = 
dm§c_ôî©e_devi˚s
,

5364 
__öô
 
	$dm§c_moduÀ_öô
()

5366 
r
 = 0;

5368 
r
 = 
	`dm_ªgi°î_èrgë
(&
dm§c_èrgë
);

5369 i‡(
r
 < 0) {

5370 
	`WBERR
("ÁûedÅÿªgi°îÅ¨gëÉº(%d)", 
r
);

5371  
r
;

5375 
	}
}

5377 
__exô
 
	$dm§c_moduÀ_exô
()

5379 
	`dm_uƒegi°î_èrgë
(&
dm§c_èrgë
);

5380 
	}
}

5382 
moduÀ_öô
(
dm§c_moduÀ_öô
);

5383 
moduÀ_exô
(
dm§c_moduÀ_exô
);

5385 
MODULE_AUTHOR
("Yongseok Oh <ysoh@uos.ac.kr>");

5386 
MODULE_DESCRIPTION
(
DM_NAME
 " dmsrcÅarget");

5387 
MODULE_LICENSE
("GPL");

	@target.h

23 #i‚de‡
DM_SRC_H


24 
	#DM_SRC_H


	)

26 
	#DM_MSG_PREFIX
 "dm-§c"

	)

28 
	~<löux/moduÀ.h
>

29 
	~<löux/vîsi⁄.h
>

30 
	~<löux/li°.h
>

31 
	~<löux/¶ab.h
>

32 
	~<löux/vmÆloc.h
>

33 
	~<löux/muãx.h
>

34 
	~<löux/kthªad.h
>

35 
	~<löux/sched.h
>

36 
	~<löux/timî.h
>

37 
	~<löux/w‹kqueue.h
>

38 
	~<löux/devi˚-m≠≥r.h
>

39 
	~<löux/dm-io.h
>

40 
	~<löux/ty≥s.h
>

41 
	~"øid.h
"

42 
	~"hódî.h
"

45 
	#CRC_SEED
 17

	)

47 
	#NUM_SSD
 (
su≥r
->
dev_öfo
.
num_ˇche_devs
)

	)

48 
	#NUM_DATA_SSD
 (
su≥r
->
dev_öfo
.
num_d©a_ˇche_devs
)

49 

	)

50 
	#NUM_BLOCKS
 (
su≥r
->
ˇche_°©
.
num_blocks_≥r_ssd
 * 
NUM_SSD
)

	)

51 
	#NUM_USED_BLOCKS
 (
	`©omic_ªad
(&
su≥r
->
ˇche_°©
.
num_u£d_blocks
))

	)

52 
	#NUM_BLOCKS_PER_SSD
 (
su≥r
->
ˇche_°©
.
num_blocks_≥r_ssd
)

	)

54 
	#CHUNK_SZ
 (
su≥r
->
ˇche_°©
.
num_blocks_≥r_chunk
)

	)

55 
	#CHUNK_SZ_SECTOR
 (
su≥r
->
ˇche_°©
.
num_blocks_≥r_chunk
<<3)

	)

57 
	#SEGMENT_GROUP_SIZE
 (
su≥r
->
ˇche_°©
.
num_chunks_≥r_group
)

	)

58 
	#GROUP_SZ
 (
SEGMENT_GROUP_SIZE
*
su≥r
->
ˇche_°©
.
num_blocks_≥r_chunk
)

	)

59 
	#GROUP_SZ_SECTOR
 (
SEGMENT_GROUP_SIZE
*(
su≥r
->
ˇche_°©
.
num_blocks_≥r_chunk
<<3))

	)

61 
	#STRIPE_SZ
 (
CHUNK_SZ
 * 
NUM_SSD
)

	)

62 
	#STRIPE_SZ_SECTOR
 (
CHUNK_SZ_SECTOR
 * 
NUM_SSD
)

	)

64 
	#SEG_START_IDX
(
s
Ë(s->
£g_id
 * 
STRIPE_SZ
)

	)

67 
	#NO_USE_ERASURE_CODE
(
∑øm
Ë(’¨am)->
îasuª_code
==
ERASURE_CODE_NONE
)

	)

68 
	#USE_ERASURE_CODE
(
∑øm
Ë(’¨am)->
îasuª_code
!=
ERASURE_CODE_NONE
)

	)

69 
	#USE_ERASURE_PARITY
(
∑øm
Ë(’¨am)->
îasuª_code
==
ERASURE_CODE_PARITY
)

	)

70 
	#USE_ERASURE_RAID6
(
∑øm
Ë(’¨am)->
îasuª_code
==
ERASURE_CODE_RAID6
)

	)

72 
	#STRIPING_POLICY
 (
su≥r
->
∑øm
.
°rùög_pﬁicy
)

	)

74 
	#MIGRATE_LOWWATER
 (
su≥r
->
∑øm
.
migøã_loww©î
)

	)

75 
	#MIGRATE_HIGHWATER
 (
su≥r
->
∑øm
.
migøã_highw©î
)

	)

78 
	#SEQ_CUTOFF
 (8192*512)

79 
	#SEQ_CUTOFF_MIN
 (256*512)

80 
	#SEQ_CUTOFF_MAX
 (
SEQ_CUTOFF
*4)

81 

	)

83 
	#TIMEOUT_US
 10

	)

86 
	#RES_MIG
 1

	)

87 
	#RES_PARTIAL
 2

	)

88 
	#RES_SEAL
 3

	)

89 
	#RES_NOFREE1
 4

	)

90 
	#RES_NOFREE2
 5

	)

91 
	#RES_FLUSH
 6

	)

92 
	#RES_BYPASS
 7

	)

93 
	#RES_ACTIVE
 8

	)

94 
	#RES_DRAM
 9

	)

95 
	#RES_COUNT
 10

	)

99 
	#SEG_CLEAN
 0

	)

100 
	#SEG_USED
 1

	)

101 
	#SEG_SEALED
 2

	)

102 
	#SEG_MIGRATING
 3

	)

103 
	#SEG_PARTIAL
 4

	)

104 
	#SEG_RECOVERY
 5

	)

105 
	#SEG_HIT
 6

	)

106 
	#SEG_LOCK
 7

	)

108 
	sgroup_hódî
 {

109 
•ölock_t
 
	mlock
;

110 
u32
 
	mgroup_id
;

111 
u32
 
	mcuºít_£g_id
;

112 
©omic_t
 
	m‰ì_£g_cou¡
;

113 
©omic_t
 
	m£Æed_£g_cou¡
;

114 
©omic_t
 
	mvÆid_cou¡
;

116 
©omic_t
 
	mnum_u£d_ssd
;

117 
©omic_t
 
	mskewed_£gmít
;

119 
li°_hód
 
	mÆloc_li°
;

120 
li°_hód
 
	mgroup_hód
;

124 
	s£gmít_hódî
 {

125 
•ölock_t
 
	mlock
;

126 
li°_hód
 
	mÆloc_li°
;

127 
li°_hód
 
	mgroup_li°
;

128 
li°_hód
 
	mmigøã_li°
;

130 
group_hódî
 *
	mgroup
;

132 
u64
 
	m£g_id
;

133 
u64
 
	mgroup_id
;

134 
u64
 
	m£quí˚
;

135 
u32
 
	m£g_ty≥
;

136 
u32
 
	m£g_lﬂd
;

137 
	mÊags
;

139 
©omic_t
 
	mvÆid_cou¡
;

140 
©omic_t
 
	mvÆid_˛ón_cou¡
;

141 
©omic_t
 
	mvÆid_dúty_cou¡
;

142 
©omic_t
 
	mdummy_cou¡
;

143 
©omic_t
 
	mdúty_cou¡
;

144 
©omic_t
 
	mhŸ_cou¡
;

145 
©omic_t
 
	mhŸ_˛ón_cou¡
;

147 
©omic_t
 
	m∑π_°¨t
;

148 
©omic_t
 
	m∑π_Àngth
;

149 
©omic_t
 
	mÀngth
;

151 
©omic_t
 
	mbios_cou¡
;

153 
©omic_t
 
	mnum_ªad_öÊight
;

154 
©omic_t
 
	mnum_fûlög
;

155 
©omic_t
 
	mnum_wrôeback
;

156 
©omic_t
 
	mnum_bufc›y
;

157 
©omic_t
 
	mnum_migios
;

159 
©omic_t
 
	msumm¨y_°¨t
[
MAX_CACHE_DEVS
];

169 
	#lock£g
(
£g
, 
Êags
Ë
	`•ö_lock_úqßve
(&(£g)->
lock
, fœgs)

	)

170 
	#u∆ock£g
(
£g
, 
Êags
Ë
	`•ö_u∆ock_úqª°‹e
(&(£g)->
lock
, fœgs)

	)

177 
	s£gmít_hódî_devi˚
 {

179 
__À64
 
	m£quí˚
;

180 
__À64
 
	muuid
;

181 
__À32
 
	mmagic
;

182 
__À32
 
	mty≥
;

188 
__À32
 
	mœp
;

189 
u8
 
	m∑ddög
[
SEGMENT_HEADER_SIZE
 - (8 + 8 + 4 + 4 + 4)];

192 } 
	g__∑cked
;

194 
	sømbuf„r
 {

195 
li°_hód
 
	mli°
;

196 
ømbuf_∑ge
 **
	m∑ges
;

197 
	mømbuf_id
;

198 
	mÆloc_cou¡
;

199 
©omic_t
 
	mªf_cou¡
;

201 *
	m£g_buf
[
MAX_CACHE_DEVS
];

203 
bio
 **
	mbios
;

204 
©omic_t
 
	mbios_cou¡
[
MAX_CACHE_DEVS
];

205 
©omic_t
 
	mbios_°¨t
[
MAX_CACHE_DEVS
];

206 
©omic_t
 
	mbios_tŸÆ_cou¡
;

207 
©omic_t
 
	mbios_tŸÆ_°¨t
;

208 
•ölock_t
 
	mlock
;

212 
	sht_hód
 {

213 
hli°_hód
 
	mht_li°
;

216 
	sio
 {

218 
hli°_node
 
	mhash
;

219 
li°_hód
 
	mÃu
;

221 
	mjiffõs
;

222 
	m£quítül
;

223 
£˘‹_t
 
	mœ°
;

226 
	sªad_ˇchög_job_li°
{

227 
•ölock_t
 
	mrm_•ölock
;

228 
©omic_t
 
	mrm_c›y_cou¡
;

229 
li°_hód
 
	mrm_c›y_hód
;

232 
	sªad_ˇchög_job
{

233 
li°_hód
 
	mgn_li°
;

235 
bio
 *
	mgn_bio
;

236 
dm§c_su≥r
 *
	mgn_su≥r
;

237 
	mgn_bio_îr‹
;

239 
mëablock
 *
	mgn_mb
;

240 
£gmít_hódî
 *
	mgn_£g
;

241 
ømbuf„r
 *
	mgn_ømbuf
;

243 
£˘‹_t
 
	mgn_£˘‹
;

246 
	ssu≥r_°©
{

247 
u32
 
	mhô
;

248 
u32
 
	mcou¡
;

249 
u32
 
	mªad_hô
;

250 
u32
 
	mªad_cou¡
;

251 
u32
 
	mwrôe_hô
;

252 
u32
 
	mwrôe_cou¡
;

254 
©omic64_t
 
	mavîage_¨rivÆ_time
;

255 
©omic64_t
 
	mavîage_¨rivÆ_cou¡
;

257 
©omic_t
 
	m£q_by∑ss_cou¡
;

258 
©omic_t
 
	mcﬁd_by∑ss_cou¡
;

260 
©omic_t
 
	mde°age_cou¡
;

261 
©omic_t
 
	mgc_cou¡
;

262 
©omic_t
 
	mgc_em±y_cou¡
;

263 
©omic_t
 
	mtŸÆ_migøti⁄
;

264 
©omic64_t
 
	mvi˘im_utû
;

265 
©omic64_t
 
	mvi˘im_cou¡
;

267 
©omic64_t
 
	mgc_io_cou¡
;

269 
©omic64_t
 
	mde°age_io_cou¡
;

271 
©omic64_t
 
	mssd_wrôe_hô_cou¡
;

272 
©omic64_t
 
	mssd_wrôe_miss_cou¡
;

274 
©omic64_t
 
	mssd_ªad_hô_cou¡
;

275 
©omic64_t
 
	mssd_ªad_miss_cou¡
;

277 
©omic_t
 
	m£g_cou¡
[
NBUF
];

279 
©omic_t
 
	m∑πül_wrôe_cou¡
;;

280 
©omic_t
 
	mby∑ss_wrôe_cou¡
;;

288 
	ssumm¨y_io_job
{

289 
	m£g_Àngth
;

290 
	mˇche_ty≥
;

291 
£gmít_hódî
 *
	m£g
;

292 
ømbuf„r
 *
	mømbuf
;

293 
bio_li°
 
	mb¨rõr_ios
;

294 *
	msu≥r
;

295 
©omic_t
 
	mcou¡
;

296 
©omic_t
 
	mªÀa£
;

303 
	sÊush_övoke_job
 {

304 
li°_hód
 
	mli°
;

305 
£gmít_hódî
 *
	m£g
;

306 
ømbuf„r
 *
	mømbuf
;

307 
bio_li°
 
	mb¨rõr_ios
;

309 
	m£g_Àngth
;

310 
	mÊush_d©a
;

311 
	mbuûd_summ¨y
;

312 
	mˇche_ty≥
;

313 
	mf‹˚_£Æ
;

314 
u64
 
	mglobÆ_£g_£quí˚
;

315 
©omic_t
 
	mbios_°¨t
[
MAX_CACHE_DEVS
];

316 
©omic_t
 
	mbios_cou¡
[
MAX_CACHE_DEVS
];

320 
	swb_job
{

321 
dm§c_su≥r
 *
	msu≥r
;

322 
£gmít_hódî
 *
	m£g
;

323 
mëablock
 *
	mmb
;

324 
bio
 *
	mbio
;

325 
ømbuf„r
 *
	mømbuf
;

327 
©omic_t
 
	mømbuf_ªÀa£
;

328 
u32
 
	m°¨t_idx
;

329 
u32
 
	mcou¡
;

330 
	mÊush_comm™d
;

331 
	mîr‹
;

332 
li°_hód
 
	mli°
;

335 
	sªcovîy_job
{

336 
dm§c_su≥r
 *
	msu≥r
;

337 
£gmít_hódî
 *
	m£g
;

338 
ømbuf„r
 *
	mømbuf
;

339 
mëablock
 *
	mmb
;

340 
li°_hód
 
	mªcovîy_li°
;

341 
©omic_t
 
	mnum_ªmaöög_ios
;

342 
	mis_ªad
;

343 
	mîr‹
;

346 
	sdegøded_job
{

347 
dm§c_su≥r
 *
	msu≥r
;

348 
£gmít_hódî
 *
	m£g
;

349 
mëablock
 *
	mmb
;

350 
li°_hód
 
	mdegøded_li°
;

351 
bio
 *
	m‹g_bio
;

352 
©omic_t
 
	mnum_ªmaöög_ios
;

353 *
	mbuf
;

354 
	mîr‹
;

358 
	s∂ug_job
{

359 
li°_hód
 
	m∂ug_li°
;

360 
£gmít_hódî
 *
	m£g
;

361 
ømbuf„r
 *
	mømbuf
;

362 
bio
 *
	mbio
;

363 
u32
 
	midx
;

368 
	sømbuf_∑ge
{

369 
li°_hód
 
	mli°
;

371 
∑ge_li°
 *
	m∂
;

375 
	smu…i_Æloˇt‹
{

376 
•ölock_t
 
	mlock
[
MAX_CACHE_DEVS
];

377 
s32
 
	mcurs‹
[
MAX_CACHE_DEVS
];

378 
©omic_t
 
	mcou¡
[
MAX_CACHE_DEVS
];

379 
©omic_t
 
	mtŸÆ_cou¡
;

380 
©omic_t
 *
	mrow_cou¡
;

381 
©omic_t
 
	mcur_dev
;

382 
	m£g_em±y_chunk_m≠
[
NBUF
][
MAX_CACHE_DEVS
];

383 
	mgroup_em±y_chunk_m≠
[
NBUF
][
MAX_CACHE_DEVS
];

387 
	#MAX_ARRIVAL_TIME
 16384

	)

388 
	#DEFAULT_ARRIVAL_US
 100

	)

391 
	s≥ndög_m™agî
{

392 
•ölock_t
 
	mlock
;

393 
bio_li°
 
	mbios
;

394 
w‹kqueue_°ru˘
 *
	mwq
;

395 
w‹k_°ru˘
 
	mw‹k
;

396 
©omic64_t
 
	mio_cou¡
;

399 
time•ec
 
	m¨rivÆ_times
[
MAX_ARRIVAL_TIME
];

400 
©omic_t
 
	m¨rivÆ_°¨t
;

401 
©omic_t
 
	m¨rivÆ_cou¡
;

402 
©omic_t
 
	m¨rivÆ_cur
;

405 
•ölock_t
 
	mb¨rõr_lock
;

406 
bio_li°
 
	mb¨rõr_ios
;

407 
©omic_t
 
	mb¨rõr_cou¡
;

409 
dm§c_su≥r
 *
	msu≥r
;

412 
mempoﬁ_t
 *
	mwb_job_poﬁ
;

413 
	möôülized
;

419 
	#RECENT_IO_BITS
 7

	)

420 
	#RECENT_IO
 (1 << 
RECENT_IO_BITS
)

	)

421 
	s£q_io_dëe˘‹
{

422 
•ölock_t
 
	m£q_lock
;

423 
io
 
	mio
[
RECENT_IO
];

424 
hli°_hód
 
	mio_hash
[
RECENT_IO
 + 1];

425 
li°_hód
 
	mio_Ãu
;

430 
	s£gbuf_m™agî
{

431 
•ölock_t
 
	mlock
;

433 
	möôülized
;

435 
ømbuf„r
 *
	mcuºít_ømbuf
[
NBUF
];

436 
ømbuf„r
 *
	mømbuf_poﬁ
;

437 
u32
 
	mnum_ømbuf_poﬁ
;

439 **
	m∑ges
;

440 **
	mbios
;

442 
li°_hód
 
	ma˘ive_li°
;;

443 
li°_hód
 
	möa˘ive_li°
;

444 
©omic_t
 
	ma˘ive_tŸÆ_cou¡
;

445 
©omic_t
 
	ma˘ive_cou¡
[
NBUF
];

446 
©omic_t
 
	möa˘ive_cou¡
;

448 
li°_hód
 
	ma˘ive_∑ge_li°
;

449 
li°_hód
 
	möa˘ive_∑ge_li°
;

450 
©omic_t
 
	ma˘ive_∑ge_cou¡
;

451 
©omic_t
 
	möa˘ive_∑ge_cou¡
;

452 
©omic_t
 
	mtŸÆ_∑ge_cou¡
;

454 
©omic_t
 
	mgc_a˘ive_∑ge_cou¡
;

456 
waô_queue_hód_t
 
	mwaô_queue
;

460 
	s£gmít_Æloˇt‹
{

461 
•ölock_t
 
	mÆloc_lock
;

463 
li°_hód
 
	mgroup_Æloc_queue
;

464 
li°_hód
 
	mgroup_u£d_queue
;

465 
li°_hód
 
	mgroup_£Æed_queue
;

466 
li°_hód
 
	mgroup_migøã_queue
;

468 
©omic_t
 
	mgroup_Æloc_cou¡
;

469 
u32
 
	mgroup_u£d_cou¡
;

470 
u32
 
	mgroup_£Æed_cou¡
;

471 
©omic_t
 
	mgroup_migøã_cou¡
;

473 
li°_hód
 
	m£g_Æloc_queue
;

474 
li°_hód
 
	m£g_u£d_queue
;

475 
li°_hód
 
	m£g_£Æed_queue
;

476 
li°_hód
 
	m£g_migøã_queue
;

478 
©omic_t
 
	m£g_Æloc_cou¡
;

479 
u32
 
	m£g_u£d_cou¡
;

480 
u32
 
	m£g_£Æed_cou¡
;

481 
©omic_t
 
	m£g_migøã_cou¡
;

482 
waô_queue_hód_t
 
	mÆloc_waô_queue
;

486 
	sdegøded_m™agî
{

487 
mempoﬁ_t
 *
	mjob_poﬁ
;

488 
mempoﬁ_t
 *
	mbuf_poﬁ
;

490 
w‹kqueue_°ru˘
 *
	mwq
;

491 
w‹k_°ru˘
 
	mw‹k
;

492 
•ölock_t
 
	mlock
;

493 
li°_hód
 
	mqueue
;

494 
dm§c_su≥r
 *
	msu≥r
;

495 
	möôülized
;

499 
	sªcovîy_m™agî
{

500 
©omic_t
 
	mbrokí_block_cou¡
;

501 
èsk_°ru˘
 *
	md´m⁄
;

503 
mempoﬁ_t
 *
	mjob_poﬁ
;

505 
w‹kqueue_°ru˘
 *
	mwq
;

506 
w‹k_°ru˘
 
	mw‹k
;

508 
•ölock_t
 
	mlock
;

509 
li°_hód
 
	mqueue
;

511 
	mÁûuª_ssd
;

513 
	m°¨t_jiffõs
;

514 
	míd_jiffõs
;

516 
dm§c_su≥r
 *
	msu≥r
;

518 
	möôülized
;

522 
	sÊush_m™agî
{

523 
èsk_°ru˘
 *
	md´m⁄
;

525 
•ölock_t
 
	mlock
;

526 
li°_hód
 
	mqueue
;

527 
©omic_t
 
	mövoke_cou¡
;

528 
©omic64_t
 
	mglobÆ_£g_£quí˚
;

529 
©omic_t
 
	mio_cou¡
;

530 
mempoﬁ_t
 *
	mövoke_poﬁ
;

533 
	möôülized
;

537 
	smigøti⁄_m™agî
{

538 
èsk_°ru˘
 *
	md´m⁄
;

540 
©omic_t
 
	mmigøã_åiggîed
;

541 
©omic_t
 
	mbackground_gc_⁄
;

542 
	mÆlow_migøã
;

544 
•ölock_t
 
	mmig_queue_lock
;

545 
•ölock_t
 
	mgroup_queue_lock
;

546 
li°_hód
 
	mmig_queue
;

547 
li°_hód
 
	mc›y_queue
;

548 
li°_hód
 
	mgroup_queue
;

550 
£gmít_hódî
 *
	mgc_cur_£g
;

551 
	mgc_cur_off£t
;

552 
	mgc_Æloc_cou¡
;

554 
mempoﬁ_t
 *
	mc›y_job_poﬁ
;

555 
mempoﬁ_t
 *
	mgroup_job_poﬁ
;

556 
©omic_t
 
	mgroup_job_cou¡
;

557 
©omic_t
 
	mc›y_job_cou¡
;

558 
©omic_t
 
	mgroup_job_£q
;

561 
w‹kqueue_°ru˘
 *
	mmig_wq
;

562 
w‹k_°ru˘
 
	mmig_w‹k
;

563 
©omic_t
 
	mmig_öÊights
;

564 
©omic_t
 
	mmig_com∂ëes
;

566 
li°_hód
 
	mmigøã_queue
;

568 
©omic_t
 
	mmigøã_queue_cou¡
;

570 
dm§c_su≥r
 *
	msu≥r
;

572 
	möôülized
;

577 
	s∂uggög_m™agî
{

578 
timî_li°
 
	mtimî
;

579 
•ölock_t
 
	mlock
[
MAX_CACHE_DEVS
];

580 
li°_hód
 
	mqueue
[
MAX_CACHE_DEVS
];

581 
©omic_t
 
	mtŸÆ_Àngth
;

582 
©omic_t
 
	mqueue_Àngth
[
MAX_CACHE_DEVS
];

583 
	mœ°_jiffõs
[
MAX_CACHE_DEVS
];

584 
	mdódlöe_us
;

587 
dm§c_su≥r
 *
	msu≥r
;

589 
	möôülized
;

593 
	s£g_wrôe_m™agî
{

594 
w‹k_°ru˘
 
	mw‹k
;

595 
w‹kqueue_°ru˘
 *
	mwq
;

597 
•ölock_t
 
	m•ölock
;

598 
©omic_t
 
	mcou¡
;

599 
li°_hód
 
	mhód
;

600 
dm§c_su≥r
 *
	msu≥r
;

601 
	möôülized
;

605 
	sªad_miss_m™agî
{

606 
w‹k_°ru˘
 
	mw‹k
;

607 
w‹kqueue_°ru˘
 *
	mwq
;

608 
mempoﬁ_t
 *
	mjob_poﬁ
;

609 
ªad_ˇchög_job_li°
 
	mqueue
;

610 
dm§c_su≥r
 *
	msu≥r
;

611 
	möôülized
;

615 
	ssync_m™agî
{

616 
hπimî
 
	mhr_timî
;

618 
ktime_t
 
	m≥riod
;

619 
w‹k_°ru˘
 
	mw‹k
;

620 
•ölock_t
 
	mlock
;

621 
	mèrgë_jiffõs
;

622 
dm§c_su≥r
 *
	msu≥r
;

623 
	möôülized
;

626 
	#REQ_CATEGORY_NORMAL
 0

	)

627 
	#REQ_CATEGORY_GC
 1

	)

628 
	#REQ_CATEGORY_TOTAL
 2

	)

629 
	#REQ_CATEGORY_NUM
 3

	)

631 
	#REQ_TYPE_READ
 0

	)

632 
	#REQ_TYPE_WRITE
 1

	)

633 
	#REQ_TYPE_TOTAL
 2

	)

634 
	#REQ_TYPE_NUM
 3

	)

636 
	sio_°©_t
{

637 
©omic64_t
 
	mi›s
[
REQ_CATEGORY_NUM
][
REQ_TYPE_NUM
];

640 
	#MAX_WINDOW_NUM
 (
MSEC_PER_SEC
*5)

	)

643 
	sw‹klﬂd_¥edi˘‹
{

644 
hπimî
 
	mhr_timî_åack
;

645 
ktime_t
 
	måack_≥riod
;

647 
hπimî
 
	mhr_timî_mëî
;

648 
ktime_t
 
	mdi•œy_≥riod
;

650 
•ölock_t
 
	mlock
;

651 
©omic_t
 
	m°¨t_wödow
;

652 
©omic_t
 
	mcur_wödow
;

653 
u32
 
	mnum_wödow
;

654 
u32
 
	mwödow_≥r_£c
;

656 
io_°©_t
 
	mio°©
[
MAX_WINDOW_NUM
];

657 
dm§c_su≥r
 *
	msu≥r
;

658 
	möôülized
;

661 
	ssˇn_mëad©a_job
{

662 
li°_hód
 
	mli°
;

663 
dm§c_su≥r
 *
	msu≥r
;

664 
	mbio_îr‹
;

665 *
	md©a
;

666 
u32
 
	m£g_id
;

667 
u32
 
	mssd_id
;

669 
	mödex
;

673 
	ssˇn_mëad©a_m™agî
{

674 
•ölock_t
 
	mlock
;

676 
li°_hód
 
	mcom∂ëe_queue
;

677 
li°_hód
 
	möa˘ive_queue
;

678 
©omic_t
 
	ma˘ive_cou¡
;

679 
©omic_t
 
	möa˘ive_cou¡
;

680 
©omic_t
 
	mcom∂ëe_cou¡
;

681 
	mqdïth
;

685 
	#MAX_BITMAP_TABLE
 4

	)

687 
	shŸ_d©a_fûãr
{

688 
•ölock_t
 
	mlock
;

689 
	mio_cou¡
;;

690 
	mdeˇy_≥riod
;

691 
	mhŸ_thªshﬁd
;

692 
	mhash_num
;

693 
	mbôm≠_èbÀ_num
;

694 
	mnum_bôs_≥r_èbÀ
;

695 
	mnum_byãs_≥r_èbÀ
;

696 
	mcur_èbÀ
;

697 
	mœ°_èbÀ
;

698 *
	mbôm≠
[
MAX_BITMAP_TABLE
];

701 
	sdevi˚_öfo
{

702 
	mnum_ˇche_devs
;

703 
	mnum_•¨e_ˇche_devs
;

704 
	mnum_d©a_ˇche_devs
;

706 
	m‹igö_«me
[128];

707 
	mˇche_«me
[
MAX_CACHE_DEVS
][128];

708 
	m•¨e_«me
[
MAX_CACHE_DEVS
][128];

710 
dm_dev
 *
	m‹igö_dev
;

711 
dm_dev
 *
	mˇche_dev
[
MAX_CACHE_DEVS
];

712 
dm_dev
 *
	m•¨e_ˇche_dev
[
MAX_CACHE_DEVS
];

714 
su≥rblock_devi˚
 
	msb_devi˚
[
MAX_CACHE_DEVS
];

716 
u32
 
	m≥r_ˇche_bw
;

717 
£˘‹_t
 
	m‹igö_£˘‹s
;

718 
£˘‹_t
 
	m≥r_ssd_£˘‹s
;

722 
	sˇche_°©
{

723 
u64
 
	muuid
;

724 
©omic64_t
 
	mÆloc_£quí˚
;

726 
©omic_t
 
	mnum_‰ì_£gmíts
;

727 
©omic_t
 
	mnum_u£d_blocks
;

728 
u32
 
	mnum_blocks_≥r_chunk
;

729 
u32
 
	mnum_blocks_≥r_ssd
;

730 
u32
 
	mnum_£gmíts
;

731 
u32
 
	mnum_groups
;

732 
u32
 
	mnum_chunks_≥r_ssd
;

733 
u32
 
	mnum_chunks_≥r_group
;

735 
©omic64_t
 
	mnum_dúty_blocks
;

737 
©omic_t
 
	möÊight_ios
;

738 
©omic_t
 
	möÊight_bios
;

740 
©omic_t
 
	mtŸÆ_ios
;

741 
©omic_t
 
	mtŸÆ_bios
;

742 
©omic_t
 
	mtŸÆ_bios2
;

745 
	sdm§c_∑øm
{

747 
u32
 
	mblock_size
;

748 
u32
 
	mchunk_size
;

749 
u32
 
	mchunk_group_size
;

750 
u32
 
	mnum_summ¨y_≥r_chunk
;

751 
u32
 
	mnum_íåy_≥r_∑ge
;

752 
u32
 
	m∑rôy_Æloˇti⁄
;

753 
u32
 
	m°rùög_pﬁicy
;

754 
u32
 
	md©a_Æloˇti⁄
;

755 
u32
 
	mÆig√d_io_dummy
;

756 
u32
 
	mîasuª_code
;

758 
u32
 
	mÊush_comm™d
;

761 
u32
 
	mømbuf_poﬁ_amou¡
;

765 
	m£quítül_cutoff
;

766 
	m£quítül_íabÀ
;

768 
u32
 
	mvi˘im_pﬁicy
;

769 
u32
 
	mª˛aim_pﬁicy
;

770 
u32
 
	mu_max
;

771 
u32
 
	mgc_wôh_dútysync
;

772 
u32
 
	mmax_migøã_öÊights
;

773 
u32
 
	mmigøã_loww©î
;

774 
u32
 
	mmigøã_highw©î
;

775 
u32
 
	mhô_bôm≠_ty≥
;

776 
u32
 
	mbio_∂uggög
;

777 
u32
 
	mhŸ_idítifiˇti⁄
;

778 
u32
 
	míabÀ_ªad_ˇche
;

780 
u32
 
	msync_öãrvÆ
;

781 
u32
 
	mcheckî_öãrvÆ
;

784 
	sdm§c_su≥r
 {

786 
©omic_t
 
	mdegøded_mode
;

787 
©omic_t
 
	mªsize_mode
;

789 
dm_èrgë
 *
	mti
;

790 
dm_io_˛õ¡
 *
	mio_˛õ¡
;

792 
•ölock_t
 
	mio_lock
;

795 
£gmít_hódî
 *
	mcuºít_£g
[
NBUF
];

797 
œrge_¨øy
 *
	m£gmít_hódî_¨øy
;

800 
group_hódî
 *
	mcuºít_group
;

802 
group_hódî
 *
	mgroup_hódî_¨øy
;

805 
œrge_¨øy
 *
	mmëablock_¨øy
[
MAX_CACHE_DEVS
];

806 
	mmëa_öôülized
;

809 
œrge_¨øy
 *
	mhèbÀ
;

810 
size_t
 
	mhtsize
;

811 
ht_hód
 *
	mnuŒ_hód
;

812 
	mht_öôülized
;

815 
mu…i_Æloˇt‹
 
	mma
[
NBUF
];

817 
ˇche_m™agî
 *
	m˛ón_døm_ˇche_m™agî
;

820 
ˇche_m™agî
 *
	mÃu_m™agî
;

823 
hŸ_d©a_fûãr
 
	mhŸ_fûãr
;

826 
devi˚_öfo
 
	mdev_öfo
;

829 
r5c⁄f
 
	møid_c⁄f
;

832 
dm§c_∑øm
 
	m∑øm
;

834 
ˇche_°©
 
	mˇche_°©
;

836 
su≥r_°©
 
	mw°©
;

839 
≥ndög_m™agî
 
	m≥ndög_mgr
;

842 
£q_io_dëe˘‹
 
	m£q_dëe˘‹
;

845 
degøded_m™agî
 
	mdegøded_mgr
;

848 
ªcovîy_m™agî
 
	mªcovîy_mgr
;

851 
£gmít_Æloˇt‹
 
	m£g_Æloˇt‹
;

854 
£gbuf_m™agî
 
	m£gbuf_mgr
;

857 
Êush_m™agî
 
	mÊush_mgr
;

860 
migøti⁄_m™agî
 
	mmigøã_mgr
;

863 
∂uggög_m™agî
 
	m∂uggî
;

866 
ªad_miss_m™agî
 
	mªad_miss_mgr
;

868 
£g_wrôe_m™agî
 
	m£g_wrôe_mgr
[
MAX_CACHE_DEVS
];

871 
sync_m™agî
 
	msync_mgr
;

874 
èsk_°ru˘
 *
	mcheckî_d´m⁄
;

877 
sˇn_mëad©a_m™agî
 *
	msˇn_m™agî
;

880 
w‹klﬂd_¥edi˘‹
 
	mwp
;

886 
	#iﬁock
(
x
, 
f
Ë
	`•ö_lock_úqßve
(&x->
io_lock
, f)

	)

887 
	#iou∆ock
(
x
, 
f
Ë
	`•ö_u∆ock_úqª°‹e
(&x->
io_lock
, f)

	)

888 
	#LOCK
(
su≥r
, 
x
Ë
	`iﬁock
(su≥r, x)

	)

889 
	#UNLOCK
(
su≥r
, 
x
Ë
	`iou∆ock
(su≥r, x)

	)

891 
	sc›y_job_group
{

892 
dm§c_su≥r
 *
	msu≥r
;

893 
li°_hód
 
	mgroup_li°
;

894 
li°_hód
 
	m˝_hód
;

895 
£gmít_hódî
 *
	md°_£g
;

896 
ømbuf„r
 *
	md°_ømbuf
;

897 
©omic_t
 
	m˝_job_cou¡
;

898 
	mˇche_ty≥
;

900 
	mrw
;

901 
	m£q
;

902 
	mîr‹
;

903 
	mgc
;

906 
	sc›y_job
{

907 
li°_hód
 
	m˝_li°
;

908 
dm_io_ªque°
 
	mio_ªq
;

909 
dm_io_ªgi⁄
 
	md°_ªgi⁄
[2];

910 
	md°_cou¡
;

911 
dm_io_ªgi⁄
 
	m§c_ªgi⁄
;

912 
mëablock
 *
	m§c_mb
;

913 
mëablock
 *
	md°_mb
;

914 
ømbuf_∑ge
 *
	m∑ge
;

920 
	sbio_˘x
 {

921 *
	m±r
;

922 
	m£q_io
;

923 
	mhŸ_io
;

924 
	möÊight
;

925 
u32
 
	m¸c32
;

932 
Êush_∑πül_mëa
(
dm§c_su≥r
 *, 
ˇche_ty≥
);

933 
öc_num_dúty_ˇches
(
dm§c_su≥r
 *);

934 
˛ónup_mb_if_dúty
(
dm§c_su≥r
 *,

935 
£gmít_hódî
 *,

936 
mëablock
 *);

937 
u8
 
©omic_ªad_mb_dútöess
(
£gmít_hódî
 *, 
mëablock
 *);

938 
u8
 
©omic_ªad_mb_vÆid√ss
(
£gmít_hódî
 *
£g
, 
mëablock
 *
mb
);

939 
övÆid©e_¥evious_ˇche
(
dm§c_su≥r
 *
su≥r
,

940 
£gmít_hódî
 *
£g
,

941 
mëablock
 *
ﬁd_mb
);

943 
mëablock
 *
Æloc_mb_d©a
(
dm§c_su≥r
 *
su≥r
,

944 
£˘‹_t
 
key
,

945 
ˇche_ty≥
,

946 
boﬁ
 
˛ón
,

947 
u32
 *
tŸÆ_cou¡
);

950 
w‹kqueue_°ru˘
 *
ß„_io_wq
;

951 
dm_io_˛õ¡
 *
su≥r_io_˛õ¡
;

952 
dm_kc›yd_˛õ¡
 *
su≥r_˝_˛õ¡
[];

955 
£˘‹_t
 
dm§c_devsize_£˘‹s
(
dm_dev
 *);

957 
ªad_ˇchög_job
 *
Æloc_gho°_node
(
dm§c_su≥r
 *
su≥r
);

958 
upd©e_d©a_ö_mb
(
dm§c_su≥r
 *
su≥r
,

959 
u32
 
upd©e_mb_idx
,

960 
£gmít_hódî
 *
£g
,

961 
ømbuf„r
 *
ømbuf
,

962 
ˇche_ty≥
,

963 *
d©a
,

964 
u32
 
¸c32
);

966 
upd©e_buf_ö_mb
(
dm§c_su≥r
 *
su≥r
,

967 
u32
 
upd©e_mb_idx
,

968 
£gmít_hódî
 *
£g
,

969 *
buf
,

970 
ˇche_ty≥
,

971 
boﬁ
 
migøã
);

973 
Êush_≥ndög_bios
(
dm§c_su≥r
 *
su≥r
);

974 
ª‰esh_£gmít
(
dm§c_su≥r
 *
su≥r
,

975 
£gmít_hódî
 *
£g
,

976 
ømbuf„r
 *
ømbuf
,

977 
ˇche_ty≥
, 
boﬁ
 
migøã
, boﬁ 
f‹˚
, 
cou¡
,

978 
bio_li°
 *);

979 
upd©e_∑rôy
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
);

980 
boﬁ
 
√ed_ª‰esh_£gmít
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
, 
cou¡
);

981 
gíî©e_∑rôy_d©a
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
ømbuf_∑ge
 **, 
fuŒ_£g
, 
ˇche_ty≥
);

982 
ª£t_∑rôy
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
ˇche_ty≥
, 
˛ór_wrôãn
);

983 
wrôe_async_bio
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
u32
 
idx
, 
bio
 *bio,

984 
ømbuf„r
 *
ømbuf
, 
fuŒ
);

986 
£˘‹_t
 
ˇlc_ˇche_Æignmít
(
dm§c_su≥r
 *
su≥r
, se˘‹_à
bio_£˘‹
);

987 
£gmít_hódî
 *
gë_£g_by_mb
(
dm§c_su≥r
 *
su≥r
, 
mëablock
 *
mb
);

988 
≥ndög_bio_add
(
dm§c_su≥r
 *
su≥r
, 
bio
 *bio);

989 
u64
 
Æloc_√w_£gmít
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
, 
boﬁ
 
u£_migøã
);

990 
waô_ømbuf_evít
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
);

991 
waô_Æloc_evít
(
dm§c_su≥r
 *
su≥r
, 
mö
);

992 
make_Êush_övoke_job
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
,

993 
ømbuf„r
 *
ømbuf
, 
£g_Àngth
, 
©omic_t
 *
bios_°¨t
,átomic_à*
bios_cou¡
,

994 
ˇche_ty≥
, 
f‹˚_£Æ
, 
summ¨y
, 
Êush_d©a
, 
u64
 
globÆ_£g_£quí˚
);

995 
åy_gë_‰ì_£gmít
(
dm§c_su≥r
 *
su≥r
, 
boﬁ
 
found
, 
rw
);

996 
buûd_mëad©a
(
dm§c_su≥r
 *
su≥r
,

997 
£gmít_hódî
 *
£g
,

998 
£g_Àngth
,

999 
ømbuf„r
 *
ømbuf
,

1000 
©omic_t
 *
bios_°¨t
,

1001 
©omic_t
 *
bios_cou¡
,

1002 
f‹˚_£Æ
,

1003 
buûd_summ¨y
,

1004 
Êush_d©a
);

1006 
curs‹_öô
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
, 
ˇche_ty≥
);

1007 
curs‹_∑rôy_°¨t
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
, 
ˇche_ty≥
);

1008 
curs‹_d©a_°¨t_ssd
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
, 
ˇche_ty≥
);

1009 
curs‹_summ¨y_off£t
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
, 
ˇche_ty≥
);

1010 
gë_devno
(
dm§c_su≥r
 *
su≥r
, 
u32
 
idx
);

1011 
block_devi˚
 *
gë_bdev
(
dm§c_su≥r
 *
su≥r
, 
u32
 
idx
);

1012 
dm_dev
 *
gë_dmdev
(
dm§c_su≥r
 *
su≥r
, 
u32
 
idx
);

1013 
£˘‹_t
 
gë_£˘‹
(
dm§c_su≥r
 *
su≥r
, 
u32
 
£g_id
, u32 
idx
);

1014 
do_degøded_w‹kî
(
w‹k_°ru˘
 *
w‹k
);

1015 
boﬁ
 
√ed_chunk_summ¨y
(
dm§c_su≥r
 *
su≥r
, 
u32
 
idx
);

1016 
boﬁ
 
chunk_summ¨y_ønge
(
dm§c_su≥r
 *
su≥r
, 
u32
 
idx
);

1017 
Æloc_mb_summ¨y
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
,

1018 
ˇche_ty≥
, 
u32
 
idx
, u32 *
tŸÆ_cou¡
);

1019 
gë_∑rôy_ssd
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
);

1020 
gë_∑rôyq_ssd
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
);

1021 
run_x‹
(**
∑ges
, *
de°
, 
§c_˙t
, 
ssize_t
 
Àn
);

1022 
_wrôe_async_bio
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
u32
 
idx
, 
bio
 *bio,

1023 
ømbuf„r
 *
ømbuf
, 
u32
 
ømbuf_idx
);

1024 
_Æloc_mb_summ¨y
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
ˇche_ty≥
, 
u32
 
idx
, 
fuŒ
, 
dummy
);

1025 
¥ï¨e_chunk_summ¨y
(

1026 
dm§c_su≥r
 *
su≥r
,

1027 
£gmít_hódî
 *
£g
,

1028 
ømbuf_∑ge
 **
∑ges
,

1029 
ssd_id
,

1030 
ˇche_ty≥
);

1031 
curs‹_öc
(
dm§c_su≥r
 *
su≥r
,
£g_id
, 
ˇche_ty≥
);

1032 
u32
 
d©a_to_summ¨y_idx
(
dm§c_su≥r
 *
su≥r
, u32 
idx
);

1033 
gë_°¨t_ssd
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
);

1034 
öôülize_mb_summ¨y
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
,

1035 
ˇche_ty≥
, 
u32
 
idx
, 
fuŒ
);

1036 
öôülize_mb
(
dm§c_su≥r
 *
su≥r
, 
mëablock
 *
√w_mb
, 
ˇche_ty≥
, 
boﬁ
 
˛ón
);

1037 
dm§c_io
(
dm_io_ªque°
 *
io_ªq
, 
num_ªgi⁄s
,

1038 
dm_io_ªgi⁄
 *
whîe
, *
sync_îr‹_bôs
);

1039 
øid_c⁄f_öô
(
dm§c_su≥r
 *
su≥r
, 
r5c⁄f
 *
c⁄f
);

1040 
≥ndög_w‹kî_scheduÀ
(
dm§c_su≥r
 *
su≥r
);

1041 
£g_Æloˇt‹_öô
(
dm§c_su≥r
 *
su≥r
);

1042 
degøded_mgr_öô
(
dm§c_su≥r
 *
su≥r
);

1043 
degøded_mgr_deöô
(
dm§c_su≥r
 *
su≥r
);

1044 
ªcovîy_mgr_öô
(
dm§c_su≥r
 *
su≥r
);

1045 
ªcovîy_mgr_deöô
(
dm§c_su≥r
 *
su≥r
);

1046 
Êush_mgr_öô
(
dm§c_su≥r
 *
su≥r
);

1047 
Êush_mgr_deöô
(
dm§c_su≥r
 *
su≥r
);

1048 
migøã_mgr_öô
(
dm§c_su≥r
 *
su≥r
);

1049 
migøã_mgr_deöô
(
dm§c_su≥r
 *
su≥r
);

1050 
∂uggî_öô
(
dm§c_su≥r
 *
su≥r
);

1051 
∂uggî_deöô
(
dm§c_su≥r
 *
su≥r
);

1052 
ªad_miss_mgr_öô
(
dm§c_su≥r
 *
su≥r
);

1053 
ªad_miss_mgr_deöô
(
dm§c_su≥r
 *
su≥r
);

1054 
sync_mgr_öô
(
dm§c_su≥r
 *
su≥r
);

1055 
sync_mgr_deöô
(
dm§c_su≥r
 *
su≥r
);

1056 
¥öt_∑øm
(
dm§c_su≥r
 *
su≥r
);

1057 
u64
 
Æloc_√xt_£gmít
(
dm§c_su≥r
 *
su≥r
, 
boﬁ
 
migøã
);

1058 
öô_√w_£gmít
(
dm§c_su≥r
 *
su≥r
, 
u64
 
√xt_id
, 
ˇche_ty≥
);

1059 
£g_Àngth_öc
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
mëablock
 *
mb
, 
boﬁ
 
öÊight
);

1060 
dm§c_då
(
dm_èrgë
 *
ti
);

1061 
do_background_gc
(
dm§c_su≥r
 *
su≥r
);

1062 
wp_upd©e
(
dm§c_su≥r
 *
su≥r
, 
is_wrôe
, 
ˇãg‹y
);

1063 
u32
 
wp_gë_i›s
(
dm§c_su≥r
 *
su≥r
, u32 *
bw_mb
, 
ˇãg‹y
, 
ty≥
);

1064 
ˇlc_√ed_num_ssds
(
dm§c_su≥r
 *
su≥r
);

1065 
_buûd_summ¨y_job
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
,

1066 
ømbuf„r
 *
ømbuf
, 
fuŒ
);

1067 
¥o˚ss_wrôe_ªque°
(
dm§c_su≥r
 *
su≥r
,

1068 
bio
 *bio,

1069 
∑ge
 *page,

1070 
£˘‹_t
 
key
,

1071 
is_dúty
,

1072 
f
,

1073 
ˇche_ty≥
,

1074 
u32
 
¸c32
);

1075 
boﬁ
 
should_√ed_ª‰esh_£g
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
);

1076 
ˇn_gë_‰ì_£gmít
(
dm§c_su≥r
 *
su≥r
, 
ˇche_ty≥
, 
gc
);

1077 
wb_job
 *
wrôeback_make_job
(
dm§c_su≥r
 *
su≥r
,

1078 
£gmít_hódî
 *
£g
,

1079 
u32
 
idx
,

1080 
bio
 *bio,

1081 
ømbuf„r
 *
ømbuf
,

1082 
ømbuf_ªÀa£
);

1083 
wrôeback_issue_job
(
dm§c_su≥r
 *
su≥r
, 
wb_job
 *
job
);

1084 
u32
 
gë_summ¨y_off£t
(
dm§c_su≥r
 *
su≥r
, u32 
ssd_id
);

1085 
bio_∂uggög
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
ømbuf„r
 *
ømbuf
,

1086 
bio
 *bio, 
u32
 
upd©e_mb_idx
);

1087 
ölöe
 
gë_∑rôy_ssd
(
dm§c_su≥r
 *
su≥r
, 
u64
 
£g_id
);

1089 
åy_waô_‰ì_£g
(
dm§c_su≥r
 *
su≥r
, 
is_wrôe
);

1090 
wb_job
 *
wrôeback_make_job_exã¡
(
dm§c_su≥r
 *
su≥r
,

1091 
£gmít_hódî
 *
£g
,

1092 
ømbuf„r
 *
ømbuf
,

1093 
u32
 
°¨t_idx
,

1094 
u32
 
cou¡
);

1095 
wrôeback_issue_job_exã¡
(
dm§c_su≥r
 *
su≥r
, 
wb_job
 *
job
, 
group_£Æed
);

1096 
√ed_˛ón_£g_wrôe
(
dm§c_su≥r
 *
su≥r
);

1097 
˛ón_£g_wrôe
(
dm§c_su≥r
 *
su≥r
, 
√ed_cou¡
, 
ˇche_ty≥
);

1098 
u32
 
Æloc_√xt_mb
(
dm§c_su≥r
 *
su≥r
, 
£gmít_hódî
 *
£g
, 
£˘‹_t
 
key
, 
ˇche_ty≥
, u32 *
tŸÆ_cou¡
);

1099 
hŸ_fûãr_upd©e
(
dm§c_su≥r
 *
su≥r
, 
£˘‹
);

1100 
hŸ_fûãr_check
(
dm§c_su≥r
 *
su≥r
, 
£˘‹
);

1101 
upd©e_sync_dódlöe
(
dm§c_su≥r
 *
su≥r
);

1111 
	#wbdebug
(
f
, 
¨gs
...) \

1112 
	`DMINFO
("debug@%s(ËL.%d" 
f
, 
__func__
, 
__LINE__
, ## 
¨gs
)

	)

1114 
	#WBERR
(
f
, 
¨gs
...) \

1115 
	`DMERR
("îr@%s(Ë" 
f
, 
__func__
, ## 
¨gs
)

	)

1116 
	#WBWARN
(
f
, 
¨gs
...) \

1117 
	`DMWARN
("w¨n@%s(Ë" 
f
, 
__func__
, ## 
¨gs
)

	)

1118 
	#WBINFO
(
f
, 
¨gs
...) \

1119 
	`DMINFO
("öfo@%s(Ë" 
f
, 
__func__
, ## 
¨gs
)

	)

	@/usr/include/linux/random.h

7 #i‚de‡
_LINUX_RANDOM_H


8 
	#_LINUX_RANDOM_H


	)

10 
	~<löux/ty≥s.h
>

11 
	~<löux/io˘l.h
>

12 
	~<löux/úqƒ.h
>

17 
	#RNDGETENTCNT
 
	`_IOR
–'R', 0x00, )

	)

20 
	#RNDADDTOENTCNT
 
	`_IOW
–'R', 0x01, )

	)

23 
	#RNDGETPOOL
 
	`_IOR
–'R', 0x02, [2] )

	)

29 
	#RNDADDENTROPY
 
	`_IOW
–'R', 0x03, [2] )

	)

32 
	#RNDZAPENTCNT
 
	`_IO
–'R', 0x04 )

	)

35 
	#RNDCLEARPOOL
 
	`_IO
–'R', 0x06 )

	)

37 
	sønd_poﬁ_öfo
 {

38 
	míå›y_cou¡
;

39 
	mbuf_size
;

40 
__u32
 
	mbuf
[0];

	@/usr/include/linux/sched.h

1 #i‚de‡
_LINUX_SCHED_H


2 
	#_LINUX_SCHED_H


	)

7 
	#CSIGNAL
 0x000000f‡

	)

8 
	#CLONE_VM
 0x00000100

	)

9 
	#CLONE_FS
 0x00000200

	)

10 
	#CLONE_FILES
 0x00000400

	)

11 
	#CLONE_SIGHAND
 0x00000800

	)

12 
	#CLONE_PTRACE
 0x00002000

	)

13 
	#CLONE_VFORK
 0x00004000

	)

14 
	#CLONE_PARENT
 0x00008000

	)

15 
	#CLONE_THREAD
 0x00010000

	)

16 
	#CLONE_NEWNS
 0x00020000

	)

17 
	#CLONE_SYSVSEM
 0x00040000

	)

18 
	#CLONE_SETTLS
 0x00080000

	)

19 
	#CLONE_PARENT_SETTID
 0x00100000

	)

20 
	#CLONE_CHILD_CLEARTID
 0x00200000

	)

21 
	#CLONE_DETACHED
 0x00400000

	)

22 
	#CLONE_UNTRACED
 0x00800000

	)

23 
	#CLONE_CHILD_SETTID
 0x01000000

	)

26 
	#CLONE_NEWUTS
 0x04000000

	)

27 
	#CLONE_NEWIPC
 0x08000000

	)

28 
	#CLONE_NEWUSER
 0x10000000

	)

29 
	#CLONE_NEWPID
 0x20000000

	)

30 
	#CLONE_NEWNET
 0x40000000

	)

31 
	#CLONE_IO
 0x80000000

	)

36 
	#SCHED_NORMAL
 0

	)

37 
	#SCHED_FIFO
 1

	)

38 
	#SCHED_RR
 2

	)

39 
	#SCHED_BATCH
 3

	)

41 
	#SCHED_IDLE
 5

	)

43 
	#SCHED_RESET_ON_FORK
 0x40000000

	)

	@/usr/include/linux/string.h

1 #i‚de‡
_LINUX_STRING_H_


2 
	#_LINUX_STRING_H_


	)

6 
	~<°rög.h
>

	@/usr/include/linux/types.h

1 #i‚de‡
_LINUX_TYPES_H


2 
	#_LINUX_TYPES_H


	)

4 
	~<asm/ty≥s.h
>

6 #i‚de‡
__ASSEMBLY__


8 
	~<löux/posix_ty≥s.h
>

16 #ifde‡
__CHECKER__


17 
	#__bôwi£__
 
	`__©åibuã__
((
bôwi£
))

	)

19 
	#__bôwi£__


	)

21 #ifde‡
__CHECK_ENDIAN__


22 
	#__bôwi£
 
__bôwi£__


	)

24 
	#__bôwi£


	)

27 
__u16
 
	t__bôwi£
 
	t__À16
;

28 
__u16
 
	t__bôwi£
 
	t__be16
;

29 
__u32
 
	t__bôwi£
 
	t__À32
;

30 
__u32
 
	t__bôwi£
 
	t__be32
;

31 
__u64
 
	t__bôwi£
 
	t__À64
;

32 
__u64
 
	t__bôwi£
 
	t__be64
;

34 
__u16
 
	t__bôwi£
 
	t__sum16
;

35 
__u32
 
	t__bôwi£
 
	t__wsum
;

46 
	#__Æig√d_u64
 
__u64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

47 
	#__Æig√d_be64
 
__be64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

48 
	#__Æig√d_À64
 
__À64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

	@/usr/include/linux/version.h

1 
	#LINUX_VERSION_CODE
 199168

	)

2 
	#KERNEL_VERSION
(
a
,
b
,
c
Ë((◊Ë<< 16Ë+ ((bË<< 8Ë+ (c))

	)

3 
	#RHEL_MAJOR
 7

	)

4 
	#RHEL_MINOR
 2

	)

5 
	#RHEL_RELEASE_VERSION
(
a
,
b
Ë((◊Ë<< 8Ë+ (b))

	)

6 
	#RHEL_RELEASE_CODE
 1794

	)

7 
	#RHEL_RELEASE
 "327.36.3"

	)

	@/usr/include/asm/types.h

1 #i‚de‡
_ASM_X86_TYPES_H


2 
	#_ASM_X86_TYPES_H


	)

4 
	~<asm-gíîic/ty≥s.h
>

	@/usr/include/linux/ioctl.h

1 #i‚de‡
_LINUX_IOCTL_H


2 
	#_LINUX_IOCTL_H


	)

4 
	~<asm/io˘l.h
>

	@/usr/include/linux/irqnr.h

	@/usr/include/linux/posix_types.h

1 #i‚de‡
_LINUX_POSIX_TYPES_H


2 
	#_LINUX_POSIX_TYPES_H


	)

4 
	~<löux/°ddef.h
>

21 #unde‡
__FD_SETSIZE


22 
	#__FD_SETSIZE
 1024

	)

25 
	mfds_bôs
[
__FD_SETSIZE
 / (8 * ())];

26 } 
	t__kî√l_fd_£t
;

29 (*
	t__kî√l_sigh™dÀr_t
)();

32 
	t__kî√l_key_t
;

33 
	t__kî√l_mqd_t
;

35 
	~<asm/posix_ty≥s.h
>

	@/usr/include/string.h

22 #i‚def 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


30 
	#__√ed_size_t


	)

31 
	#__√ed_NULL


	)

32 
	~<°ddef.h
>

35 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (4, 4)

36 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

40 
__BEGIN_NAMESPACE_STD


42 *
	$mem˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

43 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

46 *
	$memmove
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
)

47 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

48 
__END_NAMESPACE_STD


53 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_BSD
 || deföed 
__USE_XOPEN


54 *
	$memc˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

55 
__c
, 
size_t
 
__n
)

56 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

60 
__BEGIN_NAMESPACE_STD


62 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

65 
	$memcmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

66 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

69 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


72 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

73 
__THROW
 
	`__asm
 ("memchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

74 c⁄° *
	`memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

75 
__THROW
 
	`__asm
 ("memchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

77 #ifde‡
__OPTIMIZE__


78 
__exã∫_Æways_ölöe
 *

79 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW


81  
	`__buûtö_memchr
 (
__s
, 
__c
, 
__n
);

84 
__exã∫_Æways_ölöe
 const *

85 
	`memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
Ë
__THROW


87  
	`__buûtö_memchr
 (
__s
, 
__c
, 
__n
);

90 
	}
}

92 *
	$memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

93 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

95 
__END_NAMESPACE_STD


97 #ifde‡
__USE_GNU


100 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


101 "C++" *
	$øwmemchr
 (*
__s
, 
__c
)

102 
__THROW
 
	`__asm
 ("øwmemchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

103 "C++" c⁄° *
	$øwmemchr
 (c⁄° *
__s
, 
__c
)

104 
__THROW
 
	`__asm
 ("øwmemchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

106 *
	$øwmemchr
 (c⁄° *
__s
, 
__c
)

107 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

111 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


112 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

113 
__THROW
 
	`__asm
 ("memrchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

114 "C++" c⁄° *
	$memrchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

115 
__THROW
 
	`__asm
 ("memrchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

117 *
	$memrchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

118 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

123 
__BEGIN_NAMESPACE_STD


125 *
	$°r˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

126 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

128 *
	$°∫˝y
 (*
__ª°ri˘
 
__de°
,

129 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

130 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

133 *
	$°rˇt
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

134 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

136 *
	$°∫ˇt
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

137 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

140 
	$°rcmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

141 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

143 
	$°∫cmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

144 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

147 
	$°rcﬁl
 (c⁄° *
__s1
, c⁄° *
__s2
)

148 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

150 
size_t
 
	$°rx‰m
 (*
__ª°ri˘
 
__de°
,

151 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

152 
__THROW
 
	`__n⁄nuŒ
 ((2));

153 
__END_NAMESPACE_STD


155 #ifde‡
__USE_XOPEN2K8


159 
	~<xloˇÀ.h
>

162 
	$°rcﬁl_l
 (c⁄° *
__s1
, c⁄° *
__s2
, 
__loˇÀ_t
 
__l
)

163 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

165 
size_t
 
	$°rx‰m_l
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
,

166 
__loˇÀ_t
 
__l
Ë
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

169 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED
 \

170 || 
deföed
 
__USE_XOPEN2K8


172 *
	$°rdup
 (c⁄° *
__s
)

173 
__THROW
 
__©åibuã_mÆloc__
 
	`__n⁄nuŒ
 ((1));

179 #i‡
deföed
 
__USE_XOPEN2K8


180 *
	$°∫dup
 (c⁄° *
__°rög
, 
size_t
 
__n
)

181 
__THROW
 
__©åibuã_mÆloc__
 
	`__n⁄nuŒ
 ((1));

184 #i‡
deföed
 
__USE_GNU
 && deföed 
__GNUC__


186 
	#°rdu∑
(
s
) \

187 (
__exãnsi⁄__
 \

189 c⁄° *
__ﬁd
 = (
s
); \

190 
size_t
 
__Àn
 = 
	`°æí
 (
__ﬁd
) + 1; \

191 *
__√w
 = (*Ë
	`__buûtö_Æloˇ
 (
__Àn
); \

192 (*Ë
	`mem˝y
 (
__√w
, 
__ﬁd
, 
__Àn
); \

193 
	}
}))

	)

196 
	#°∫du∑
(
s
, 
n
) \

197 (
__exãnsi⁄__
 \

199 c⁄° *
__ﬁd
 = (
s
); \

200 
size_t
 
__Àn
 = 
	`°∫Àn
 (
__ﬁd
, (
n
)); \

201 *
__√w
 = (*Ë
	`__buûtö_Æloˇ
 (
__Àn
 + 1); \

202 
__√w
[
__Àn
] = '\0'; \

203 (*Ë
	`mem˝y
 (
__√w
, 
__ﬁd
, 
__Àn
); \

204 }))

	)

207 
	g__BEGIN_NAMESPACE_STD


209 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


212 *
°rchr
 (*
__s
, 
__c
)

213 
__THROW
 
__asm
 ("°rchr"Ë
__©åibuã_puª__
 
__n⁄nuŒ
 ((1));

214 c⁄° *
°rchr
 (c⁄° *
__s
, 
__c
)

215 
__THROW
 
__asm
 ("°rchr"Ë
__©åibuã_puª__
 
__n⁄nuŒ
 ((1));

217 #ifde‡
__OPTIMIZE__


218 
__exã∫_Æways_ölöe
 *

219 
°rchr
 (*
__s
, 
__c
Ë
	g__THROW


221  
__buûtö_°rchr
 (
__s
, 
__c
);

224 
__exã∫_Æways_ölöe
 const *

225 
°rchr
 (c⁄° *
__s
, 
__c
Ë
	g__THROW


227  
__buûtö_°rchr
 (
__s
, 
__c
);

232 *
	$°rchr
 (c⁄° *
__s
, 
__c
)

233 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

236 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


239 *
	`°ºchr
 (*
__s
, 
__c
)

240 
__THROW
 
	`__asm
 ("°ºchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

241 c⁄° *
	`°ºchr
 (c⁄° *
__s
, 
__c
)

242 
__THROW
 
	`__asm
 ("°ºchr"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

244 #ifde‡
__OPTIMIZE__


245 
__exã∫_Æways_ölöe
 *

246 
	`°ºchr
 (*
__s
, 
__c
Ë
__THROW


248  
	`__buûtö_°ºchr
 (
__s
, 
__c
);

251 
__exã∫_Æways_ölöe
 const *

252 
	`°ºchr
 (c⁄° *
__s
, 
__c
Ë
__THROW


254  
	`__buûtö_°ºchr
 (
__s
, 
__c
);

257 
	}
}

259 *
	$°ºchr
 (c⁄° *
__s
, 
__c
)

260 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

262 
__END_NAMESPACE_STD


264 #ifde‡
__USE_GNU


267 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


268 "C++" *
	$°rch∫ul
 (*
__s
, 
__c
)

269 
__THROW
 
	`__asm
 ("°rch∫ul"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

270 "C++" c⁄° *
	$°rch∫ul
 (c⁄° *
__s
, 
__c
)

271 
__THROW
 
	`__asm
 ("°rch∫ul"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

273 *
	$°rch∫ul
 (c⁄° *
__s
, 
__c
)

274 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

278 
__BEGIN_NAMESPACE_STD


281 
size_t
 
	$°rc•n
 (c⁄° *
__s
, c⁄° *
__ªje˘
)

282 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

285 
size_t
 
	$°r•n
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

286 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

288 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


291 *
	`°Ωbrk
 (*
__s
, c⁄° *
__ac˚±
)

292 
__THROW
 
	`__asm
 ("°Ωbrk"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

293 c⁄° *
	`°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

294 
__THROW
 
	`__asm
 ("°Ωbrk"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

296 #ifde‡
__OPTIMIZE__


297 
__exã∫_Æways_ölöe
 *

298 
	`°Ωbrk
 (*
__s
, c⁄° *
__ac˚±
Ë
__THROW


300  
	`__buûtö_°Ωbrk
 (
__s
, 
__ac˚±
);

303 
__exã∫_Æways_ölöe
 const *

304 
	`°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
Ë
__THROW


306  
	`__buûtö_°Ωbrk
 (
__s
, 
__ac˚±
);

309 
	}
}

311 *
	$°Ωbrk
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

312 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

315 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


318 *
	`°r°r
 (*
__hay°ack
, c⁄° *
__√edÀ
)

319 
__THROW
 
	`__asm
 ("°r°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

320 c⁄° *
	`°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

321 
__THROW
 
	`__asm
 ("°r°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

323 #ifde‡
__OPTIMIZE__


324 
__exã∫_Æways_ölöe
 *

325 
	`°r°r
 (*
__hay°ack
, c⁄° *
__√edÀ
Ë
__THROW


327  
	`__buûtö_°r°r
 (
__hay°ack
, 
__√edÀ
);

330 
__exã∫_Æways_ölöe
 const *

331 
	`°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
Ë
__THROW


333  
	`__buûtö_°r°r
 (
__hay°ack
, 
__√edÀ
);

336 
	}
}

338 *
	$°r°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

339 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

344 *
	$°πok
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__dñim
)

345 
__THROW
 
	`__n⁄nuŒ
 ((2));

346 
__END_NAMESPACE_STD


350 *
	$__°πok_r
 (*
__ª°ri˘
 
__s
,

351 c⁄° *
__ª°ri˘
 
__dñim
,

352 **
__ª°ri˘
 
__ßve_±r
)

353 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

354 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


355 *
	$°πok_r
 (*
__ª°ri˘
 
__s
, c⁄° *__ª°ri˘ 
__dñim
,

356 **
__ª°ri˘
 
__ßve_±r
)

357 
__THROW
 
	`__n⁄nuŒ
 ((2, 3));

360 #ifde‡
__USE_GNU


362 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


363 "C++" *
	$°rˇ£°r
 (*
__hay°ack
, c⁄° *
__√edÀ
)

364 
__THROW
 
	`__asm
 ("°rˇ£°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

365 "C++" c⁄° *
	$°rˇ£°r
 (c⁄° *
__hay°ack
,

366 c⁄° *
__√edÀ
)

367 
__THROW
 
	`__asm
 ("°rˇ£°r"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

369 *
	$°rˇ£°r
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

370 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

374 #ifde‡
__USE_GNU


378 *
	$memmem
 (c⁄° *
__hay°ack
, 
size_t
 
__hay°ackÀn
,

379 c⁄° *
__√edÀ
, 
size_t
 
__√edÀÀn
)

380 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 3));

384 *
	$__memp˝y
 (*
__ª°ri˘
 
__de°
,

385 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

386 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

387 *
	$memp˝y
 (*
__ª°ri˘
 
__de°
,

388 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

389 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

393 
__BEGIN_NAMESPACE_STD


395 
size_t
 
	$°æí
 (c⁄° *
__s
)

396 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

397 
__END_NAMESPACE_STD


399 #ifdef 
__USE_XOPEN2K8


402 
size_t
 
	$°∫Àn
 (c⁄° *
__°rög
, 
size_t
 
__maxÀn
)

403 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

407 
__BEGIN_NAMESPACE_STD


409 *
	$°ªº‹
 (
__î∫um
Ë
__THROW
;

410 
__END_NAMESPACE_STD


411 #i‡
deföed
 
__USE_XOPEN2K
 || deföed 
__USE_MISC


419 #i‡
deföed
 
__USE_XOPEN2K
 && !deföed 
__USE_GNU


422 #ifde‡
__REDIRECT_NTH


423 
	`__REDIRECT_NTH
 (
°ªº‹_r
,

424 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
),

425 
__xpg_°ªº‹_r
Ë
	`__n⁄nuŒ
 ((2));

427 
	$__xpg_°ªº‹_r
 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
)

428 
__THROW
 
	`__n⁄nuŒ
 ((2));

429 
	#°ªº‹_r
 
__xpg_°ªº‹_r


	)

434 *
	$°ªº‹_r
 (
__î∫um
, *
__buf
, 
size_t
 
__buÊí
)

435 
__THROW
 
	`__n⁄nuŒ
 ((2)Ë
__wur
;

439 #ifde‡
__USE_XOPEN2K8


441 *
	$°ªº‹_l
 (
__î∫um
, 
__loˇÀ_t
 
__l
Ë
__THROW
;

447 
	$__bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

449 #ifde‡
__USE_BSD


451 
	$bc›y
 (c⁄° *
__§c
, *
__de°
, 
size_t
 
__n
)

452 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

455 
	$bzîo
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

458 
	$bcmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

459 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

462 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


465 *
	`ödex
 (*
__s
, 
__c
)

466 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

467 c⁄° *
	`ödex
 (c⁄° *
__s
, 
__c
)

468 
__THROW
 
	`__asm
 ("ödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

470 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


471 
__exã∫_Æways_ölöe
 *

472 
	`ödex
 (*
__s
, 
__c
Ë
__THROW


474  
	`__buûtö_ödex
 (
__s
, 
__c
);

477 
__exã∫_Æways_ölöe
 const *

478 
	`ödex
 (c⁄° *
__s
, 
__c
Ë
__THROW


480  
	`__buûtö_ödex
 (
__s
, 
__c
);

483 
	}
}

485 *
	$ödex
 (c⁄° *
__s
, 
__c
)

486 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

490 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


493 *
	`rödex
 (*
__s
, 
__c
)

494 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

495 c⁄° *
	`rödex
 (c⁄° *
__s
, 
__c
)

496 
__THROW
 
	`__asm
 ("rödex"Ë
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

498 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


499 
__exã∫_Æways_ölöe
 *

500 
	`rödex
 (*
__s
, 
__c
Ë
__THROW


502  
	`__buûtö_rödex
 (
__s
, 
__c
);

505 
__exã∫_Æways_ölöe
 const *

506 
	`rödex
 (c⁄° *
__s
, 
__c
Ë
__THROW


508  
	`__buûtö_rödex
 (
__s
, 
__c
);

511 
	}
}

513 *
	$rödex
 (c⁄° *
__s
, 
__c
)

514 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1));

519 
	$ffs
 (
__i
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

523 #ifdef 
__USE_GNU


524 
	$ff¶
 (
__l
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

525 #ifde‡
__GNUC__


526 
__exãnsi⁄__
 
	$ff¶l
 (
__Œ
)

527 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

532 
	$°rˇ£cmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

533 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

536 
	$°∫ˇ£cmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

537 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

540 #ifdef 
__USE_GNU


543 
	$°rˇ£cmp_l
 (c⁄° *
__s1
, c⁄° *
__s2
,

544 
__loˇÀ_t
 
__loc
)

545 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 3));

547 
	$°∫ˇ£cmp_l
 (c⁄° *
__s1
, c⁄° *
__s2
,

548 
size_t
 
__n
, 
__loˇÀ_t
 
__loc
)

549 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2, 4));

552 #ifdef 
__USE_BSD


555 *
	$°r£p
 (**
__ª°ri˘
 
__°rögp
,

556 c⁄° *
__ª°ri˘
 
__dñim
)

557 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

560 #ifdef 
__USE_XOPEN2K8


562 *
	$°rsig«l
 (
__sig
Ë
__THROW
;

565 *
	$__°p˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

566 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

567 *
	$°p˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

568 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

572 *
	$__°≤˝y
 (*
__ª°ri˘
 
__de°
,

573 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

574 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

575 *
	$°≤˝y
 (*
__ª°ri˘
 
__de°
,

576 c⁄° *
__ª°ri˘
 
__§c
, 
size_t
 
__n
)

577 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

580 #ifdef 
__USE_GNU


582 
	$°rvîscmp
 (c⁄° *
__s1
, c⁄° *
__s2
)

583 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1, 2));

586 *
	$°r‰y
 (*
__°rög
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

589 *
	$mem‰ob
 (*
__s
, 
size_t
 
__n
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

591 #i‚de‡
ba£«me


596 #ifde‡
__CORRECT_ISO_CPP_STRING_H_PROTO


597 "C++" *
	$ba£«me
 (*
__fûíame
)

598 
__THROW
 
	`__asm
 ("ba£«me"Ë
	`__n⁄nuŒ
 ((1));

599 "C++" c⁄° *
	$ba£«me
 (c⁄° *
__fûíame
)

600 
__THROW
 
	`__asm
 ("ba£«me"Ë
	`__n⁄nuŒ
 ((1));

602 *
	$ba£«me
 (c⁄° *
__fûíame
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

608 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

609 #i‡
deföed
 
__OPTIMIZE__
 && !deföed 
__OPTIMIZE_SIZE__
 \

610 && !
deföed
 
__NO_INLINE__
 && !deföed 
__˝lu•lus


630 
	~<bôs/°rög.h
>

633 
	~<bôs/°rög2.h
>

636 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


638 
	~<bôs/°rög3.h
>

642 
__END_DECLS


	@/usr/include/asm-generic/types.h

1 #i‚de‡
_ASM_GENERIC_TYPES_H


2 
	#_ASM_GENERIC_TYPES_H


	)

7 
	~<asm-gíîic/öt-Œ64.h
>

	@/usr/include/asm/ioctl.h

1 
	~<asm-gíîic/io˘l.h
>

	@/usr/include/asm/posix_types.h

1 #ifde‡
__i386__


2 
	~<asm/posix_ty≥s_32.h
>

3 #ñi‡
deföed
(
__ILP32__
)

4 
	~<asm/posix_ty≥s_x32.h
>

6 
	~<asm/posix_ty≥s_64.h
>

	@/usr/include/bits/string.h

19 #i‚de‡
_STRING_H


24 
	#_STRING_ARCH_u«lig√d
 1

	)

28 #i‡!
deföed
 
__x86_64__
 && (deföed 
__i486__
 || deföed 
__≥¡ium__
 \

29 || 
deföed
 
	g__≥¡ium¥o__
 || deföed 
	g__≥¡ium4__
 \

30 || 
deföed
 
	g__noc⁄a__
 || deföed 
	g__©om__
 \

31 || 
deföed
 
	g__c‹e2__
 || deföed 
	g__c‹ei7__
 \

32 || 
deföed
 
	g__k6__
 || deföed 
	g__geode__
 \

33 || 
deföed
 
	g__k8__
 || deföed 
	g__©hl⁄__
 \

34 || 
deföed
 
	g__amdÁm10__
)

38 #i‡!
deföed
 
__NO_STRING_INLINES
 && deföed 
__USE_STRING_INLINES
 \

39 && 
deföed
 
	g__GNUC__
 && __GNUC__ >2 && !
__BOUNDED_POINTERS__


41 #i‚de‡
__STRING_INLINE


42 #i‚de‡
__exã∫_ölöe


43 
	#__STRING_INLINE
 
ölöe


	)

45 
	#__STRING_INLINE
 
__exã∫_ölöe


	)

50 
	#__STRING_SMALL_GET16
(
§c
, 
idx
) \

51 ((((c⁄° *Ë(
§c
))[
idx
 + 1] << 8) \

52 | ((c⁄° *Ë(
§c
))[
idx
])

	)

53 
	#__STRING_SMALL_GET32
(
§c
, 
idx
) \

54 (((((c⁄° *Ë(
§c
))[
idx
 + 3] << 8 \

55 | ((c⁄° *Ë(
§c
))[
idx
 + 2]) << 8 \

56 | ((c⁄° *Ë(
§c
))[
idx
 + 1]) << 8 \

57 | ((c⁄° *Ë(
§c
))[
idx
])

	)

61 
	#_HAVE_STRING_ARCH_mem˝y
 1

	)

62 
	#mem˝y
(
de°
, 
§c
, 
n
) \

63 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
n
) \

64 ? 
	`__mem˝y_c
 ((
de°
), (
§c
), (
n
)) \

65 : 
	`__mem˝y_g
 ((
de°
), (
§c
), (
n
))))

	)

66 
	#__mem˝y_c
(
de°
, 
§c
, 
n
) \

67 ((
n
) == 0 \

68 ? (
de°
) \

69 : (((
n
) % 4 == 0) \

70 ? 
	`__mem˝y_by4
 (
de°
, 
§c
, 
n
) \

71 : (((
n
) % 2 == 0) \

72 ? 
	`__mem˝y_by2
 (
de°
, 
§c
, 
n
) \

73 : 
	`__mem˝y_g
 (
de°
, 
§c
, 
n
))))

	)

75 
__STRING_INLINE
 *
__mem˝y_by4
 (*
__de°
, c⁄° *
__§c
,

76 
size_t
 
__n
);

78 
__STRING_INLINE
 *

79 
	$__mem˝y_by4
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
)

81 
__d0
, 
__d1
;

82 *
__tmp
 = 
__de°
;

83 
__asm__
 
__vﬁ©ûe__


91 : "=&r" (
__d0
), "=&r" (
__tmp
), "=&r" (
__§c
), "=&r" (
__d1
)

92 : "1" (
__tmp
), "2" (
__§c
), "3" (
__n
 / 4)

94  
__de°
;

95 
	}
}

97 
__STRING_INLINE
 *
__mem˝y_by2
 (*
__de°
, c⁄° *
__§c
,

98 
size_t
 
__n
);

100 
__STRING_INLINE
 *

101 
	$__mem˝y_by2
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
)

103 
__d0
, 
__d1
;

104 *
__tmp
 = 
__de°
;

105 
__asm__
 
__vﬁ©ûe__


118 : "=&q" (
__d0
), "=&r" (
__tmp
), "=&r" (
__§c
), "=&r" (
__d1
)

119 : "1" (
__tmp
), "2" (
__§c
), "3" (
__n
 / 2)

121  
__de°
;

122 
	}
}

124 
__STRING_INLINE
 *
__mem˝y_g
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
);

126 
__STRING_INLINE
 *

127 
	$__mem˝y_g
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
)

129 
__d0
, 
__d1
, 
__d2
;

130 *
__tmp
 = 
__de°
;

131 
__asm__
 
__vﬁ©ûe__


142 : "=&c" (
__d0
), "=&D" (
__d1
), "=&S" (
__d2
),

143 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__de°
)

144 : "0" (
__n
), "1" (
__tmp
), "2" (
__§c
),

145 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__§c
)

147  
__de°
;

148 
	}
}

150 
	#_HAVE_STRING_ARCH_memmove
 1

	)

151 #i‚de‡
_FORCE_INLINES


154 
	#memmove
(
de°
, 
§c
, 
n
Ë
	`__memmove_g
 (de°, src,Ç)

	)

156 
__STRING_INLINE
 *
	$__memmove_g
 (*, c⁄° *, 
size_t
)

157 
	`__asm__
 ("memmove");

159 
__STRING_INLINE
 *

160 
	$__memmove_g
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
)

162 
__d0
, 
__d1
, 
__d2
;

163 *
__tmp
 = 
__de°
;

164 i‡(
__de°
 < 
__§c
)

165 
__asm__
 
__vﬁ©ûe__


168 : "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
),

169 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__de°
)

170 : "0" (
__n
), "1" (
__§c
), "2" (
__tmp
),

171 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__§c
));

173 
__asm__
 
__vﬁ©ûe__


177 : "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
),

178 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__de°
)

179 : "0" (
__n
), "1" (__¿- 1 + (c⁄° *Ë
__§c
),

180 "2" (
__n
 - 1 + (*Ë
__tmp
),

181 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__§c
));

182  
__de°
;

183 
	}
}

187 
	#_HAVE_STRING_ARCH_memcmp
 1

	)

188 #i‚de‡
_FORCE_INLINES


189 #i‚de‡
__PIC__


191 
__STRING_INLINE
 

192 
	$memcmp
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

194 
__d0
, 
__d1
, 
__d2
;

195 
__ªs
;

196 
__asm__
 
__vﬁ©ûe__


204 : "=&a" (
__ªs
), "=&S" (
__d0
), "=&D" (
__d1
), "=&c" (
__d2
)

205 : "0" (0), "1" (
__s1
), "2" (
__s2
), "3" (
__n
),

206 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s1
),

207 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s2
)

209  
__ªs
;

210 
	}
}

215 
	#_HAVE_STRING_ARCH_mem£t
 1

	)

216 
	#_USE_STRING_ARCH_mem£t
 1

	)

217 
	#mem£t
(
s
, 
c
, 
n
) \

218 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
n
) && (n) <= 16 \

219 ? ((
n
) == 1 \

220 ? 
	`__mem£t_c1
 ((
s
), (
c
)) \

221 : 
	`__mem£t_gc
 ((
s
), (
c
), (
n
))) \

222 : (
	`__buûtö_c⁄°™t_p
 (
c
) \

223 ? (
	`__buûtö_c⁄°™t_p
 (
n
) \

224 ? 
	`__mem£t_c˙
 ((
s
), (
c
), (
n
)) \

225 : 
	`mem£t
 ((
s
), (
c
), (
n
))) \

226 : (
	`__buûtö_c⁄°™t_p
 (
n
) \

227 ? 
	`__mem£t_g˙
 ((
s
), (
c
), (
n
)) \

228 : 
	`mem£t
 ((
s
), (
c
), (
n
))))))

	)

230 
	#__mem£t_c1
(
s
, 
c
Ë({ *
__s
 = (s); \

231 *((*Ë
__s
Ë(Ë(
c
); \

232 
__s
; })

	)

234 
	#__mem£t_gc
(
s
, 
c
, 
n
) \

235 ({ *
__s
 = (
s
); \

237 
__ui
; \

238 
__usi
; \

239 
__uc
; \

240 } *
__u
 = 
__s
; \

241 
__c
 = ((Ë((Ë(
c
))) * 0x01010101; \

247 i‡((
n
) == 3 || (n) >= 5) \

248 
__asm__
 
	`__vﬁ©ûe__
 ("" : "Ù" (
__c
) : "0" (__c)); \

251 
n
) \

254 
__u
->
__ui
 = 
__c
; \

255 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

257 
__u
->
__ui
 = 
__c
; \

258 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

260 
__u
->
__ui
 = 
__c
; \

261 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

263 
__u
->
__usi
 = (Ë
__c
; \

264 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2); \

265 
__u
->
__uc
 = (Ë
__c
; \

269 
__u
->
__ui
 = 
__c
; \

270 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

272 
__u
->
__ui
 = 
__c
; \

273 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

275 
__u
->
__ui
 = 
__c
; \

276 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

278 
__u
->
__usi
 = (Ë
__c
; \

282 
__u
->
__ui
 = 
__c
; \

283 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

285 
__u
->
__ui
 = 
__c
; \

286 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

288 
__u
->
__ui
 = 
__c
; \

289 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

291 
__u
->
__uc
 = (Ë
__c
; \

295 
__u
->
__ui
 = 
__c
; \

296 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

298 
__u
->
__ui
 = 
__c
; \

299 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

301 
__u
->
__ui
 = 
__c
; \

302 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

304 
__u
->
__ui
 = 
__c
; \

309 
__s
; })

	)

311 
	#__mem£t_c˙
(
s
, 
c
, 
n
) \

312 (((
n
) % 4 == 0) \

313 ? 
	`__mem£t_c˙_by4
 (
s
, ((Ë((Ë(
c
))) * 0x01010101,\

314 
n
) \

315 : (((
n
) % 2 == 0) \

316 ? 
	`__mem£t_c˙_by2
 (
s
, \

317 ((Ë((Ë(
c
))) * 0x01010101,\

318 
n
) \

319 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

321 
__STRING_INLINE
 *
__mem£t_c˙_by4
 (*
__s
, 
__c
,

322 
size_t
 
__n
);

324 
__STRING_INLINE
 *

325 
	$__mem£t_c˙_by4
 (*
__s
, 
__c
, 
size_t
 
__n
)

327 *
__tmp
 = 
__s
;

328 
__d0
;

329 #ifde‡
__i686__


330 
__asm__
 
__vﬁ©ûe__


333 : "=&a" (
__c
), "=&D" (
__tmp
), "=&c" (
__d0
),

334 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

335 : "0" ((Ë
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

338 
__asm__
 
__vﬁ©ûe__


344 : "=&r" (
__c
), "=&r" (
__tmp
), "=&r" (
__d0
),

345 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

346 : "0" ((Ë
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

349  
__s
;

350 
	}
}

352 
__STRING_INLINE
 *
__mem£t_c˙_by2
 (*
__s
, 
__c
,

353 
size_t
 
__n
);

355 
__STRING_INLINE
 *

356 
	$__mem£t_c˙_by2
 (*
__s
, 
__c
, 
size_t
 
__n
)

358 
__d0
, 
__d1
;

359 *
__tmp
 = 
__s
;

360 #ifde‡
__i686__


361 
__asm__
 
__vﬁ©ûe__


365 : "=&a" (
__d0
), "=&D" (
__tmp
), "=&c" (
__d1
),

366 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

367 : "0" ((Ë
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

370 
__asm__
 
__vﬁ©ûe__


376 : "=&q" (
__d0
), "=&r" (
__tmp
), "=&r" (
__d1
),

377 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

378 : "0" ((Ë
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

381  
__s
;

382 
	}
}

384 
	#__mem£t_g˙
(
s
, 
c
, 
n
) \

385 (((
n
) % 4 == 0) \

386 ? 
	`__mem£t_g˙_by4
 (
s
, 
c
, 
n
) \

387 : (((
n
) % 2 == 0) \

388 ? 
	`__mem£t_g˙_by2
 (
s
, 
c
, 
n
) \

389 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

391 
__STRING_INLINE
 *
__mem£t_g˙_by4
 (*
__s
, 
__c
, 
size_t
 
__n
);

393 
__STRING_INLINE
 *

394 
	$__mem£t_g˙_by4
 (*
__s
, 
__c
, 
size_t
 
__n
)

396 *
__tmp
 = 
__s
;

397 
__d0
;

398 
__asm__
 
__vﬁ©ûe__


408 : "=&q" (
__c
), "=&r" (
__tmp
), "=&r" (
__d0
),

409 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

410 : "0" ((Ë
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

412  
__s
;

413 
	}
}

415 
__STRING_INLINE
 *
__mem£t_g˙_by2
 (*
__s
, 
__c
, 
size_t
 
__n
);

417 
__STRING_INLINE
 *

418 
	$__mem£t_g˙_by2
 (*
__s
, 
__c
, 
size_t
 
__n
)

420 
__d0
, 
__d1
;

421 *
__tmp
 = 
__s
;

422 
__asm__
 
__vﬁ©ûe__


433 : "=&q" (
__d0
), "=&r" (
__tmp
), "=&r" (
__d1
),

434 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

435 : "0" ((Ë
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

437  
__s
;

438 
	}
}

442 
	#_HAVE_STRING_ARCH_memchr
 1

	)

443 #i‚de‡
_FORCE_INLINES


444 
__STRING_INLINE
 *

445 
	$memchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

447 
__d0
;

448 #ifde‡
__i686__


449 
__d1
;

451 *
__ªs
;

452 i‡(
__n
 == 0)

453  
NULL
;

454 #ifde‡
__i686__


455 
__asm__
 
__vﬁ©ûe__


459 : "=D" (
__ªs
), "=&c" (
__d0
), "=&r" (
__d1
)

460 : "a" (
__c
), "0" (
__s
), "1" (
__n
), "2" (1),

461 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

464 
__asm__
 
__vﬁ©ûe__


470 : "=D" (
__ªs
), "=&c" (
__d0
)

471 : "a" (
__c
), "0" (
__s
), "1" (
__n
),

472 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

475  
__ªs
 - 1;

476 
	}
}

479 
	#_HAVE_STRING_ARCH_memrchr
 1

	)

480 #i‚de‡
_FORCE_INLINES


481 
__STRING_INLINE
 *
__memrchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
);

483 
__STRING_INLINE
 *

484 
	$__memrchr
 (c⁄° *
__s
, 
__c
, 
size_t
 
__n
)

486 
__d0
;

487 #ifde‡
__i686__


488 
__d1
;

490 *
__ªs
;

491 i‡(
__n
 == 0)

492  
NULL
;

493 #ifde‡
__i686__


494 
__asm__
 
__vﬁ©ûe__


500 : "=D" (
__ªs
), "=&c" (
__d0
), "=&r" (
__d1
)

501 : "a" (
__c
), "0" (
__s
 + 
__n
 - 1), "1" (__n), "2" (-1),

502 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

505 
__asm__
 
__vﬁ©ûe__


512 : "=D" (
__ªs
), "=&c" (
__d0
)

513 : "a" (
__c
), "0" (
__s
 + 
__n
 - 1), "1" (__n),

514 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s
)

517  
__ªs
;

518 
	}
}

519 #ifde‡
__USE_GNU


520 
	#memrchr
(
s
, 
c
, 
n
Ë
	`__memrchr
 ((s), (c), (n))

	)

525 
	#_HAVE_STRING_ARCH_øwmemchr
 1

	)

526 
__STRING_INLINE
 *
__øwmemchr
 (c⁄° *
__s
, 
__c
);

528 #i‚de‡
_FORCE_INLINES


529 
__STRING_INLINE
 *

530 
	$__øwmemchr
 (c⁄° *
__s
, 
__c
)

532 
__d0
;

533 *
__ªs
;

534 
__asm__
 
__vﬁ©ûe__


537 : "=D" (
__ªs
), "=&c" (
__d0
)

538 : "a" (
__c
), "0" (
__s
), "1" (0xffffffff),

539 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

541  
__ªs
 - 1;

542 
	}
}

543 #ifde‡
__USE_GNU


544 
__STRING_INLINE
 *

545 
	$øwmemchr
 (c⁄° *
__s
, 
__c
)

547  
	`__øwmemchr
 (
__s
, 
__c
);

548 
	}
}

554 
	#_HAVE_STRING_ARCH_°æí
 1

	)

555 
	#°æí
(
°r
) \

556 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
°r
) \

557 ? 
	`__buûtö_°æí
 (
°r
) \

558 : 
	`__°æí_g
 (
°r
)))

	)

559 
__STRING_INLINE
 
size_t
 
__°æí_g
 (c⁄° *
__°r
);

561 
__STRING_INLINE
 
size_t


562 
	$__°æí_g
 (c⁄° *
__°r
)

564 
__dummy
;

565 c⁄° *
__tmp
 = 
__°r
;

566 
__asm__
 
__vﬁ©ûe__


572 : "Ù" (
__tmp
), "=&q" (
__dummy
)

573 : "0" (
__°r
),

574 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__°r
)

576  
__tmp
 - 
__°r
 - 1;

577 
	}
}

581 
	#_HAVE_STRING_ARCH_°r˝y
 1

	)

582 
	#°r˝y
(
de°
, 
§c
) \

583 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
) \

584 ? ( ((
§c
)[0]Ë=1 && 
	`°æí
 (src) + 1 <= 8 \

585 ? 
	`__°r˝y_a_smÆl
 ((
de°
), (
§c
), 
	`°æí
 (src) + 1) \

586 : (*Ë
	`mem˝y
 ((*Ë(
de°
), \

587 (c⁄° *Ë(
§c
), \

588 
	`°æí
 (
§c
) + 1)) \

589 : 
	`__°r˝y_g
 ((
de°
), (
§c
))))

	)

591 
	#__°r˝y_a_smÆl
(
de°
, 
§c
, 
§˛í
) \

592 (
	`__exãnsi⁄__
 ({ *
__de°
 = (
de°
); \

594 
__ui
; \

595 
__usi
; \

596 
__uc
; \

597 
__c
; \

598 } *
__u
 = (*Ë
__de°
; \

599 
§˛í
) \

602 
__u
->
__uc
 = '\0'; \

605 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
§c
, 0); \

608 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
§c
, 0); \

609 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2); \

610 
__u
->
__uc
 = '\0'; \

613 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

616 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

617 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

618 
__u
->
__uc
 = '\0'; \

621 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

622 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

623 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
§c
, 4); \

626 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

627 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

628 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
§c
, 4); \

629 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2); \

630 
__u
->
__uc
 = '\0'; \

633 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

634 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

635 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 4); \

638 (*Ë
__de°
; }))

	)

640 
__STRING_INLINE
 *
__°r˝y_g
 (*
__de°
, c⁄° *
__§c
);

642 
__STRING_INLINE
 *

643 
	$__°r˝y_g
 (*
__de°
, c⁄° *
__§c
)

645 *
__tmp
 = 
__de°
;

646 
__dummy
;

647 
__asm__
 
__vﬁ©ûe__


656 : "=&r" (
__§c
), "=&r" (
__tmp
), "=&q" (
__dummy
),

657 "=m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__de°
)

658 : "0" (
__§c
), "1" (
__tmp
),

659 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__§c
)

661  
__de°
;

662 
	}
}

665 #ifde‡
__USE_GNU


666 
	#_HAVE_STRING_ARCH_°p˝y
 1

	)

668 
	#__°p˝y
(
de°
, 
§c
) \

669 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
) \

670 ? (
	`°æí
 (
§c
) + 1 <= 8 \

671 ? 
	`__°p˝y_a_smÆl
 ((
de°
), (
§c
), 
	`°æí
 (src) + 1) \

672 : 
	`__°p˝y_c
 ((
de°
), (
§c
), 
	`°æí
 (src) + 1)) \

673 : 
	`__°p˝y_g
 ((
de°
), (
§c
))))

	)

674 
	#__°p˝y_c
(
de°
, 
§c
, 
§˛í
) \

675 ((
§˛í
) % 4 == 0 \

676 ? 
	`__memp˝y_by4
 (
de°
, 
§c
, 
§˛í
) - 1 \

677 : ((
§˛í
) % 2 == 0 \

678 ? 
	`__memp˝y_by2
 (
de°
, 
§c
, 
§˛í
) - 1 \

679 : 
	`__memp˝y_byn
 (
de°
, 
§c
, 
§˛í
Ë- 1))

	)

682 
	#°p˝y
(
de°
, 
§c
Ë
	`__°p˝y
 ((de°), (§c))

	)

684 
	#__°p˝y_a_smÆl
(
de°
, 
§c
, 
§˛í
) \

685 (
	`__exãnsi⁄__
 ({ union { \

686 
__ui
; \

687 
__usi
; \

688 
__uc
; \

689 
__c
; \

690 } *
__u
 = (*Ë(
de°
); \

691 
§˛í
) \

694 
__u
->
__uc
 = '\0'; \

697 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
§c
, 0); \

698 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 1); \

701 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
§c
, 0); \

702 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2); \

703 
__u
->
__uc
 = '\0'; \

706 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

707 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 3); \

710 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

711 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

712 
__u
->
__uc
 = '\0'; \

715 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

716 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

717 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
§c
, 4); \

718 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 1); \

721 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

722 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

723 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
§c
, 4); \

724 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2); \

725 
__u
->
__uc
 = '\0'; \

728 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 0); \

729 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

730 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
§c
, 4); \

731 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 3); \

734 (*Ë
__u
; }))

	)

736 
__STRING_INLINE
 *
__memp˝y_by4
 (*
__de°
, c⁄° *
__§c
,

737 
size_t
 
__§˛í
);

739 
__STRING_INLINE
 *

740 
	$__memp˝y_by4
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__§˛í
)

742 *
__tmp
 = 
__de°
;

743 
__d0
, 
__d1
;

744 
__asm__
 
__vﬁ©ûe__


752 : "=&r" (
__d0
), "Ù" (
__tmp
), "=&r" (
__§c
), "=&r" (
__d1
)

753 : "1" (
__tmp
), "2" (
__§c
), "3" (
__§˛í
 / 4)

755  
__tmp
;

756 
	}
}

758 
__STRING_INLINE
 *
__memp˝y_by2
 (*
__de°
, c⁄° *
__§c
,

759 
size_t
 
__§˛í
);

761 
__STRING_INLINE
 *

762 
	$__memp˝y_by2
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__§˛í
)

764 *
__tmp
 = 
__de°
;

765 
__d0
, 
__d1
;

766 
__asm__
 
__vﬁ©ûe__


779 : "=&q" (
__d0
), "Ù" (
__tmp
), "=&r" (
__§c
), "=&r" (
__d1
),

780 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__de°
)

781 : "1" (
__tmp
), "2" (
__§c
), "3" (
__§˛í
 / 2),

782 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__§c
)

784  
__tmp
 + 2;

785 
	}
}

787 
__STRING_INLINE
 *
__memp˝y_byn
 (*
__de°
, c⁄° *
__§c
,

788 
size_t
 
__§˛í
);

790 
__STRING_INLINE
 *

791 
	$__memp˝y_byn
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__§˛í
)

793 
__d0
, 
__d1
;

794 *
__tmp
 = 
__de°
;

795 
__asm__
 
__vﬁ©ûe__


806 : "=D" (
__tmp
), "=&c" (
__d0
), "=&S" (
__d1
),

807 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__de°
)

808 : "0" (
__tmp
), "1" (
__§˛í
), "2" (
__§c
),

809 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__§c
)

811  
__tmp
;

812 
	}
}

814 
__STRING_INLINE
 *
__°p˝y_g
 (*
__de°
, c⁄° *
__§c
);

816 
__STRING_INLINE
 *

817 
	$__°p˝y_g
 (*
__de°
, c⁄° *
__§c
)

819 *
__tmp
 = 
__de°
;

820 
__dummy
;

821 
__asm__
 
__vﬁ©ûe__


830 : "=&r" (
__§c
), "Ù" (
__tmp
), "=&q" (
__dummy
),

831 "=m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__de°
)

832 : "0" (
__§c
), "1" (
__tmp
),

833 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__§c
)

835  
__tmp
 - 1;

836 
	}
}

841 
	#_HAVE_STRING_ARCH_°∫˝y
 1

	)

842 
	#°∫˝y
(
de°
, 
§c
, 
n
) \

843 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
) \

844 ? ((
	`°æí
 (
§c
Ë+ 1 >((
size_t
Ë(
n
)) \

845 ? (*Ë
	`mem˝y
 ((*Ë(
de°
), \

846 (c⁄° *Ë(
§c
), 
n
) \

847 : 
	`__°∫˝y_cg
 ((
de°
), (
§c
), 
	`°æí
 (§cË+ 1, 
n
))) \

848 : 
	`__°∫˝y_gg
 ((
de°
), (
§c
), 
n
)))

	)

849 
	#__°∫˝y_cg
(
de°
, 
§c
, 
§˛í
, 
n
) \

850 (((
§˛í
) % 4 == 0) \

851 ? 
	`__°∫˝y_by4
 (
de°
, 
§c
, 
§˛í
, 
n
) \

852 : (((
§˛í
) % 2 == 0) \

853 ? 
	`__°∫˝y_by2
 (
de°
, 
§c
, 
§˛í
, 
n
) \

854 : 
	`__°∫˝y_byn
 (
de°
, 
§c
, 
§˛í
, 
n
)))

	)

856 
__STRING_INLINE
 *
__°∫˝y_by4
 (*
__de°
, c⁄° 
__§c
[],

857 
size_t
 
__§˛í
, size_à
__n
);

859 
__STRING_INLINE
 *

860 
	$__°∫˝y_by4
 (*
__de°
, c⁄° 
__§c
[], 
size_t
 
__§˛í
, size_à
__n
)

862 *
__tmp
 = 
__de°
;

863 
__dummy1
, 
__dummy2
;

864 
__asm__
 
__vﬁ©ûe__


872 : "=&r" (
__dummy1
), "Ù" (
__tmp
), "=&r" (
__§c
), "=&r" (
__dummy2
),

873 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__de°
)

874 : "1" (
__tmp
), "2" (
__§c
), "3" (
__§˛í
 / 4),

875 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__§c
)

877 (Ë
	`mem£t
 (
__tmp
, '\0', 
__n
 - 
__§˛í
);

878  
__de°
;

879 
	}
}

881 
__STRING_INLINE
 *
__°∫˝y_by2
 (*
__de°
, c⁄° 
__§c
[],

882 
size_t
 
__§˛í
, size_à
__n
);

884 
__STRING_INLINE
 *

885 
	$__°∫˝y_by2
 (*
__de°
, c⁄° 
__§c
[], 
size_t
 
__§˛í
, size_à
__n
)

887 *
__tmp
 = 
__de°
;

888 
__dummy1
, 
__dummy2
;

889 
__asm__
 
__vﬁ©ûe__


902 : "=&q" (
__dummy1
), "Ù" (
__tmp
), "=&r" (
__§c
), "=&r" (
__dummy2
),

903 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__de°
)

904 : "1" (
__tmp
), "2" (
__§c
), "3" (
__§˛í
 / 2),

905 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__§c
)

907 (Ë
	`mem£t
 (
__tmp
 + 2, '\0', 
__n
 - 
__§˛í
);

908  
__de°
;

909 
	}
}

911 
__STRING_INLINE
 *
__°∫˝y_byn
 (*
__de°
, c⁄° 
__§c
[],

912 
size_t
 
__§˛í
, size_à
__n
);

914 
__STRING_INLINE
 *

915 
	$__°∫˝y_byn
 (*
__de°
, c⁄° 
__§c
[], 
size_t
 
__§˛í
, size_à
__n
)

917 
__d0
, 
__d1
;

918 *
__tmp
 = 
__de°
;

919 
__asm__
 
__vﬁ©ûe__


930 : "=D" (
__tmp
), "=&c" (
__d0
), "=&S" (
__d1
),

931 "=m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__de°
)

932 : "1" (
__§˛í
), "0" (
__tmp
),"2" (
__§c
),

933 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__§c
)

935 (Ë
	`mem£t
 (
__tmp
, '\0', 
__n
 - 
__§˛í
);

936  
__de°
;

937 
	}
}

939 
__STRING_INLINE
 *
__°∫˝y_gg
 (*
__de°
, c⁄° *
__§c
,

940 
size_t
 
__n
);

942 
__STRING_INLINE
 *

943 
	$__°∫˝y_gg
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
)

945 *
__tmp
 = 
__de°
;

946 
__dummy
;

947 i‡(
__n
 > 0)

948 
__asm__
 
__vﬁ©ûe__


964 : "=&r" (
__§c
), "=&r" (
__tmp
), "=&q" (
__dummy
), "=&r" (
__n
)

965 : "0" (
__§c
), "1" (
__tmp
), "3" (
__n
)

968  
__de°
;

969 
	}
}

973 
	#_HAVE_STRING_ARCH_°rˇt
 1

	)

974 
	#°rˇt
(
de°
, 
§c
) \

975 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
) \

976 ? 
	`__°rˇt_c
 ((
de°
), (
§c
), 
	`°æí
 (src) + 1) \

977 : 
	`__°rˇt_g
 ((
de°
), (
§c
))))

	)

979 
__STRING_INLINE
 *
__°rˇt_c
 (*
__de°
, c⁄° 
__§c
[],

980 
size_t
 
__§˛í
);

982 
__STRING_INLINE
 *

983 
	$__°rˇt_c
 (*
__de°
, c⁄° 
__§c
[], 
size_t
 
__§˛í
)

985 #ifde‡
__i686__


986 
__d0
;

987 *
__tmp
;

988 
__asm__
 
__vﬁ©ûe__


990 : "=D" (
__tmp
), "=&c" (
__d0
),

991 "=m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__de°
)

992 : "0" (
__de°
), "1" (0xffffffff), "a" (0),

993 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__§c
)

995 --
__tmp
;

997 *
__tmp
 = 
__de°
 - 1;

998 
__asm__
 
__vﬁ©ûe__


1003 : "Ù" (
__tmp
),

1004 "=m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__de°
)

1005 : "0" (
__tmp
),

1006 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__§˛í
]; } *)
__§c
)

1009 (Ë
	`mem˝y
 (
__tmp
, 
__§c
, 
__§˛í
);

1010  
__de°
;

1011 
	}
}

1013 
__STRING_INLINE
 *
__°rˇt_g
 (*
__de°
, c⁄° *
__§c
);

1015 
__STRING_INLINE
 *

1016 
	$__°rˇt_g
 (*
__de°
, c⁄° *
__§c
)

1018 *
__tmp
 = 
__de°
 - 1;

1019 
__dummy
;

1020 
__asm__
 
__vﬁ©ûe__


1032 : "=&q" (
__dummy
), "=&r" (
__tmp
), "=&r" (
__§c
),

1033 "=m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__de°
)

1034 : "1" (
__tmp
), "2" (
__§c
),

1035 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__§c
)

1037  
__de°
;

1038 
	}
}

1042 
	#_HAVE_STRING_ARCH_°∫ˇt
 1

	)

1043 
	#°∫ˇt
(
de°
, 
§c
, 
n
) \

1044 (
	`__exãnsi⁄__
 ({ *
__de°
 = (
de°
); \

1045 
	`__buûtö_c⁄°™t_p
 (
§c
Ë&& __buûtö_c⁄°™t_∞(
n
) \

1046 ? (
	`°æí
 (
§c
Ë< ((
size_t
Ë(
n
)) \

1047 ? 
	`°rˇt
 (
__de°
, (
§c
)) \

1048 : (*(*)
	`__memp˝y
 (
	`°rchr
 (
__de°
, '\0'), \

1049 (c⁄° *Ë(
§c
), \

1050 (
n
)Ë0, 
__de°
)) \

1051 : 
	`__°∫ˇt_g
 (
__de°
, (
§c
), (
n
)); }))

	)

1053 
__STRING_INLINE
 *
__°∫ˇt_g
 (*
__de°
, c⁄° 
__§c
[],

1054 
size_t
 
__n
);

1056 
__STRING_INLINE
 *

1057 
	$__°∫ˇt_g
 (*
__de°
, c⁄° 
__§c
[], 
size_t
 
__n
)

1059 *
__tmp
 = 
__de°
;

1060 
__dummy
;

1061 #ifde‡
__i686__


1062 
__asm__
 
__vﬁ©ûe__


1076 : "=&a" (
__dummy
), "=&D" (
__tmp
), "=&S" (
__§c
), "=&c" (
__n
)

1077 : "g" (
__n
), "0" (0), "1" (
__tmp
), "2" (
__§c
), "3" (0xffffffff)

1080 --
__tmp
;

1081 
__asm__
 
__vﬁ©ûe__


1098 : "=&q" (
__dummy
), "=&r" (
__tmp
), "=&r" (
__§c
), "=&r" (
__n
)

1099 : "1" (
__tmp
), "2" (
__§c
), "3" (
__n
)

1102  
__de°
;

1103 
	}
}

1107 
	#_HAVE_STRING_ARCH_°rcmp
 1

	)

1108 
	#°rcmp
(
s1
, 
s2
) \

1109 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
s1
Ë&& __buûtö_c⁄°™t_∞(
s2
) \

1110 && ( ((
s1
)[0]Ë!1 || 
	`°æí
 (s1) >= 4) \

1111 && ( ((
s2
)[0]Ë!1 || 
	`°æí
 (s2) >= 4) \

1112 ? 
	`memcmp
 ((c⁄° *Ë(
s1
), (c⁄° *Ë(
s2
), \

1113 (
	`°æí
 (
s1
Ë< såÀ¿(
s2
) \

1114 ? 
	`°æí
 (
s1
Ë: såÀ¿(
s2
)) + 1) \

1115 : (
	`__buûtö_c⁄°™t_p
 (
s1
) &&  ((s1)[0]) == 1 \

1116 &&  ((
s2
)[0]Ë=1 && 
	`°æí
 (
s1
) < 4 \

1117 ? (
	`__buûtö_c⁄°™t_p
 (
s2
) &&  ((s2)[0]) == 1 \

1118 ? 
	`__°rcmp_cc
 ((c⁄° *Ë(
s1
), \

1119 (c⁄° *Ë(
s2
), \

1120 
	`°æí
 (
s1
)) \

1121 : 
	`__°rcmp_cg
 ((c⁄° *Ë(
s1
), \

1122 (c⁄° *Ë(
s2
), \

1123 
	`°æí
 (
s1
))) \

1124 : (
	`__buûtö_c⁄°™t_p
 (
s2
Ë&&  ((
s1
)[0]) == 1 \

1125 &&  ((
s2
)[0]Ë=1 && 
	`°æí
 (s2) < 4 \

1126 ? (
	`__buûtö_c⁄°™t_p
 (
s1
) \

1127 ? 
	`__°rcmp_cc
 ((c⁄° *Ë(
s1
), \

1128 (c⁄° *Ë(
s2
), \

1129 
	`°æí
 (
s2
)) \

1130 : 
	`__°rcmp_gc
 ((c⁄° *Ë(
s1
), \

1131 (c⁄° *Ë(
s2
), \

1132 
	`°æí
 (
s2
))) \

1133 : 
	`__°rcmp_gg
 ((
s1
), (
s2
))))))

	)

1135 
	#__°rcmp_cc
(
s1
, 
s2
, 
l
) \

1136 (
	`__exãnsi⁄__
 ({ 
__ªsu…
 = (
s1
)[0] - (
s2
)[0]; \

1137 i‡(
l
 > 0 && 
__ªsu…
 == 0) \

1139 
__ªsu…
 = (
s1
)[1] - (
s2
)[1]; \

1140 i‡(
l
 > 1 && 
__ªsu…
 == 0) \

1142 
__ªsu…
 = (
s1
)[2] - (
s2
)[2]; \

1143 i‡(
l
 > 2 && 
__ªsu…
 == 0) \

1144 
__ªsu…
 = (
s1
)[3] - (
s2
)[3]; \

1147 
__ªsu…
; }))

	)

1149 
	#__°rcmp_cg
(
s1
, 
s2
, 
l1
) \

1150 (
	`__exãnsi⁄__
 ({ c⁄° *
__s2
 = (
s2
); \

1151 
__ªsu…
 = (
s1
)[0] - 
__s2
[0]; \

1152 i‡(
l1
 > 0 && 
__ªsu…
 == 0) \

1154 
__ªsu…
 = (
s1
)[1] - 
__s2
[1]; \

1155 i‡(
l1
 > 1 && 
__ªsu…
 == 0) \

1157 
__ªsu…
 = (
s1
)[2] - 
__s2
[2]; \

1158 i‡(
l1
 > 2 && 
__ªsu…
 == 0) \

1159 
__ªsu…
 = (
s1
)[3] - 
__s2
[3]; \

1162 
__ªsu…
; }))

	)

1164 
	#__°rcmp_gc
(
s1
, 
s2
, 
l2
) \

1165 (
	`__exãnsi⁄__
 ({ c⁄° *
__s1
 = (
s1
); \

1166 
__ªsu…
 = 
__s1
[0] - (
s2
)[0]; \

1167 i‡(
l2
 > 0 && 
__ªsu…
 == 0) \

1169 
__ªsu…
 = 
__s1
[1] - (
s2
)[1]; \

1170 i‡(
l2
 > 1 && 
__ªsu…
 == 0) \

1172 
__ªsu…
 = 
__s1
[2] - (
s2
)[2]; \

1173 i‡(
l2
 > 2 && 
__ªsu…
 == 0) \

1174 
__ªsu…
 = 
__s1
[3] - (
s2
)[3]; \

1177 
__ªsu…
; }))

	)

1179 
__STRING_INLINE
 
__°rcmp_gg
 (c⁄° *
__s1
, c⁄° *
__s2
);

1181 
__STRING_INLINE
 

1182 
	$__°rcmp_gg
 (c⁄° *
__s1
, c⁄° *
__s2
)

1184 
__ªs
;

1185 
__asm__
 
__vﬁ©ûe__


1201 : "=q" (
__ªs
), "=&r" (
__s1
), "=&r" (
__s2
)

1202 : "1" (
__s1
), "2" (
__s2
),

1203 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s1
),

1204 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s2
)

1206  
__ªs
;

1207 
	}
}

1211 
	#_HAVE_STRING_ARCH_°∫cmp
 1

	)

1212 
	#°∫cmp
(
s1
, 
s2
, 
n
) \

1213 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
s1
Ë&& 
	`°æí
 (s1Ë< ((
size_t
Ë(
n
)) \

1214 ? 
	`°rcmp
 ((
s1
), (
s2
)) \

1215 : (
	`__buûtö_c⁄°™t_p
 (
s2
Ë&& 
	`°æí
 (s2Ë< ((
size_t
Ë(
n
))\

1216 ? 
	`°rcmp
 ((
s1
), (
s2
)) \

1217 : 
	`__°∫cmp_g
 ((
s1
), (
s2
), (
n
)))))

	)

1219 
__STRING_INLINE
 
__°∫cmp_g
 (c⁄° *
__s1
, c⁄° *
__s2
,

1220 
size_t
 
__n
);

1222 
__STRING_INLINE
 

1223 
	$__°∫cmp_g
 (c⁄° *
__s1
, c⁄° *
__s2
, 
size_t
 
__n
)

1225 
__ªs
;

1226 
__asm__
 
__vﬁ©ûe__


1245 : "=q" (
__ªs
), "=&r" (
__s1
), "=&r" (
__s2
), "=&r" (
__n
)

1246 : "1" (
__s1
), "2" (
__s2
), "3" (
__n
),

1247 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s1
),

1248 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__n
]; } *)
__s2
)

1250  
__ªs
;

1251 
	}
}

1255 
	#_HAVE_STRING_ARCH_°rchr
 1

	)

1256 
	#_USE_STRING_ARCH_°rchr
 1

	)

1257 
	#°rchr
(
s
, 
c
) \

1258 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
c
) \

1259 ? ((
c
) == '\0' \

1260 ? (*Ë
	`__øwmemchr
 ((
s
), (
c
)) \

1261 : 
	`__°rchr_c
 ((
s
), ((
c
) & 0xff) << 8)) \

1262 : 
	`__°rchr_g
 ((
s
), (
c
))))

	)

1264 
__STRING_INLINE
 *
__°rchr_c
 (c⁄° *
__s
, 
__c
);

1266 
__STRING_INLINE
 *

1267 
	$__°rchr_c
 (c⁄° *
__s
, 
__c
)

1269 
__d0
;

1270 *
__ªs
;

1271 
__asm__
 
__vﬁ©ûe__


1281 : "Ù" (
__ªs
), "=&a" (
__d0
)

1282 : "0" (
__s
), "1" (
__c
),

1283 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1285  
__ªs
;

1286 
	}
}

1288 
__STRING_INLINE
 *
__°rchr_g
 (c⁄° *
__s
, 
__c
);

1290 
__STRING_INLINE
 *

1291 
	$__°rchr_g
 (c⁄° *
__s
, 
__c
)

1293 
__d0
;

1294 *
__ªs
;

1295 
__asm__
 
__vﬁ©ûe__


1306 : "Ù" (
__ªs
), "=&a" (
__d0
)

1307 : "0" (
__s
), "1" (
__c
),

1308 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1310  
__ªs
;

1311 
	}
}

1315 
	#_HAVE_STRING_ARCH_°rch∫ul
 1

	)

1316 
	#__°rch∫ul
(
s
, 
c
) \

1317 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
c
) \

1318 ? ((
c
) == '\0' \

1319 ? (*Ë
	`__øwmemchr
 ((
s
), 
c
) \

1320 : 
	`__°rch∫ul_c
 ((
s
), ((
c
) & 0xff) << 8)) \

1321 : 
	`__°rch∫ul_g
 ((
s
), 
c
)))

	)

1323 
__STRING_INLINE
 *
__°rch∫ul_c
 (c⁄° *
__s
, 
__c
);

1325 
__STRING_INLINE
 *

1326 
	$__°rch∫ul_c
 (c⁄° *
__s
, 
__c
)

1328 
__d0
;

1329 *
__ªs
;

1330 
__asm__
 
__vﬁ©ûe__


1340 : "Ù" (
__ªs
), "=&a" (
__d0
)

1341 : "0" (
__s
), "1" (
__c
),

1342 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1344  
__ªs
;

1345 
	}
}

1347 
__STRING_INLINE
 *
__°rch∫ul_g
 (c⁄° *
__s
, 
__c
);

1349 
__STRING_INLINE
 *

1350 
	$__°rch∫ul_g
 (c⁄° *
__s
, 
__c
)

1352 
__d0
;

1353 *
__ªs
;

1354 
__asm__
 
__vﬁ©ûe__


1365 : "Ù" (
__ªs
), "=&a" (
__d0
)

1366 : "0" (
__s
), "1" (
__c
),

1367 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1369  
__ªs
;

1370 
	}
}

1371 #ifde‡
__USE_GNU


1372 
	#°rch∫ul
(
s
, 
c
Ë
	`__°rch∫ul
 ((s), (c))

	)

1376 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


1378 
	#_HAVE_STRING_ARCH_ödex
 1

	)

1379 
	#ödex
(
s
, 
c
) \

1380 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
c
) \

1381 ? 
	`__°rchr_c
 ((
s
), ((
c
) & 0xff) << 8) \

1382 : 
	`__°rchr_g
 ((
s
), (
c
))))

	)

1387 
	#_HAVE_STRING_ARCH_°ºchr
 1

	)

1388 
	#°ºchr
(
s
, 
c
) \

1389 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
c
) \

1390 ? 
	`__°ºchr_c
 ((
s
), ((
c
) & 0xff) << 8) \

1391 : 
	`__°ºchr_g
 ((
s
), (
c
))))

	)

1393 #ifde‡
__i686__


1394 
__STRING_INLINE
 *
__°ºchr_c
 (c⁄° *
__s
, 
__c
);

1396 
__STRING_INLINE
 *

1397 
	$__°ºchr_c
 (c⁄° *
__s
, 
__c
)

1399 
__d0
, 
__d1
;

1400 *
__ªs
;

1401 
__asm__
 
__vﬁ©ûe__


1409 : "=d" (
__ªs
), "=&S" (
__d0
), "=&a" (
__d1
)

1410 : "0" (1), "1" (
__s
), "2" (
__c
),

1411 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1413  
__ªs
 - 1;

1414 
	}
}

1416 
__STRING_INLINE
 *
__°ºchr_g
 (c⁄° *
__s
, 
__c
);

1418 
__STRING_INLINE
 *

1419 
	$__°ºchr_g
 (c⁄° *
__s
, 
__c
)

1421 
__d0
, 
__d1
;

1422 *
__ªs
;

1423 
__asm__
 
__vﬁ©ûe__


1432 : "=d" (
__ªs
), "=&S" (
__d0
), "=&a" (
__d1
)

1433 : "0" (1), "1" (
__s
), "2" (
__c
),

1434 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1436  
__ªs
 - 1;

1437 
	}
}

1439 
__STRING_INLINE
 *
__°ºchr_c
 (c⁄° *
__s
, 
__c
);

1441 
__STRING_INLINE
 *

1442 
	$__°ºchr_c
 (c⁄° *
__s
, 
__c
)

1444 
__d0
, 
__d1
;

1445 *
__ªs
;

1446 
__asm__
 
__vﬁ©ûe__


1456 : "=d" (
__ªs
), "=&S" (
__d0
), "=&a" (
__d1
)

1457 : "0" (0), "1" (
__s
), "2" (
__c
),

1458 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1460  
__ªs
;

1461 
	}
}

1463 
__STRING_INLINE
 *
__°ºchr_g
 (c⁄° *
__s
, 
__c
);

1465 
__STRING_INLINE
 *

1466 
	$__°ºchr_g
 (c⁄° *
__s
, 
__c
)

1468 
__d0
, 
__d1
;

1469 *
__ªs
;

1470 
__asm__
 
__vﬁ©ûe__


1481 : "Ù" (
__ªs
), "=&S" (
__d0
), "=&a" (
__d1
)

1482 : "0" (0), "1" (
__s
), "2" (
__c
),

1483 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1485  
__ªs
;

1486 
	}
}

1490 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


1492 
	#_HAVE_STRING_ARCH_rödex
 1

	)

1493 
	#rödex
(
s
, 
c
) \

1494 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
c
) \

1495 ? 
	`__°ºchr_c
 ((
s
), ((
c
) & 0xff) << 8) \

1496 : 
	`__°ºchr_g
 ((
s
), (
c
))))

	)

1502 
	#_HAVE_STRING_ARCH_°rc•n
 1

	)

1503 
	#°rc•n
(
s
, 
ªje˘
) \

1504 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
ªje˘
) &&  ((reject)[0]) == 1 \

1505 ? ((
ªje˘
)[0] == '\0' \

1506 ? 
	`°æí
 (
s
) \

1507 : ((
ªje˘
)[1] == '\0' \

1508 ? 
	`__°rc•n_c1
 ((
s
), (((
ªje˘
)[0] << 8) & 0xff00)) \

1509 : 
	`__°rc•n_cg
 ((
s
), (
ªje˘
), 
	`°æí
 (reject)))) \

1510 : 
	`__°rc•n_g
 ((
s
), (
ªje˘
))))

	)

1512 
__STRING_INLINE
 
size_t
 
__°rc•n_c1
 (c⁄° *
__s
, 
__ªje˘
);

1514 #i‚de‡
_FORCE_INLINES


1515 
__STRING_INLINE
 
size_t


1516 
	$__°rc•n_c1
 (c⁄° *
__s
, 
__ªje˘
)

1518 
__d0
;

1519 *
__ªs
;

1520 
__asm__
 
__vﬁ©ûe__


1529 : "Ù" (
__ªs
), "=&a" (
__d0
)

1530 : "0" (
__s
), "1" (
__ªje˘
),

1531 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1533  (
__ªs
 - 1Ë- 
__s
;

1534 
	}
}

1537 
__STRING_INLINE
 
size_t
 
__°rc•n_cg
 (c⁄° *
__s
, c⁄° 
__ªje˘
[],

1538 
size_t
 
__ªje˘_Àn
);

1540 
__STRING_INLINE
 
size_t


1541 
	$__°rc•n_cg
 (c⁄° *
__s
, c⁄° 
__ªje˘
[], 
size_t
 
__ªje˘_Àn
)

1543 
__d0
, 
__d1
, 
__d2
;

1544 c⁄° *
__ªs
;

1545 
__asm__
 
__vﬁ©ûe__


1556 : "=S" (
__ªs
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1557 : "0" (
__s
), "d" (
__ªje˘
), "g" (
__ªje˘_Àn
)

1559  (
__ªs
 - 1Ë- 
__s
;

1560 
	}
}

1562 
__STRING_INLINE
 
size_t
 
__°rc•n_g
 (c⁄° *
__s
, c⁄° *
__ªje˘
);

1563 #ifde‡
__PIC__


1565 
__STRING_INLINE
 
size_t


1566 
	$__°rc•n_g
 (c⁄° *
__s
, c⁄° *
__ªje˘
)

1568 
__d0
, 
__d1
, 
__d2
;

1569 c⁄° *
__ªs
;

1570 
__asm__
 
__vﬁ©ûe__


1587 : "=S" (
__ªs
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1588 : "r" (
__ªje˘
), "0" (
__s
), "1" (0), "2" (0xffffffff)

1590  (
__ªs
 - 1Ë- 
__s
;

1591 
	}
}

1593 
__STRING_INLINE
 
size_t


1594 
	$__°rc•n_g
 (c⁄° *
__s
, c⁄° *
__ªje˘
)

1596 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1597 c⁄° *
__ªs
;

1598 
__asm__
 
__vﬁ©ûe__


1612 : "=S" (
__ªs
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
), "=&d" (
__d3
)

1613 : "0" (
__s
), "1" (0), "2" (0xffffffff), "3" (
__ªje˘
), "b" (__reject)

1616  (
__ªs
 - 1Ë- 
__s
;

1617 
	}
}

1623 
	#_HAVE_STRING_ARCH_°r•n
 1

	)

1624 
	#°r•n
(
s
, 
ac˚±
) \

1625 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
ac˚±
) &&  ((accept)[0]) == 1 \

1626 ? ((
ac˚±
)[0] == '\0' \

1627 ? ((Ë(
s
), 0) \

1628 : ((
ac˚±
)[1] == '\0' \

1629 ? 
	`__°r•n_c1
 ((
s
), (((
ac˚±
)[0] << 8 ) & 0xff00)) \

1630 : 
	`__°r•n_cg
 ((
s
), (
ac˚±
), 
	`°æí
 (accept)))) \

1631 : 
	`__°r•n_g
 ((
s
), (
ac˚±
))))

	)

1633 #i‚de‡
_FORCE_INLINES


1634 
__STRING_INLINE
 
size_t
 
__°r•n_c1
 (c⁄° *
__s
, 
__ac˚±
);

1636 
__STRING_INLINE
 
size_t


1637 
	$__°r•n_c1
 (c⁄° *
__s
, 
__ac˚±
)

1639 
__d0
;

1640 *
__ªs
;

1642 
__asm__
 
__vﬁ©ûe__


1648 : "Ù" (
__ªs
), "=&q" (
__d0
)

1649 : "0" (
__s
), "1" (
__ac˚±
),

1650 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
)

1652  (
__ªs
 - 1Ë- 
__s
;

1653 
	}
}

1656 
__STRING_INLINE
 
size_t
 
__°r•n_cg
 (c⁄° *
__s
, c⁄° 
__ac˚±
[],

1657 
size_t
 
__ac˚±_Àn
);

1659 
__STRING_INLINE
 
size_t


1660 
	$__°r•n_cg
 (c⁄° *
__s
, c⁄° 
__ac˚±
[], 
size_t
 
__ac˚±_Àn
)

1662 
__d0
, 
__d1
, 
__d2
;

1663 c⁄° *
__ªs
;

1664 
__asm__
 
__vﬁ©ûe__


1675 : "=S" (
__ªs
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1676 : "0" (
__s
), "g" (
__ac˚±
), "g" (
__ac˚±_Àn
),

1679 "m" ( *(°ru˘ { 
__x
[0xfffffff]; } *)
__s
),

1680 "m" ( *(°ru˘ { 
__exãnsi⁄__
 
__x
[
__ac˚±_Àn
]; } *)
__ac˚±
)

1682  (
__ªs
 - 1Ë- 
__s
;

1683 
	}
}

1685 
__STRING_INLINE
 
size_t
 
__°r•n_g
 (c⁄° *
__s
, c⁄° *
__ac˚±
);

1686 #ifde‡
__PIC__


1688 
__STRING_INLINE
 
size_t


1689 
	$__°r•n_g
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

1691 
__d0
, 
__d1
, 
__d2
;

1692 c⁄° *
__ªs
;

1693 
__asm__
 
__vﬁ©ûe__


1709 : "=S" (
__ªs
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1710 : "d" (
__ac˚±
), "0" (
__s
), "1" (0), "2" (0xffffffff), "3" (__accept)

1712  (
__ªs
 - 1Ë- 
__s
;

1713 
	}
}

1715 
__STRING_INLINE
 
size_t


1716 
	$__°r•n_g
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

1718 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1719 c⁄° *
__ªs
;

1720 
__asm__
 
__vﬁ©ûe__


1734 : "=S" (
__ªs
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
), "=&d" (
__d3
)

1735 : "0" (
__s
), "1" (0), "2" (0xffffffff), "3" (
__ac˚±
), "b" (__accept)

1737  (
__ªs
 - 1Ë- 
__s
;

1738 
	}
}

1743 
	#_HAVE_STRING_ARCH_°Ωbrk
 1

	)

1744 
	#°Ωbrk
(
s
, 
ac˚±
) \

1745 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
ac˚±
) &&  ((accept)[0]) == 1 \

1746 ? ((
ac˚±
)[0] == '\0' \

1747 ? ((Ë(
s
), (*) 0) \

1748 : ((
ac˚±
)[1] == '\0' \

1749 ? 
	`°rchr
 ((
s
), (
ac˚±
)[0]) \

1750 : 
	`__°Ωbrk_cg
 ((
s
), (
ac˚±
), 
	`°æí
 (accept)))) \

1751 : 
	`__°Ωbrk_g
 ((
s
), (
ac˚±
))))

	)

1753 
__STRING_INLINE
 *
__°Ωbrk_cg
 (c⁄° *
__s
, c⁄° 
__ac˚±
[],

1754 
size_t
 
__ac˚±_Àn
);

1756 
__STRING_INLINE
 *

1757 
	$__°Ωbrk_cg
 (c⁄° *
__s
, c⁄° 
__ac˚±
[], 
size_t
 
__ac˚±_Àn
)

1759 
__d0
, 
__d1
, 
__d2
;

1760 *
__ªs
;

1761 
__asm__
 
__vﬁ©ûe__


1776 : "=S" (
__ªs
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1777 : "0" (
__s
), "d" (
__ac˚±
), "g" (
__ac˚±_Àn
)

1779  
__ªs
;

1780 
	}
}

1782 
__STRING_INLINE
 *
__°Ωbrk_g
 (c⁄° *
__s
, c⁄° *
__ac˚±
);

1783 #ifde‡
__PIC__


1785 
__STRING_INLINE
 *

1786 
	$__°Ωbrk_g
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

1788 
__d0
, 
__d1
, 
__d2
;

1789 *
__ªs
;

1790 
__asm__
 
__vﬁ©ûe__


1811 : "=S" (
__ªs
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1812 : "d" (
__ac˚±
), "0" (
__s
), "1" (0), "2" (0xffffffff)

1814  
__ªs
;

1815 
	}
}

1817 
__STRING_INLINE
 *

1818 
	$__°Ωbrk_g
 (c⁄° *
__s
, c⁄° *
__ac˚±
)

1820 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1821 *
__ªs
;

1822 
__asm__
 
__vﬁ©ûe__


1841 : "=S" (
__ªs
), "=&a" (
__d0
), "=&c" (
__d1
), "=&d" (
__d2
), "=&D" (
__d3
)

1842 : "0" (
__s
), "1" (0), "2" (0xffffffff), "b" (
__ac˚±
)

1844  
__ªs
;

1845 
	}
}

1850 
	#_HAVE_STRING_ARCH_°r°r
 1

	)

1851 
	#°r°r
(
hay°ack
, 
√edÀ
) \

1852 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
√edÀ
) &&  ((needle)[0]) == 1 \

1853 ? ((
√edÀ
)[0] == '\0' \

1854 ? (
hay°ack
) \

1855 : ((
√edÀ
)[1] == '\0' \

1856 ? 
	`°rchr
 ((
hay°ack
), (
√edÀ
)[0]) \

1857 : 
	`__°r°r_cg
 ((
hay°ack
), (
√edÀ
), \

1858 
	`°æí
 (
√edÀ
)))) \

1859 : 
	`__°r°r_g
 ((
hay°ack
), (
√edÀ
))))

	)

1863 
__STRING_INLINE
 *
__°r°r_cg
 (c⁄° *
__hay°ack
,

1864 c⁄° 
__√edÀ
[],

1865 
size_t
 
__√edÀ_Àn
);

1867 
__STRING_INLINE
 *

1868 
	$__°r°r_cg
 (c⁄° *
__hay°ack
, c⁄° 
__√edÀ
[],

1869 
size_t
 
__√edÀ_Àn
)

1871 
__d0
, 
__d1
, 
__d2
;

1872 *
__ªs
;

1873 
__asm__
 
__vﬁ©ûe__


1886 : "=&a" (
__ªs
), "=&S" (
__d0
), "=&D" (
__d1
), "=&c" (
__d2
)

1887 : "g" (
__√edÀ_Àn
), "1" (
__hay°ack
), "d" (
__√edÀ
)

1889  
__ªs
;

1890 
	}
}

1892 
__STRING_INLINE
 *
__°r°r_g
 (c⁄° *
__hay°ack
,

1893 c⁄° *
__√edÀ
);

1894 #ifde‡
__PIC__


1896 
__STRING_INLINE
 *

1897 
	$__°r°r_g
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

1899 
__d0
, 
__d1
, 
__d2
;

1900 *
__ªs
;

1901 
__asm__
 
__vﬁ©ûe__


1920 : "=&a" (
__ªs
), "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
)

1921 : "0" (0), "1" (0xffffffff), "2" (
__hay°ack
), "3" (
__√edÀ
),

1922 "d" (
__√edÀ
)

1924  
__ªs
;

1925 
	}
}

1927 
__STRING_INLINE
 *

1928 
	$__°r°r_g
 (c⁄° *
__hay°ack
, c⁄° *
__√edÀ
)

1930 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1931 *
__ªs
;

1932 
__asm__
 
__vﬁ©ûe__


1949 : "=&a" (
__ªs
), "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
), "=&d" (
__d3
)

1950 : "0" (0), "1" (0xffffffff), "2" (
__hay°ack
), "3" (
__√edÀ
),

1951 "b" (
__√edÀ
)

1953  
__ªs
;

1954 
	}
}

1960 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


1961 #ifde‡
__i686__


1962 
	#_HAVE_STRING_ARCH_ffs
 1

	)

1963 
	#ffs
(
w‹d
Ë(
	`__buûtö_c⁄°™t_p
 (word) \

1964 ? 
	`__buûtö_ffs
 (
w‹d
) \

1965 : ({ 
__˙t
, 
__tmp
; \

1966 
__asm__
 
__vﬁ©ûe__
 \

1969 : "=&r" (
__˙t
), "Ù" (
__tmp
) \

1970 : "rm" (
w‹d
), "1" (-1)); \

1971 
__˙t
 + 1; }))

	)

1973 #i‚de‡
ff¶


1974 
	#ff¶
(
w‹d
Ë
	`ffs
(w‹d)

	)

1979 #i‚de‡
_FORCE_INLINES


1980 #unde‡
__STRING_INLINE


	@/usr/include/bits/string2.h

20 #i‚de‡
_STRING_H


24 #i‡!
deföed
 
__NO_STRING_INLINES
 && !deföed 
__BOUNDED_POINTERS__


41 #i‚de‡
__STRING_INLINE


42 #ifde‡
__˝lu•lus


43 
	#__STRING_INLINE
 
ölöe


	)

45 
	#__STRING_INLINE
 
__exã∫_ölöe


	)

49 #i‡
_STRING_ARCH_u«lig√d


51 
	~<ídün.h
>

52 
	~<bôs/ty≥s.h
>

54 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


55 
	#__STRING2_SMALL_GET16
(
§c
, 
idx
) \

56 (((c⁄° *Ë(c⁄° *Ë(
§c
))[
idx
 + 1] << 8 \

57 | ((c⁄° *Ë(c⁄° *Ë(
§c
))[
idx
])

	)

58 
	#__STRING2_SMALL_GET32
(
§c
, 
idx
) \

59 (((((c⁄° *Ë(c⁄° *Ë(
§c
))[
idx
 + 3] << 8 \

60 | ((c⁄° *Ë(c⁄° *Ë(
§c
))[
idx
 + 2]) << 8 \

61 | ((c⁄° *Ë(c⁄° *Ë(
§c
))[
idx
 + 1]) << 8 \

62 | ((c⁄° *Ë(c⁄° *Ë(
§c
))[
idx
])

	)

64 
	#__STRING2_SMALL_GET16
(
§c
, 
idx
) \

65 (((c⁄° *Ë(c⁄° *Ë(
§c
))[
idx
] << 8 \

66 | ((c⁄° *Ë(c⁄° *Ë(
§c
))[
idx
 + 1])

	)

67 
	#__STRING2_SMALL_GET32
(
§c
, 
idx
) \

68 (((((c⁄° *Ë(c⁄° *Ë(
§c
))[
idx
] << 8 \

69 | ((c⁄° *Ë(c⁄° *Ë(
§c
))[
idx
 + 1]) << 8 \

70 | ((c⁄° *Ë(c⁄° *Ë(
§c
))[
idx
 + 2]) << 8 \

71 | ((c⁄° *Ë(c⁄° *Ë(
§c
))[
idx
 + 3])

	)

76 
	#__STRING2_COPY_TYPE
(
N
) \

77 °ru˘ { 
__¨r
[
N
]; } \

78 
	t__©åibuã__
 ((
	t__∑cked__
)Ë
	t__STRING2_COPY_ARR
##
	tN


	)

79 
	t__STRING2_COPY_TYPE
 (2);

80 
__STRING2_COPY_TYPE
 (3);

81 
__STRING2_COPY_TYPE
 (4);

82 
__STRING2_COPY_TYPE
 (5);

83 
__STRING2_COPY_TYPE
 (6);

84 
__STRING2_COPY_TYPE
 (7);

85 
__STRING2_COPY_TYPE
 (8);

86 #unde‡
__STRING2_COPY_TYPE


92 
	#__°rög2_1b±r_p
(
__x
) \

93 ((
size_t
)(c⁄° *)((
__x
Ë+ 1Ë- (size_t)(c⁄° *)(__xË=1)

	)

96 #i‡!
deföed
 
_HAVE_STRING_ARCH_mem£t


97 #i‡!
__GNUC_PREREQ
 (3, 0)

98 #i‡
_STRING_ARCH_u«lig√d


99 
	#mem£t
(
s
, 
c
, 
n
) \

100 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
n
) && (n) <= 16 \

101 ? ((
n
) == 1 \

102 ? 
	`__mem£t_1
 (
s
, 
c
) \

103 : 
	`__mem£t_gc
 (
s
, 
c
, 
n
)) \

104 : (
	`__buûtö_c⁄°™t_p
 (
c
) && (c) == '\0' \

105 ? ({ *
__s
 = (
s
); 
	`__bzîo
 (__s, 
n
); __s; }) \

106 : 
	`mem£t
 (
s
, 
c
, 
n
))))

	)

108 
	#__mem£t_1
(
s
, 
c
Ë({ *
__s
 = (s); \

109 *((
__uöt8_t
 *Ë
__s
Ë(__uöt8_tË
c
; __s; })

	)

111 
	#__mem£t_gc
(
s
, 
c
, 
n
) \

112 ({ *
__s
 = (
s
); \

114 
__ui
; \

115 
__usi
; \

116 
__uc
; \

117 } *
__u
 = 
__s
; \

118 
__uöt8_t
 
__c
 = (__uöt8_tË(
c
); \

121 (Ë(
n
)) \

124 
__u
->
__ui
 = 
__c
 * 0x01010101; \

125 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

127 
__u
->
__ui
 = 
__c
 * 0x01010101; \

128 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

130 
__u
->
__ui
 = 
__c
 * 0x01010101; \

131 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

133 
__u
->
__usi
 = (Ë
__c
 * 0x0101; \

134 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2); \

135 
__u
->
__uc
 = (Ë
__c
; \

139 
__u
->
__ui
 = 
__c
 * 0x01010101; \

140 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

142 
__u
->
__ui
 = 
__c
 * 0x01010101; \

143 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

145 
__u
->
__ui
 = 
__c
 * 0x01010101; \

146 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

148 
__u
->
__usi
 = (Ë
__c
 * 0x0101; \

152 
__u
->
__ui
 = 
__c
 * 0x01010101; \

153 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

155 
__u
->
__ui
 = 
__c
 * 0x01010101; \

156 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

158 
__u
->
__ui
 = 
__c
 * 0x01010101; \

159 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

161 
__u
->
__uc
 = (Ë
__c
; \

165 
__u
->
__ui
 = 
__c
 * 0x01010101; \

166 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

168 
__u
->
__ui
 = 
__c
 * 0x01010101; \

169 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

171 
__u
->
__ui
 = 
__c
 * 0x01010101; \

172 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4); \

174 
__u
->
__ui
 = 
__c
 * 0x01010101; \

179 
__s
; })

	)

181 
	#mem£t
(
s
, 
c
, 
n
) \

182 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
c
) && (c) == '\0' \

183 ? ({ *
__s
 = (
s
); 
	`__bzîo
 (__s, 
n
); __s; }) \

184 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

193 #i‡
__GNUC_PREREQ
 (2, 91)

194 
	#__bzîo
(
s
, 
n
Ë
	`__buûtö_mem£t
 (s, '\0',Ç)

	)

202 #ifde‡
__USE_GNU


203 #i‡!
deföed
 
_HAVE_STRING_ARCH_memp˝y
 || deföed 
_FORCE_INLINES


204 #i‚de‡
_HAVE_STRING_ARCH_memp˝y


205 #i‡
__GNUC_PREREQ
 (3, 4)

206 
	#__memp˝y
(
de°
, 
§c
, 
n
Ë
	`__buûtö_memp˝y
 (de°, src,Ç)

	)

207 #ñi‡
__GNUC_PREREQ
 (3, 0)

208 
	#__memp˝y
(
de°
, 
§c
, 
n
) \

209 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
Ë&& __buûtö_c⁄°™t_∞(
n
) \

210 && 
	`__°rög2_1b±r_p
 (
§c
Ë&& 
n
 <= 8 \

211 ? 
	`__buûtö_mem˝y
 (
de°
, 
§c
, 
n
) + (n) \

212 : 
	`__memp˝y
 (
de°
, 
§c
, 
n
)))

	)

214 
	#__memp˝y
(
de°
, 
§c
, 
n
) \

215 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
Ë&& __buûtö_c⁄°™t_∞(
n
) \

216 && 
	`__°rög2_1b±r_p
 (
§c
Ë&& 
n
 <= 8 \

217 ? 
	`__memp˝y_smÆl
 (
de°
, 
	`__memp˝y_¨gs
 (
§c
), 
n
) \

218 : 
	`__memp˝y
 (
de°
, 
§c
, 
n
)))

	)

222 
	#memp˝y
(
de°
, 
§c
, 
n
Ë
	`__memp˝y
 (de°, src,Ç)

	)

225 #i‡!
__GNUC_PREREQ
 (3, 0Ë|| 
deföed
 
_FORCE_INLINES


226 #i‡
_STRING_ARCH_u«lig√d


227 #i‚de‡
_FORCE_INLINES


228 
	#__memp˝y_¨gs
(
§c
) \

229 ((c⁄° *Ë(
§c
))[0], ((const *) (src))[2], \

230 ((c⁄° *Ë(
§c
))[4], ((const *) (src))[6], \

231 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET16
 (
§c
, 0), \

232 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET16
 (
§c
, 4), \

233 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET32
 (
§c
, 0), \

234 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET32
 (
§c
, 4)

	)

236 
__STRING_INLINE
 *
__memp˝y_smÆl
 (*, , , , ,

237 
__uöt16_t
, __uöt16_t, 
__uöt32_t
,

238 
__uöt32_t
, 
size_t
);

239 
__STRING_INLINE
 *

240 
	$__memp˝y_smÆl
 (*
__de°1
,

241 
__§c0_1
, 
__§c2_1
, 
__§c4_1
, 
__§c6_1
,

242 
__uöt16_t
 
__§c0_2
, __uöt16_à
__§c4_2
,

243 
__uöt32_t
 
__§c0_4
, __uöt32_à
__§c4_4
,

244 
size_t
 
__§˛í
)

247 
__uöt32_t
 
__ui
;

248 
__uöt16_t
 
__usi
;

249 
__uc
;

250 
__c
;

251 } *
__u
 = 
__de°1
;

252 (Ë
__§˛í
)

255 
__u
->
__c
 = 
__§c0_1
;

256 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 1);

259 
__u
->
__usi
 = 
__§c0_2
;

260 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2);

263 
__u
->
__usi
 = 
__§c0_2
;

264 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2);

265 
__u
->
__c
 = 
__§c2_1
;

266 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 1);

269 
__u
->
__ui
 = 
__§c0_4
;

270 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

273 
__u
->
__ui
 = 
__§c0_4
;

274 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

275 
__u
->
__c
 = 
__§c4_1
;

276 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 1);

279 
__u
->
__ui
 = 
__§c0_4
;

280 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

281 
__u
->
__usi
 = 
__§c4_2
;

282 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2);

285 
__u
->
__ui
 = 
__§c0_4
;

286 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

287 
__u
->
__usi
 = 
__§c4_2
;

288 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2);

289 
__u
->
__c
 = 
__§c6_1
;

290 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 1);

293 
__u
->
__ui
 = 
__§c0_4
;

294 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

295 
__u
->
__ui
 = 
__§c4_4
;

296 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

299  (*Ë
__u
;

300 
	}
}

302 #i‚de‡
_FORCE_INLINES


303 
	#__memp˝y_¨gs
(
§c
) \

304 ((c⁄° *Ë(
§c
))[0], \

305 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR2
) \

306 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1] } }), \

307 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR3
) \

308 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1], \

309 ((c⁄° *Ë(
§c
))[2] } }), \

310 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR4
) \

311 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1], \

312 ((c⁄° *Ë(
§c
))[2], ((const *) (src))[3] } }), \

313 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR5
) \

314 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1], \

315 ((c⁄° *Ë(
§c
))[2], ((const *) (src))[3], \

316 ((c⁄° *Ë(
§c
))[4] } }), \

317 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR6
) \

318 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1], \

319 ((c⁄° *Ë(
§c
))[2], ((const *) (src))[3], \

320 ((c⁄° *Ë(
§c
))[4], ((const *) (src))[5] } }), \

321 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR7
) \

322 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1], \

323 ((c⁄° *Ë(
§c
))[2], ((const *) (src))[3], \

324 ((c⁄° *Ë(
§c
))[4], ((const *) (src))[5], \

325 ((c⁄° *Ë(
§c
))[6] } }), \

326 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR8
) \

327 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1], \

328 ((c⁄° *Ë(
§c
))[2], ((const *) (src))[3], \

329 ((c⁄° *Ë(
§c
))[4], ((const *) (src))[5], \

330 ((c⁄° *Ë(
§c
))[6], ((c⁄° *Ë(§c))[7] } })

	)

332 
__STRING_INLINE
 *
__memp˝y_smÆl
 (*, , 
__STRING2_COPY_ARR2
,

333 
__STRING2_COPY_ARR3
,

334 
__STRING2_COPY_ARR4
,

335 
__STRING2_COPY_ARR5
,

336 
__STRING2_COPY_ARR6
,

337 
__STRING2_COPY_ARR7
,

338 
__STRING2_COPY_ARR8
, 
size_t
);

339 
__STRING_INLINE
 *

340 
	$__memp˝y_smÆl
 (*
__de°
, 
__§c1
,

341 
__STRING2_COPY_ARR2
 
__§c2
, 
__STRING2_COPY_ARR3
 
__§c3
,

342 
__STRING2_COPY_ARR4
 
__§c4
, 
__STRING2_COPY_ARR5
 
__§c5
,

343 
__STRING2_COPY_ARR6
 
__§c6
, 
__STRING2_COPY_ARR7
 
__§c7
,

344 
__STRING2_COPY_ARR8
 
__§c8
, 
size_t
 
__§˛í
)

347 
__c
;

348 
__STRING2_COPY_ARR2
 
__sˇ2
;

349 
__STRING2_COPY_ARR3
 
__sˇ3
;

350 
__STRING2_COPY_ARR4
 
__sˇ4
;

351 
__STRING2_COPY_ARR5
 
__sˇ5
;

352 
__STRING2_COPY_ARR6
 
__sˇ6
;

353 
__STRING2_COPY_ARR7
 
__sˇ7
;

354 
__STRING2_COPY_ARR8
 
__sˇ8
;

355 } *
__u
 = 
__de°
;

356 (Ë
__§˛í
)

359 
__u
->
__c
 = 
__§c1
;

362 
__exãnsi⁄__
 
__u
->
__sˇ2
 = 
__§c2
;

365 
__exãnsi⁄__
 
__u
->
__sˇ3
 = 
__§c3
;

368 
__exãnsi⁄__
 
__u
->
__sˇ4
 = 
__§c4
;

371 
__exãnsi⁄__
 
__u
->
__sˇ5
 = 
__§c5
;

374 
__exãnsi⁄__
 
__u
->
__sˇ6
 = 
__§c6
;

377 
__exãnsi⁄__
 
__u
->
__sˇ7
 = 
__§c7
;

380 
__exãnsi⁄__
 
__u
->
__sˇ8
 = 
__§c8
;

383  
	`__exãnsi⁄__
 ((*Ë
__u
 + 
__§˛í
);

384 
	}
}

392 #i‚de‡
_HAVE_STRING_ARCH_°rchr


393 *
__øwmemchr
 (c⁄° *
__s
, 
__c
);

394 #i‡
__GNUC_PREREQ
 (3, 2)

395 
	#°rchr
(
s
, 
c
) \

396 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
c
Ë&& !__buûtö_c⁄°™t_∞(
s
) \

397 && (
c
) == '\0' \

398 ? (*Ë
	`__øwmemchr
 (
s
, 
c
) \

399 : 
	`__buûtö_°rchr
 (
s
, 
c
)))

	)

401 
	#°rchr
(
s
, 
c
) \

402 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
c
) && (c) == '\0' \

403 ? (*Ë
	`__øwmemchr
 (
s
, 
c
) \

404 : 
	`°rchr
 (
s
, 
c
)))

	)

410 #i‡(!
deföed
 
_HAVE_STRING_ARCH_°r˝y
 && !
__GNUC_PREREQ
 (3, 0)) \

411 || 
deföed
 
	g_FORCE_INLINES


412 #i‡!
deföed
 
_HAVE_STRING_ARCH_°r˝y
 && !
__GNUC_PREREQ
 (3, 0)

413 
	#°r˝y
(
de°
, 
§c
) \

414 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
) \

415 ? (
	`__°rög2_1b±r_p
 (
§c
Ë&& 
	`°æí
 (src) + 1 <= 8 \

416 ? 
	`__°r˝y_smÆl
 (
de°
, 
	`__°r˝y_¨gs
 (
§c
), \

417 
	`°æí
 (
§c
) + 1) \

418 : (*Ë
	`mem˝y
 (
de°
, 
§c
, 
	`°æí
 (src) + 1)) \

419 : 
	`°r˝y
 (
de°
, 
§c
)))

	)

422 #i‡
_STRING_ARCH_u«lig√d


423 #i‚de‡
_FORCE_INLINES


424 
	#__°r˝y_¨gs
(
§c
) \

425 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET16
 (
§c
, 0), \

426 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET16
 (
§c
, 4), \

427 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET32
 (
§c
, 0), \

428 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET32
 (
§c
, 4)

	)

430 
__STRING_INLINE
 *
__°r˝y_smÆl
 (*, 
__uöt16_t
, __uint16_t,

431 
__uöt32_t
, __uöt32_t, 
size_t
);

432 
__STRING_INLINE
 *

433 
	$__°r˝y_smÆl
 (*
__de°
,

434 
__uöt16_t
 
__§c0_2
, __uöt16_à
__§c4_2
,

435 
__uöt32_t
 
__§c0_4
, __uöt32_à
__§c4_4
,

436 
size_t
 
__§˛í
)

439 
__uöt32_t
 
__ui
;

440 
__uöt16_t
 
__usi
;

441 
__uc
;

442 } *
__u
 = (*Ë
__de°
;

443 (Ë
__§˛í
)

446 
__u
->
__uc
 = '\0';

449 
__u
->
__usi
 = 
__§c0_2
;

452 
__u
->
__usi
 = 
__§c0_2
;

453 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2);

454 
__u
->
__uc
 = '\0';

457 
__u
->
__ui
 = 
__§c0_4
;

460 
__u
->
__ui
 = 
__§c0_4
;

461 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

462 
__u
->
__uc
 = '\0';

465 
__u
->
__ui
 = 
__§c0_4
;

466 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

467 
__u
->
__usi
 = 
__§c4_2
;

470 
__u
->
__ui
 = 
__§c0_4
;

471 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

472 
__u
->
__usi
 = 
__§c4_2
;

473 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2);

474 
__u
->
__uc
 = '\0';

477 
__u
->
__ui
 = 
__§c0_4
;

478 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

479 
__u
->
__ui
 = 
__§c4_4
;

482  
__de°
;

483 
	}
}

485 #i‚de‡
_FORCE_INLINES


486 
	#__°r˝y_¨gs
(
§c
) \

487 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR2
) \

488 { { ((c⁄° *Ë(
§c
))[0], '\0' } }), \

489 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR3
) \

490 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1], \

492 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR4
) \

493 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1], \

494 ((c⁄° *Ë(
§c
))[2], '\0' } }), \

495 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR5
) \

496 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1], \

497 ((c⁄° *Ë(
§c
))[2], ((const *) (src))[3], \

499 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR6
) \

500 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1], \

501 ((c⁄° *Ë(
§c
))[2], ((const *) (src))[3], \

502 ((c⁄° *Ë(
§c
))[4], '\0' } }), \

503 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR7
) \

504 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1], \

505 ((c⁄° *Ë(
§c
))[2], ((const *) (src))[3], \

506 ((c⁄° *Ë(
§c
))[4], ((const *) (src))[5], \

508 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR8
) \

509 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1], \

510 ((c⁄° *Ë(
§c
))[2], ((const *) (src))[3], \

511 ((c⁄° *Ë(
§c
))[4], ((const *) (src))[5], \

512 ((c⁄° *Ë(
§c
))[6], '\0' } })

	)

514 
__STRING_INLINE
 *
__°r˝y_smÆl
 (*, 
__STRING2_COPY_ARR2
,

515 
__STRING2_COPY_ARR3
,

516 
__STRING2_COPY_ARR4
,

517 
__STRING2_COPY_ARR5
,

518 
__STRING2_COPY_ARR6
,

519 
__STRING2_COPY_ARR7
,

520 
__STRING2_COPY_ARR8
, 
size_t
);

521 
__STRING_INLINE
 *

522 
	$__°r˝y_smÆl
 (*
__de°
,

523 
__STRING2_COPY_ARR2
 
__§c2
, 
__STRING2_COPY_ARR3
 
__§c3
,

524 
__STRING2_COPY_ARR4
 
__§c4
, 
__STRING2_COPY_ARR5
 
__§c5
,

525 
__STRING2_COPY_ARR6
 
__§c6
, 
__STRING2_COPY_ARR7
 
__§c7
,

526 
__STRING2_COPY_ARR8
 
__§c8
, 
size_t
 
__§˛í
)

529 
__c
;

530 
__STRING2_COPY_ARR2
 
__sˇ2
;

531 
__STRING2_COPY_ARR3
 
__sˇ3
;

532 
__STRING2_COPY_ARR4
 
__sˇ4
;

533 
__STRING2_COPY_ARR5
 
__sˇ5
;

534 
__STRING2_COPY_ARR6
 
__sˇ6
;

535 
__STRING2_COPY_ARR7
 
__sˇ7
;

536 
__STRING2_COPY_ARR8
 
__sˇ8
;

537 } *
__u
 = (*Ë
__de°
;

538 (Ë
__§˛í
)

541 
__u
->
__c
 = '\0';

544 
__exãnsi⁄__
 
__u
->
__sˇ2
 = 
__§c2
;

547 
__exãnsi⁄__
 
__u
->
__sˇ3
 = 
__§c3
;

550 
__exãnsi⁄__
 
__u
->
__sˇ4
 = 
__§c4
;

553 
__exãnsi⁄__
 
__u
->
__sˇ5
 = 
__§c5
;

556 
__exãnsi⁄__
 
__u
->
__sˇ6
 = 
__§c6
;

559 
__exãnsi⁄__
 
__u
->
__sˇ7
 = 
__§c7
;

562 
__exãnsi⁄__
 
__u
->
__sˇ8
 = 
__§c8
;

565  
__de°
;

566 
	}
}

572 #ifde‡
__USE_GNU


573 #i‡!
deföed
 
_HAVE_STRING_ARCH_°p˝y
 || deföed 
_FORCE_INLINES


574 #i‚de‡
_HAVE_STRING_ARCH_°p˝y


575 #i‡
__GNUC_PREREQ
 (3, 4)

576 
	#__°p˝y
(
de°
, 
§c
Ë
	`__buûtö_°p˝y
 (de°, src)

	)

577 #ñi‡
__GNUC_PREREQ
 (3, 0)

578 
	#__°p˝y
(
de°
, 
§c
) \

579 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
) \

580 ? (
	`__°rög2_1b±r_p
 (
§c
Ë&& 
	`°æí
 (src) + 1 <= 8 \

581 ? 
	`__buûtö_°r˝y
 (
de°
, 
§c
Ë+ 
	`°æí
 (src) \

582 : ((*Ë(
__memp˝y
Ë(
de°
, 
§c
, 
	`°æí
 (src) + 1) \

584 : 
	`__°p˝y
 (
de°
, 
§c
)))

	)

586 
	#__°p˝y
(
de°
, 
§c
) \

587 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
) \

588 ? (
	`__°rög2_1b±r_p
 (
§c
Ë&& 
	`°æí
 (src) + 1 <= 8 \

589 ? 
	`__°p˝y_smÆl
 (
de°
, 
	`__°p˝y_¨gs
 (
§c
), \

590 
	`°æí
 (
§c
) + 1) \

591 : ((*Ë(
__memp˝y
Ë(
de°
, 
§c
, 
	`°æí
 (src) + 1) \

593 : 
	`__°p˝y
 (
de°
, 
§c
)))

	)

597 
	#°p˝y
(
de°
, 
§c
Ë
	`__°p˝y
 (de°, src)

	)

600 #i‡!
__GNUC_PREREQ
 (3, 0Ë|| 
deföed
 
_FORCE_INLINES


601 #i‡
_STRING_ARCH_u«lig√d


602 #i‚de‡
_FORCE_INLINES


603 
	#__°p˝y_¨gs
(
§c
) \

604 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET16
 (
§c
, 0), \

605 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET16
 (
§c
, 4), \

606 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET32
 (
§c
, 0), \

607 
__exãnsi⁄__
 
	`__STRING2_SMALL_GET32
 (
§c
, 4)

	)

609 
__STRING_INLINE
 *
__°p˝y_smÆl
 (*, 
__uöt16_t
, __uint16_t,

610 
__uöt32_t
, __uöt32_t, 
size_t
);

611 
__STRING_INLINE
 *

612 
	$__°p˝y_smÆl
 (*
__de°
,

613 
__uöt16_t
 
__§c0_2
, __uöt16_à
__§c4_2
,

614 
__uöt32_t
 
__§c0_4
, __uöt32_à
__§c4_4
,

615 
size_t
 
__§˛í
)

618 
__ui
;

619 
__usi
;

620 
__uc
;

621 
__c
;

622 } *
__u
 = (*Ë
__de°
;

623 (Ë
__§˛í
)

626 
__u
->
__uc
 = '\0';

629 
__u
->
__usi
 = 
__§c0_2
;

630 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 1);

633 
__u
->
__usi
 = 
__§c0_2
;

634 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2);

635 
__u
->
__uc
 = '\0';

638 
__u
->
__ui
 = 
__§c0_4
;

639 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 3);

642 
__u
->
__ui
 = 
__§c0_4
;

643 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

644 
__u
->
__uc
 = '\0';

647 
__u
->
__ui
 = 
__§c0_4
;

648 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

649 
__u
->
__usi
 = 
__§c4_2
;

650 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 1);

653 
__u
->
__ui
 = 
__§c0_4
;

654 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

655 
__u
->
__usi
 = 
__§c4_2
;

656 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 2);

657 
__u
->
__uc
 = '\0';

660 
__u
->
__ui
 = 
__§c0_4
;

661 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 4);

662 
__u
->
__ui
 = 
__§c4_4
;

663 
__u
 = 
	`__exãnsi⁄__
 ((*) __u + 3);

666  &
__u
->
__c
;

667 
	}
}

669 #i‚de‡
_FORCE_INLINES


670 
	#__°p˝y_¨gs
(
§c
) \

671 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR2
) \

672 { { ((c⁄° *Ë(
§c
))[0], '\0' } }), \

673 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR3
) \

674 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1], \

676 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR4
) \

677 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1], \

678 ((c⁄° *Ë(
§c
))[2], '\0' } }), \

679 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR5
) \

680 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1], \

681 ((c⁄° *Ë(
§c
))[2], ((const *) (src))[3], \

683 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR6
) \

684 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1], \

685 ((c⁄° *Ë(
§c
))[2], ((const *) (src))[3], \

686 ((c⁄° *Ë(
§c
))[4], '\0' } }), \

687 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR7
) \

688 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1], \

689 ((c⁄° *Ë(
§c
))[2], ((const *) (src))[3], \

690 ((c⁄° *Ë(
§c
))[4], ((const *) (src))[5], \

692 
	`__exãnsi⁄__
 ((
__STRING2_COPY_ARR8
) \

693 { { ((c⁄° *Ë(
§c
))[0], ((const *) (src))[1], \

694 ((c⁄° *Ë(
§c
))[2], ((const *) (src))[3], \

695 ((c⁄° *Ë(
§c
))[4], ((const *) (src))[5], \

696 ((c⁄° *Ë(
§c
))[6], '\0' } })

	)

698 
__STRING_INLINE
 *
__°p˝y_smÆl
 (*, 
__STRING2_COPY_ARR2
,

699 
__STRING2_COPY_ARR3
,

700 
__STRING2_COPY_ARR4
,

701 
__STRING2_COPY_ARR5
,

702 
__STRING2_COPY_ARR6
,

703 
__STRING2_COPY_ARR7
,

704 
__STRING2_COPY_ARR8
, 
size_t
);

705 
__STRING_INLINE
 *

706 
	$__°p˝y_smÆl
 (*
__de°
,

707 
__STRING2_COPY_ARR2
 
__§c2
, 
__STRING2_COPY_ARR3
 
__§c3
,

708 
__STRING2_COPY_ARR4
 
__§c4
, 
__STRING2_COPY_ARR5
 
__§c5
,

709 
__STRING2_COPY_ARR6
 
__§c6
, 
__STRING2_COPY_ARR7
 
__§c7
,

710 
__STRING2_COPY_ARR8
 
__§c8
, 
size_t
 
__§˛í
)

713 
__c
;

714 
__STRING2_COPY_ARR2
 
__sˇ2
;

715 
__STRING2_COPY_ARR3
 
__sˇ3
;

716 
__STRING2_COPY_ARR4
 
__sˇ4
;

717 
__STRING2_COPY_ARR5
 
__sˇ5
;

718 
__STRING2_COPY_ARR6
 
__sˇ6
;

719 
__STRING2_COPY_ARR7
 
__sˇ7
;

720 
__STRING2_COPY_ARR8
 
__sˇ8
;

721 } *
__u
 = (*Ë
__de°
;

722 (Ë
__§˛í
)

725 
__u
->
__c
 = '\0';

728 
__exãnsi⁄__
 
__u
->
__sˇ2
 = 
__§c2
;

731 
__exãnsi⁄__
 
__u
->
__sˇ3
 = 
__§c3
;

734 
__exãnsi⁄__
 
__u
->
__sˇ4
 = 
__§c4
;

737 
__exãnsi⁄__
 
__u
->
__sˇ5
 = 
__§c5
;

740 
__exãnsi⁄__
 
__u
->
__sˇ6
 = 
__§c6
;

743 
__exãnsi⁄__
 
__u
->
__sˇ7
 = 
__§c7
;

746 
__exãnsi⁄__
 
__u
->
__sˇ8
 = 
__§c8
;

749  
__de°
 + 
__§˛í
 - 1;

750 
	}
}

758 #i‚de‡
_HAVE_STRING_ARCH_°∫˝y


759 #i‡
__GNUC_PREREQ
 (3, 2)

760 
	#°∫˝y
(
de°
, 
§c
, 
n
Ë
	`__buûtö_°∫˝y
 (de°, src,Ç)

	)

762 
	#°∫˝y
(
de°
, 
§c
, 
n
) \

763 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
Ë&& __buûtö_c⁄°™t_∞(
n
) \

764 ? (
	`°æí
 (
§c
Ë+ 1 >((
size_t
Ë(
n
)) \

765 ? (*Ë
	`mem˝y
 (
de°
, 
§c
, 
n
) \

766 : 
	`°∫˝y
 (
de°
, 
§c
, 
n
)) \

767 : 
	`°∫˝y
 (
de°
, 
§c
, 
n
)))

	)

773 #i‚de‡
_HAVE_STRING_ARCH_°∫ˇt


774 #ifde‡
_USE_STRING_ARCH_°rchr


775 
	#°∫ˇt
(
de°
, 
§c
, 
n
) \

776 (
	`__exãnsi⁄__
 ({ *
__de°
 = (
de°
); \

777 
	`__buûtö_c⁄°™t_p
 (
§c
Ë&& __buûtö_c⁄°™t_∞(
n
) \

778 ? (
	`°æí
 (
§c
Ë< ((
size_t
Ë(
n
)) \

779 ? 
	`°rˇt
 (
__de°
, 
§c
) \

780 : (*((*Ë
	`__memp˝y
 (
	`°rchr
 (
__de°
, '\0'), \

781 
§c
, 
n
)Ë'\0', 
__de°
)) \

782 : 
	`°∫ˇt
 (
de°
, 
§c
, 
n
); }))

	)

783 #ñi‡
__GNUC_PREREQ
 (3, 2)

784 
	#°∫ˇt
(
de°
, 
§c
, 
n
Ë
	`__buûtö_°∫ˇt
 (de°, src,Ç)

	)

786 
	#°∫ˇt
(
de°
, 
§c
, 
n
) \

787 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
§c
Ë&& __buûtö_c⁄°™t_∞(
n
) \

788 ? (
	`°æí
 (
§c
Ë< ((
size_t
Ë(
n
)) \

789 ? 
	`°rˇt
 (
de°
, 
§c
) \

790 : 
	`°∫ˇt
 (
de°
, 
§c
, 
n
)) \

791 : 
	`°∫ˇt
 (
de°
, 
§c
, 
n
)))

	)

797 #i‚de‡
_HAVE_STRING_ARCH_°rcmp


798 #i‡
__GNUC_PREREQ
 (3, 2)

799 
	#°rcmp
(
s1
, 
s2
) \

800 
__exãnsi⁄__
 \

801 ({ 
size_t
 
__s1_Àn
, 
__s2_Àn
; \

802 (
	`__buûtö_c⁄°™t_p
 (
s1
Ë&& __buûtö_c⁄°™t_∞(
s2
) \

803 && (
__s1_Àn
 = 
	`°æí
 (
s1
), 
__s2_Àn
 = såÀ¿(
s2
), \

804 (!
	`__°rög2_1b±r_p
 (
s1
Ë|| 
__s1_Àn
 >= 4) \

805 && (!
	`__°rög2_1b±r_p
 (
s2
Ë|| 
__s2_Àn
 >= 4)) \

806 ? 
	`__buûtö_°rcmp
 (
s1
, 
s2
) \

807 : (
	`__buûtö_c⁄°™t_p
 (
s1
Ë&& 
	`__°rög2_1b±r_p
 (s1) \

808 && (
__s1_Àn
 = 
	`°æí
 (
s1
), __s1_len < 4) \

809 ? (
	`__buûtö_c⁄°™t_p
 (
s2
Ë&& 
	`__°rög2_1b±r_p
 (s2) \

810 ? 
	`__buûtö_°rcmp
 (
s1
, 
s2
) \

811 : 
	`__°rcmp_cg
 (
s1
, 
s2
, 
__s1_Àn
)) \

812 : (
	`__buûtö_c⁄°™t_p
 (
s2
Ë&& 
	`__°rög2_1b±r_p
 (s2) \

813 && (
__s2_Àn
 = 
	`°æí
 (
s2
), __s2_len < 4) \

814 ? (
	`__buûtö_c⁄°™t_p
 (
s1
Ë&& 
	`__°rög2_1b±r_p
 (s1) \

815 ? 
	`__buûtö_°rcmp
 (
s1
, 
s2
) \

816 : 
	`__°rcmp_gc
 (
s1
, 
s2
, 
__s2_Àn
)) \

817 : 
	`__buûtö_°rcmp
 (
s1
, 
s2
)))); })

	)

819 
	#°rcmp
(
s1
, 
s2
) \

820 
__exãnsi⁄__
 \

821 ({ 
size_t
 
__s1_Àn
, 
__s2_Àn
; \

822 (
	`__buûtö_c⁄°™t_p
 (
s1
Ë&& __buûtö_c⁄°™t_∞(
s2
) \

823 && (
__s1_Àn
 = 
	`°æí
 (
s1
), 
__s2_Àn
 = såÀ¿(
s2
), \

824 (!
	`__°rög2_1b±r_p
 (
s1
Ë|| 
__s1_Àn
 >= 4) \

825 && (!
	`__°rög2_1b±r_p
 (
s2
Ë|| 
__s2_Àn
 >= 4)) \

826 ? 
	`memcmp
 ((c⁄° *Ë(
s1
), (c⁄° *Ë(
s2
), \

827 (
__s1_Àn
 < 
__s2_Àn
 ? __s1_len : __s2_len) + 1) \

828 : (
	`__buûtö_c⁄°™t_p
 (
s1
Ë&& 
	`__°rög2_1b±r_p
 (s1) \

829 && (
__s1_Àn
 = 
	`°æí
 (
s1
), __s1_len < 4) \

830 ? (
	`__buûtö_c⁄°™t_p
 (
s2
Ë&& 
	`__°rög2_1b±r_p
 (s2) \

831 ? 
	`__°rcmp_cc
 (
s1
, 
s2
, 
__s1_Àn
) \

832 : 
	`__°rcmp_cg
 (
s1
, 
s2
, 
__s1_Àn
)) \

833 : (
	`__buûtö_c⁄°™t_p
 (
s2
Ë&& 
	`__°rög2_1b±r_p
 (s2) \

834 && (
__s2_Àn
 = 
	`°æí
 (
s2
), __s2_len < 4) \

835 ? (
	`__buûtö_c⁄°™t_p
 (
s1
Ë&& 
	`__°rög2_1b±r_p
 (s1) \

836 ? 
	`__°rcmp_cc
 (
s1
, 
s2
, 
__s2_Àn
) \

837 : 
	`__°rcmp_gc
 (
s1
, 
s2
, 
__s2_Àn
)) \

838 : 
	`°rcmp
 (
s1
, 
s2
)))); })

	)

841 
	#__°rcmp_cc
(
s1
, 
s2
, 
l
) \

842 (
	`__exãnsi⁄__
 ({ 
__ªsu…
 = \

843 (((c⁄° *Ë(c⁄° *Ë(
s1
))[0] \

844 - ((c⁄° *Ë(c⁄° *)(
s2
))[0]); \

845 i‡(
l
 > 0 && 
__ªsu…
 == 0) \

847 
__ªsu…
 = (((const *) \

848 (c⁄° *Ë(
s1
))[1] \

850 (c⁄° *Ë(
s2
))[1]); \

851 i‡(
l
 > 1 && 
__ªsu…
 == 0) \

853 
__ªsu…
 = \

855 (c⁄° *Ë(
s1
))[2] \

857 (c⁄° *Ë(
s2
))[2]); \

858 i‡(
l
 > 2 && 
__ªsu…
 == 0) \

859 
__ªsu…
 = \

861 (c⁄° *Ë(
s1
))[3] \

863 (c⁄° *Ë(
s2
))[3]); \

866 
__ªsu…
; }))

	)

868 
	#__°rcmp_cg
(
s1
, 
s2
, 
l1
) \

869 (
	`__exãnsi⁄__
 ({ c⁄° *
__s2
 = \

870 (c⁄° *Ë(c⁄° *Ë(
s2
); \

871 
__ªsu…
 = \

872 (((c⁄° *Ë(c⁄° *Ë(
s1
))[0] \

873 - 
__s2
[0]); \

874 i‡(
l1
 > 0 && 
__ªsu…
 == 0) \

876 
__ªsu…
 = (((const *) \

877 (c⁄° *Ë(
s1
))[1] - 
__s2
[1]); \

878 i‡(
l1
 > 1 && 
__ªsu…
 == 0) \

880 
__ªsu…
 = (((const *) \

881 (c⁄° *Ë(
s1
))[2] - 
__s2
[2]); \

882 i‡(
l1
 > 2 && 
__ªsu…
 == 0) \

883 
__ªsu…
 = (((const *) \

884 (c⁄° *Ë(
s1
))[3] \

885 - 
__s2
[3]); \

888 
__ªsu…
; }))

	)

890 
	#__°rcmp_gc
(
s1
, 
s2
, 
l2
) \

891 (
	`__exãnsi⁄__
 ({ c⁄° *
__s1
 = \

892 (c⁄° *Ë(c⁄° *Ë(
s1
); \

893 
__ªsu…
 = \

894 
__s1
[0] - ((const *) \

895 (c⁄° *Ë(
s2
))[0]; \

896 i‡(
l2
 > 0 && 
__ªsu…
 == 0) \

898 
__ªsu…
 = (
__s1
[1] \

900 (c⁄° *Ë(
s2
))[1]); \

901 i‡(
l2
 > 1 && 
__ªsu…
 == 0) \

903 
__ªsu…
 = \

904 (
__s1
[2] - ((const *) \

905 (c⁄° *Ë(
s2
))[2]); \

906 i‡(
l2
 > 2 && 
__ªsu…
 == 0) \

907 
__ªsu…
 = \

908 (
__s1
[3] \

910 (c⁄° *Ë(
s2
))[3]); \

913 
__ªsu…
; }))

	)

918 #i‚de‡
_HAVE_STRING_ARCH_°∫cmp


919 
	#°∫cmp
(
s1
, 
s2
, 
n
) \

920 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
n
) \

921 && ((
	`__buûtö_c⁄°™t_p
 (
s1
) \

922 && 
	`°æí
 (
s1
Ë< ((
size_t
Ë(
n
))) \

923 || (
	`__buûtö_c⁄°™t_p
 (
s2
) \

924 && 
	`°æí
 (
s2
Ë< ((
size_t
Ë(
n
)))) \

925 ? 
	`°rcmp
 (
s1
, 
s2
Ë: 
	`°∫cmp
 (s1, s2, 
n
)))

	)

931 #i‡!
deföed
 
_HAVE_STRING_ARCH_°rc•n
 || deföed 
_FORCE_INLINES


932 #i‚de‡
_HAVE_STRING_ARCH_°rc•n


933 #i‡
__GNUC_PREREQ
 (3, 2)

934 
	#°rc•n
(
s
, 
ªje˘
) \

935 
__exãnsi⁄__
 \

936 ({ 
__r0
, 
__r1
, 
__r2
; \

937 (
	`__buûtö_c⁄°™t_p
 (
ªje˘
Ë&& 
	`__°rög2_1b±r_p
 (reject) \

938 ? ((
	`__buûtö_c⁄°™t_p
 (
s
Ë&& 
	`__°rög2_1b±r_p
 (s)) \

939 ? 
	`__buûtö_°rc•n
 (
s
, 
ªje˘
) \

940 : ((
__r0
 = ((c⁄° *Ë(
ªje˘
))[0], __r0 == '\0') \

941 ? 
	`°æí
 (
s
) \

942 : ((
__r1
 = ((c⁄° *Ë(
ªje˘
))[1], __r1 == '\0') \

943 ? 
	`__°rc•n_c1
 (
s
, 
__r0
) \

944 : ((
__r2
 = ((c⁄° *Ë(
ªje˘
))[2], __r2 == '\0') \

945 ? 
	`__°rc•n_c2
 (
s
, 
__r0
, 
__r1
) \

946 : (((c⁄° *Ë(
ªje˘
))[3] == '\0' \

947 ? 
	`__°rc•n_c3
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

948 : 
	`__buûtö_°rc•n
 (
s
, 
ªje˘
)))))) \

949 : 
	`__buûtö_°rc•n
 (
s
, 
ªje˘
)); })

	)

951 
	#°rc•n
(
s
, 
ªje˘
) \

952 
__exãnsi⁄__
 \

953 ({ 
__r0
, 
__r1
, 
__r2
; \

954 (
	`__buûtö_c⁄°™t_p
 (
ªje˘
Ë&& 
	`__°rög2_1b±r_p
 (reject) \

955 ? ((
__r0
 = ((c⁄° *Ë(
ªje˘
))[0], __r0 == '\0') \

956 ? 
	`°æí
 (
s
) \

957 : ((
__r1
 = ((c⁄° *Ë(
ªje˘
))[1], __r1 == '\0') \

958 ? 
	`__°rc•n_c1
 (
s
, 
__r0
) \

959 : ((
__r2
 = ((c⁄° *Ë(
ªje˘
))[2], __r2 == '\0') \

960 ? 
	`__°rc•n_c2
 (
s
, 
__r0
, 
__r1
) \

961 : (((c⁄° *Ë(
ªje˘
))[3] == '\0' \

962 ? 
	`__°rc•n_c3
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

963 : 
	`°rc•n
 (
s
, 
ªje˘
))))) \

964 : 
	`°rc•n
 (
s
, 
ªje˘
)); })

	)

968 
__STRING_INLINE
 
size_t
 
__°rc•n_c1
 (c⁄° *
__s
, 
__ªje˘
);

969 
__STRING_INLINE
 
size_t


970 
	$__°rc•n_c1
 (c⁄° *
__s
, 
__ªje˘
)

972 
size_t
 
__ªsu…
 = 0;

973 
__s
[
__ªsu…
] !'\0' && __s[__ªsu…] !
__ªje˘
)

974 ++
__ªsu…
;

975  
__ªsu…
;

976 
	}
}

978 
__STRING_INLINE
 
size_t
 
__°rc•n_c2
 (c⁄° *
__s
, 
__ªje˘1
,

979 
__ªje˘2
);

980 
__STRING_INLINE
 
size_t


981 
	$__°rc•n_c2
 (c⁄° *
__s
, 
__ªje˘1
, 
__ªje˘2
)

983 
size_t
 
__ªsu…
 = 0;

984 
__s
[
__ªsu…
] !'\0' && __s[__ªsu…] !
__ªje˘1


985 && 
__s
[
__ªsu…
] !
__ªje˘2
)

986 ++
__ªsu…
;

987  
__ªsu…
;

988 
	}
}

990 
__STRING_INLINE
 
size_t
 
__°rc•n_c3
 (c⁄° *
__s
, 
__ªje˘1
,

991 
__ªje˘2
, 
__ªje˘3
);

992 
__STRING_INLINE
 
size_t


993 
	$__°rc•n_c3
 (c⁄° *
__s
, 
__ªje˘1
, 
__ªje˘2
,

994 
__ªje˘3
)

996 
size_t
 
__ªsu…
 = 0;

997 
__s
[
__ªsu…
] !'\0' && __s[__ªsu…] !
__ªje˘1


998 && 
__s
[
__ªsu…
] !
__ªje˘2
 && __s[__ªsu…] !
__ªje˘3
)

999 ++
__ªsu…
;

1000  
__ªsu…
;

1001 
	}
}

1007 #i‡!
deföed
 
_HAVE_STRING_ARCH_°r•n
 || deföed 
_FORCE_INLINES


1008 #i‚de‡
_HAVE_STRING_ARCH_°r•n


1009 #i‡
__GNUC_PREREQ
 (3, 2)

1010 
	#°r•n
(
s
, 
ac˚±
) \

1011 
__exãnsi⁄__
 \

1012 ({ 
__a0
, 
__a1
, 
__a2
; \

1013 (
	`__buûtö_c⁄°™t_p
 (
ac˚±
Ë&& 
	`__°rög2_1b±r_p
 (accept) \

1014 ? ((
	`__buûtö_c⁄°™t_p
 (
s
Ë&& 
	`__°rög2_1b±r_p
 (s)) \

1015 ? 
	`__buûtö_°r•n
 (
s
, 
ac˚±
) \

1016 : ((
__a0
 = ((c⁄° *Ë(
ac˚±
))[0], __a0 == '\0') \

1017 ? ((Ë(
s
), (
size_t
) 0) \

1018 : ((
__a1
 = ((c⁄° *Ë(
ac˚±
))[1], __a1 == '\0') \

1019 ? 
	`__°r•n_c1
 (
s
, 
__a0
) \

1020 : ((
__a2
 = ((c⁄° *Ë(
ac˚±
))[2], __a2 == '\0') \

1021 ? 
	`__°r•n_c2
 (
s
, 
__a0
, 
__a1
) \

1022 : (((c⁄° *Ë(
ac˚±
))[3] == '\0' \

1023 ? 
	`__°r•n_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1024 : 
	`__buûtö_°r•n
 (
s
, 
ac˚±
)))))) \

1025 : 
	`__buûtö_°r•n
 (
s
, 
ac˚±
)); })

	)

1027 
	#°r•n
(
s
, 
ac˚±
) \

1028 
__exãnsi⁄__
 \

1029 ({ 
__a0
, 
__a1
, 
__a2
; \

1030 (
	`__buûtö_c⁄°™t_p
 (
ac˚±
Ë&& 
	`__°rög2_1b±r_p
 (accept) \

1031 ? ((
__a0
 = ((c⁄° *Ë(
ac˚±
))[0], __a0 == '\0') \

1032 ? ((Ë(
s
), (
size_t
) 0) \

1033 : ((
__a1
 = ((c⁄° *Ë(
ac˚±
))[1], __a1 == '\0') \

1034 ? 
	`__°r•n_c1
 (
s
, 
__a0
) \

1035 : ((
__a2
 = ((c⁄° *Ë(
ac˚±
))[2], __a2 == '\0') \

1036 ? 
	`__°r•n_c2
 (
s
, 
__a0
, 
__a1
) \

1037 : (((c⁄° *Ë(
ac˚±
))[3] == '\0' \

1038 ? 
	`__°r•n_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1039 : 
	`°r•n
 (
s
, 
ac˚±
))))) \

1040 : 
	`°r•n
 (
s
, 
ac˚±
)); })

	)

1044 
__STRING_INLINE
 
size_t
 
__°r•n_c1
 (c⁄° *
__s
, 
__ac˚±
);

1045 
__STRING_INLINE
 
size_t


1046 
	$__°r•n_c1
 (c⁄° *
__s
, 
__ac˚±
)

1048 
size_t
 
__ªsu…
 = 0;

1050 
__s
[
__ªsu…
] =
__ac˚±
)

1051 ++
__ªsu…
;

1052  
__ªsu…
;

1053 
	}
}

1055 
__STRING_INLINE
 
size_t
 
__°r•n_c2
 (c⁄° *
__s
, 
__ac˚±1
,

1056 
__ac˚±2
);

1057 
__STRING_INLINE
 
size_t


1058 
	$__°r•n_c2
 (c⁄° *
__s
, 
__ac˚±1
, 
__ac˚±2
)

1060 
size_t
 
__ªsu…
 = 0;

1062 
__s
[
__ªsu…
] =
__ac˚±1
 || __s[__ªsu…] =
__ac˚±2
)

1063 ++
__ªsu…
;

1064  
__ªsu…
;

1065 
	}
}

1067 
__STRING_INLINE
 
size_t
 
__°r•n_c3
 (c⁄° *
__s
, 
__ac˚±1
,

1068 
__ac˚±2
, 
__ac˚±3
);

1069 
__STRING_INLINE
 
size_t


1070 
	$__°r•n_c3
 (c⁄° *
__s
, 
__ac˚±1
, 
__ac˚±2
, 
__ac˚±3
)

1072 
size_t
 
__ªsu…
 = 0;

1074 
__s
[
__ªsu…
] =
__ac˚±1
 || __s[__ªsu…] =
__ac˚±2


1075 || 
__s
[
__ªsu…
] =
__ac˚±3
)

1076 ++
__ªsu…
;

1077  
__ªsu…
;

1078 
	}
}

1083 #i‡!
deföed
 
_HAVE_STRING_ARCH_°Ωbrk
 || deföed 
_FORCE_INLINES


1084 #i‚de‡
_HAVE_STRING_ARCH_°Ωbrk


1085 #i‡
__GNUC_PREREQ
 (3, 2)

1086 
	#°Ωbrk
(
s
, 
ac˚±
) \

1087 
__exãnsi⁄__
 \

1088 ({ 
__a0
, 
__a1
, 
__a2
; \

1089 (
	`__buûtö_c⁄°™t_p
 (
ac˚±
Ë&& 
	`__°rög2_1b±r_p
 (accept) \

1090 ? ((
	`__buûtö_c⁄°™t_p
 (
s
Ë&& 
	`__°rög2_1b±r_p
 (s)) \

1091 ? 
	`__buûtö_°Ωbrk
 (
s
, 
ac˚±
) \

1092 : ((
__a0
 = ((c⁄° *Ë(
ac˚±
))[0], __a0 == '\0') \

1093 ? ((Ë(
s
), (*Ë
NULL
) \

1094 : ((
__a1
 = ((c⁄° *Ë(
ac˚±
))[1], __a1 == '\0') \

1095 ? 
	`__buûtö_°rchr
 (
s
, 
__a0
) \

1096 : ((
__a2
 = ((c⁄° *Ë(
ac˚±
))[2], __a2 == '\0') \

1097 ? 
	`__°Ωbrk_c2
 (
s
, 
__a0
, 
__a1
) \

1098 : (((c⁄° *Ë(
ac˚±
))[3] == '\0' \

1099 ? 
	`__°Ωbrk_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1100 : 
	`__buûtö_°Ωbrk
 (
s
, 
ac˚±
)))))) \

1101 : 
	`__buûtö_°Ωbrk
 (
s
, 
ac˚±
)); })

	)

1103 
	#°Ωbrk
(
s
, 
ac˚±
) \

1104 
__exãnsi⁄__
 \

1105 ({ 
__a0
, 
__a1
, 
__a2
; \

1106 (
	`__buûtö_c⁄°™t_p
 (
ac˚±
Ë&& 
	`__°rög2_1b±r_p
 (accept) \

1107 ? ((
__a0
 = ((c⁄° *Ë(
ac˚±
))[0], __a0 == '\0') \

1108 ? ((Ë(
s
), (*Ë
NULL
) \

1109 : ((
__a1
 = ((c⁄° *Ë(
ac˚±
))[1], __a1 == '\0') \

1110 ? 
	`°rchr
 (
s
, 
__a0
) \

1111 : ((
__a2
 = ((c⁄° *Ë(
ac˚±
))[2], __a2 == '\0') \

1112 ? 
	`__°Ωbrk_c2
 (
s
, 
__a0
, 
__a1
) \

1113 : (((c⁄° *Ë(
ac˚±
))[3] == '\0' \

1114 ? 
	`__°Ωbrk_c3
 (
s
, 
__a0
, 
__a1
, 
__a2
) \

1115 : 
	`°Ωbrk
 (
s
, 
ac˚±
))))) \

1116 : 
	`°Ωbrk
 (
s
, 
ac˚±
)); })

	)

1120 
__STRING_INLINE
 *
__°Ωbrk_c2
 (c⁄° *
__s
, 
__ac˚±1
,

1121 
__ac˚±2
);

1122 
__STRING_INLINE
 *

1123 
	$__°Ωbrk_c2
 (c⁄° *
__s
, 
__ac˚±1
, 
__ac˚±2
)

1126 *
__s
 !'\0' && *__†!
__ac˚±1
 && *__†!
__ac˚±2
)

1127 ++
__s
;

1128  *
__s
 ='\0' ? 
NULL
 : (*Ë(
size_t
) __s;

1129 
	}
}

1131 
__STRING_INLINE
 *
__°Ωbrk_c3
 (c⁄° *
__s
, 
__ac˚±1
,

1132 
__ac˚±2
, 
__ac˚±3
);

1133 
__STRING_INLINE
 *

1134 
	$__°Ωbrk_c3
 (c⁄° *
__s
, 
__ac˚±1
, 
__ac˚±2
, 
__ac˚±3
)

1137 *
__s
 !'\0' && *__†!
__ac˚±1
 && *__†!
__ac˚±2


1138 && *
__s
 !
__ac˚±3
)

1139 ++
__s
;

1140  *
__s
 ='\0' ? 
NULL
 : (*Ë(
size_t
) __s;

1141 
	}
}

1147 #i‡!
deföed
 
_HAVE_STRING_ARCH_°r°r
 && !
__GNUC_PREREQ
 (2, 97)

1148 
	#°r°r
(
hay°ack
, 
√edÀ
) \

1149 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
√edÀ
Ë&& 
	`__°rög2_1b±r_p
 (needle) \

1150 ? (((c⁄° *Ë(
√edÀ
))[0] == '\0' \

1151 ? (*Ë(
size_t
Ë(
hay°ack
) \

1152 : (((c⁄° *Ë(
√edÀ
))[1] == '\0' \

1153 ? 
	`°rchr
 (
hay°ack
, \

1154 ((c⁄° *Ë(
√edÀ
))[0]) \

1155 : 
	`°r°r
 (
hay°ack
, 
√edÀ
))) \

1156 : 
	`°r°r
 (
hay°ack
, 
√edÀ
)))

	)

1160 #i‡!
deföed
 
_HAVE_STRING_ARCH_°πok_r
 || deföed 
_FORCE_INLINES


1161 #i‚de‡
_HAVE_STRING_ARCH_°πok_r


1162 
	#__°πok_r
(
s
, 
£p
, 
√xç
) \

1163 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
£p
Ë&& 
	`__°rög2_1b±r_p
 (sep) \

1164 && ((c⁄° *Ë(
£p
))[0] != '\0' \

1165 && ((c⁄° *Ë(
£p
))[1] == '\0' \

1166 ? 
	`__°πok_r_1c
 (
s
, ((c⁄° *Ë(
£p
))[0], 
√xç
) \

1167 : 
	`__°πok_r
 (
s
, 
£p
, 
√xç
)))

	)

1170 
__STRING_INLINE
 *
__°πok_r_1c
 (*
__s
, 
__£p
, **
__√xç
);

1171 
__STRING_INLINE
 *

1172 
	$__°πok_r_1c
 (*
__s
, 
__£p
, **
__√xç
)

1174 *
__ªsu…
;

1175 i‡(
__s
 =
NULL
)

1176 
__s
 = *
__√xç
;

1177 *
__s
 =
__£p
)

1178 ++
__s
;

1179 
__ªsu…
 = 
NULL
;

1180 i‡(*
__s
 != '\0')

1182 
__ªsu…
 = 
__s
++;

1183 *
__s
 != '\0')

1184 i‡(*
__s
++ =
__£p
)

1186 
__s
[-1] = '\0';

1190 *
__√xç
 = 
__s
;

1191  
__ªsu…
;

1192 
	}
}

1193 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


1194 
	#°πok_r
(
s
, 
£p
, 
√xç
Ë
	`__°πok_r
 (s, sï,Çexç)

	)

1199 #i‡!
deföed
 
_HAVE_STRING_ARCH_°r£p
 || deföed 
_FORCE_INLINES


1200 #i‚de‡
_HAVE_STRING_ARCH_°r£p


1202 *
__°r£p_g
 (**
__°rögp
, c⁄° *
__dñim
);

1203 
	#__°r£p
(
s
, 
ªje˘
) \

1204 
__exãnsi⁄__
 \

1205 ({ 
__r0
, 
__r1
, 
__r2
; \

1206 (
	`__buûtö_c⁄°™t_p
 (
ªje˘
Ë&& 
	`__°rög2_1b±r_p
 (reject) \

1207 && (
__r0
 = ((c⁄° *Ë(
ªje˘
))[0], \

1208 ((c⁄° *Ë(
ªje˘
))[0] != '\0') \

1209 ? ((
__r1
 = ((c⁄° *Ë(
ªje˘
))[1], \

1210 ((c⁄° *Ë(
ªje˘
))[1] == '\0') \

1211 ? 
	`__°r£p_1c
 (
s
, 
__r0
) \

1212 : ((
__r2
 = ((c⁄° *Ë(
ªje˘
))[2], __r2 == '\0') \

1213 ? 
	`__°r£p_2c
 (
s
, 
__r0
, 
__r1
) \

1214 : (((c⁄° *Ë(
ªje˘
))[3] == '\0' \

1215 ? 
	`__°r£p_3c
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

1216 : 
	`__°r£p_g
 (
s
, 
ªje˘
)))) \

1217 : 
	`__°r£p_g
 (
s
, 
ªje˘
)); })

	)

1220 
__STRING_INLINE
 *
__°r£p_1c
 (**
__s
, 
__ªje˘
);

1221 
__STRING_INLINE
 *

1222 
	$__°r£p_1c
 (**
__s
, 
__ªje˘
)

1224 *
__ªtvÆ
 = *
__s
;

1225 i‡(
__ªtvÆ
 !
NULL
 && (*
__s
 = 
	`°rchr
 (__ªtvÆ, 
__ªje˘
)) != NULL)

1226 *(*
__s
)++ = '\0';

1227  
__ªtvÆ
;

1228 
	}
}

1230 
__STRING_INLINE
 *
__°r£p_2c
 (**
__s
, 
__ªje˘1
, 
__ªje˘2
);

1231 
__STRING_INLINE
 *

1232 
	$__°r£p_2c
 (**
__s
, 
__ªje˘1
, 
__ªje˘2
)

1234 *
__ªtvÆ
 = *
__s
;

1235 i‡(
__ªtvÆ
 !
NULL
)

1237 *
__˝
 = 
__ªtvÆ
;

1240 i‡(*
__˝
 == '\0')

1242 
__˝
 = 
NULL
;

1245 i‡(*
__˝
 =
__ªje˘1
 || *__˝ =
__ªje˘2
)

1247 *
__˝
++ = '\0';

1250 ++
__˝
;

1252 *
__s
 = 
__˝
;

1254  
__ªtvÆ
;

1255 
	}
}

1257 
__STRING_INLINE
 *
__°r£p_3c
 (**
__s
, 
__ªje˘1
, 
__ªje˘2
,

1258 
__ªje˘3
);

1259 
__STRING_INLINE
 *

1260 
	$__°r£p_3c
 (**
__s
, 
__ªje˘1
, 
__ªje˘2
, 
__ªje˘3
)

1262 *
__ªtvÆ
 = *
__s
;

1263 i‡(
__ªtvÆ
 !
NULL
)

1265 *
__˝
 = 
__ªtvÆ
;

1268 i‡(*
__˝
 == '\0')

1270 
__˝
 = 
NULL
;

1273 i‡(*
__˝
 =
__ªje˘1
 || *__˝ =
__ªje˘2
 || *__˝ =
__ªje˘3
)

1275 *
__˝
++ = '\0';

1278 ++
__˝
;

1280 *
__s
 = 
__˝
;

1282  
__ªtvÆ
;

1283 
	}
}

1284 #ifde‡
__USE_BSD


1285 
	#°r£p
(
s
, 
ªje˘
Ë
	`__°r£p
 (s,Ñeje˘)

	)

1292 #ifde‡
__USE_MISC


1294 #i‡!
deföed
 
_HAVE_STRING_ARCH_°rdup
 || !deföed 
_HAVE_STRING_ARCH_°∫dup


1295 
	#__√ed_mÆloc_™d_ˇŒoc


	)

1296 
	~<°dlib.h
>

1299 #i‚de‡
_HAVE_STRING_ARCH_°rdup


1301 *
	$__°rdup
 (c⁄° *
__°rög
Ë
__THROW
 
__©åibuã_mÆloc__
;

1302 
	#__°rdup
(
s
) \

1303 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
s
Ë&& 
	`__°rög2_1b±r_p
 (s) \

1304 ? (((c⁄° *Ë(
s
))[0] == '\0' \

1305 ? (*Ë
	`ˇŒoc
 ((
size_t
) 1, (size_t) 1) \

1306 : ({ 
size_t
 
__Àn
 = 
	`°æí
 (
s
) + 1; \

1307 *
__ªtvÆ
 = (*Ë
	`mÆloc
 (
__Àn
); \

1308 i‡(
__ªtvÆ
 !
NULL
) \

1309 
__ªtvÆ
 = (*Ë
	`mem˝y
 (__ªtvÆ, 
s
, 
__Àn
); \

1310 
__ªtvÆ
; 
	}
})) \

1311 : 
	`__°rdup
 (
s
)))

	)

1313 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


1314 
	#°rdup
(
s
Ë
	`__°rdup
 (s)

	)

1318 #i‚de‡
_HAVE_STRING_ARCH_°∫dup


1320 *
	$__°∫dup
 (c⁄° *
__°rög
, 
size_t
 
__n
)

1321 
__THROW
 
__©åibuã_mÆloc__
;

1322 
	#__°∫dup
(
s
, 
n
) \

1323 (
	`__exãnsi⁄__
 (
	`__buûtö_c⁄°™t_p
 (
s
Ë&& 
	`__°rög2_1b±r_p
 (s) \

1324 ? (((c⁄° *Ë(
s
))[0] == '\0' \

1325 ? (*Ë
	`ˇŒoc
 ((
size_t
) 1, (size_t) 1) \

1326 : ({ 
size_t
 
__Àn
 = 
	`°æí
 (
s
) + 1; \

1327 
size_t
 
__n
 = (
n
); \

1328 *
__ªtvÆ
; \

1329 i‡(
__n
 < 
__Àn
) \

1330 
__Àn
 = 
__n
 + 1; \

1331 
__ªtvÆ
 = (*Ë
	`mÆloc
 (
__Àn
); \

1332 i‡(
__ªtvÆ
 !
NULL
) \

1334 
__ªtvÆ
[
__Àn
 - 1] = '\0'; \

1335 
__ªtvÆ
 = (*Ë
	`mem˝y
 (__ªtvÆ, 
s
, \

1336 
__Àn
 - 1); \

1338 
__ªtvÆ
; 
	}
})) \

1339 : 
	`__°∫dup
 (
s
, 
n
)))

	)

1341 #ifde‡
__USE_GNU


1342 
	#°∫dup
(
s
, 
n
Ë
	`__°∫dup
 (s,Ç)

	)

1348 #i‚de‡
_FORCE_INLINES


1349 #unde‡
__STRING_INLINE


	@/usr/include/bits/string3.h

18 #i‚de‡
_STRING_H


22 
__w¨nde˛
 (
__w¨n_mem£t_zîo_Àn
,

25 #i‚de‡
__˝lu•lus


29 #unde‡
mem˝y


30 #unde‡
memmove


31 #unde‡
mem£t


32 #unde‡
°rˇt


33 #unde‡
°r˝y


34 #unde‡
°∫ˇt


35 #unde‡
°∫˝y


36 #ifde‡
__USE_GNU


37 #unde‡
memp˝y


38 #unde‡
°p˝y


40 #ifde‡
__USE_BSD


41 #unde‡
bc›y


42 #unde‡
bzîo


47 
__f‹tify_fun˘i⁄
 *

48 
__NTH
 (
	$mem˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

49 
size_t
 
__Àn
))

51  
	`__buûtö___mem˝y_chk
 (
__de°
, 
__§c
, 
__Àn
, 
	`__bos0
 (__dest));

52 
	}
}

54 
__f‹tify_fun˘i⁄
 *

55 
__NTH
 (
	$memmove
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__Àn
))

57  
	`__buûtö___memmove_chk
 (
__de°
, 
__§c
, 
__Àn
, 
	`__bos0
 (__dest));

58 
	}
}

60 #ifde‡
__USE_GNU


61 
__f‹tify_fun˘i⁄
 *

62 
__NTH
 (
	$memp˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

63 
size_t
 
__Àn
))

65  
	`__buûtö___memp˝y_chk
 (
__de°
, 
__§c
, 
__Àn
, 
	`__bos0
 (__dest));

66 
	}
}

75 
__f‹tify_fun˘i⁄
 *

76 
__NTH
 (
	$mem£t
 (*
__de°
, 
__ch
, 
size_t
 
__Àn
))

78 i‡(
	`__buûtö_c⁄°™t_p
 (
__Àn
) && __len == 0

79 && (!
	`__buûtö_c⁄°™t_p
 (
__ch
) || __ch != 0))

81 
	`__w¨n_mem£t_zîo_Àn
 ();

82  
__de°
;

84  
	`__buûtö___mem£t_chk
 (
__de°
, 
__ch
, 
__Àn
, 
	`__bos0
 (__dest));

85 
	}
}

87 #ifde‡
__USE_BSD


88 
__f‹tify_fun˘i⁄
 

89 
__NTH
 (
	$bc›y
 (c⁄° *
__§c
, *
__de°
, 
size_t
 
__Àn
))

91 (Ë
	`__buûtö___memmove_chk
 (
__de°
, 
__§c
, 
__Àn
, 
	`__bos0
 (__dest));

92 
	}
}

94 
__f‹tify_fun˘i⁄
 

95 
__NTH
 (
	$bzîo
 (*
__de°
, 
size_t
 
__Àn
))

97 (Ë
	`__buûtö___mem£t_chk
 (
__de°
, '\0', 
__Àn
, 
	`__bos0
 (__dest));

98 
	}
}

101 
__f‹tify_fun˘i⁄
 *

102 
__NTH
 (
	$°r˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
))

104  
	`__buûtö___°r˝y_chk
 (
__de°
, 
__§c
, 
	`__bos
 (__dest));

105 
	}
}

107 #ifde‡
__USE_GNU


108 
__f‹tify_fun˘i⁄
 *

109 
__NTH
 (
	$°p˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
))

111  
	`__buûtö___°p˝y_chk
 (
__de°
, 
__§c
, 
	`__bos
 (__dest));

112 
	}
}

116 
__f‹tify_fun˘i⁄
 *

117 
__NTH
 (
	$°∫˝y
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

118 
size_t
 
__Àn
))

120  
	`__buûtö___°∫˝y_chk
 (
__de°
, 
__§c
, 
__Àn
, 
	`__bos
 (__dest));

121 
	}
}

124 *
	$__°≤˝y_chk
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
,

125 
size_t
 
__de°Àn
Ë
__THROW
;

126 *
	`__REDIRECT_NTH
 (
__°≤˝y_Æüs
, (*
__de°
, c⁄° *
__§c
,

127 
size_t
 
__n
), 
°≤˝y
);

129 
__f‹tify_fun˘i⁄
 *

130 
	`__NTH
 (
	$°≤˝y
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__n
))

132 i‡(
	`__bos
 (
__de°
Ë!(
size_t
) -1

133 && (!
	`__buûtö_c⁄°™t_p
 (
__n
Ë|| __¿<
	`__bos
 (
__de°
)))

134  
	`__°≤˝y_chk
 (
__de°
, 
__§c
, 
__n
, 
	`__bos
 (__dest));

135  
	`__°≤˝y_Æüs
 (
__de°
, 
__§c
, 
__n
);

136 
	}
}

139 
__f‹tify_fun˘i⁄
 *

140 
__NTH
 (
	$°rˇt
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
))

142  
	`__buûtö___°rˇt_chk
 (
__de°
, 
__§c
, 
	`__bos
 (__dest));

143 
	}
}

146 
__f‹tify_fun˘i⁄
 *

147 
__NTH
 (
	$°∫ˇt
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

148 
size_t
 
__Àn
))

150  
	`__buûtö___°∫ˇt_chk
 (
__de°
, 
__§c
, 
__Àn
, 
	`__bos
 (__dest));

151 
	}
}

	@/usr/include/features.h

18 #i‚def 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

98 #unde‡
__USE_ISOC11


99 #unde‡
__USE_ISOC99


100 #unde‡
__USE_ISOC95


101 #unde‡
__USE_ISOCXX11


102 #unde‡
__USE_POSIX


103 #unde‡
__USE_POSIX2


104 #unde‡
__USE_POSIX199309


105 #unde‡
__USE_POSIX199506


106 #unde‡
__USE_XOPEN


107 #unde‡
__USE_XOPEN_EXTENDED


108 #unde‡
__USE_UNIX98


109 #unde‡
__USE_XOPEN2K


110 #unde‡
__USE_XOPEN2KXSI


111 #unde‡
__USE_XOPEN2K8


112 #unde‡
__USE_XOPEN2K8XSI


113 #unde‡
__USE_LARGEFILE


114 #unde‡
__USE_LARGEFILE64


115 #unde‡
__USE_FILE_OFFSET64


116 #unde‡
__USE_BSD


117 #unde‡
__USE_SVID


118 #unde‡
__USE_MISC


119 #unde‡
__USE_ATFILE


120 #unde‡
__USE_GNU


121 #unde‡
__USE_REENTRANT


122 #unde‡
__USE_FORTIFY_LEVEL


123 #unde‡
__FAVOR_BSD


124 #unde‡
__KERNEL_STRICT_NAMES


128 #i‚de‡
_LOOSE_KERNEL_NAMES


129 
	#__KERNEL_STRICT_NAMES


	)

133 
	#__USE_ANSI
 1

	)

142 #i‡
deföed
 
__GNUC__
 && deföed 
__GNUC_MINOR__


143 
	#__GNUC_PREREQ
(
maj
, 
mö
) \

144 ((
__GNUC__
 << 16Ë+ 
__GNUC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

146 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë0

	)

151 #i‡
deföed
 
_BSD_SOURCE
 && \

152 !(
deföed
 
	g_POSIX_SOURCE
 || deföed 
	g_POSIX_C_SOURCE
 || \

153 
deföed
 
	g_XOPEN_SOURCE
 || deföed 
	g_GNU_SOURCE
 || deföed 
	g_SVID_SOURCE
)

154 
	#__FAVOR_BSD
 1

	)

158 #ifde‡
_GNU_SOURCE


159 #unde‡
_ISOC95_SOURCE


160 
	#_ISOC95_SOURCE
 1

	)

161 #unde‡
_ISOC99_SOURCE


162 
	#_ISOC99_SOURCE
 1

	)

163 #unde‡
_ISOC11_SOURCE


164 
	#_ISOC11_SOURCE
 1

	)

165 #unde‡
_POSIX_SOURCE


166 
	#_POSIX_SOURCE
 1

	)

167 #unde‡
_POSIX_C_SOURCE


168 
	#_POSIX_C_SOURCE
 200809L

	)

169 #unde‡
_XOPEN_SOURCE


170 
	#_XOPEN_SOURCE
 700

	)

171 #unde‡
_XOPEN_SOURCE_EXTENDED


172 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

173 #unde‡
_LARGEFILE64_SOURCE


174 
	#_LARGEFILE64_SOURCE
 1

	)

175 #unde‡
_BSD_SOURCE


176 
	#_BSD_SOURCE
 1

	)

177 #unde‡
_SVID_SOURCE


178 
	#_SVID_SOURCE
 1

	)

179 #unde‡
_ATFILE_SOURCE


180 
	#_ATFILE_SOURCE
 1

	)

185 #i‡(!
deföed
 
__STRICT_ANSI__
 && !deföed 
_ISOC99_SOURCE
 && \

186 !
deföed
 
	g_POSIX_SOURCE
 && !deföed 
	g_POSIX_C_SOURCE
 && \

187 !
deföed
 
	g_XOPEN_SOURCE
 && !deföed 
	g_BSD_SOURCE
 && !deföed 
	g_SVID_SOURCE
)

188 
	#_BSD_SOURCE
 1

	)

189 
	#_SVID_SOURCE
 1

	)

193 #i‡(
deföed
 
_ISOC11_SOURCE
 \

194 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

195 
	#__USE_ISOC11
 1

	)

199 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

200 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

201 
	#__USE_ISOC99
 1

	)

205 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

206 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

207 
	#__USE_ISOC95
 1

	)

214 #i‡((
deföed
 
__˝lu•lus
 && __cplusplus >= 201103L) \

215 || 
deföed
 
__GXX_EXPERIMENTAL_CXX0X__
)

216 
	#__USE_ISOCXX11
 1

	)

221 #i‡((!
deföed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

222 !
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE
)

223 
	#_POSIX_SOURCE
 1

	)

224 #i‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

225 
	#_POSIX_C_SOURCE
 2

	)

226 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

227 
	#_POSIX_C_SOURCE
 199506L

	)

228 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

229 
	#_POSIX_C_SOURCE
 200112L

	)

231 
	#_POSIX_C_SOURCE
 200809L

	)

233 
	#__USE_POSIX_IMPLICITLY
 1

	)

236 #i‡
deföed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >1 || deföed 
_XOPEN_SOURCE


237 
	#__USE_POSIX
 1

	)

240 #i‡
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >2 || deföed 
_XOPEN_SOURCE


241 
	#__USE_POSIX2
 1

	)

244 #i‡(
_POSIX_C_SOURCE
 - 0) >= 199309L

245 
	#__USE_POSIX199309
 1

	)

248 #i‡(
_POSIX_C_SOURCE
 - 0) >= 199506L

249 
	#__USE_POSIX199506
 1

	)

252 #i‡(
_POSIX_C_SOURCE
 - 0) >= 200112L

253 
	#__USE_XOPEN2K
 1

	)

254 #unde‡
__USE_ISOC95


255 
	#__USE_ISOC95
 1

	)

256 #unde‡
__USE_ISOC99


257 
	#__USE_ISOC99
 1

	)

260 #i‡(
_POSIX_C_SOURCE
 - 0) >= 200809L

261 
	#__USE_XOPEN2K8
 1

	)

262 #unde‡
_ATFILE_SOURCE


263 
	#_ATFILE_SOURCE
 1

	)

266 #ifdef 
_XOPEN_SOURCE


267 
	#__USE_XOPEN
 1

	)

268 #i‡(
_XOPEN_SOURCE
 - 0) >= 500

269 
	#__USE_XOPEN_EXTENDED
 1

	)

270 
	#__USE_UNIX98
 1

	)

271 #unde‡
_LARGEFILE_SOURCE


272 
	#_LARGEFILE_SOURCE
 1

	)

273 #i‡(
_XOPEN_SOURCE
 - 0) >= 600

274 #i‡(
_XOPEN_SOURCE
 - 0) >= 700

275 
	#__USE_XOPEN2K8
 1

	)

276 
	#__USE_XOPEN2K8XSI
 1

	)

278 
	#__USE_XOPEN2K
 1

	)

279 
	#__USE_XOPEN2KXSI
 1

	)

280 #unde‡
__USE_ISOC95


281 
	#__USE_ISOC95
 1

	)

282 #unde‡
__USE_ISOC99


283 
	#__USE_ISOC99
 1

	)

286 #ifde‡
_XOPEN_SOURCE_EXTENDED


287 
	#__USE_XOPEN_EXTENDED
 1

	)

292 #ifde‡
_LARGEFILE_SOURCE


293 
	#__USE_LARGEFILE
 1

	)

296 #ifde‡
_LARGEFILE64_SOURCE


297 
	#__USE_LARGEFILE64
 1

	)

300 #i‡
deföed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

301 
	#__USE_FILE_OFFSET64
 1

	)

304 #i‡
deföed
 
_BSD_SOURCE
 || deföed 
_SVID_SOURCE


305 
	#__USE_MISC
 1

	)

308 #ifdef 
_BSD_SOURCE


309 
	#__USE_BSD
 1

	)

312 #ifdef 
_SVID_SOURCE


313 
	#__USE_SVID
 1

	)

316 #ifdef 
_ATFILE_SOURCE


317 
	#__USE_ATFILE
 1

	)

320 #ifdef 
_GNU_SOURCE


321 
	#__USE_GNU
 1

	)

324 #i‡
deföed
 
_REENTRANT
 || deföed 
_THREAD_SAFE


325 
	#__USE_REENTRANT
 1

	)

328 #i‡
deföed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0

329 #i‡!
deföed
 
__OPTIMIZE__
 || __OPTIMIZE__ <= 0

330 #w¨nög 
_FORTIFY_SOURCE
 
ªquúes
 
compûög
 
wôh
 
›timiz©i⁄
 (-
O
)

331 #ñi‡!
__GNUC_PREREQ
 (4, 1)

332 #w¨nög 
_FORTIFY_SOURCE
 
ªquúes
 
GCC
 4.1 
‹
 
œãr


333 #ñi‡
_FORTIFY_SOURCE
 > 1

334 
	#__USE_FORTIFY_LEVEL
 2

	)

336 
	#__USE_FORTIFY_LEVEL
 1

	)

339 #i‚de‡
__USE_FORTIFY_LEVEL


340 
	#__USE_FORTIFY_LEVEL
 0

	)

345 
	~<°dc-¥edef.h
>

353 #unde‡
__GNU_LIBRARY__


354 
	#__GNU_LIBRARY__
 6

	)

358 
	#__GLIBC__
 2

	)

359 
	#__GLIBC_MINOR__
 17

	)

361 
	#__GLIBC_PREREQ
(
maj
, 
mö
) \

362 ((
__GLIBC__
 << 16Ë+ 
__GLIBC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

365 #i‡
deföed
 
__GNUC__
 \

366 || (
deföed
 
	g__PGI
 && deföed 
	g__i386__
 ) \

367 || (
deföed
 
	g__INTEL_COMPILER
 && (deföed 
	g__i386__
 || deföed 
	g__ü64__
)) \

368 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L)

369 
	#__GLIBC_HAVE_LONG_LONG
 1

	)

373 #i‚de‡
__ASSEMBLER__


374 #i‚de‡
_SYS_CDEFS_H


375 
	~<sys/cdefs.h
>

380 #i‡
deföed
 
__USE_FILE_OFFSET64
 && !deföed 
__REDIRECT


381 
	#__USE_LARGEFILE
 1

	)

382 
	#__USE_LARGEFILE64
 1

	)

388 #i‡
__GNUC_PREREQ
 (2, 7Ë&& 
deföed
 
__OPTIMIZE__
 \

389 && !
deföed
 
	g__OPTIMIZE_SIZE__
 && !deföed 
	g__NO_INLINE__
 \

390 && 
deföed
 
	g__exã∫_ölöe


391 
	#__USE_EXTERN_INLINES
 1

	)

399 
	~<gnu/°ubs.h
>

	@/usr/include/linux/stddef.h

	@/usr/include/xlocale.h

20 #i‚de‡
_XLOCALE_H


21 
	#_XLOCALE_H
 1

	)

27 
	s__loˇÀ_°ru˘


30 
__loˇÀ_d©a
 *
	m__loˇÀs
[13];

33 c⁄° *
	m__˘y≥_b
;

34 c⁄° *
	m__˘y≥_tﬁowî
;

35 c⁄° *
	m__˘y≥_touµî
;

38 c⁄° *
	m__«mes
[13];

39 } *
	t__loˇÀ_t
;

42 
__loˇÀ_t
 
	tloˇÀ_t
;

	@/usr/include/asm-generic/int-ll64.h

8 #i‚de‡
_ASM_GENERIC_INT_LL64_H


9 
	#_ASM_GENERIC_INT_LL64_H


	)

11 
	~<asm/bô•îl⁄g.h
>

13 #i‚de‡
__ASSEMBLY__


19 
__sig√d__
 
	t__s8
;

20 
	t__u8
;

22 
__sig√d__
 
	t__s16
;

23 
	t__u16
;

25 
__sig√d__
 
	t__s32
;

26 
	t__u32
;

28 #ifde‡
__GNUC__


29 
__exãnsi⁄__
 
__sig√d__
 
	t__s64
;

30 
__exãnsi⁄__
 
	t__u64
;

32 
__sig√d__
 
	t__s64
;

33 
	t__u64
;

	@/usr/include/asm-generic/ioctl.h

1 #i‚de‡
_ASM_GENERIC_IOCTL_H


2 
	#_ASM_GENERIC_IOCTL_H


	)

22 
	#_IOC_NRBITS
 8

	)

23 
	#_IOC_TYPEBITS
 8

	)

30 #i‚de‡
_IOC_SIZEBITS


31 
	#_IOC_SIZEBITS
 14

	)

34 #i‚de‡
_IOC_DIRBITS


35 
	#_IOC_DIRBITS
 2

	)

38 
	#_IOC_NRMASK
 ((1 << 
_IOC_NRBITS
)-1)

	)

39 
	#_IOC_TYPEMASK
 ((1 << 
_IOC_TYPEBITS
)-1)

	)

40 
	#_IOC_SIZEMASK
 ((1 << 
_IOC_SIZEBITS
)-1)

	)

41 
	#_IOC_DIRMASK
 ((1 << 
_IOC_DIRBITS
)-1)

	)

43 
	#_IOC_NRSHIFT
 0

	)

44 
	#_IOC_TYPESHIFT
 (
_IOC_NRSHIFT
+
_IOC_NRBITS
)

	)

45 
	#_IOC_SIZESHIFT
 (
_IOC_TYPESHIFT
+
_IOC_TYPEBITS
)

	)

46 
	#_IOC_DIRSHIFT
 (
_IOC_SIZESHIFT
+
_IOC_SIZEBITS
)

	)

53 #i‚de‡
_IOC_NONE


54 
	#_IOC_NONE
 0U

	)

57 #i‚de‡
_IOC_WRITE


58 
	#_IOC_WRITE
 1U

	)

61 #i‚de‡
_IOC_READ


62 
	#_IOC_READ
 2U

	)

65 
	#_IOC
(
dú
,
ty≥
,
ƒ
,
size
) \

66 (((
dú
Ë<< 
_IOC_DIRSHIFT
) | \

67 ((
ty≥
Ë<< 
_IOC_TYPESHIFT
) | \

68 ((
ƒ
Ë<< 
_IOC_NRSHIFT
) | \

69 ((
size
Ë<< 
_IOC_SIZESHIFT
))

	)

71 
	#_IOC_TYPECHECK
(
t
Ë(—))

	)

74 
	#_IO
(
ty≥
,
ƒ
Ë
	`_IOC
(
_IOC_NONE
,—y≥),“r),0)

	)

75 
	#_IOR
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
,—y≥),“r),(
	`_IOC_TYPECHECK
(size)))

	)

76 
	#_IOW
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_WRITE
,—y≥),“r),(
	`_IOC_TYPECHECK
(size)))

	)

77 
	#_IOWR
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,—y≥),“r),(
	`_IOC_TYPECHECK
(size)))

	)

78 
	#_IOR_BAD
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
,—y≥),“r),(size))

	)

79 
	#_IOW_BAD
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_WRITE
,—y≥),“r),(size))

	)

80 
	#_IOWR_BAD
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,—y≥),“r),(size))

	)

83 
	#_IOC_DIR
(
ƒ
Ë((“rË>> 
_IOC_DIRSHIFT
Ë& 
_IOC_DIRMASK
)

	)

84 
	#_IOC_TYPE
(
ƒ
Ë((“rË>> 
_IOC_TYPESHIFT
Ë& 
_IOC_TYPEMASK
)

	)

85 
	#_IOC_NR
(
ƒ
Ë((“rË>> 
_IOC_NRSHIFT
Ë& 
_IOC_NRMASK
)

	)

86 
	#_IOC_SIZE
(
ƒ
Ë((“rË>> 
_IOC_SIZESHIFT
Ë& 
_IOC_SIZEMASK
)

	)

90 
	#IOC_IN
 (
_IOC_WRITE
 << 
_IOC_DIRSHIFT
)

	)

91 
	#IOC_OUT
 (
_IOC_READ
 << 
_IOC_DIRSHIFT
)

	)

92 
	#IOC_INOUT
 ((
_IOC_WRITE
|
_IOC_READ
Ë<< 
_IOC_DIRSHIFT
)

	)

93 
	#IOCSIZE_MASK
 (
_IOC_SIZEMASK
 << 
_IOC_SIZESHIFT
)

	)

94 
	#IOCSIZE_SHIFT
 (
_IOC_SIZESHIFT
)

	)

	@/usr/include/asm/posix_types_32.h

1 #i‚de‡
_ASM_X86_POSIX_TYPES_32_H


2 
	#_ASM_X86_POSIX_TYPES_32_H


	)

10 
	t__kî√l_mode_t
;

11 
	#__kî√l_mode_t
 
__kî√l_mode_t


	)

13 
	t__kî√l_ùc_pid_t
;

14 
	#__kî√l_ùc_pid_t
 
__kî√l_ùc_pid_t


	)

16 
	t__kî√l_uid_t
;

17 
	t__kî√l_gid_t
;

18 
	#__kî√l_uid_t
 
__kî√l_uid_t


	)

20 
	t__kî√l_ﬁd_dev_t
;

21 
	#__kî√l_ﬁd_dev_t
 
__kî√l_ﬁd_dev_t


	)

23 
	~<asm-gíîic/posix_ty≥s.h
>

	@/usr/include/asm/posix_types_64.h

1 #i‚de‡
_ASM_X86_POSIX_TYPES_64_H


2 
	#_ASM_X86_POSIX_TYPES_64_H


	)

10 
	t__kî√l_ﬁd_uid_t
;

11 
	t__kî√l_ﬁd_gid_t
;

12 
	#__kî√l_ﬁd_uid_t
 
__kî√l_ﬁd_uid_t


	)

14 
	t__kî√l_ﬁd_dev_t
;

15 
	#__kî√l_ﬁd_dev_t
 
__kî√l_ﬁd_dev_t


	)

17 
	~<asm-gíîic/posix_ty≥s.h
>

	@/usr/include/asm/posix_types_x32.h

1 #i‚de‡
_ASM_X86_POSIX_TYPES_X32_H


2 
	#_ASM_X86_POSIX_TYPES_X32_H


	)

13 
	t__kî√l_l⁄g_t
;

14 
	t__kî√l_ul⁄g_t
;

15 
	#__kî√l_l⁄g_t
 
__kî√l_l⁄g_t


	)

17 
	~<asm/posix_ty≥s_64.h
>

	@/usr/include/bits/types.h

23 #i‚def 
_BITS_TYPES_H


24 
	#_BITS_TYPES_H
 1

	)

26 
	~<„©uªs.h
>

27 
	~<bôs/w‹dsize.h
>

30 
	t__u_ch¨
;

31 
	t__u_sh‹t
;

32 
	t__u_öt
;

33 
	t__u_l⁄g
;

36 sig√d 
	t__öt8_t
;

37 
	t__uöt8_t
;

38 sig√d 
	t__öt16_t
;

39 
	t__uöt16_t
;

40 sig√d 
	t__öt32_t
;

41 
	t__uöt32_t
;

42 #i‡
__WORDSIZE
 == 64

43 sig√d 
	t__öt64_t
;

44 
	t__uöt64_t
;

45 #ñi‡
deföed
 
__GLIBC_HAVE_LONG_LONG


46 
__exãnsi⁄__
 sig√d 
	t__öt64_t
;

47 
__exãnsi⁄__
 
	t__uöt64_t
;

51 #i‡
__WORDSIZE
 == 64

52 
	t__quad_t
;

53 
	t__u_quad_t
;

54 #ñi‡
deföed
 
__GLIBC_HAVE_LONG_LONG


55 
__exãnsi⁄__
 
	t__quad_t
;

56 
__exãnsi⁄__
 
	t__u_quad_t
;

60 
	m__vÆ
[2];

61 } 
	t__quad_t
;

64 
__u_l⁄g
 
	m__vÆ
[2];

65 } 
	t__u_quad_t
;

98 
	#__S16_TYPE
 

	)

99 
	#__U16_TYPE
 

	)

100 
	#__S32_TYPE
 

	)

101 
	#__U32_TYPE
 

	)

102 
	#__SLONGWORD_TYPE
 

	)

103 
	#__ULONGWORD_TYPE
 

	)

104 #i‡
__WORDSIZE
 == 32

105 
	#__SQUAD_TYPE
 
__quad_t


	)

106 
	#__UQUAD_TYPE
 
__u_quad_t


	)

107 
	#__SWORD_TYPE
 

	)

108 
	#__UWORD_TYPE
 

	)

109 
	#__SLONG32_TYPE
 

	)

110 
	#__ULONG32_TYPE
 

	)

111 
	#__S64_TYPE
 
__quad_t


	)

112 
	#__U64_TYPE
 
__u_quad_t


	)

115 
	#__STD_TYPE
 
__exãnsi⁄__
 

	)

116 #ñi‡
__WORDSIZE
 == 64

117 
	t__SQUAD_TYPE
 

	)

118 
	t__UQUAD_TYPE
 

	)

119 
	t__SWORD_TYPE
 

	)

120 
	t__UWORD_TYPE
 

	)

121 
	t__SLONG32_TYPE
 

	)

122 
	t__ULONG32_TYPE
 

	)

123 
	t__S64_TYPE
 

	)

124 
	t__U64_TYPE
 

	)

126 
	t__STD_TYPE
 

	)

130 
	~<bôs/ty≥sizes.h
>

133 
__STD_TYPE
 
	t__DEV_T_TYPE
 
	t__dev_t
;

134 
__STD_TYPE
 
__UID_T_TYPE
 
	g__uid_t
;

135 
__STD_TYPE
 
__GID_T_TYPE
 
	g__gid_t
;

136 
__STD_TYPE
 
__INO_T_TYPE
 
	g__öo_t
;

137 
__STD_TYPE
 
__INO64_T_TYPE
 
	g__öo64_t
;

138 
__STD_TYPE
 
__MODE_T_TYPE
 
	g__mode_t
;

139 
__STD_TYPE
 
__NLINK_T_TYPE
 
	g__∆ök_t
;

140 
__STD_TYPE
 
__OFF_T_TYPE
 
	g__off_t
;

141 
__STD_TYPE
 
__OFF64_T_TYPE
 
	g__off64_t
;

142 
__STD_TYPE
 
__PID_T_TYPE
 
	g__pid_t
;

143 
__STD_TYPE
 
__FSID_T_TYPE
 
	g__fsid_t
;

144 
__STD_TYPE
 
__CLOCK_T_TYPE
 
	g__˛ock_t
;

145 
__STD_TYPE
 
__RLIM_T_TYPE
 
	g__æim_t
;

146 
__STD_TYPE
 
__RLIM64_T_TYPE
 
	g__æim64_t
;

147 
__STD_TYPE
 
__ID_T_TYPE
 
	g__id_t
;

148 
__STD_TYPE
 
__TIME_T_TYPE
 
	g__time_t
;

149 
__STD_TYPE
 
__USECONDS_T_TYPE
 
	g__u£c⁄ds_t
;

150 
__STD_TYPE
 
__SUSECONDS_T_TYPE
 
	g__su£c⁄ds_t
;

152 
__STD_TYPE
 
__DADDR_T_TYPE
 
	g__daddr_t
;

153 
__STD_TYPE
 
__KEY_T_TYPE
 
	g__key_t
;

156 
__STD_TYPE
 
__CLOCKID_T_TYPE
 
	g__˛ockid_t
;

159 
__STD_TYPE
 
__TIMER_T_TYPE
 
	g__timî_t
;

162 
__STD_TYPE
 
__BLKSIZE_T_TYPE
 
	g__blksize_t
;

167 
__STD_TYPE
 
__BLKCNT_T_TYPE
 
	g__blk˙t_t
;

168 
__STD_TYPE
 
__BLKCNT64_T_TYPE
 
	g__blk˙t64_t
;

171 
__STD_TYPE
 
__FSBLKCNT_T_TYPE
 
	g__fsblk˙t_t
;

172 
__STD_TYPE
 
__FSBLKCNT64_T_TYPE
 
	g__fsblk˙t64_t
;

175 
__STD_TYPE
 
__FSFILCNT_T_TYPE
 
	g__fsfû˙t_t
;

176 
__STD_TYPE
 
__FSFILCNT64_T_TYPE
 
	g__fsfû˙t64_t
;

179 
__STD_TYPE
 
__FSWORD_T_TYPE
 
	g__fsw‹d_t
;

181 
__STD_TYPE
 
__SSIZE_T_TYPE
 
	g__ssize_t
;

184 
__STD_TYPE
 
__SYSCALL_SLONG_TYPE
 
	g__sysˇŒ_¶⁄g_t
;

186 
__STD_TYPE
 
__SYSCALL_ULONG_TYPE
 
	g__sysˇŒ_ul⁄g_t
;

190 
__off64_t
 
	t__loff_t
;

191 
__quad_t
 *
	t__qaddr_t
;

192 *
	t__ˇddr_t
;

195 
__STD_TYPE
 
__SWORD_TYPE
 
	g__öçå_t
;

198 
__STD_TYPE
 
__U32_TYPE
 
	g__sockÀn_t
;

201 #unde‡
__STD_TYPE


	@/usr/include/endian.h

18 #i‚def 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<„©uªs.h
>

31 
	#__LITTLE_ENDIAN
 1234

	)

32 
	#__BIG_ENDIAN
 4321

	)

33 
	#__PDP_ENDIAN
 3412

	)

36 
	~<bôs/ídün.h
>

40 #i‚de‡
__FLOAT_WORD_ORDER


41 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

44 #ifdef 
__USE_BSD


45 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

46 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

47 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

48 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

51 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


52 
	#__LONG_LONG_PAIR
(
HI
, 
LO
ËLO, 
	)
HI

53 #ñi‡
__BYTE_ORDER
 =
__BIG_ENDIAN


54 
	#__LONG_LONG_PAIR
(
HI
, 
LO
ËHI, 
	)
LO

58 #i‡
deföed
 
__USE_BSD
 && !deföed 
__ASSEMBLER__


60 
	~<bôs/byãsw≠.h
>

62 #i‡
__BYTE_ORDER
 =
__LITTLE_ENDIAN


63 
	#htobe16
(
x
Ë
	`__bsw≠_16
 (x)

	)

64 
	#htﬁe16
(
x
Ë(x)

	)

65 
	#be16toh
(
x
Ë
	`__bsw≠_16
 (x)

	)

66 
	#À16toh
(
x
Ë(x)

	)

68 
	#htobe32
(
x
Ë
	`__bsw≠_32
 (x)

	)

69 
	#htﬁe32
(
x
Ë(x)

	)

70 
	#be32toh
(
x
Ë
	`__bsw≠_32
 (x)

	)

71 
	#À32toh
(
x
Ë(x)

	)

73 #i‡
__GLIBC_HAVE_LONG_LONG


74 
	#htobe64
(
x
Ë
	`__bsw≠_64
 (x)

	)

75 
	#htﬁe64
(
x
Ë(x)

	)

76 
	#be64toh
(
x
Ë
	`__bsw≠_64
 (x)

	)

77 
	#À64toh
(
x
Ë(x)

	)

81 
	#htobe16
(
x
Ë(x)

	)

82 
	#htﬁe16
(
x
Ë
	`__bsw≠_16
 (x)

	)

83 
	#be16toh
(
x
Ë(x)

	)

84 
	#À16toh
(
x
Ë
	`__bsw≠_16
 (x)

	)

86 
	#htobe32
(
x
Ë(x)

	)

87 
	#htﬁe32
(
x
Ë
	`__bsw≠_32
 (x)

	)

88 
	#be32toh
(
x
Ë(x)

	)

89 
	#À32toh
(
x
Ë
	`__bsw≠_32
 (x)

	)

91 #i‡
__GLIBC_HAVE_LONG_LONG


92 
	#htobe64
(
x
Ë(x)

	)

93 
	#htﬁe64
(
x
Ë
	`__bsw≠_64
 (x)

	)

94 
	#be64toh
(
x
Ë(x)

	)

95 
	#À64toh
(
x
Ë
	`__bsw≠_64
 (x)

	)

	@/usr/include/gnu/stubs.h

6 #i‡!
deföed
 
__x86_64__


7 
	~<gnu/°ubs-32.h
>

9 #i‡
deföed
 
__x86_64__
 && deföed 
__LP64__


10 
	~<gnu/°ubs-64.h
>

12 #i‡
deföed
 
__x86_64__
 && deföed 
__ILP32__


13 
	~<gnu/°ubs-x32.h
>

	@/usr/include/stdc-predef.h

18 #i‚def 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

30 
	#__STDC_IEC_559__
 1

	)

31 
	#__STDC_IEC_559_COMPLEX__
 1

	)

35 
	#__STDC_ISO_10646__
 201103L

	)

38 
	#__STDC_NO_THREADS__
 1

	)

	@/usr/include/stdlib.h

22 #i‚def 
_STDLIB_H


24 
	~<„©uªs.h
>

27 
	#__√ed_size_t


	)

28 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


29 
	#__√ed_wch¨_t


	)

30 
	#__√ed_NULL


	)

32 
	~<°ddef.h
>

34 
	g__BEGIN_DECLS


36 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


37 
	#_STDLIB_H
 1

	)

39 #i‡(
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8
Ë&& !deföed 
_SYS_WAIT_H


41 
	~<bôs/waôÊags.h
>

42 
	~<bôs/waô°©us.h
>

44 #ifde‡
__USE_BSD


49 #i‡
deföed
 
__GNUC__
 && !deföed 
__˝lu•lus


50 
	#__WAIT_INT
(
°©us
) \

51 (
	`__exãnsi⁄__
 (((uni⁄ { 
	`__ty≥of
(
°©us
Ë
__ö
; 
__i
; }) \

52 { .
__ö
 = (
°©us
Ë}).
__i
))

	)

54 
	#__WAIT_INT
(
°©us
Ë(*(*Ë&(°©us))

	)

62 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2 || deföed 
__˝lu•lus


63 
	#__WAIT_STATUS
 *

	)

64 
	#__WAIT_STATUS_DEFN
 *

	)

69 
waô
 *
	m__u±r
;

70 *
	m__ùå
;

71 } 
	t__WAIT_STATUS
 
	t__©åibuã__
 ((
	t__å™•¨ít_uni⁄__
));

72 
	#__WAIT_STATUS_DEFN
 *

	)

77 
	#__WAIT_INT
(
°©us
Ë(°©us)

	)

78 
	#__WAIT_STATUS
 *

	)

79 
	#__WAIT_STATUS_DEFN
 *

	)

84 
	#WEXITSTATUS
(
°©us
Ë
	`__WEXITSTATUS
 (
	`__WAIT_INT
 (°©us))

	)

85 
	#WTERMSIG
(
°©us
Ë
	`__WTERMSIG
 (
	`__WAIT_INT
 (°©us))

	)

86 
	#WSTOPSIG
(
°©us
Ë
	`__WSTOPSIG
 (
	`__WAIT_INT
 (°©us))

	)

87 
	#WIFEXITED
(
°©us
Ë
	`__WIFEXITED
 (
	`__WAIT_INT
 (°©us))

	)

88 
	#WIFSIGNALED
(
°©us
Ë
	`__WIFSIGNALED
 (
	`__WAIT_INT
 (°©us))

	)

89 
	#WIFSTOPPED
(
°©us
Ë
	`__WIFSTOPPED
 (
	`__WAIT_INT
 (°©us))

	)

90 #ifde‡
__WIFCONTINUED


91 
	#WIFCONTINUED
(
°©us
Ë
	`__WIFCONTINUED
 (
	`__WAIT_INT
 (°©us))

	)

95 
__BEGIN_NAMESPACE_STD


99 
	mquŸ
;

100 
	mªm
;

101 } 
	tdiv_t
;

104 #i‚de‡
__ldiv_t_deföed


107 
	mquŸ
;

108 
	mªm
;

109 } 
	tldiv_t
;

110 
	#__ldiv_t_deföed
 1

	)

112 
	g__END_NAMESPACE_STD


114 #i‡
deföed
 
__USE_ISOC99
 && !deföed 
__Œdiv_t_deföed


115 
__BEGIN_NAMESPACE_C99


117 
__exãnsi⁄__
 struct

119 
	mquŸ
;

120 
	mªm
;

121 } 
	tŒdiv_t
;

122 
	#__Œdiv_t_deföed
 1

	)

123 
	g__END_NAMESPACE_C99


128 
	#RAND_MAX
 2147483647

	)

133 
	#EXIT_FAILURE
 1

	)

134 
	#EXIT_SUCCESS
 0

	)

138 
	#MB_CUR_MAX
 (
	`__˘y≥_gë_mb_cur_max
 ())

	)

139 
size_t
 
	$__˘y≥_gë_mb_cur_max
 (Ë
__THROW
 
__wur
;

142 
__BEGIN_NAMESPACE_STD


144 
	$©of
 (c⁄° *
__≈å
)

145 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

147 
	$©oi
 (c⁄° *
__≈å
)

148 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

150 
	$©ﬁ
 (c⁄° *
__≈å
)

151 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

152 
__END_NAMESPACE_STD


154 #i‡
deföed
 
__USE_ISOC99
 || (deföed 
__GLIBC_HAVE_LONG_LONG
 && deföed 
__USE_MISC
)

155 
__BEGIN_NAMESPACE_C99


157 
__exãnsi⁄__
 
	$©ﬁl
 (c⁄° *
__≈å
)

158 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

159 
__END_NAMESPACE_C99


162 
__BEGIN_NAMESPACE_STD


164 
	$°πod
 (c⁄° *
__ª°ri˘
 
__≈å
,

165 **
__ª°ri˘
 
__íd±r
)

166 
__THROW
 
	`__n⁄nuŒ
 ((1));

167 
__END_NAMESPACE_STD


169 #ifdef 
__USE_ISOC99


170 
__BEGIN_NAMESPACE_C99


172 
	$°πof
 (c⁄° *
__ª°ri˘
 
__≈å
,

173 **
__ª°ri˘
 
__íd±r
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

175 
	$°πﬁd
 (c⁄° *
__ª°ri˘
 
__≈å
,

176 **
__ª°ri˘
 
__íd±r
)

177 
__THROW
 
	`__n⁄nuŒ
 ((1));

178 
__END_NAMESPACE_C99


181 
__BEGIN_NAMESPACE_STD


183 
	$°πﬁ
 (c⁄° *
__ª°ri˘
 
__≈å
,

184 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

185 
__THROW
 
	`__n⁄nuŒ
 ((1));

187 
	$°πoul
 (c⁄° *
__ª°ri˘
 
__≈å
,

188 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

189 
__THROW
 
	`__n⁄nuŒ
 ((1));

190 
__END_NAMESPACE_STD


192 #i‡
deföed
 
__GLIBC_HAVE_LONG_LONG
 && deföed 
__USE_BSD


194 
__exãnsi⁄__


195 
	$°πoq
 (c⁄° *
__ª°ri˘
 
__≈å
,

196 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

197 
__THROW
 
	`__n⁄nuŒ
 ((1));

199 
__exãnsi⁄__


200 
	$°πouq
 (c⁄° *
__ª°ri˘
 
__≈å
,

201 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

202 
__THROW
 
	`__n⁄nuŒ
 ((1));

205 #i‡
deföed
 
__USE_ISOC99
 || (deföed 
__GLIBC_HAVE_LONG_LONG
 && deföed 
__USE_MISC
)

206 
__BEGIN_NAMESPACE_C99


208 
__exãnsi⁄__


209 
	$°πﬁl
 (c⁄° *
__ª°ri˘
 
__≈å
,

210 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

211 
__THROW
 
	`__n⁄nuŒ
 ((1));

213 
__exãnsi⁄__


214 
	$°πouŒ
 (c⁄° *
__ª°ri˘
 
__≈å
,

215 **
__ª°ri˘
 
__íd±r
, 
__ba£
)

216 
__THROW
 
	`__n⁄nuŒ
 ((1));

217 
__END_NAMESPACE_C99


221 #ifde‡
__USE_GNU


235 
	~<xloˇÀ.h
>

239 
	$°πﬁ_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

240 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

241 
__loˇÀ_t
 
__loc
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

243 
	$°πoul_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

244 **
__ª°ri˘
 
__íd±r
,

245 
__ba£
, 
__loˇÀ_t
 
__loc
)

246 
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

248 
__exãnsi⁄__


249 
	$°πﬁl_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

250 **
__ª°ri˘
 
__íd±r
, 
__ba£
,

251 
__loˇÀ_t
 
__loc
)

252 
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

254 
__exãnsi⁄__


255 
	$°πouŒ_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

256 **
__ª°ri˘
 
__íd±r
,

257 
__ba£
, 
__loˇÀ_t
 
__loc
)

258 
__THROW
 
	`__n⁄nuŒ
 ((1, 4));

260 
	$°πod_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

261 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

262 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

264 
	$°πof_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

265 **
__ª°ri˘
 
__íd±r
, 
__loˇÀ_t
 
__loc
)

266 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

268 
	$°πﬁd_l
 (c⁄° *
__ª°ri˘
 
__≈å
,

269 **
__ª°ri˘
 
__íd±r
,

270 
__loˇÀ_t
 
__loc
)

271 
__THROW
 
	`__n⁄nuŒ
 ((1, 3));

275 #ifde‡
__USE_EXTERN_INLINES


276 
__BEGIN_NAMESPACE_STD


277 
__exã∫_ölöe
 

278 
	`__NTH
 (
	$©oi
 (c⁄° *
__≈å
))

280  (Ë
	`°πﬁ
 (
__≈å
, (**Ë
NULL
, 10);

281 
	}
}

282 
__exã∫_ölöe
 

283 
__NTH
 (
	$©ﬁ
 (c⁄° *
__≈å
))

285  
	`°πﬁ
 (
__≈å
, (**Ë
NULL
, 10);

286 
	}
}

287 
	g__END_NAMESPACE_STD


289 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_ISOC99


290 
__BEGIN_NAMESPACE_C99


291 
__exãnsi⁄__
 
__exã∫_ölöe
 

292 
__NTH
 (
	$©ﬁl
 (c⁄° *
__≈å
))

294  
	`°πﬁl
 (
__≈å
, (**Ë
NULL
, 10);

295 
	}
}

296 
	g__END_NAMESPACE_C99


301 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN_EXTENDED


305 *
	$l64a
 (
__n
Ë
__THROW
 
__wur
;

308 
	$a64l
 (c⁄° *
__s
)

309 
__THROW
 
__©åibuã_puª__
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

313 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_BSD


314 
	~<sys/ty≥s.h
>

321 
	$øndom
 (Ë
__THROW
;

324 
	$§™dom
 (
__£ed
Ë
__THROW
;

330 *
	$öô°©e
 (
__£ed
, *
__°©ebuf
,

331 
size_t
 
__°©ñí
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

335 *
	$£t°©e
 (*
__°©ebuf
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

338 #ifde‡
__USE_MISC


343 
	søndom_d©a


345 
öt32_t
 *
Âå
;

346 
öt32_t
 *
Ωå
;

347 
öt32_t
 *
°©e
;

348 
ønd_ty≥
;

349 
ønd_deg
;

350 
ønd_£p
;

351 
öt32_t
 *
íd_±r
;

354 
	$øndom_r
 (
øndom_d©a
 *
__ª°ri˘
 
__buf
,

355 
öt32_t
 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

357 
	$§™dom_r
 (
__£ed
, 
øndom_d©a
 *
__buf
)

358 
__THROW
 
	`__n⁄nuŒ
 ((2));

360 
	$öô°©e_r
 (
__£ed
, *
__ª°ri˘
 
__°©ebuf
,

361 
size_t
 
__°©ñí
,

362 
øndom_d©a
 *
__ª°ri˘
 
__buf
)

363 
__THROW
 
	`__n⁄nuŒ
 ((2, 4));

365 
	$£t°©e_r
 (*
__ª°ri˘
 
__°©ebuf
,

366 
øndom_d©a
 *
__ª°ri˘
 
__buf
)

367 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

372 
__BEGIN_NAMESPACE_STD


374 
	$ønd
 (Ë
__THROW
;

376 
	$§™d
 (
__£ed
Ë
__THROW
;

377 
__END_NAMESPACE_STD


379 #ifde‡
__USE_POSIX


381 
	$ønd_r
 (*
__£ed
Ë
__THROW
;

385 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


389 
	$dønd48
 (Ë
__THROW
;

390 
	$î™d48
 (
__xsubi
[3]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

393 
	$Ã™d48
 (Ë
__THROW
;

394 
	$ƒ™d48
 (
__xsubi
[3])

395 
__THROW
 
	`__n⁄nuŒ
 ((1));

398 
	$mønd48
 (Ë
__THROW
;

399 
	$jønd48
 (
__xsubi
[3])

400 
__THROW
 
	`__n⁄nuŒ
 ((1));

403 
	$§™d48
 (
__£edvÆ
Ë
__THROW
;

404 *
	$£ed48
 (
__£ed16v
[3])

405 
__THROW
 
	`__n⁄nuŒ
 ((1));

406 
	$lc⁄g48
 (
__∑øm
[7]Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

408 #ifde‡
__USE_MISC


412 
	sdønd48_d©a


414 
__x
[3];

415 
__ﬁd_x
[3];

416 
__c
;

417 
__öô
;

418 
__a
;

422 
	$dønd48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

423 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

424 
	$î™d48_r
 (
__xsubi
[3],

425 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

426 *
__ª°ri˘
 
__ªsu…
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

429 
	$Ã™d48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

430 *
__ª°ri˘
 
__ªsu…
)

431 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

432 
	$ƒ™d48_r
 (
__xsubi
[3],

433 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

434 *
__ª°ri˘
 
__ªsu…
)

435 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

438 
	$mønd48_r
 (
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

439 *
__ª°ri˘
 
__ªsu…
)

440 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

441 
	$jønd48_r
 (
__xsubi
[3],

442 
dønd48_d©a
 *
__ª°ri˘
 
__buf„r
,

443 *
__ª°ri˘
 
__ªsu…
)

444 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

447 
	$§™d48_r
 (
__£edvÆ
, 
dønd48_d©a
 *
__buf„r
)

448 
__THROW
 
	`__n⁄nuŒ
 ((2));

450 
	$£ed48_r
 (
__£ed16v
[3],

451 
dønd48_d©a
 *
__buf„r
Ë
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

453 
	$lc⁄g48_r
 (
__∑øm
[7],

454 
dønd48_d©a
 *
__buf„r
)

455 
__THROW
 
	`__n⁄nuŒ
 ((1, 2));

461 #i‚de‡
__mÆloc_™d_ˇŒoc_deföed


462 
	#__mÆloc_™d_ˇŒoc_deföed


	)

463 
__BEGIN_NAMESPACE_STD


465 *
	$mÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

467 *
	$ˇŒoc
 (
size_t
 
__nmemb
, size_à
__size
)

468 
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

469 
__END_NAMESPACE_STD


472 #i‚de‡
__√ed_mÆloc_™d_ˇŒoc


473 
__BEGIN_NAMESPACE_STD


479 *
	$ªÆloc
 (*
__±r
, 
size_t
 
__size
)

480 
__THROW
 
__©åibuã_w¨n_unu£d_ªsu…__
;

482 
	$‰ì
 (*
__±r
Ë
__THROW
;

483 
__END_NAMESPACE_STD


485 #ifdef 
__USE_MISC


487 
	$c‰ì
 (*
__±r
Ë
__THROW
;

490 #i‡
deföed
 
__USE_GNU
 || deföed 
__USE_BSD
 || deföed 
__USE_MISC


491 
	~<Æloˇ.h
>

494 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K
) \

495 || 
deföed
 
__USE_BSD


497 *
	$vÆloc
 (
size_t
 
__size
Ë
__THROW
 
__©åibuã_mÆloc__
 
__wur
;

500 #ifde‡
__USE_XOPEN2K


502 
	$posix_memÆign
 (**
__mem±r
, 
size_t
 
__Æignmít
, size_à
__size
)

503 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

506 #ifde‡
__USE_ISOC11


508 *
	$Æig√d_Æloc
 (
size_t
 
__Æignmít
, size_à
__size
)

509 
__THROW
 
__wur
 
	`__©åibuã__
 ((
__mÆloc__
, 
	`__Æloc_size__
 (2)));

512 
__BEGIN_NAMESPACE_STD


514 
	$ab‹t
 (Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

518 
	`©exô
 ((*
__func
Ë()Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

520 #i‡
deföed
 
__USE_ISOC11
 || deföed 
__USE_ISOCXX11


522 #ifde‡
__˝lu•lus


523 "C++" 
	`©_quick_exô
 ((*
__func
) ())

524 
__THROW
 
	`__asm
 ("©_quick_exô"Ë
	`__n⁄nuŒ
 ((1));

526 
	`©_quick_exô
 ((*
__func
Ë()Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

529 
__END_NAMESPACE_STD


531 #ifdef 
__USE_MISC


534 
	`⁄_exô
 ((*
__func
Ë(
__°©us
, *
__¨g
), *__arg)

535 
__THROW
 
	`__n⁄nuŒ
 ((1));

538 
__BEGIN_NAMESPACE_STD


542 
	$exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

544 #i‡
deföed
 
__USE_ISOC11
 || deföed 
__USE_ISOCXX11


548 
	$quick_exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

550 
__END_NAMESPACE_STD


552 #ifde‡
__USE_ISOC99


553 
__BEGIN_NAMESPACE_C99


556 
	$_Exô
 (
__°©us
Ë
__THROW
 
	`__©åibuã__
 ((
__n‹ëu∫__
));

557 
__END_NAMESPACE_C99


561 
__BEGIN_NAMESPACE_STD


563 *
	$gëív
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

564 
__END_NAMESPACE_STD


566 #ifde‡
__USE_GNU


569 *
	$£cuª_gëív
 (c⁄° *
__«me
)

570 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

573 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


577 
	$puãnv
 (*
__°rög
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

580 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN2K


583 
	$£ãnv
 (c⁄° *
__«me
, c⁄° *
__vÆue
, 
__ª∂a˚
)

584 
__THROW
 
	`__n⁄nuŒ
 ((2));

587 
	$un£ãnv
 (c⁄° *
__«me
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

590 #ifdef 
__USE_MISC


594 
	$˛óªnv
 (Ë
__THROW
;

598 #i‡
deföed
 
__USE_MISC
 \

599 || (
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
)

605 *
	$mkãmp
 (*
__ãm∂©e
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

608 #i‡
deföed
 
__USE_MISC
 || deföed 
__USE_XOPEN_EXTENDED
 \

609 || 
deföed
 
__USE_XOPEN2K8


618 #i‚de‡
__USE_FILE_OFFSET64


619 
	$mk°emp
 (*
__ãm∂©e
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

621 #ifde‡
__REDIRECT


622 
	`__REDIRECT
 (
mk°emp
, (*
__ãm∂©e
), 
mk°emp64
)

623 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

625 
	#mk°emp
 
mk°emp64


	)

628 #ifde‡
__USE_LARGEFILE64


629 
	$mk°emp64
 (*
__ãm∂©e
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

633 #ifde‡
__USE_MISC


640 #i‚de‡
__USE_FILE_OFFSET64


641 
	$mk°emps
 (*
__ãm∂©e
, 
__suffixÀn
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

643 #ifde‡
__REDIRECT


644 
	`__REDIRECT
 (
mk°emps
, (*
__ãm∂©e
, 
__suffixÀn
),

645 
mk°emps64
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

647 
	#mk°emps
 
mk°emps64


	)

650 #ifde‡
__USE_LARGEFILE64


651 
	$mk°emps64
 (*
__ãm∂©e
, 
__suffixÀn
)

652 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

656 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN2K8


662 *
	$mkdãmp
 (*
__ãm∂©e
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

665 #ifde‡
__USE_GNU


672 #i‚de‡
__USE_FILE_OFFSET64


673 
	$mko°emp
 (*
__ãm∂©e
, 
__Êags
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

675 #ifde‡
__REDIRECT


676 
	`__REDIRECT
 (
mko°emp
, (*
__ãm∂©e
, 
__Êags
), 
mko°emp64
)

677 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

679 
	#mko°emp
 
mko°emp64


	)

682 #ifde‡
__USE_LARGEFILE64


683 
	$mko°emp64
 (*
__ãm∂©e
, 
__Êags
Ë
	`__n⁄nuŒ
 ((1)Ë
__wur
;

692 #i‚de‡
__USE_FILE_OFFSET64


693 
	$mko°emps
 (*
__ãm∂©e
, 
__suffixÀn
, 
__Êags
)

694 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

696 #ifde‡
__REDIRECT


697 
	`__REDIRECT
 (
mko°emps
, (*
__ãm∂©e
, 
__suffixÀn
,

698 
__Êags
), 
mko°emps64
)

699 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

701 
	#mko°emps
 
mko°emps64


	)

704 #ifde‡
__USE_LARGEFILE64


705 
	$mko°emps64
 (*
__ãm∂©e
, 
__suffixÀn
, 
__Êags
)

706 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

711 
__BEGIN_NAMESPACE_STD


716 
	$sy°em
 (c⁄° *
__comm™d
Ë
__wur
;

717 
__END_NAMESPACE_STD


720 #ifdef 
__USE_GNU


723 *
	$ˇn⁄iˇlize_fûe_«me
 (c⁄° *
__«me
)

724 
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

727 #i‡
deföed
 
__USE_BSD
 || deföed 
__USE_XOPEN_EXTENDED


733 *
	$ªÆ∑th
 (c⁄° *
__ª°ri˘
 
__«me
,

734 *
__ª°ri˘
 
__ªsﬁved
Ë
__THROW
 
__wur
;

739 #i‚de‡
__COMPAR_FN_T


740 
	#__COMPAR_FN_T


	)

741 (*
	t__com∑r_‚_t
) (const *, const *);

743 #ifdef 
__USE_GNU


744 
__com∑r_‚_t
 
	tcom∑ris⁄_‚_t
;

747 #ifde‡
__USE_GNU


748 (*
	t__com∑r_d_‚_t
) (const *, const *, *);

751 
__BEGIN_NAMESPACE_STD


754 *
	$b£¨ch
 (c⁄° *
__key
, c⁄° *
__ba£
,

755 
size_t
 
__nmemb
, size_à
__size
, 
__com∑r_‚_t
 
__com∑r
)

756 
	`__n⁄nuŒ
 ((1, 2, 5)Ë
__wur
;

760 
	$qs‹t
 (*
__ba£
, 
size_t
 
__nmemb
, size_à
__size
,

761 
__com∑r_‚_t
 
__com∑r
Ë
	`__n⁄nuŒ
 ((1, 4));

762 #ifde‡
__USE_GNU


763 
	$qs‹t_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_à
__size
,

764 
__com∑r_d_‚_t
 
__com∑r
, *
__¨g
)

765 
	`__n⁄nuŒ
 ((1, 4));

770 
	$abs
 (
__x
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

771 
	$œbs
 (
__x
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

772 
__END_NAMESPACE_STD


774 #ifde‡
__USE_ISOC99


775 
__exãnsi⁄__
 
	$Œabs
 (
__x
)

776 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

780 
__BEGIN_NAMESPACE_STD


784 
div_t
 
	$div
 (
__numî
, 
__díom
)

785 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

786 
ldiv_t
 
	$ldiv
 (
__numî
, 
__díom
)

787 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

788 
__END_NAMESPACE_STD


790 #ifde‡
__USE_ISOC99


791 
__BEGIN_NAMESPACE_C99


792 
__exãnsi⁄__
 
Œdiv_t
 
	$Œdiv
 (
__numî
,

793 
__díom
)

794 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
)Ë
__wur
;

795 
__END_NAMESPACE_C99


799 #i‡(
deföed
 
__USE_XOPEN_EXTENDED
 && !deföed 
__USE_XOPEN2K8
) \

800 || 
deföed
 
__USE_SVID


807 *
	$ecvt
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

808 *
__ª°ri˘
 
__sign
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

813 *
	$fcvt
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

814 *
__ª°ri˘
 
__sign
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

819 *
	$gcvt
 (
__vÆue
, 
__ndigô
, *
__buf
)

820 
__THROW
 
	`__n⁄nuŒ
 ((3)Ë
__wur
;

823 #ifde‡
__USE_MISC


825 *
	$qecvt
 (
__vÆue
, 
__ndigô
,

826 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
)

827 
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

828 *
	$qfcvt
 (
__vÆue
, 
__ndigô
,

829 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
)

830 
__THROW
 
	`__n⁄nuŒ
 ((3, 4)Ë
__wur
;

831 *
	$qgcvt
 (
__vÆue
, 
__ndigô
, *
__buf
)

832 
__THROW
 
	`__n⁄nuŒ
 ((3)Ë
__wur
;

837 
	$ecvt_r
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

838 *
__ª°ri˘
 
__sign
, *__ª°ri˘ 
__buf
,

839 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

840 
	$fcvt_r
 (
__vÆue
, 
__ndigô
, *
__ª°ri˘
 
__de˝t
,

841 *
__ª°ri˘
 
__sign
, *__ª°ri˘ 
__buf
,

842 
size_t
 
__Àn
Ë
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

844 
	$qecvt_r
 (
__vÆue
, 
__ndigô
,

845 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
,

846 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

847 
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

848 
	$qfcvt_r
 (
__vÆue
, 
__ndigô
,

849 *
__ª°ri˘
 
__de˝t
, *__ª°ri˘ 
__sign
,

850 *
__ª°ri˘
 
__buf
, 
size_t
 
__Àn
)

851 
__THROW
 
	`__n⁄nuŒ
 ((3, 4, 5));

856 
__BEGIN_NAMESPACE_STD


859 
	$mbÀn
 (c⁄° *
__s
, 
size_t
 
__n
Ë
__THROW
 
__wur
;

862 
	$mbtowc
 (
wch¨_t
 *
__ª°ri˘
 
__pwc
,

863 c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
Ë
__THROW
 
__wur
;

866 
	$w˘omb
 (*
__s
, 
wch¨_t
 
__wch¨
Ë
__THROW
 
__wur
;

870 
size_t
 
	$mb°owcs
 (
wch¨_t
 *
__ª°ri˘
 
__pwcs
,

871 c⁄° *
__ª°ri˘
 
__s
, 
size_t
 
__n
Ë
__THROW
;

873 
size_t
 
	$wc°ombs
 (*
__ª°ri˘
 
__s
,

874 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__pwcs
, 
size_t
 
__n
)

875 
__THROW
;

876 
__END_NAMESPACE_STD


879 #ifde‡
__USE_SVID


884 
	$Ωm©ch
 (c⁄° *
__ª•⁄£
Ë
__THROW
 
	`__n⁄nuŒ
 ((1)Ë
__wur
;

888 #i‡
deföed
 
__USE_XOPEN_EXTENDED
 || deföed 
__USE_XOPEN2K8


895 
	$gësub›t
 (**
__ª°ri˘
 
__›ti⁄p
,

896 *c⁄° *
__ª°ri˘
 
__tokís
,

897 **
__ª°ri˘
 
__vÆuï
)

898 
__THROW
 
	`__n⁄nuŒ
 ((1, 2, 3)Ë
__wur
;

902 #ifde‡
__USE_XOPEN


904 
	$£tkey
 (c⁄° *
__key
Ë
__THROW
 
	`__n⁄nuŒ
 ((1));

910 #ifde‡
__USE_XOPEN2KXSI


912 
	$posix_›í±
 (
__oÊag
Ë
__wur
;

915 #ifde‡
__USE_XOPEN


920 
	$gø¡±
 (
__fd
Ë
__THROW
;

924 
	$u∆ock±
 (
__fd
Ë
__THROW
;

929 *
	$±¢ame
 (
__fd
Ë
__THROW
 
__wur
;

932 #ifde‡
__USE_GNU


936 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
)

937 
__THROW
 
	`__n⁄nuŒ
 ((2));

940 
	`gë±
 ();

943 #ifde‡
__USE_BSD


947 
	$gëlﬂdavg
 (
__lﬂdavg
[], 
__√Àm
)

948 
__THROW
 
	`__n⁄nuŒ
 ((1));

951 
	~<bôs/°dlib-Êﬂt.h
>

954 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__f‹tify_fun˘i⁄


955 
	~<bôs/°dlib.h
>

957 #ifde‡
__LDBL_COMPAT


958 
	~<bôs/°dlib-ldbl.h
>

962 #unde‡
__√ed_mÆloc_™d_ˇŒoc


964 
__END_DECLS


	@/usr/include/sys/cdefs.h

19 #i‚def 
_SYS_CDEFS_H


20 
	#_SYS_CDEFS_H
 1

	)

23 #i‚de‡
_FEATURES_H


24 
	~<„©uªs.h
>

30 #i‡
deföed
 
__GNUC__
 && !deföed 
__STDC__


35 #unde‡
__P


36 #unde‡
__PMT


38 #ifde‡
__GNUC__


42 #i‡
__GNUC_PREREQ
 (4, 6Ë&& !
deföed
 
_LIBC


43 
	#__LEAF
 , 
__Àaf__


	)

44 
	#__LEAF_ATTR
 
	`__©åibuã__
 ((
__Àaf__
))

	)

46 
	#__LEAF


	)

47 
	#__LEAF_ATTR


	)

55 #i‡!
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (3, 3)

56 
	#__THROW
 
	`__©åibuã__
 ((
__nŸhrow__
 
__LEAF
))

	)

57 
	#__THROWNL
 
	`__©åibuã__
 ((
__nŸhrow__
))

	)

58 
	#__NTH
(
f˘
Ë
	`__©åibuã__
 ((
__nŸhrow__
 
__LEAF
)Ë
	)
fct

60 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (2,8)

61 
	#__THROW
 
	`throw
 ()

	)

62 
	#__THROWNL
 
	`throw
 ()

	)

63 
	#__NTH
(
f˘
Ë
__LEAF_ATTR
 f˘ 
	`throw
 ()

	)

65 
	#__THROW


	)

66 
	#__THROWNL


	)

67 
	#__NTH
(
f˘
Ë
	)
fct

73 
	#__ölöe


	)

75 
	#__THROW


	)

76 
	#__THROWNL


	)

77 
	#__NTH
(
f˘
Ë
	)
fct

83 
	#__P
(
¨gs
Ë
	)
args

84 
	#__PMT
(
¨gs
Ë
	)
args

89 
	#__CONCAT
(
x
,
y
Ëx ## 
	)
y

90 
	#__STRING
(
x
Ë#x

	)

93 
	#__±r_t
 *

	)

94 
	#__l⁄g_doubÀ_t
 

	)

98 #ifdef 
__˝lu•lus


99 
	#__BEGIN_DECLS
 "C" {

	)

100 
	#__END_DECLS
 }

	)

102 
	#__BEGIN_DECLS


	)

103 
	#__END_DECLS


	)

112 #i‡
deföed
 
__˝lu•lus
 && deföed 
_GLIBCPP_USE_NAMESPACES


113 
	#__BEGIN_NAMESPACE_STD
 
«me•a˚
 
°d
 {

	)

114 
	#__END_NAMESPACE_STD
 }

	)

115 
	#__USING_NAMESPACE_STD
(
«me
Ë
usög
 
°d
::«me;

	)

116 
	#__BEGIN_NAMESPACE_C99
 
«me•a˚
 
__c99
 {

	)

117 
	#__END_NAMESPACE_C99
 }

	)

118 
	#__USING_NAMESPACE_C99
(
«me
Ë
usög
 
__c99
::«me;

	)

123 
	#__BEGIN_NAMESPACE_STD


	)

124 
	#__END_NAMESPACE_STD


	)

125 
	#__USING_NAMESPACE_STD
(
«me
)

	)

126 
	#__BEGIN_NAMESPACE_C99


	)

127 
	#__END_NAMESPACE_C99


	)

128 
	#__USING_NAMESPACE_C99
(
«me
)

	)

133 #i‚de‡
__BOUNDED_POINTERS__


134 
	#__bounded


	)

135 
	#__unbounded


	)

136 
	#__±rvÆue


	)

141 
	#__bos
(
±r
Ë
	`__buûtö_obje˘_size
 (±r, 
__USE_FORTIFY_LEVEL
 > 1)

	)

142 
	#__bos0
(
±r
Ë
	`__buûtö_obje˘_size
 (±r, 0)

	)

144 #i‡
__GNUC_PREREQ
 (4,3)

145 
	#__w¨nde˛
(
«me
, 
msg
) \

146 
	`«me
 (Ë
	`__©åibuã__
((
	`__w¨nög__
 (
msg
)))

	)

147 
	#__w¨«âr
(
msg
Ë
	`__©åibuã__
((
	`__w¨nög__
 (msg)))

	)

148 
	#__îr‹de˛
(
«me
, 
msg
) \

149 
	`«me
 (Ë
	`__©åibuã__
((
	`__îr‹__
 (
msg
)))

	)

151 
	#__w¨nde˛
(
«me
, 
msg
Ë
	`«me
 ()

	)

152 
	#__w¨«âr
(
msg
)

	)

153 
	#__îr‹de˛
(
«me
, 
msg
Ë
	`«me
 ()

	)

157 #i‡
__GNUC_PREREQ
 (2,97)

159 
	#__Êex¨r
 []

	)

161 #ifde‡
__GNUC__


162 
	#__Êex¨r
 [0]

	)

164 #i‡
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

165 
	#__Êex¨r
 []

	)

168 
	#__Êex¨r
 [1]

	)

184 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

186 
	#__REDIRECT
(
«me
, 
¥Ÿo
, 
Æüs
Ë«mê¥Ÿÿ
	`__asm__
 (
	`__ASMNAME
 (#Æüs))

	)

187 #ifde‡
__˝lu•lus


188 
	#__REDIRECT_NTH
(
«me
, 
¥Ÿo
, 
Æüs
) \

189 
«me
 
¥Ÿo
 
__THROW
 
	`__asm__
 (
	`__ASMNAME
 (#Æüs))

	)

190 
	#__REDIRECT_NTHNL
(
«me
, 
¥Ÿo
, 
Æüs
) \

191 
«me
 
¥Ÿo
 
__THROWNL
 
	`__asm__
 (
	`__ASMNAME
 (#Æüs))

	)

193 
	#__REDIRECT_NTH
(
«me
, 
¥Ÿo
, 
Æüs
) \

194 
«me
 
¥Ÿo
 
	`__asm__
 (
	`__ASMNAME
 (#Æüs)Ë
__THROW


	)

195 
	#__REDIRECT_NTHNL
(
«me
, 
¥Ÿo
, 
Æüs
) \

196 
«me
 
¥Ÿo
 
	`__asm__
 (
	`__ASMNAME
 (#Æüs)Ë
__THROWNL


	)

198 
	#__ASMNAME
(
˙ame
Ë
	`__ASMNAME2
 (
__USER_LABEL_PREFIX__
, c«me)

	)

199 
	#__ASMNAME2
(
¥efix
, 
˙ame
Ë
	`__STRING
 (¥efixË
	)
cname

212 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2

213 
	#__©åibuã__
(
xyz
Ë

	)

219 #i‡
__GNUC_PREREQ
 (2,96)

220 
	#__©åibuã_mÆloc__
 
	`__©åibuã__
 ((
__mÆloc__
))

	)

222 
	#__©åibuã_mÆloc__


	)

228 #i‡
__GNUC_PREREQ
 (2,96)

229 
	#__©åibuã_puª__
 
	`__©åibuã__
 ((
__puª__
))

	)

231 
	#__©åibuã_puª__


	)

235 #i‡
__GNUC_PREREQ
 (2,5)

236 
	#__©åibuã_c⁄°__
 
	`__©åibuã__
 ((
__c⁄°__
))

	)

238 
	#__©åibuã_c⁄°__


	)

244 #i‡
__GNUC_PREREQ
 (3,1)

245 
	#__©åibuã_u£d__
 
	`__©åibuã__
 ((
__u£d__
))

	)

246 
	#__©åibuã_noölöe__
 
	`__©åibuã__
 ((
__noölöe__
))

	)

248 
	#__©åibuã_u£d__
 
	`__©åibuã__
 ((
__unu£d__
))

	)

249 
	#__©åibuã_noölöe__


	)

253 #i‡
__GNUC_PREREQ
 (3,2)

254 
	#__©åibuã_dïªˇãd__
 
	`__©åibuã__
 ((
__dïªˇãd__
))

	)

256 
	#__©åibuã_dïªˇãd__


	)

265 #i‡
__GNUC_PREREQ
 (2,8)

266 
	#__©åibuã_f‹m©_¨g__
(
x
Ë
	`__©åibuã__
 ((
	`__f‹m©_¨g__
 (x)))

	)

268 
	#__©åibuã_f‹m©_¨g__
(
x
Ë

	)

275 #i‡
__GNUC_PREREQ
 (2,97)

276 
	#__©åibuã_f‹m©_°rfm⁄__
(
a
,
b
) \

277 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__°rfm⁄__
, 
a
, 
b
)))

	)

279 
	#__©åibuã_f‹m©_°rfm⁄__
(
a
,
b
Ë

	)

284 #i‡
__GNUC_PREREQ
 (3,3)

285 
	#__n⁄nuŒ
(
∑øms
Ë
	`__©åibuã__
 ((
__n⁄nuŒ__
Ö¨ams))

	)

287 
	#__n⁄nuŒ
(
∑øms
)

	)

292 #i‡
__GNUC_PREREQ
 (3,4)

293 
	#__©åibuã_w¨n_unu£d_ªsu…__
 \

294 
	`__©åibuã__
 ((
__w¨n_unu£d_ªsu…__
))

	)

295 #i‡
__USE_FORTIFY_LEVEL
 > 0

296 
	#__wur
 
__©åibuã_w¨n_unu£d_ªsu…__


	)

299 
	#__©åibuã_w¨n_unu£d_ªsu…__


	)

301 #i‚de‡
__wur


302 
	#__wur


	)

306 #i‡
__GNUC_PREREQ
 (3,2)

307 
	#__Æways_ölöe
 
__ölöe
 
	`__©åibuã__
 ((
__Æways_ölöe__
))

	)

309 
	#__Æways_ölöe
 
__ölöe


	)

314 #i‡
__GNUC_PREREQ
 (4,3)

315 
	#__©åibuã_¨tificül__
 
	`__©åibuã__
 ((
__¨tificül__
))

	)

317 
	#__©åibuã_¨tificül__


	)

329 #i‡(!
deföed
 
__˝lu•lus
 || 
__GNUC_PREREQ
 (4,3) \

330 || (
deföed
 
__˛™g__
 && (deföed 
__GNUC_STDC_INLINE__
 \

331 || 
deföed
 
__GNUC_GNU_INLINE__
)))

332 #i‡
deföed
 
__GNUC_STDC_INLINE__
 || deföed 
__˝lu•lus


333 
	#__exã∫_ölöe
 
__ölöe
 
	`__©åibuã__
 ((
__gnu_ölöe__
))

	)

334 
	#__exã∫_Æways_ölöe
 \

335 
__Æways_ölöe
 
	`__©åibuã__
 ((
__gnu_ölöe__
))

	)

337 
	#__exã∫_ölöe
 
__ölöe


	)

338 
	#__exã∫_Æways_ölöe
 
__Æways_ölöe


	)

342 #ifde‡
__exã∫_Æways_ölöe


343 
	#__f‹tify_fun˘i⁄
 
__exã∫_Æways_ölöe
 
__©åibuã_¨tificül__


	)

348 #i‡
__GNUC_PREREQ
 (4,3)

349 
	#__va_¨g_∑ck
(Ë
	`__buûtö_va_¨g_∑ck
 ()

	)

350 
	#__va_¨g_∑ck_Àn
(Ë
	`__buûtö_va_¨g_∑ck_Àn
 ()

	)

357 #i‡!
__GNUC_PREREQ
 (2,8)

358 
	#__exãnsi⁄__


	)

362 #i‡!
__GNUC_PREREQ
 (2,92)

363 
	#__ª°ri˘


	)

369 #i‡
__GNUC_PREREQ
 (3,1Ë&& !
deföed
 
__GNUG__


370 
	#__ª°ri˘_¨r
 
__ª°ri˘


	)

372 #ifde‡
__GNUC__


373 
	#__ª°ri˘_¨r


	)

375 #i‡
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

376 
	#__ª°ri˘_¨r
 
ª°ri˘


	)

379 
	#__ª°ri˘_¨r


	)

384 #i‡
__GNUC__
 >= 3

385 
	#__glibc_u∆ikñy
(
c⁄d
Ë
	`__buûtö_ex≥˘
((c⁄d), 0)

	)

386 
	#__glibc_likñy
(
c⁄d
Ë
	`__buûtö_ex≥˘
((c⁄d), 1)

	)

388 
	#__glibc_u∆ikñy
(
c⁄d
Ë(c⁄d)

	)

389 
	#__glibc_likñy
(
c⁄d
Ë(c⁄d)

	)

392 
	~<bôs/w‹dsize.h
>

394 #i‡
deföed
 
__LONG_DOUBLE_MATH_OPTIONAL
 && deföed 
__NO_LONG_DOUBLE_MATH


395 
	#__LDBL_COMPAT
 1

	)

396 #ifde‡
__REDIRECT


397 
	#__LDBL_REDIR1
(
«me
, 
¥Ÿo
, 
Æüs
Ë
	`__REDIRECT
 («me,ÖrŸo,álüs)

	)

398 
	#__LDBL_REDIR
(
«me
, 
¥Ÿo
) \

399 
	`__LDBL_REDIR1
 (
«me
, 
¥Ÿo
, 
__∆dbl_
##«me)

	)

400 
	#__LDBL_REDIR1_NTH
(
«me
, 
¥Ÿo
, 
Æüs
Ë
	`__REDIRECT_NTH
 («me,ÖrŸo,álüs)

	)

401 
	#__LDBL_REDIR_NTH
(
«me
, 
¥Ÿo
) \

402 
	`__LDBL_REDIR1_NTH
 (
«me
, 
¥Ÿo
, 
__∆dbl_
##«me)

	)

403 
	#__LDBL_REDIR1_DECL
(
«me
, 
Æüs
) \

404 
	`__ty≥of
 (
«me
Ë«mê
	`__asm
 (
	`__ASMNAME
 (#Æüs));

	)

405 
	#__LDBL_REDIR_DECL
(
«me
) \

406 
	`__ty≥of
 (
«me
Ë«mê
	`__asm
 (
	`__ASMNAME
 ("__∆dbl_" #«me));

	)

407 
	#__REDIRECT_LDBL
(
«me
, 
¥Ÿo
, 
Æüs
) \

408 
	`__LDBL_REDIR1
 (
«me
, 
¥Ÿo
, 
__∆dbl_
##
Æüs
)

	)

409 
	#__REDIRECT_NTH_LDBL
(
«me
, 
¥Ÿo
, 
Æüs
) \

410 
	`__LDBL_REDIR1_NTH
 (
«me
, 
¥Ÿo
, 
__∆dbl_
##
Æüs
)

	)

413 #i‡!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT


414 
	#__LDBL_REDIR1
(
«me
, 
¥Ÿo
, 
Æüs
Ë«mê
	)
proto

415 
	#__LDBL_REDIR
(
«me
, 
¥Ÿo
Ë«mê
	)
proto

416 
	#__LDBL_REDIR1_NTH
(
«me
, 
¥Ÿo
, 
Æüs
Ë«mê¥Ÿÿ
__THROW


	)

417 
	#__LDBL_REDIR_NTH
(
«me
, 
¥Ÿo
Ë«mê¥Ÿÿ
__THROW


	)

418 
	#__LDBL_REDIR_DECL
(
«me
)

	)

419 #ifde‡
__REDIRECT


420 
	#__REDIRECT_LDBL
(
«me
, 
¥Ÿo
, 
Æüs
Ë
	`__REDIRECT
 («me,ÖrŸo,álüs)

	)

421 
	#__REDIRECT_NTH_LDBL
(
«me
, 
¥Ÿo
, 
Æüs
) \

422 
	`__REDIRECT_NTH
 (
«me
, 
¥Ÿo
, 
Æüs
)

	)

	@/usr/include/alloca.h

18 #i‚def 
_ALLOCA_H


19 
	#_ALLOCA_H
 1

	)

21 
	~<„©uªs.h
>

23 
	#__√ed_size_t


	)

24 
	~<°ddef.h
>

26 
	g__BEGIN_DECLS


29 #unde‡
Æloˇ


32 *
	$Æloˇ
 (
size_t
 
__size
Ë
__THROW
;

34 #ifdef 
__GNUC__


35 
	#Æloˇ
(
size
Ë
	`__buûtö_Æloˇ
 (size)

	)

38 
__END_DECLS


	@/usr/include/asm-generic/posix_types.h

1 #i‚de‡
__ASM_GENERIC_POSIX_TYPES_H


2 
	#__ASM_GENERIC_POSIX_TYPES_H


	)

4 
	~<asm/bô•îl⁄g.h
>

13 #i‚de‡
__kî√l_l⁄g_t


14 
	t__kî√l_l⁄g_t
;

15 
	t__kî√l_ul⁄g_t
;

18 #i‚de‡
__kî√l_öo_t


19 
__kî√l_ul⁄g_t
 
	t__kî√l_öo_t
;

22 #i‚de‡
__kî√l_mode_t


23 
	t__kî√l_mode_t
;

26 #i‚de‡
__kî√l_pid_t


27 
	t__kî√l_pid_t
;

30 #i‚de‡
__kî√l_ùc_pid_t


31 
	t__kî√l_ùc_pid_t
;

34 #i‚de‡
__kî√l_uid_t


35 
	t__kî√l_uid_t
;

36 
	t__kî√l_gid_t
;

39 #i‚de‡
__kî√l_su£c⁄ds_t


40 
__kî√l_l⁄g_t
 
	t__kî√l_su£c⁄ds_t
;

43 #i‚de‡
__kî√l_daddr_t


44 
	t__kî√l_daddr_t
;

47 #i‚de‡
__kî√l_uid32_t


48 
	t__kî√l_uid32_t
;

49 
	t__kî√l_gid32_t
;

52 #i‚de‡
__kî√l_ﬁd_uid_t


53 
__kî√l_uid_t
 
	t__kî√l_ﬁd_uid_t
;

54 
__kî√l_gid_t
 
	t__kî√l_ﬁd_gid_t
;

57 #i‚de‡
__kî√l_ﬁd_dev_t


58 
	t__kî√l_ﬁd_dev_t
;

65 #i‚de‡
__kî√l_size_t


66 #i‡
__BITS_PER_LONG
 != 64

67 
	t__kî√l_size_t
;

68 
	t__kî√l_ssize_t
;

69 
	t__kî√l_±rdiff_t
;

71 
__kî√l_ul⁄g_t
 
	t__kî√l_size_t
;

72 
__kî√l_l⁄g_t
 
	t__kî√l_ssize_t
;

73 
__kî√l_l⁄g_t
 
	t__kî√l_±rdiff_t
;

77 #i‚de‡
__kî√l_fsid_t


79 
	mvÆ
[2];

80 } 
	t__kî√l_fsid_t
;

86 
__kî√l_l⁄g_t
 
	t__kî√l_off_t
;

87 
	t__kî√l_loff_t
;

88 
__kî√l_l⁄g_t
 
	t__kî√l_time_t
;

89 
__kî√l_l⁄g_t
 
	t__kî√l_˛ock_t
;

90 
	t__kî√l_timî_t
;

91 
	t__kî√l_˛ockid_t
;

92 * 
	t__kî√l_ˇddr_t
;

93 
	t__kî√l_uid16_t
;

94 
	t__kî√l_gid16_t
;

	@/usr/include/asm/bitsperlong.h

1 #i‚de‡
__ASM_X86_BITSPERLONG_H


2 
	#__ASM_X86_BITSPERLONG_H


	)

4 #ifde‡
__x86_64__


5 
	#__BITS_PER_LONG
 64

	)

7 
	#__BITS_PER_LONG
 32

	)

10 
	~<asm-gíîic/bô•îl⁄g.h
>

	@/usr/include/bits/byteswap.h

19 #i‡!
deföed
 
_BYTESWAP_H
 && !deföed 
_NETINET_IN_H
 && !deföed 
_ENDIAN_H


23 #i‚de‡
_BITS_BYTESWAP_H


24 
	#_BITS_BYTESWAP_H
 1

	)

26 
	~<„©uªs.h
>

27 
	~<bôs/ty≥s.h
>

28 
	~<bôs/w‹dsize.h
>

31 
	#__bsw≠_c⁄°™t_16
(
x
) \

32 ((Ë((((
x
Ë>> 8Ë& 0xffË| (((xË& 0xffË<< 8)))

	)

35 
	~<bôs/byãsw≠-16.h
>

38 
	#__bsw≠_c⁄°™t_32
(
x
) \

39 ((((
x
) & 0xff000000) >> 24) | (((x) & 0x00ff0000) >> 8) | \

40 (((
x
Ë& 0x0000ff00Ë<< 8Ë| (((xË& 0x000000ffË<< 24))

	)

42 #ifde‡
__GNUC__


43 #i‡
__GNUC_PREREQ
 (4, 3)

44 
__ölöe
 

45 
	$__bsw≠_32
 (
__bsx
)

47  
	`__buûtö_bsw≠32
 (
__bsx
);

48 
	}
}

49 #ñi‡
__GNUC__
 >= 2

50 #i‡
__WORDSIZE
 =64 || (
deföed
 
__i486__
 || deföed 
__≥¡ium__
 \

51 || 
deföed
 
	g__≥¡ium¥o__
 || deföed 
	g__≥¡ium4__
 \

52 || 
deföed
 
	g__k8__
 || deföed 
	g__©hl⁄__
 \

53 || 
deföed
 
	g__k6__
 || deföed 
	g__noc⁄a__
 \

54 || 
deföed
 
	g__c‹e2__
 || deföed 
	g__geode__
 \

55 || 
deföed
 
	g__amdÁm10__
)

58 
	#__bsw≠_32
(
x
) \

59 (
__exãnsi⁄__
 \

60 ({ 
__v
, 
__x
 = (
x
); \

61 i‡(
	`__buûtö_c⁄°™t_p
 (
__x
)) \

62 
__v
 = 
	`__bsw≠_c⁄°™t_32
 (
__x
); \

64 
	`__asm__
 ("bsw≠ %0" : "Ù" (
__v
Ë: "0" (
__x
)); \

65 
__v
; }))

	)

67 
	#__bsw≠_32
(
x
) \

68 (
__exãnsi⁄__
 \

69 ({ 
__v
, 
__x
 = (
x
); \

70 i‡(
	`__buûtö_c⁄°™t_p
 (
__x
)) \

71 
__v
 = 
	`__bsw≠_c⁄°™t_32
 (
__x
); \

73 
	`__asm__
 ("rorw $8, %w0;" \

76 : "Ù" (
__v
) \

77 : "0" (
__x
) \

79 
__v
; }))

	)

82 
	#__bsw≠_32
(
x
) \

83 (
__exãnsi⁄__
 \

84 ({ 
__x
 = (
x
); 
	`__bsw≠_c⁄°™t_32
 (__x); }))

	)

87 
__ölöe
 

88 
	$__bsw≠_32
 (
__bsx
)

90  
	`__bsw≠_c⁄°™t_32
 (
__bsx
);

91 
	}
}

95 #i‡
__GNUC_PREREQ
 (2, 0)

97 
	#__bsw≠_c⁄°™t_64
(
x
) \

98 (
	`__exãnsi⁄__
 ((((
x
) & 0xff00000000000000ull) >> 56) \

99 | (((
x
) & 0x00ff000000000000ull) >> 40) \

100 | (((
x
) & 0x0000ff0000000000ull) >> 24) \

101 | (((
x
) & 0x000000ff00000000ull) >> 8) \

102 | (((
x
) & 0x00000000ff000000ull) << 8) \

103 | (((
x
) & 0x0000000000ff0000ull) << 24) \

104 | (((
x
) & 0x000000000000ff00ull) << 40) \

105 | (((
x
Ë& 0x00000000000000ffuŒË<< 56)))

	)

107 #i‡
__GNUC_PREREQ
 (4, 3)

108 
__ölöe
 
__uöt64_t


109 
	$__bsw≠_64
 (
__uöt64_t
 
__bsx
)

111  
	`__buûtö_bsw≠64
 (
__bsx
);

112 
	}
}

113 #ñi‡
__WORDSIZE
 == 64

114 
	#__bsw≠_64
(
x
) \

115 (
__exãnsi⁄__
 \

116 ({ 
__uöt64_t
 
__v
, 
__x
 = (
x
); \

117 i‡(
	`__buûtö_c⁄°™t_p
 (
__x
)) \

118 
__v
 = 
	`__bsw≠_c⁄°™t_64
 (
__x
); \

120 
	`__asm__
 ("bsw≠ %q0" : "Ù" (
__v
Ë: "0" (
__x
)); \

121 
__v
; }))

	)

123 
	#__bsw≠_64
(
x
) \

124 (
__exãnsi⁄__
 \

125 ({ uni⁄ { 
__exãnsi⁄__
 
__uöt64_t
 
__Œ
; \

126 
__l
[2]; } 
__w
, 
__r
; \

127 i‡(
	`__buûtö_c⁄°™t_p
 (
x
)) \

128 
__r
.
__Œ
 = 
	`__bsw≠_c⁄°™t_64
 (
x
); \

131 
__w
.
__Œ
 = (
x
); \

132 
__r
.
__l
[0] = 
	`__bsw≠_32
 (
__w
.__l[1]); \

133 
__r
.
__l
[1] = 
	`__bsw≠_32
 (
__w
.__l[0]); \

135 
__r
.
__Œ
; }))

	)

137 #ñi‡
__GLIBC_HAVE_LONG_LONG


138 
	#__bsw≠_c⁄°™t_64
(
x
) \

139 ((((
x
) & 0xff00000000000000ull) >> 56) \

140 | (((
x
) & 0x00ff000000000000ull) >> 40) \

141 | (((
x
) & 0x0000ff0000000000ull) >> 24) \

142 | (((
x
) & 0x000000ff00000000ull) >> 8) \

143 | (((
x
) & 0x00000000ff000000ull) << 8) \

144 | (((
x
) & 0x0000000000ff0000ull) << 24) \

145 | (((
x
) & 0x000000000000ff00ull) << 40) \

146 | (((
x
Ë& 0x00000000000000ffuŒË<< 56))

	)

148 
__ölöe
 
__uöt64_t


149 
	$__bsw≠_64
 (
__uöt64_t
 
__bsx
)

151  
	`__bsw≠_c⁄°™t_64
 (
__bsx
);

152 
	}
}

	@/usr/include/bits/endian.h

3 #i‚de‡
_ENDIAN_H


7 
	#__BYTE_ORDER
 
__LITTLE_ENDIAN


	)

	@/usr/include/bits/stdlib-float.h

19 #i‚de‡
_STDLIB_H


23 #ifde‡
__USE_EXTERN_INLINES


24 
__BEGIN_NAMESPACE_STD


25 
__exã∫_ölöe
 

26 
__NTH
 (
	$©of
 (c⁄° *
__≈å
))

28  
	`°πod
 (
__≈å
, (**Ë
NULL
);

29 
	}
}

30 
	g__END_NAMESPACE_STD


	@/usr/include/bits/stdlib-ldbl.h

19 #i‚de‡
_STDLIB_H


23 #ifdef 
__USE_ISOC99


24 
__BEGIN_NAMESPACE_C99


25 
	$__LDBL_REDIR1_DECL
 (
°πﬁd
, 
°πod
)

26 
__END_NAMESPACE_C99


29 #ifde‡
__USE_GNU


30 
	$__LDBL_REDIR1_DECL
 (
°πﬁd_l
, 
°πod_l
)

33 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN_EXTENDED


34 #ifde‡
__USE_MISC


35 
	$__LDBL_REDIR1_DECL
 (
qecvt
, 
ecvt
)

36 
	$__LDBL_REDIR1_DECL
 (
qfcvt
, 
fcvt
)

37 
	$__LDBL_REDIR1_DECL
 (
qgcvt
, 
gcvt
)

38 
	$__LDBL_REDIR1_DECL
 (
qecvt_r
, 
ecvt_r
)

39 
	$__LDBL_REDIR1_DECL
 (
qfcvt_r
, 
fcvt_r
)

	@/usr/include/bits/stdlib.h

19 #i‚de‡
_STDLIB_H


23 *
	$__ªÆ∑th_chk
 (c⁄° *
__ª°ri˘
 
__«me
,

24 *
__ª°ri˘
 
__ªsﬁved
,

25 
size_t
 
__ªsﬁvedÀn
Ë
__THROW
 
__wur
;

26 *
	`__REDIRECT_NTH
 (
__ªÆ∑th_Æüs
,

27 (c⁄° *
__ª°ri˘
 
__«me
,

28 *
__ª°ri˘
 
__ªsﬁved
), 
ªÆ∑th
Ë
__wur
;

29 *
	`__REDIRECT_NTH
 (
__ªÆ∑th_chk_w¨n
,

30 (c⁄° *
__ª°ri˘
 
__«me
,

31 *
__ª°ri˘
 
__ªsﬁved
,

32 
size_t
 
__ªsﬁvedÀn
), 
__ªÆ∑th_chk
Ë
__wur


33 
	`__w¨«âr
 ("secondárgument ofÑealpath must beÉither NULL orát "

36 
__f‹tify_fun˘i⁄
 
__wur
 *

37 
	`__NTH
 (
	$ªÆ∑th
 (c⁄° *
__ª°ri˘
 
__«me
, *__ª°ri˘ 
__ªsﬁved
))

39 i‡(
	`__bos
 (
__ªsﬁved
Ë!(
size_t
) -1)

41 #i‡
deföed
 
_LIBC_LIMITS_H_
 && deföed 
PATH_MAX


42 i‡(
	`__bos
 (
__ªsﬁved
Ë< 
PATH_MAX
)

43  
	`__ªÆ∑th_chk_w¨n
 (
__«me
, 
__ªsﬁved
, 
	`__bos
 (__resolved));

45  
	`__ªÆ∑th_chk
 (
__«me
, 
__ªsﬁved
, 
	`__bos
 (__resolved));

48  
	`__ªÆ∑th_Æüs
 (
__«me
, 
__ªsﬁved
);

49 
	}
}

52 
	$__±¢ame_r_chk
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
,

53 
size_t
 
__ƒól
Ë
__THROW
 
	`__n⁄nuŒ
 ((2));

54 
	`__REDIRECT_NTH
 (
__±¢ame_r_Æüs
, (
__fd
, *
__buf
,

55 
size_t
 
__buÊí
), 
±¢ame_r
)

56 
	`__n⁄nuŒ
 ((2));

57 
	`__REDIRECT_NTH
 (
__±¢ame_r_chk_w¨n
,

58 (
__fd
, *
__buf
, 
size_t
 
__buÊí
,

59 
size_t
 
__ƒól
), 
__±¢ame_r_chk
)

60 
	`__n⁄nuŒ
 ((2)Ë
	`__w¨«âr
 ("ptsname_r called with buflen biggerÅhan "

63 
__f‹tify_fun˘i⁄
 

64 
	`__NTH
 (
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buÊí
))

66 i‡(
	`__bos
 (
__buf
Ë!(
size_t
) -1)

68 i‡(!
	`__buûtö_c⁄°™t_p
 (
__buÊí
))

69  
	`__±¢ame_r_chk
 (
__fd
, 
__buf
, 
__buÊí
, 
	`__bos
 (__buf));

70 i‡(
__buÊí
 > 
	`__bos
 (
__buf
))

71  
	`__±¢ame_r_chk_w¨n
 (
__fd
, 
__buf
, 
__buÊí
, 
	`__bos
 (__buf));

73  
	`__±¢ame_r_Æüs
 (
__fd
, 
__buf
, 
__buÊí
);

74 
	}
}

77 
	$__w˘omb_chk
 (*
__s
, 
wch¨_t
 
__wch¨
, 
size_t
 
__buÊí
)

78 
__THROW
 
__wur
;

79 
	`__REDIRECT_NTH
 (
__w˘omb_Æüs
, (*
__s
, 
wch¨_t
 
__wch¨
),

80 
w˘omb
Ë
__wur
;

82 
__f‹tify_fun˘i⁄
 
__wur
 

83 
	`__NTH
 (
	$w˘omb
 (*
__s
, 
wch¨_t
 
__wch¨
))

88 
	#__STDLIB_MB_LEN_MAX
 16

	)

89 #i‡
deföed
 
MB_LEN_MAX
 && MB_LEN_MAX !
__STDLIB_MB_LEN_MAX


92 i‡(
	`__bos
 (
__s
Ë!(
size_t
Ë-1 && 
__STDLIB_MB_LEN_MAX
 > __bos (__s))

93  
	`__w˘omb_chk
 (
__s
, 
__wch¨
, 
	`__bos
 (__s));

94  
	`__w˘omb_Æüs
 (
__s
, 
__wch¨
);

95 
	}
}

98 
size_t
 
	$__mb°owcs_chk
 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

99 c⁄° *
__ª°ri˘
 
__§c
,

100 
size_t
 
__Àn
, size_à
__d°Àn
Ë
__THROW
;

101 
size_t
 
	`__REDIRECT_NTH
 (
__mb°owcs_Æüs
,

102 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

103 c⁄° *
__ª°ri˘
 
__§c
,

104 
size_t
 
__Àn
), 
mb°owcs
);

105 
size_t
 
	`__REDIRECT_NTH
 (
__mb°owcs_chk_w¨n
,

106 (
wch¨_t
 *
__ª°ri˘
 
__d°
,

107 c⁄° *
__ª°ri˘
 
__§c
,

108 
size_t
 
__Àn
, size_à
__d°Àn
), 
__mb°owcs_chk
)

109 
	`__w¨«âr
 ("mbstowcs called with dst buffer smallerÅhanÜen "

112 
__f‹tify_fun˘i⁄
 
size_t


113 
	`__NTH
 (
	$mb°owcs
 (
wch¨_t
 *
__ª°ri˘
 
__d°
, c⁄° *__ª°ri˘ 
__§c
,

114 
size_t
 
__Àn
))

116 i‡(
	`__bos
 (
__d°
Ë!(
size_t
) -1)

118 i‡(!
	`__buûtö_c⁄°™t_p
 (
__Àn
))

119  
	`__mb°owcs_chk
 (
__d°
, 
__§c
, 
__Àn
,

120 
	`__bos
 (
__d°
Ë/  (
wch¨_t
));

122 i‡(
__Àn
 > 
	`__bos
 (
__d°
Ë/  (
wch¨_t
))

123  
	`__mb°owcs_chk_w¨n
 (
__d°
, 
__§c
, 
__Àn
,

124 
	`__bos
 (
__d°
Ë/  (
wch¨_t
));

126  
	`__mb°owcs_Æüs
 (
__d°
, 
__§c
, 
__Àn
);

127 
	}
}

130 
size_t
 
	$__wc°ombs_chk
 (*
__ª°ri˘
 
__d°
,

131 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
,

132 
size_t
 
__Àn
, size_à
__d°Àn
Ë
__THROW
;

133 
size_t
 
	`__REDIRECT_NTH
 (
__wc°ombs_Æüs
,

134 (*
__ª°ri˘
 
__d°
,

135 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
,

136 
size_t
 
__Àn
), 
wc°ombs
);

137 
size_t
 
	`__REDIRECT_NTH
 (
__wc°ombs_chk_w¨n
,

138 (*
__ª°ri˘
 
__d°
,

139 c⁄° 
wch¨_t
 *
__ª°ri˘
 
__§c
,

140 
size_t
 
__Àn
, size_à
__d°Àn
), 
__wc°ombs_chk
)

141 
	`__w¨«âr
 ("wcstombs called with dst buffer smallerÅhanÜen");

143 
__f‹tify_fun˘i⁄
 
size_t


144 
	`__NTH
 (
	$wc°ombs
 (*
__ª°ri˘
 
__d°
, c⁄° 
wch¨_t
 *__ª°ri˘ 
__§c
,

145 
size_t
 
__Àn
))

147 i‡(
	`__bos
 (
__d°
Ë!(
size_t
) -1)

149 i‡(!
	`__buûtö_c⁄°™t_p
 (
__Àn
))

150  
	`__wc°ombs_chk
 (
__d°
, 
__§c
, 
__Àn
, 
	`__bos
 (__dst));

151 i‡(
__Àn
 > 
	`__bos
 (
__d°
))

152  
	`__wc°ombs_chk_w¨n
 (
__d°
, 
__§c
, 
__Àn
, 
	`__bos
 (__dst));

154  
	`__wc°ombs_Æüs
 (
__d°
, 
__§c
, 
__Àn
);

155 
	}
}

	@/usr/include/bits/typesizes.h

19 #i‚de‡
_BITS_TYPES_H


23 #i‚def 
_BITS_TYPESIZES_H


24 
	#_BITS_TYPESIZES_H
 1

	)

30 #i‡
deföed
 
__x86_64__
 && deföed 
__ILP32__


31 
	#__SYSCALL_SLONG_TYPE
 
__SQUAD_TYPE


	)

32 
	#__SYSCALL_ULONG_TYPE
 
__UQUAD_TYPE


	)

34 
	#__SYSCALL_SLONG_TYPE
 
__SLONGWORD_TYPE


	)

35 
	#__SYSCALL_ULONG_TYPE
 
__ULONGWORD_TYPE


	)

38 
	#__DEV_T_TYPE
 
__UQUAD_TYPE


	)

39 
	#__UID_T_TYPE
 
__U32_TYPE


	)

40 
	#__GID_T_TYPE
 
__U32_TYPE


	)

41 
	#__INO_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

42 
	#__INO64_T_TYPE
 
__UQUAD_TYPE


	)

43 
	#__MODE_T_TYPE
 
__U32_TYPE


	)

44 #ifde‡
__x86_64__


45 
	#__NLINK_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

46 
	#__FSWORD_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

48 
	#__NLINK_T_TYPE
 
__UWORD_TYPE


	)

49 
	#__FSWORD_T_TYPE
 
__SWORD_TYPE


	)

51 
	#__OFF_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

52 
	#__OFF64_T_TYPE
 
__SQUAD_TYPE


	)

53 
	#__PID_T_TYPE
 
__S32_TYPE


	)

54 
	#__RLIM_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

55 
	#__RLIM64_T_TYPE
 
__UQUAD_TYPE


	)

56 
	#__BLKCNT_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

57 
	#__BLKCNT64_T_TYPE
 
__SQUAD_TYPE


	)

58 
	#__FSBLKCNT_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

59 
	#__FSBLKCNT64_T_TYPE
 
__UQUAD_TYPE


	)

60 
	#__FSFILCNT_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

61 
	#__FSFILCNT64_T_TYPE
 
__UQUAD_TYPE


	)

62 
	#__ID_T_TYPE
 
__U32_TYPE


	)

63 
	#__CLOCK_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

64 
	#__TIME_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

65 
	#__USECONDS_T_TYPE
 
__U32_TYPE


	)

66 
	#__SUSECONDS_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

67 
	#__DADDR_T_TYPE
 
__S32_TYPE


	)

68 
	#__KEY_T_TYPE
 
__S32_TYPE


	)

69 
	#__CLOCKID_T_TYPE
 
__S32_TYPE


	)

70 
	#__TIMER_T_TYPE
 *

	)

71 
	#__BLKSIZE_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

72 
	#__FSID_T_TYPE
 såu˘ { 
__vÆ
[2]; }

	)

73 
	#__SSIZE_T_TYPE
 
__SWORD_TYPE


	)

75 #ifde‡
__x86_64__


79 
	#__OFF_T_MATCHES_OFF64_T
 1

	)

82 
	#__INO_T_MATCHES_INO64_T
 1

	)

86 
	#__FD_SETSIZE
 1024

	)

	@/usr/include/bits/waitflags.h

19 #i‡!
deföed
 
_SYS_WAIT_H
 && !deföed 
_STDLIB_H


25 
	#WNOHANG
 1

	)

26 
	#WUNTRACED
 2

	)

29 
	#WSTOPPED
 2

	)

30 
	#WEXITED
 4

	)

31 
	#WCONTINUED
 8

	)

32 
	#WNOWAIT
 0x01000000

	)

34 
	#__WNOTHREAD
 0x20000000

	)

36 
	#__WALL
 0x40000000

	)

37 
	#__WCLONE
 0x80000000

	)

	@/usr/include/bits/waitstatus.h

19 #i‡!
deföed
 
_SYS_WAIT_H
 && !deföed 
_STDLIB_H


28 
	#__WEXITSTATUS
(
°©us
Ë(((°©usË& 0xff00Ë>> 8)

	)

31 
	#__WTERMSIG
(
°©us
Ë((°©usË& 0x7f)

	)

34 
	#__WSTOPSIG
(
°©us
Ë
	`__WEXITSTATUS
(°©us)

	)

37 
	#__WIFEXITED
(
°©us
Ë(
	`__WTERMSIG
(°©usË=0)

	)

40 
	#__WIFSIGNALED
(
°©us
) \

41 (((sig√d Ë(((
°©us
Ë& 0x7fË+ 1Ë>> 1Ë> 0)

	)

44 
	#__WIFSTOPPED
(
°©us
Ë(((°©usË& 0xffË=0x7f)

	)

48 #ifde‡
WCONTINUED


49 
	#__WIFCONTINUED
(
°©us
Ë((°©usË=
__W_CONTINUED
)

	)

53 
	#__WCOREDUMP
(
°©us
Ë((°©usË& 
__WCOREFLAG
)

	)

56 
	#__W_EXITCODE
(
ªt
, 
sig
Ë(‘ëË<< 8 | (sig))

	)

57 
	#__W_STOPCODE
(
sig
Ë((sigË<< 8 | 0x7f)

	)

58 
	#__W_CONTINUED
 0xffff

	)

59 
	#__WCOREFLAG
 0x80

	)

62 #ifdef 
__USE_BSD


64 
	~<ídün.h
>

66 
	uwaô


68 
	mw_°©us
;

71 #if 
__BYTE_ORDER
 =
__LITTLE_ENDIAN


72 
	m__w_ãrmsig
:7;

73 
	m__w_c‹edump
:1;

74 
	m__w_ªtcode
:8;

77 #if 
__BYTE_ORDER
 =
__BIG_ENDIAN


79 
	m__w_ªtcode
:8;

80 
	m__w_c‹edump
:1;

81 
	m__w_ãrmsig
:7;

83 } 
	m__waô_ãrmö©ed
;

86 #if 
__BYTE_ORDER
 =
__LITTLE_ENDIAN


87 
	m__w_°›vÆ
:8;

88 
	m__w_°›sig
:8;

91 #if 
__BYTE_ORDER
 =
__BIG_ENDIAN


93 
	m__w_°›sig
:8;

94 
	m__w_°›vÆ
:8;

96 } 
	m__waô_°›≥d
;

99 
	#w_ãrmsig
 
__waô_ãrmö©ed
.
__w_ãrmsig


	)

100 
	#w_c‹edump
 
__waô_ãrmö©ed
.
__w_c‹edump


	)

101 
	#w_ªtcode
 
__waô_ãrmö©ed
.
__w_ªtcode


	)

102 
	#w_°›sig
 
__waô_°›≥d
.
__w_°›sig


	)

103 
	#w_°›vÆ
 
__waô_°›≥d
.
__w_°›vÆ


	)

	@/usr/include/bits/wordsize.h

3 #i‡
deföed
 
__x86_64__
 && !deföed 
__ILP32__


4 
	#__WORDSIZE
 64

	)

6 
	#__WORDSIZE
 32

	)

9 #ifde‡
__x86_64__


10 
	#__WORDSIZE_TIME64_COMPAT32
 1

	)

12 
	#__SYSCALL_WORDSIZE
 64

	)

	@/usr/include/gnu/stubs-64.h

6 #ifde‡
_LIBC


7 #îr‹ 
Aµliˇti⁄s
 
may
 
nŸ
 
deföe
 
the
 
ma¸o
 
_LIBC


10 
	#__°ub_bdÊush


	)

11 
	#__°ub_chÊags


	)

12 
	#__°ub_Áâach


	)

13 
	#__°ub_fchÊags


	)

14 
	#__°ub_fdëach


	)

15 
	#__°ub_gëmsg


	)

16 
	#__°ub_gây


	)

17 
	#__°ub_lchmod


	)

18 
	#__°ub_putmsg


	)

19 
	#__°ub_ªvoke


	)

20 
	#__°ub_£éogö


	)

21 
	#__°ub_sigªtu∫


	)

22 
	#__°ub_s°k


	)

23 
	#__°ub_°ty


	)

	@/usr/include/sys/types.h

22 #i‚def 
_SYS_TYPES_H


23 
	#_SYS_TYPES_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


29 
	~<bôs/ty≥s.h
>

31 #ifdef 
__USE_BSD


32 #i‚de‡
__u_ch¨_deföed


33 
__u_ch¨
 
	tu_ch¨
;

34 
__u_sh‹t
 
	tu_sh‹t
;

35 
__u_öt
 
	tu_öt
;

36 
__u_l⁄g
 
	tu_l⁄g
;

37 
__quad_t
 
	tquad_t
;

38 
__u_quad_t
 
	tu_quad_t
;

39 
__fsid_t
 
	tfsid_t
;

40 
	#__u_ch¨_deföed


	)

44 
__loff_t
 
	tloff_t
;

46 #i‚de‡
__öo_t_deföed


47 #i‚de‡
__USE_FILE_OFFSET64


48 
__öo_t
 
	töo_t
;

50 
__öo64_t
 
	töo_t
;

52 
	#__öo_t_deföed


	)

54 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__öo64_t_deföed


55 
__öo64_t
 
	töo64_t
;

56 
	#__öo64_t_deföed


	)

59 #i‚de‡
__dev_t_deföed


60 
__dev_t
 
	tdev_t
;

61 
	#__dev_t_deföed


	)

64 #i‚de‡
__gid_t_deföed


65 
__gid_t
 
	tgid_t
;

66 
	#__gid_t_deföed


	)

69 #i‚de‡
__mode_t_deföed


70 
__mode_t
 
	tmode_t
;

71 
	#__mode_t_deföed


	)

74 #i‚de‡
__∆ök_t_deföed


75 
__∆ök_t
 
	t∆ök_t
;

76 
	#__∆ök_t_deföed


	)

79 #i‚de‡
__uid_t_deföed


80 
__uid_t
 
	tuid_t
;

81 
	#__uid_t_deföed


	)

84 #i‚de‡
__off_t_deföed


85 #i‚de‡
__USE_FILE_OFFSET64


86 
__off_t
 
	toff_t
;

88 
__off64_t
 
	toff_t
;

90 
	#__off_t_deföed


	)

92 #i‡
deföed
 
__USE_LARGEFILE64
 && !deföed 
__off64_t_deföed


93 
__off64_t
 
	toff64_t
;

94 
	#__off64_t_deföed


	)

97 #i‚de‡
__pid_t_deföed


98 
__pid_t
 
	tpid_t
;

99 
	#__pid_t_deföed


	)

102 #i‡(
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8
) \

103 && !
deföed
 
__id_t_deföed


104 
__id_t
 
	tid_t
;

105 
	#__id_t_deföed


	)

108 #i‚de‡
__ssize_t_deföed


109 
__ssize_t
 
	tssize_t
;

110 
	#__ssize_t_deföed


	)

113 #ifdef 
__USE_BSD


114 #i‚de‡
__daddr_t_deföed


115 
__daddr_t
 
	tdaddr_t
;

116 
__ˇddr_t
 
	tˇddr_t
;

117 
	#__daddr_t_deföed


	)

121 #i‡(
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN
Ë&& !deföed 
__key_t_deföed


122 
__key_t
 
	tkey_t
;

123 
	#__key_t_deföed


	)

126 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_XOPEN2K8


127 
	#__√ed_˛ock_t


	)

129 
	#__√ed_time_t


	)

130 
	#__√ed_timî_t


	)

131 
	#__√ed_˛ockid_t


	)

132 
	~<time.h
>

134 #ifde‡
__USE_XOPEN


135 #i‚de‡
__u£c⁄ds_t_deföed


136 
__u£c⁄ds_t
 
	tu£c⁄ds_t
;

137 
	#__u£c⁄ds_t_deföed


	)

139 #i‚de‡
__su£c⁄ds_t_deföed


140 
__su£c⁄ds_t
 
	tsu£c⁄ds_t
;

141 
	#__su£c⁄ds_t_deföed


	)

145 
	#__√ed_size_t


	)

146 
	~<°ddef.h
>

148 #ifde‡
__USE_MISC


150 
	tul⁄g
;

151 
	tush‹t
;

152 
	tuöt
;

157 #i‡!
__GNUC_PREREQ
 (2, 7)

160 #i‚de‡
__öt8_t_deföed


161 
	#__öt8_t_deföed


	)

162 
	töt8_t
;

163 
	töt16_t
;

164 
	töt32_t
;

165 #i‡
__WORDSIZE
 == 64

166 
	töt64_t
;

167 #ñi‡
__GLIBC_HAVE_LONG_LONG


168 
__exãnsi⁄__
 
	töt64_t
;

173 
	tu_öt8_t
;

174 
	tu_öt16_t
;

175 
	tu_öt32_t
;

176 #i‡
__WORDSIZE
 == 64

177 
	tu_öt64_t
;

178 #ñi‡
__GLIBC_HAVE_LONG_LONG


179 
__exãnsi⁄__
 
	tu_öt64_t
;

182 
	tªgi°î_t
;

187 
	#__ötN_t
(
N
, 
MODE
) \

188 ##
	tN
##
	t_t
 
	t__©åibuã__
 ((
	t__mode__
 (
	tMODE
)))

	)

189 
	t__u_ötN_t
(
	tN
, 
	tMODE
) \

190 
	tu_öt
##
	tN
##
	t_t
 
	t__©åibuã__
 ((
	t__mode__
 (
	tMODE
)))

	)

192 #i‚de‡
	t__öt8_t_deföed


193 
	t__öt8_t_deföed


	)

194 
	t__ötN_t
 (8, 
	t__QI__
);

195 
__ötN_t
 (16, 
__HI__
);

196 
__ötN_t
 (32, 
__SI__
);

197 
__ötN_t
 (64, 
__DI__
);

200 
__u_ötN_t
 (8, 
__QI__
);

201 
__u_ötN_t
 (16, 
__HI__
);

202 
__u_ötN_t
 (32, 
__SI__
);

203 
__u_ötN_t
 (64, 
__DI__
);

205 
	tªgi°î_t
 
	t__©åibuã__
 ((
	t__mode__
 (
	t__w‹d__
)));

211 
	#__BIT_TYPES_DEFINED__
 1

	)

214 #ifdef 
__USE_BSD


216 
	~<ídün.h
>

219 
	~<sys/£À˘.h
>

222 
	~<sys/sysma¸os.h
>

226 #i‡(
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K8
) \

227 && !
deföed
 
__blksize_t_deföed


228 
__blksize_t
 
	tblksize_t
;

229 
	#__blksize_t_deföed


	)

233 #i‚de‡
__USE_FILE_OFFSET64


234 #i‚de‡
__blk˙t_t_deföed


235 
__blk˙t_t
 
	tblk˙t_t
;

236 
	#__blk˙t_t_deföed


	)

238 #i‚de‡
__fsblk˙t_t_deföed


239 
__fsblk˙t_t
 
	tfsblk˙t_t
;

240 
	#__fsblk˙t_t_deföed


	)

242 #i‚de‡
__fsfû˙t_t_deföed


243 
__fsfû˙t_t
 
	tfsfû˙t_t
;

244 
	#__fsfû˙t_t_deföed


	)

247 #i‚de‡
__blk˙t_t_deföed


248 
__blk˙t64_t
 
	tblk˙t_t
;

249 
	#__blk˙t_t_deföed


	)

251 #i‚de‡
__fsblk˙t_t_deföed


252 
__fsblk˙t64_t
 
	tfsblk˙t_t
;

253 
	#__fsblk˙t_t_deföed


	)

255 #i‚de‡
__fsfû˙t_t_deföed


256 
__fsfû˙t64_t
 
	tfsfû˙t_t
;

257 
	#__fsfû˙t_t_deföed


	)

261 #ifde‡
__USE_LARGEFILE64


262 
__blk˙t64_t
 
	tblk˙t64_t
;

263 
__fsblk˙t64_t
 
	tfsblk˙t64_t
;

264 
__fsfû˙t64_t
 
	tfsfû˙t64_t
;

269 #i‡
deföed
 
__USE_POSIX199506
 || deföed 
__USE_UNIX98


270 
	~<bôs/±hªadty≥s.h
>

273 
	g__END_DECLS


	@/usr/include/asm-generic/bitsperlong.h

1 #i‚de‡
__ASM_GENERIC_BITS_PER_LONG


2 
	#__ASM_GENERIC_BITS_PER_LONG


	)

11 #i‚de‡
__BITS_PER_LONG


12 
	#__BITS_PER_LONG
 32

	)

	@/usr/include/bits/byteswap-16.h

19 #i‚de‡
_BITS_BYTESWAP_H


23 #ifde‡
__GNUC__


24 #i‡
__GNUC__
 >= 2

25 
	#__bsw≠_16
(
x
) \

26 (
__exãnsi⁄__
 \

27 ({ 
__v
, 
__x
 = (Ë(
x
); \

28 i‡(
	`__buûtö_c⁄°™t_p
 (
__x
)) \

29 
__v
 = 
	`__bsw≠_c⁄°™t_16
 (
__x
); \

31 
	`__asm__
 ("rorw $8, %w0" \

32 : "Ù" (
__v
) \

33 : "0" (
__x
) \

35 
__v
; }))

	)

38 
	#__bsw≠_16
(
x
) \

39 (
__exãnsi⁄__
 \

40 ({ 
__x
 = (Ë(
x
); \

41 
	`__bsw≠_c⁄°™t_16
 (
__x
); }))

	)

44 
__ölöe
 

45 
	$__bsw≠_16
 (
__bsx
)

47  
	`__bsw≠_c⁄°™t_16
 (
__bsx
);

48 
	}
}

	@/usr/include/bits/pthreadtypes.h

18 #i‚de‡
_BITS_PTHREADTYPES_H


19 
	#_BITS_PTHREADTYPES_H
 1

	)

21 
	~<bôs/w‹dsize.h
>

23 #ifde‡
__x86_64__


24 #i‡
__WORDSIZE
 == 64

25 
	#__SIZEOF_PTHREAD_ATTR_T
 56

	)

26 
	#__SIZEOF_PTHREAD_MUTEX_T
 40

	)

27 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

28 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

29 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

30 
	#__SIZEOF_PTHREAD_RWLOCK_T
 56

	)

31 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

32 
	#__SIZEOF_PTHREAD_BARRIER_T
 32

	)

33 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

35 
	#__SIZEOF_PTHREAD_ATTR_T
 32

	)

36 
	#__SIZEOF_PTHREAD_MUTEX_T
 32

	)

37 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

38 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

39 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

40 
	#__SIZEOF_PTHREAD_RWLOCK_T
 44

	)

41 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

42 
	#__SIZEOF_PTHREAD_BARRIER_T
 20

	)

43 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

46 
	#__SIZEOF_PTHREAD_ATTR_T
 36

	)

47 
	#__SIZEOF_PTHREAD_MUTEX_T
 24

	)

48 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

49 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

50 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

51 
	#__SIZEOF_PTHREAD_RWLOCK_T
 32

	)

52 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

53 
	#__SIZEOF_PTHREAD_BARRIER_T
 20

	)

54 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

60 
	t±hªad_t
;

63 
	u±hªad_©å_t


65 
	m__size
[
__SIZEOF_PTHREAD_ATTR_T
];

66 
	m__Æign
;

68 #i‚de‡
__have_±hªad_©å_t


69 
±hªad_©å_t
 
	t±hªad_©å_t
;

70 
	#__have_±hªad_©å_t
 1

	)

74 #ifde‡
__x86_64__


75 
	s__±hªad_öã∫Æ_li°


77 
__±hªad_öã∫Æ_li°
 *
	m__¥ev
;

78 
__±hªad_öã∫Æ_li°
 *
	m__√xt
;

79 } 
	t__±hªad_li°_t
;

81 
	s__±hªad_öã∫Æ_¶i°


83 
__±hªad_öã∫Æ_¶i°
 *
	m__√xt
;

84 } 
	t__±hªad_¶i°_t
;

92 
	s__±hªad_muãx_s


94 
	m__lock
;

95 
	m__cou¡
;

96 
	m__ow√r
;

97 #ifde‡
__x86_64__


98 
	m__nu£rs
;

102 
	m__köd
;

103 #ifde‡
__x86_64__


104 
	m__•ös
;

105 
__±hªad_li°_t
 
	m__li°
;

106 
	#__PTHREAD_MUTEX_HAVE_PREV
 1

	)

108 
	m__nu£rs
;

109 
__exãnsi⁄__
 union

111 
	m__•ös
;

112 
__±hªad_¶i°_t
 
	m__li°
;

115 } 
	m__d©a
;

116 
	m__size
[
__SIZEOF_PTHREAD_MUTEX_T
];

117 
	m__Æign
;

118 } 
	t±hªad_muãx_t
;

122 
	m__size
[
__SIZEOF_PTHREAD_MUTEXATTR_T
];

123 
	m__Æign
;

124 } 
	t±hªad_muãx©å_t
;

133 
	m__lock
;

134 
	m__fuãx
;

135 
__exãnsi⁄__
 
	m__tŸÆ_£q
;

136 
__exãnsi⁄__
 
	m__wakeup_£q
;

137 
__exãnsi⁄__
 
	m__wokí_£q
;

138 *
	m__muãx
;

139 
	m__nwaôîs
;

140 
	m__brﬂdˇ°_£q
;

141 } 
	m__d©a
;

142 
	m__size
[
__SIZEOF_PTHREAD_COND_T
];

143 
__exãnsi⁄__
 
	m__Æign
;

144 } 
	t±hªad_c⁄d_t
;

148 
	m__size
[
__SIZEOF_PTHREAD_CONDATTR_T
];

149 
	m__Æign
;

150 } 
	t±hªad_c⁄d©å_t
;

154 
	t±hªad_key_t
;

158 
	t±hªad_⁄˚_t
;

161 #i‡
deföed
 
__USE_UNIX98
 || deföed 
__USE_XOPEN2K


166 #ifde‡
__x86_64__


169 
	m__lock
;

170 
	m__ƒ_ªadîs
;

171 
	m__ªadîs_wakeup
;

172 
	m__wrôî_wakeup
;

173 
	m__ƒ_ªadîs_queued
;

174 
	m__ƒ_wrôîs_queued
;

175 
	m__wrôî
;

176 
	m__sh¨ed
;

177 
	m__∑d1
;

178 
	m__∑d2
;

181 
	m__Êags
;

182 
	#__PTHREAD_RWLOCK_INT_FLAGS_SHARED
 1

	)

183 } 
	m__d©a
;

187 
	m__lock
;

188 
	m__ƒ_ªadîs
;

189 
	m__ªadîs_wakeup
;

190 
	m__wrôî_wakeup
;

191 
	m__ƒ_ªadîs_queued
;

192 
	m__ƒ_wrôîs_queued
;

195 
	m__Êags
;

196 
	m__sh¨ed
;

197 
	m__∑d1
;

198 
	m__∑d2
;

199 
	m__wrôî
;

200 } 
	m__d©a
;

202 
	m__size
[
__SIZEOF_PTHREAD_RWLOCK_T
];

203 
	m__Æign
;

204 } 
	t±hªad_rwlock_t
;

208 
	m__size
[
__SIZEOF_PTHREAD_RWLOCKATTR_T
];

209 
	m__Æign
;

210 } 
	t±hªad_rwlock©å_t
;

214 #ifde‡
__USE_XOPEN2K


216 vﬁ©ûê
	t±hªad_•ölock_t
;

223 
	m__size
[
__SIZEOF_PTHREAD_BARRIER_T
];

224 
	m__Æign
;

225 } 
	t±hªad_b¨rõr_t
;

229 
	m__size
[
__SIZEOF_PTHREAD_BARRIERATTR_T
];

230 
	m__Æign
;

231 } 
	t±hªad_b¨rõøâr_t
;

235 #i‚de‡
__x86_64__


237 
	#__˛ónup_f˘_©åibuã
 
	`__©åibuã__
 ((
	`__ªg∑rm__
 (1)))

	)

	@/usr/include/sys/select.h

21 #i‚de‡
_SYS_SELECT_H


22 
	#_SYS_SELECT_H
 1

	)

24 
	~<„©uªs.h
>

27 
	~<bôs/ty≥s.h
>

30 
	~<bôs/£À˘.h
>

33 
	~<bôs/sig£t.h
>

35 #i‚de‡
__sig£t_t_deföed


36 
	#__sig£t_t_deföed


	)

37 
__sig£t_t
 
	tsig£t_t
;

41 
	#__√ed_time_t


	)

42 
	#__√ed_time•ec


	)

43 
	~<time.h
>

44 
	#__√ed_timevÆ


	)

45 
	~<bôs/time.h
>

47 #i‚de‡
__su£c⁄ds_t_deföed


48 
__su£c⁄ds_t
 
	tsu£c⁄ds_t
;

49 
	#__su£c⁄ds_t_deföed


	)

54 
	t__fd_mask
;

57 #unde‡
__NFDBITS


59 
	#__NFDBITS
 (8 * (Ë (
__fd_mask
))

	)

60 
	#__FD_ELT
(
d
Ë((dË/ 
__NFDBITS
)

	)

61 
	#__FD_MASK
(
d
Ë((
__fd_mask
Ë1 << ((dË% 
__NFDBITS
))

	)

68 #ifde‡
__USE_XOPEN


69 
__fd_mask
 
	mfds_bôs
[
__FD_SETSIZE
 / 
__NFDBITS
];

70 
	#__FDS_BITS
(
£t
Ë((£t)->
fds_bôs
)

	)

72 
__fd_mask
 
	m__fds_bôs
[
__FD_SETSIZE
 / 
__NFDBITS
];

73 
	#__FDS_BITS
(
£t
Ë((£t)->
__fds_bôs
)

	)

75 } 
	tfd_£t
;

78 
	#FD_SETSIZE
 
__FD_SETSIZE


	)

80 #ifde‡
__USE_MISC


82 
__fd_mask
 
	tfd_mask
;

85 
	#NFDBITS
 
__NFDBITS


	)

90 
	#FD_SET
(
fd
, 
fd£ç
Ë
	`__FD_SET
 (fd, fd£ç)

	)

91 
	#FD_CLR
(
fd
, 
fd£ç
Ë
	`__FD_CLR
 (fd, fd£ç)

	)

92 
	#FD_ISSET
(
fd
, 
fd£ç
Ë
	`__FD_ISSET
 (fd, fd£ç)

	)

93 
	#FD_ZERO
(
fd£ç
Ë
	`__FD_ZERO
 (fd£ç)

	)

96 
__BEGIN_DECLS


106 
£À˘
 (
__nfds
, 
fd_£t
 *
__ª°ri˘
 
__ªadfds
,

107 
fd_£t
 *
__ª°ri˘
 
__wrôefds
,

108 
fd_£t
 *
__ª°ri˘
 
__ex˚±fds
,

109 
timevÆ
 *
__ª°ri˘
 
__timeout
);

111 #ifde‡
__USE_XOPEN2K


118 
p£À˘
 (
__nfds
, 
fd_£t
 *
__ª°ri˘
 
__ªadfds
,

119 
fd_£t
 *
__ª°ri˘
 
__wrôefds
,

120 
fd_£t
 *
__ª°ri˘
 
__ex˚±fds
,

121 c⁄° 
time•ec
 *
__ª°ri˘
 
__timeout
,

122 c⁄° 
__sig£t_t
 *
__ª°ri˘
 
__sigmask
);

127 #i‡
__USE_FORTIFY_LEVEL
 > 0 && 
deföed
 
__GNUC__


128 
	~<bôs/£À˘2.h
>

131 
	g__END_DECLS


	@/usr/include/sys/sysmacros.h

20 #i‚de‡
_SYS_SYSMACROS_H


21 
	#_SYS_SYSMACROS_H
 1

	)

23 
	~<„©uªs.h
>

28 #ifde‡
__GLIBC_HAVE_LONG_LONG


29 
__BEGIN_DECLS


31 
__exãnsi⁄__


32 
	$gnu_dev_maj‹
 (
__dev
)

33 
__THROW
 
__©åibuã_c⁄°__
;

34 
__exãnsi⁄__


35 
	$gnu_dev_mö‹
 (
__dev
)

36 
__THROW
 
__©åibuã_c⁄°__
;

37 
__exãnsi⁄__


38 
	$gnu_dev_makedev
 (
__maj‹
,

39 
__mö‹
)

40 
__THROW
 
__©åibuã_c⁄°__
;

42 #i‡
deföed
 
__GNUC__
 && __GNUC__ >2 && deföed 
__USE_EXTERN_INLINES


43 
__exãnsi⁄__
 
__exã∫_ölöe
 
__©åibuã_c⁄°__
 

44 
	`__NTH
 (
	$gnu_dev_maj‹
 (
__dev
))

46  ((
__dev
 >> 8) & 0xfff) | (() (__dev >> 32) & ~0xfff);

47 
	}
}

49 
__exãnsi⁄__
 
__exã∫_ölöe
 
__©åibuã_c⁄°__
 

50 
__NTH
 (
	$gnu_dev_mö‹
 (
__dev
))

52  (
__dev
 & 0xff) | (() (__dev >> 12) & ~0xff);

53 
	}
}

55 
__exãnsi⁄__
 
__exã∫_ölöe
 
__©åibuã_c⁄°__
 

56 
__NTH
 (
	$gnu_dev_makedev
 (
__maj‹
, 
__mö‹
))

58  ((
__mö‹
 & 0xffË| ((
__maj‹
 & 0xfff) << 8)

59 | (((Ë(
__mö‹
 & ~0xff)) << 12)

60 | (((Ë(
__maj‹
 & ~0xfff)) << 32));

61 
	}
}

63 
	g__END_DECLS


66 
	#maj‹
(
dev
Ë
	`gnu_dev_maj‹
 (dev)

	)

67 
	#mö‹
(
dev
Ë
	`gnu_dev_mö‹
 (dev)

	)

68 
	#makedev
(
maj
, 
mö
Ë
	`gnu_dev_makedev
 (maj, mö)

	)

	@/usr/include/time.h

22 #i‚def 
_TIME_H


24 #i‡(! 
deföed
 
__√ed_time_t
 && !deföed 
__√ed_˛ock_t
 && \

25 ! 
deföed
 
	g__√ed_time•ec
)

26 
	#_TIME_H
 1

	)

27 
	~<„©uªs.h
>

29 
	g__BEGIN_DECLS


33 #ifdef 
_TIME_H


35 
	#__√ed_size_t


	)

36 
	#__√ed_NULL


	)

37 
	~<°ddef.h
>

41 
	~<bôs/time.h
>

44 #i‡!
deföed
 
__STRICT_ANSI__
 && !deföed 
__USE_XOPEN2K


45 #i‚de‡
CLK_TCK


46 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

52 #i‡!
deföed
 
__˛ock_t_deföed
 && (deföed 
_TIME_H
 || deföed 
__√ed_˛ock_t
)

53 
	#__˛ock_t_deföed
 1

	)

55 
	~<bôs/ty≥s.h
>

57 
__BEGIN_NAMESPACE_STD


59 
__˛ock_t
 
	t˛ock_t
;

60 
	g__END_NAMESPACE_STD


61 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_POSIX
 || deföed 
__USE_MISC


62 
	$__USING_NAMESPACE_STD
(
˛ock_t
)

66 #unde‡
__√ed_˛ock_t


68 #i‡!
deföed
 
__time_t_deföed
 && (deföed 
_TIME_H
 || deföed 
__√ed_time_t
)

69 
	#__time_t_deföed
 1

	)

71 
	~<bôs/ty≥s.h
>

73 
__BEGIN_NAMESPACE_STD


75 
__time_t
 
	ttime_t
;

76 
__END_NAMESPACE_STD


77 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC
 || deföed 
__USE_SVID


78 
	$__USING_NAMESPACE_STD
(
time_t
)

82 #unde‡
__√ed_time_t


84 #i‡!
deföed
 
__˛ockid_t_deföed
 && \

85 ((
deföed
 
_TIME_H
 && deföed 
__USE_POSIX199309
Ë|| deföed 
__√ed_˛ockid_t
)

86 
	#__˛ockid_t_deföed
 1

	)

88 
	~<bôs/ty≥s.h
>

91 
__˛ockid_t
 
	t˛ockid_t
;

94 #unde‡
__˛ockid_time_t


96 #i‡!
deföed
 
__timî_t_deföed
 && \

97 ((
deföed
 
_TIME_H
 && deföed 
__USE_POSIX199309
Ë|| deföed 
__√ed_timî_t
)

98 
	#__timî_t_deföed
 1

	)

100 
	~<bôs/ty≥s.h
>

103 
__timî_t
 
	ttimî_t
;

106 #unde‡
__√ed_timî_t


109 #i‡(!
deföed
 
__time•ec_deföed
 \

110 && ((
deföed
 
_TIME_H
 \

111 && (
deföed
 
__USE_POSIX199309
 || deföed 
__USE_MISC
 \

112 || 
deföed
 
__USE_ISOC11
)) \

113 || 
deföed
 
__√ed_time•ec
))

114 
	#__time•ec_deföed
 1

	)

116 
	~<bôs/ty≥s.h
>

120 
	stime•ec


122 
__time_t
 
tv_£c
;

123 
__sysˇŒ_¶⁄g_t
 
tv_n£c
;

127 #unde‡
__√ed_time•ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mö
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_m⁄
;

140 
tm_yór
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd°
;

145 #ifdef 
__USE_BSD


146 
tm_gmtoff
;

147 c⁄° *
tm_z⁄e
;

149 
__tm_gmtoff
;

150 c⁄° *
__tm_z⁄e
;

153 
__END_NAMESPACE_STD


154 #i‡
deföed
 
__USE_XOPEN
 || deföed 
__USE_POSIX
 || deföed 
__USE_MISC


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifde‡
__USE_POSIX199309


161 
	sôimî•ec


163 
time•ec
 
ô_öãrvÆ
;

164 
time•ec
 
ô_vÆue
;

168 
sigevít
;

172 #ifde‡
__USE_XOPEN2K


173 #i‚de‡
__pid_t_deföed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_deföed


	)

180 #ifde‡
__USE_ISOC11


182 
	#TIME_UTC
 1

	)

186 
__BEGIN_NAMESPACE_STD


189 
˛ock_t
 
	$˛ock
 (Ë
__THROW
;

192 
time_t
 
	$time
 (
time_t
 *
__timî
Ë
__THROW
;

195 
	$dif·ime
 (
time_t
 
__time1
,Åime_à
__time0
)

196 
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

199 
time_t
 
	$mktime
 (
tm
 *
__ç
Ë
__THROW
;

205 
size_t
 
	$°r·ime
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

206 c⁄° *
__ª°ri˘
 
__f‹m©
,

207 c⁄° 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

208 
__END_NAMESPACE_STD


210 #ifde‡
__USE_XOPEN


213 *
	$°Ωtime
 (c⁄° *
__ª°ri˘
 
__s
,

214 c⁄° *
__ª°ri˘
 
__fmt
, 
tm
 *
__ç
)

215 
__THROW
;

218 #ifde‡
__USE_XOPEN2K8


221 
	~<xloˇÀ.h
>

223 
size_t
 
	$°r·ime_l
 (*
__ª°ri˘
 
__s
, 
size_t
 
__maxsize
,

224 c⁄° *
__ª°ri˘
 
__f‹m©
,

225 c⁄° 
tm
 *
__ª°ri˘
 
__ç
,

226 
__loˇÀ_t
 
__loc
Ë
__THROW
;

229 #ifde‡
__USE_GNU


230 *
	$°Ωtime_l
 (c⁄° *
__ª°ri˘
 
__s
,

231 c⁄° *
__ª°ri˘
 
__fmt
, 
tm
 *
__ç
,

232 
__loˇÀ_t
 
__loc
Ë
__THROW
;

236 
__BEGIN_NAMESPACE_STD


239 
tm
 *
	$gmtime
 (c⁄° 
time_t
 *
__timî
Ë
__THROW
;

243 
tm
 *
	$loˇ…ime
 (c⁄° 
time_t
 *
__timî
Ë
__THROW
;

244 
__END_NAMESPACE_STD


246 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


249 
tm
 *
	$gmtime_r
 (c⁄° 
time_t
 *
__ª°ri˘
 
__timî
,

250 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

254 
tm
 *
	$loˇ…ime_r
 (c⁄° 
time_t
 *
__ª°ri˘
 
__timî
,

255 
tm
 *
__ª°ri˘
 
__ç
Ë
__THROW
;

258 
__BEGIN_NAMESPACE_STD


261 *
	$as˘ime
 (c⁄° 
tm
 *
__ç
Ë
__THROW
;

264 *
	$˘ime
 (c⁄° 
time_t
 *
__timî
Ë
__THROW
;

265 
__END_NAMESPACE_STD


267 #i‡
deföed
 
__USE_POSIX
 || deföed 
__USE_MISC


272 *
	$as˘ime_r
 (c⁄° 
tm
 *
__ª°ri˘
 
__ç
,

273 *
__ª°ri˘
 
__buf
Ë
__THROW
;

276 *
	$˘ime_r
 (c⁄° 
time_t
 *
__ª°ri˘
 
__timî
,

277 *
__ª°ri˘
 
__buf
Ë
__THROW
;

282 *
__tz«me
[2];

283 
__daylight
;

284 
__timez⁄e
;

287 #ifdef 
__USE_POSIX


289 *
tz«me
[2];

293 
	$tz£t
 (Ë
__THROW
;

296 #i‡
deföed
 
__USE_SVID
 || deföed 
__USE_XOPEN


297 
daylight
;

298 
timez⁄e
;

301 #ifde‡
__USE_SVID


304 
	$°ime
 (c⁄° 
time_t
 *
__whí
Ë
__THROW
;

310 
	#__i¶óp
(
yór
) \

311 ((
yór
Ë% 4 =0 && ((yórË% 100 !0 || (yórË% 400 =0))

	)

314 #ifde‡
__USE_MISC


319 
time_t
 
	$timegm
 (
tm
 *
__ç
Ë
__THROW
;

322 
time_t
 
	$timñoˇl
 (
tm
 *
__ç
Ë
__THROW
;

325 
	$dysize
 (
__yór
Ë
__THROW
 
	`__©åibuã__
 ((
__c⁄°__
));

329 #ifde‡
__USE_POSIX199309


334 
	`«no¶ìp
 (c⁄° 
time•ec
 *
__ªque°ed_time
,

335 
time•ec
 *
__ªmaöög
);

339 
	$˛ock_gëªs
 (
˛ockid_t
 
__˛ock_id
, 
time•ec
 *
__ªs
Ë
__THROW
;

342 
	$˛ock_gëtime
 (
˛ockid_t
 
__˛ock_id
, 
time•ec
 *
__ç
Ë
__THROW
;

345 
	$˛ock_£âime
 (
˛ockid_t
 
__˛ock_id
, c⁄° 
time•ec
 *
__ç
)

346 
__THROW
;

348 #ifde‡
__USE_XOPEN2K


353 
	`˛ock_«no¶ìp
 (
˛ockid_t
 
__˛ock_id
, 
__Êags
,

354 c⁄° 
time•ec
 *
__ªq
,

355 
time•ec
 *
__ªm
);

358 
	$˛ock_gë˝u˛ockid
 (
pid_t
 
__pid
, 
˛ockid_t
 *
__˛ock_id
Ë
__THROW
;

363 
	$timî_¸óã
 (
˛ockid_t
 
__˛ock_id
,

364 
sigevít
 *
__ª°ri˘
 
__evp
,

365 
timî_t
 *
__ª°ri˘
 
__timîid
Ë
__THROW
;

368 
	$timî_dñëe
 (
timî_t
 
__timîid
Ë
__THROW
;

371 
	$timî_£âime
 (
timî_t
 
__timîid
, 
__Êags
,

372 c⁄° 
ôimî•ec
 *
__ª°ri˘
 
__vÆue
,

373 
ôimî•ec
 *
__ª°ri˘
 
__ovÆue
Ë
__THROW
;

376 
	$timî_gëtime
 (
timî_t
 
__timîid
, 
ôimî•ec
 *
__vÆue
)

377 
__THROW
;

380 
	$timî_gëovîrun
 (
timî_t
 
__timîid
Ë
__THROW
;

384 #ifde‡
__USE_ISOC11


386 
	$time•ec_gë
 (
time•ec
 *
__ts
, 
__ba£
)

387 
__THROW
 
	`__n⁄nuŒ
 ((1));

391 #ifde‡
__USE_XOPEN_EXTENDED


403 
gëd©e_îr
;

412 
tm
 *
	`gëd©e
 (c⁄° *
__°rög
);

415 #ifde‡
__USE_GNU


426 
	`gëd©e_r
 (c⁄° *
__ª°ri˘
 
__°rög
,

427 
tm
 *
__ª°ri˘
 
__ªsbuÂ
);

430 
__END_DECLS


	@/usr/include/bits/select.h

18 #i‚de‡
_SYS_SELECT_H


22 
	~<bôs/w‹dsize.h
>

25 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

27 #i‡
__WORDSIZE
 == 64

28 
	#__FD_ZERO_STOS
 "°osq"

	)

30 
	#__FD_ZERO_STOS
 "°o¶"

	)

33 
	#__FD_ZERO
(
fd•
) \

35 
__d0
, 
__d1
; \

36 
__asm__
 
	`__vﬁ©ûe__
 ("˛d;Ñï; " 
__FD_ZERO_STOS
 \

37 : "=c" (
__d0
), "=D" (
__d1
) \

38 : "a" (0), "0" ( (
fd_£t
) \

39 /  (
__fd_mask
)), \

40 "1" (&
	`__FDS_BITS
 (
fd•
)[0]) \

42 } 0)

	)

48 
	#__FD_ZERO
(
£t
) \

50 
__i
; \

51 
fd_£t
 *
__¨r
 = (
£t
); \

52 
__i
 = 0; __ò<  (
fd_£t
Ë/  (
__fd_mask
); ++__i) \

53 
	`__FDS_BITS
 (
__¨r
)[
__i
] = 0; \

54 } 0)

	)

58 
	#__FD_SET
(
d
, 
£t
) \

59 ((Ë(
	`__FDS_BITS
 (
£t
)[
	`__FD_ELT
 (
d
)] |
	`__FD_MASK
 (d)))

	)

60 
	#__FD_CLR
(
d
, 
£t
) \

61 ((Ë(
	`__FDS_BITS
 (
£t
)[
	`__FD_ELT
 (
d
)] &~
	`__FD_MASK
 (d)))

	)

62 
	#__FD_ISSET
(
d
, 
£t
) \

63 ((
	`__FDS_BITS
 (
£t
)[
	`__FD_ELT
 (
d
)] & 
	`__FD_MASK
 (d)Ë!0)

	)

	@/usr/include/bits/select2.h

19 #i‚de‡
_SYS_SELECT_H


24 
__fdñt_chk
 (
__d
);

25 
	$__fdñt_w¨n
 (
__d
)

26 
	`__w¨«âr
 ("bit outside of fd_set selected");

27 #unde‡
__FD_ELT


28 
	#__FD_ELT
(
d
) \

29 
__exãnsi⁄__
 \

30 ({ 
__d
 = (
d
); \

31 (
	`__buûtö_c⁄°™t_p
 (
__d
) \

32 ? (0 <
__d
 && __d < 
__FD_SETSIZE
 \

33 ? (
__d
 / 
__NFDBITS
) \

34 : 
	`__fdñt_w¨n
 (
__d
)) \

35 : 
	`__fdñt_chk
 (
__d
)); 
	}
})

	)

	@/usr/include/bits/sigset.h

20 #i‚def 
_SIGSET_H_ty≥s


21 
	#_SIGSET_H_ty≥s
 1

	)

23 
	t__sig_©omic_t
;

27 
	#_SIGSET_NWORDS
 (1024 / (8 *  ()))

	)

30 
	m__vÆ
[
_SIGSET_NWORDS
];

31 } 
	t__sig£t_t
;

42 #i‡!
deföed
 
_SIGSET_H_‚s
 && deföed 
_SIGNAL_H


43 
	#_SIGSET_H_‚s
 1

	)

45 #i‚de‡
_EXTERN_INLINE


46 
	#_EXTERN_INLINE
 
__exã∫_ölöe


	)

50 
	#__sigmask
(
sig
) \

51 (((Ë1Ë<< (((
sig
Ë- 1Ë% (8 *  ())))

	)

54 
	#__sigw‹d
(
sig
Ë(((sigË- 1Ë/ (8 *  ()))

	)

56 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

57 
	#__sigem±y£t
(
£t
) \

58 (
	`__exãnsi⁄__
 ({ 
__˙t
 = 
_SIGSET_NWORDS
; \

59 
sig£t_t
 *
__£t
 = (
£t
); \

60 --
__˙t
 >0Ë
__£t
->
__vÆ
[__cnt] = 0; \

61 0; }))

	)

62 
	#__sigfûl£t
(
£t
) \

63 (
	`__exãnsi⁄__
 ({ 
__˙t
 = 
_SIGSET_NWORDS
; \

64 
sig£t_t
 *
__£t
 = (
£t
); \

65 --
__˙t
 >0Ë
__£t
->
__vÆ
[__cnt] = ~0UL; \

66 0; }))

	)

68 #ifde‡
__USE_GNU


72 
	#__sigi£m±y£t
(
£t
) \

73 (
	`__exãnsi⁄__
 ({ 
__˙t
 = 
_SIGSET_NWORDS
; \

74 c⁄° 
sig£t_t
 *
__£t
 = (
£t
); \

75 
__ªt
 = 
__£t
->
__vÆ
[--
__˙t
]; \

76 !
__ªt
 && --
__˙t
 >= 0) \

77 
__ªt
 = 
__£t
->
__vÆ
[
__˙t
]; \

78 
__ªt
 =0; }))

	)

79 
	#__sig™d£t
(
de°
, 
À·
, 
right
) \

80 (
	`__exãnsi⁄__
 ({ 
__˙t
 = 
_SIGSET_NWORDS
; \

81 
sig£t_t
 *
__de°
 = (
de°
); \

82 c⁄° 
sig£t_t
 *
__À·
 = (
À·
); \

83 c⁄° 
sig£t_t
 *
__right
 = (
right
); \

84 --
__˙t
 >= 0) \

85 
__de°
->
__vÆ
[
__˙t
] = (
__À·
->__val[__cnt] \

86 & 
__right
->
__vÆ
[
__˙t
]); \

87 0; }))

	)

88 
	#__sig‹£t
(
de°
, 
À·
, 
right
) \

89 (
	`__exãnsi⁄__
 ({ 
__˙t
 = 
_SIGSET_NWORDS
; \

90 
sig£t_t
 *
__de°
 = (
de°
); \

91 c⁄° 
sig£t_t
 *
__À·
 = (
À·
); \

92 c⁄° 
sig£t_t
 *
__right
 = (
right
); \

93 --
__˙t
 >= 0) \

94 
__de°
->
__vÆ
[
__˙t
] = (
__À·
->__val[__cnt] \

95 | 
__right
->
__vÆ
[
__˙t
]); \

96 0; }))

	)

103 
__sigismembî
 (c⁄° 
__sig£t_t
 *, );

104 
__sigadd£t
 (
__sig£t_t
 *, );

105 
__sigdñ£t
 (
__sig£t_t
 *, );

107 #ifde‡
__USE_EXTERN_INLINES


108 
	#__SIGSETFN
(
NAME
, 
BODY
, 
CONST
) \

109 
_EXTERN_INLINE
 \

110 
	`NAME
 (
CONST
 
__sig£t_t
 *
__£t
, 
__sig
) \

112 
__mask
 = 
	`__sigmask
 (
__sig
); \

113 
__w‹d
 = 
	`__sigw‹d
 (
__sig
); \

114  
BODY
; \

115 }

	)

117 
__SIGSETFN
 (
__sigismembî
, (
__£t
->
__vÆ
[
__w‹d
] & 
__mask
) ? 1 : 0, const)

118 
__SIGSETFN
 (
__sigadd£t
, ((
__£t
->
__vÆ
[
__w‹d
] |
__mask
), 0), )

119 
__SIGSETFN
 (
__sigdñ£t
, ((
__£t
->
__vÆ
[
__w‹d
] &~
__mask
), 0), )

121 #unde‡
__SIGSETFN


	@/usr/include/bits/time.h

23 #i‡
deföed
 
__√ed_timevÆ
 || deföed 
__USE_GNU


24 #i‚de‡
_STRUCT_TIMEVAL


25 
	#_STRUCT_TIMEVAL
 1

	)

26 
	~<bôs/ty≥s.h
>

30 
	stimevÆ


32 
__time_t
 
	mtv_£c
;

33 
__su£c⁄ds_t
 
	mtv_u£c
;

38 #i‚de‡
__√ed_timevÆ


39 #i‚de‡
_BITS_TIME_H


40 
	#_BITS_TIME_H
 1

	)

48 
	#CLOCKS_PER_SEC
 1000000l

	)

50 #i‡(!
deföed
 
__STRICT_ANSI__
 || deföed 
__USE_POSIX
) \

51 && !
deföed
 
	g__USE_XOPEN2K


54 
	~<bôs/ty≥s.h
>

55 
__sysc⁄f
 ();

56 
	#CLK_TCK
 ((
__˛ock_t
Ë
	`__sysc⁄f
 (2)Ë

	)

59 #ifde‡
__USE_POSIX199309


61 
	#CLOCK_REALTIME
 0

	)

63 
	#CLOCK_MONOTONIC
 1

	)

65 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

67 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

69 
	#CLOCK_MONOTONIC_RAW
 4

	)

71 
	#CLOCK_REALTIME_COARSE
 5

	)

73 
	#CLOCK_MONOTONIC_COARSE
 6

	)

75 
	#CLOCK_BOOTTIME
 7

	)

77 
	#CLOCK_REALTIME_ALARM
 8

	)

79 
	#CLOCK_BOOTTIME_ALARM
 9

	)

82 
	#TIMER_ABSTIME
 1

	)

85 #ifde‡
__USE_GNU


86 
	~<bôs/timex.h
>

88 
__BEGIN_DECLS


91 
	$˛ock_adjtime
 (
__˛ockid_t
 
__˛ock_id
, 
timex
 *
__utx
Ë
__THROW
;

93 
__END_DECLS


99 #unde‡
__√ed_timevÆ


	@/usr/include/bits/timex.h

18 #i‚def 
_BITS_TIMEX_H


19 
	#_BITS_TIMEX_H
 1

	)

21 
	~<bôs/ty≥s.h
>

25 
	stimex


27 
	mmodes
;

28 
__sysˇŒ_¶⁄g_t
 
	moff£t
;

29 
__sysˇŒ_¶⁄g_t
 
	m‰eq
;

30 
__sysˇŒ_¶⁄g_t
 
	mmaxîr‹
;

31 
__sysˇŒ_¶⁄g_t
 
	me°îr‹
;

32 
	m°©us
;

33 
__sysˇŒ_¶⁄g_t
 
	mc⁄°™t
;

34 
__sysˇŒ_¶⁄g_t
 
	m¥ecisi⁄
;

35 
__sysˇŒ_¶⁄g_t
 
	mtﬁî™˚
;

36 
timevÆ
 
	mtime
;

37 
__sysˇŒ_¶⁄g_t
 
	mtick
;

38 
__sysˇŒ_¶⁄g_t
 
	mµs‰eq
;

39 
__sysˇŒ_¶⁄g_t
 
	mjôãr
;

40 
	mshi·
;

41 
__sysˇŒ_¶⁄g_t
 
	m°abû
;

42 
__sysˇŒ_¶⁄g_t
 
	mjô˙t
;

43 
__sysˇŒ_¶⁄g_t
 
	mˇl˙t
;

44 
__sysˇŒ_¶⁄g_t
 
	mîr˙t
;

45 
__sysˇŒ_¶⁄g_t
 
	m°b˙t
;

47 
	mèi
;

56 
	#ADJ_OFFSET
 0x0001

	)

57 
	#ADJ_FREQUENCY
 0x0002

	)

58 
	#ADJ_MAXERROR
 0x0004

	)

59 
	#ADJ_ESTERROR
 0x0008

	)

60 
	#ADJ_STATUS
 0x0010

	)

61 
	#ADJ_TIMECONST
 0x0020

	)

62 
	#ADJ_TAI
 0x0080

	)

63 
	#ADJ_MICRO
 0x1000

	)

64 
	#ADJ_NANO
 0x2000

	)

65 
	#ADJ_TICK
 0x4000

	)

66 
	#ADJ_OFFSET_SINGLESHOT
 0x8001

	)

67 
	#ADJ_OFFSET_SS_READ
 0xa001

	)

70 
	#MOD_OFFSET
 
ADJ_OFFSET


	)

71 
	#MOD_FREQUENCY
 
ADJ_FREQUENCY


	)

72 
	#MOD_MAXERROR
 
ADJ_MAXERROR


	)

73 
	#MOD_ESTERROR
 
ADJ_ESTERROR


	)

74 
	#MOD_STATUS
 
ADJ_STATUS


	)

75 
	#MOD_TIMECONST
 
ADJ_TIMECONST


	)

76 
	#MOD_CLKB
 
ADJ_TICK


	)

77 
	#MOD_CLKA
 
ADJ_OFFSET_SINGLESHOT


	)

78 
	#MOD_TAI
 
ADJ_TAI


	)

79 
	#MOD_MICRO
 
ADJ_MICRO


	)

80 
	#MOD_NANO
 
ADJ_NANO


	)

84 
	#STA_PLL
 0x0001

	)

85 
	#STA_PPSFREQ
 0x0002

	)

86 
	#STA_PPSTIME
 0x0004

	)

87 
	#STA_FLL
 0x0008

	)

89 
	#STA_INS
 0x0010

	)

90 
	#STA_DEL
 0x0020

	)

91 
	#STA_UNSYNC
 0x0040

	)

92 
	#STA_FREQHOLD
 0x0080

	)

94 
	#STA_PPSSIGNAL
 0x0100

	)

95 
	#STA_PPSJITTER
 0x0200

	)

96 
	#STA_PPSWANDER
 0x0400

	)

97 
	#STA_PPSERROR
 0x0800

	)

99 
	#STA_CLOCKERR
 0x1000

	)

100 
	#STA_NANO
 0x2000

	)

101 
	#STA_MODE
 0x4000

	)

102 
	#STA_CLK
 0x8000

	)

105 
	#STA_RONLY
 (
STA_PPSSIGNAL
 | 
STA_PPSJITTER
 | 
STA_PPSWANDER
 | \

106 
STA_PPSERROR
 | 
STA_CLOCKERR
 | 
STA_NANO
 | 
STA_MODE
 | 
STA_CLK
)

	)

	@
1
.
1
/usr/include
68
1679
alloc.c
alloc.h
daemon.c
daemon.h
dm-src.mod.c
header.h
lru.c
lru.h
metadata.c
metadata.h
raid.h
target.c
target.h
/usr/include/linux/random.h
/usr/include/linux/sched.h
/usr/include/linux/string.h
/usr/include/linux/types.h
/usr/include/linux/version.h
/usr/include/asm/types.h
/usr/include/linux/ioctl.h
/usr/include/linux/irqnr.h
/usr/include/linux/posix_types.h
/usr/include/string.h
/usr/include/asm-generic/types.h
/usr/include/asm/ioctl.h
/usr/include/asm/posix_types.h
/usr/include/bits/string.h
/usr/include/bits/string2.h
/usr/include/bits/string3.h
/usr/include/features.h
/usr/include/linux/stddef.h
/usr/include/xlocale.h
/usr/include/asm-generic/int-ll64.h
/usr/include/asm-generic/ioctl.h
/usr/include/asm/posix_types_32.h
/usr/include/asm/posix_types_64.h
/usr/include/asm/posix_types_x32.h
/usr/include/bits/types.h
/usr/include/endian.h
/usr/include/gnu/stubs.h
/usr/include/stdc-predef.h
/usr/include/stdlib.h
/usr/include/sys/cdefs.h
/usr/include/alloca.h
/usr/include/asm-generic/posix_types.h
/usr/include/asm/bitsperlong.h
/usr/include/bits/byteswap.h
/usr/include/bits/endian.h
/usr/include/bits/stdlib-float.h
/usr/include/bits/stdlib-ldbl.h
/usr/include/bits/stdlib.h
/usr/include/bits/typesizes.h
/usr/include/bits/waitflags.h
/usr/include/bits/waitstatus.h
/usr/include/bits/wordsize.h
/usr/include/gnu/stubs-64.h
/usr/include/sys/types.h
/usr/include/asm-generic/bitsperlong.h
/usr/include/bits/byteswap-16.h
/usr/include/bits/pthreadtypes.h
/usr/include/sys/select.h
/usr/include/sys/sysmacros.h
/usr/include/time.h
/usr/include/bits/select.h
/usr/include/bits/select2.h
/usr/include/bits/sigset.h
/usr/include/bits/time.h
/usr/include/bits/timex.h
